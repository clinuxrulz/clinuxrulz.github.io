import{h as Be,j as mt,D as mr,t as G,k as We,i as Y,l as De,g as _t,u as zt,s as Vt,d as wt,n as vr,libUrl as qt,S as Ue,q as yr,w as $t,x as Ze,y as q,z as Re,I as hr,T as pr,L as br,N as at,E as Sr,r as zr,A as kt,f as At,a as wr,e as xr,B as Pr,F as Er,G as Ir,H as Fr,EcsWorld as Cr}from"./lib-DZussN0N.js";import{O as Z,u as Oe,q as x,Z as $e,n as ke,W as Ae,l as F,K as ue,Y as te,c as U,p as J,N as ot,S as ve,s as ee,w as Dr,b as be,v as ct,J as me,m as ae,I as _r,Q as Xt,M as xe,h as vt,a as $r,g as kr,D as Yt,t as et,F as Ar}from"./dev-B9-ass9r.js";import{a as je,p as Tt}from"./dev-CC7pdsS5.js";import"./index-XNH-lkY3.js";import Tr from"./PixelEditor-Ba9pWbex.js";import Rr,{mountAutomergeFolderToMonacoVfsWhileMounted as Mr}from"./ScriptEditor-B6cFZPqT.js";import X,{ModuleKind as Or}from"typescript";import{solidjsUrl as Lr}from"./solid-js-C16mITwu.js";import{pixijsUrl as Nr}from"./pixi-js-CTVzrHHI.js";import{solidjsStoreUrl as Ur}from"./solid-js-store-D4PqY48D.js";import{e as Br,i as Wr}from"./index-3-HsNmx4.js";import Hr,{mountAutomergeFolderToCodeMirrorVfsWhileMounted as jr}from"./CodeMirror-8KfFX504.js";import"./ColourPicker-Bfj7Ag49.js";import"./FederatedEventTarget-DFQx8mKK.js";import"./Filter-BDK7ILDO.js";import"./State-3sV0XrC-.js";import"./CanvasTextSystem-BKHjFPHo.js";import"./colorToUniform-W8Zlj3HA.js";import"./SharedSystems-BwGi1NkL.js";import"./AnimatedSprite-CrPahPC5.js";import"./WebGLRenderer-DzfsPnmv.js";import"./WebGPURenderer-DziseXTR.js";function Kr(e){let t={},r=i=>{if(i=i.trim(),i.startsWith("/")||(i="/"+i),i.endsWith("/")&&(i=i.slice(0,i.length-1)),i=i.trim(),t[i]!=null){let n=t[i];return n.refCount++,Z(()=>{n.refCount--,n.refCount==0&&n.dispose()}),n.fileOrFolder}else{if(i==""){let{folder:y,dispose:m}=Oe(h=>({folder:e.rootFolder(),dispose:h}));t[i]={fileOrFolder:x(()=>Be({type:"Folder",value:y})),refCount:1,dispose:m};let a=t[i];return Z(()=>{a.refCount--,a.refCount==0&&a.dispose()}),t[i].fileOrFolder}let n=i.lastIndexOf("/")??0,o=i.slice(n+1),u=i.slice(0,n+1),c=r(u),{fileOrFolder:s,dispose:g}=Oe(y=>({fileOrFolder:x(()=>{let a=c();if(a.type!="Success")return a;let h=a.value;if(h.type!="Folder")return mt("Tried to read a file like it was a folder");let P=h.value();if(P.type!="Success")return P;let C=P.value,O=C.contents.find(Q=>Q.name==o);if(O==null)return mt("File or folder not found");let $=O,re;switch($.type){case"File":{re={type:"File",value:C.openFileById($.id)};break}case"Folder":{re={type:"Folder",value:C.openFolderById($.id)};break}}return Be(re)}),dispose:y}));t[i]={fileOrFolder:s,refCount:1,dispose:g};let f=t[i];return Z(()=>{f.refCount--,f.refCount==0&&f.dispose()}),t[i].fileOrFolder}};e.rootFolder();function l(i,n){let o=r(i)();if(o.type=="Pending")return n?.withFileTypes?[{type:"File",path:"Loading..."}]:["Loading..."];if(o.type=="Failed")return n?.withFileTypes?[{type:"File",path:"Error"}]:["Error"];let u=o.value;if(u.type!="Folder")return[];let c=u.value();if(c.type=="Pending")return n?.withFileTypes?[{type:"File",path:"Loading..."}]:["Loading..."];if(c.type=="Failed")return n?.withFileTypes?[{type:"File",path:"Error"}]:["Error"];let g=c.value.contents;return n?.withFileTypes?g.map(f=>{let y;switch(f.type){case"File":y="file";break;case"Folder":y="dir";break}return{type:y,path:(i!=""&&i!="/"?i+"/":i)+f.name}}):g.map(f=>(i!=""&&i!="/"?i+"/":i)+f.name)}return{exists(i){return r(i)().type=="Success"},getType(i){let o=r(i)();if(o.type!="Success")return"file";switch(o.value.type){case"File":return"file";case"Folder":return"dir"}},readdir:l,mkdir(i,n){throw new Error("TODO")},readFile(i){throw new Error("TODO")},rename(i,n){throw new Error("TODO")},rm(i,n){throw new Error("TODO")},writeFile(i,n){throw new Error("TODO")}}}var Qe=new Map,xt=(e,t)=>{if(Qe.has(e))return Qe.get(e);const r=ke(t);return Qe.set(e,r),r},Pt=e=>{const t=Qe.get(e);if(t)return $e(t)},Gr=/((?:--)?(?:\w+-?)+)\s*:\s*([^;]*)/g;function Vr(e){const t={};let r;for(;r=Gr.exec(e);)t[r[1]]=r[2];return t}function Et(e,t){return typeof t=="string"&&(t=Vr(t)),{...e,...t}}var ze=(e,t)=>(e&&(typeof e=="function"?e(t):e[0](e[1],t)),t.defaultPrevented),qr=(e,t)=>{const r=e.compareDocumentPosition(t);return r&Node.DOCUMENT_POSITION_PRECEDING||r&Node.DOCUMENT_POSITION_CONTAINS?1:r&Node.DOCUMENT_POSITION_FOLLOWING||r&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:0},Rt=e=>typeof e=="function"?e():e,Xr=e=>(...t)=>{for(const r of e)r&&r(...t)},It=(...e)=>Xr(e),Yr=(...e)=>e.some(t=>!!t()),Jt=e=>typeof e=="function"&&e.length>0,tt=e=>e?"":void 0,Jr=e=>{const[t,r]=Ae(e,["as"]),l=x(()=>t.as??"div");return x(()=>{const n=l();switch(typeof n){case"function":return te(()=>n(r));case"string":return F(mr,ue({component:n},r))}})},Ft=Jr,Zr=e=>{let t,r=!1;return()=>r?t:(r=!0,t=x(e))},Zt=Zr;function Qr(e){const[t,r]=U(e.initialValue),l=()=>e.value?.()!==void 0,i=()=>l()?e.value?.():t();return[i,o=>te(()=>{let u;return typeof o=="function"?u=o(i()):u=o,Object.is(u,i())||(l()||r(u),e.onChange?.(u)),u})]}var en=Qr,tn=e=>{const[t,r]=U(0);J(()=>{const n=Rt(e.element);if(!n)return;i(n);const o=new ResizeObserver(l);o.observe(n),Z(()=>{o.disconnect()})});const l=([n])=>{i(n.target)},i=n=>{switch(Rt(e.dimension)){case"width":r(n.offsetWidth);break;case"height":r(n.offsetHeight);break}};return t},rn=tn,nn=G("<div data-corvu-resizable-handle-start-intersection>"),ln=G("<div data-corvu-resizable-handle-end-intersection>"),Qt=ke(),on=e=>e===void 0?Qt:xt(`resizable-${e}`),sn=e=>{if(e===void 0){const r=$e(Qt);if(!r)throw new Error("[corvu]: Resizable context not found. Make sure to wrap Resizable components in <Resizable.Root>");return r}const t=Pt(`resizable-${e}`);if(!t)throw new Error(`[corvu]: Resizable context with id "${e}" not found. Make sure to wrap Resizable components in <Resizable.Root contextId="${e}">`);return t},er=ke(),an=e=>e===void 0?er:xt(`resizable-internal-${e}`),tr=e=>{if(e===void 0){const r=$e(er);if(!r)throw new Error("[corvu]: Resizable context not found. Make sure to wrap Resizable components in <Resizable.Root>");return r}const t=Pt(`resizable-internal-${e}`);if(!t)throw new Error(`[corvu]: Resizable context with id "${e}" not found. Make sure to wrap Resizable components in <Resizable.Root contextId="${e}">`);return t},L=(e,t)=>{if(typeof e=="number")return e;if(!e.endsWith("px"))throw new Error(`[corvu] Sizes must be a number or a string ending with 'px'. Got ${e}`);return ie(parseFloat(e)/t)},He=e=>{const t=e.panels.filter(l=>!!(e.focusedElement.compareDocumentPosition(l.data.element)&Node.DOCUMENT_POSITION_PRECEDING)),r=e.panels.filter(l=>!!(e.focusedElement.compareDocumentPosition(l.data.element)&Node.DOCUMENT_POSITION_FOLLOWING));return[t,r]},cn=6,ie=e=>parseFloat(e.toFixed(cn)),yt=null,Ce=null,ne=0,dn={1:"e-resize",2:"w-resize",3:"ew-resize",4:"s-resize",8:"n-resize",12:"ns-resize",5:"se-resize",9:"ne-resize",6:"sw-resize",10:"nw-resize"},dt=null,Ct=()=>{if(!yt){Ce&&(dt=null,Ce.remove(),Ce=null);return}let e=dn[ne]??null;if(e===null)switch(yt){case"horizontal":e="col-resize";break;case"vertical":e="row-resize";break;case"both":e="move";break}e!==dt&&(dt=e,Ce||(Ce=document.createElement("style"),document.head.appendChild(Ce)),Ce.innerHTML=`*{cursor: ${e}!important;}`)},Mt=(e,t)=>{switch(e){case"horizontal":t===1?(ne|=1,ne&=-3):t===2?(ne|=2,ne&=-2):t===3?ne|=3:ne&=-4;break;case"vertical":t===1?(ne|=4,ne&=-9):t===2?(ne|=8,ne&=-5):t===3?ne|=12:ne&=-13;break}Ct()},un=()=>{ne=0,Ct()},ht=e=>{yt=e,Ct()},Ot=e=>{if(ie(e.distributablePercentage)!==ie(e.desiredPercentage)){let t=null;e.betweenCollapse===!0?t=3:e.desiredPercentage<e.distributablePercentage&&e.revertConstraints!==!0||e.desiredPercentage>e.distributablePercentage&&e.revertConstraints===!0?t=1:t=2,Mt(e.orientation,t)}else Mt(e.orientation,0)},Se=[],_e=null,rr=null,fn=1,Ve=(e,t)=>Math.abs(e-t)<=fn,gn=e=>{Se.push(e);for(const t of Se)for(const r of Se){if(t.orientation===r.orientation||t.element===r.element)continue;const l=t.element.getBoundingClientRect(),i=r.element.getBoundingClientRect();if(t.orientation==="horizontal"&&(l.left>i.right||l.right<i.left)||t.orientation==="vertical"&&(l.top>i.bottom||l.bottom<i.top))continue;const n=t.orientation==="horizontal"?Ve(l.top,i.bottom):Ve(l.left,i.right),o=t.orientation==="horizontal"?Ve(l.bottom,i.top):Ve(l.right,i.left);n&&t.startIntersection.setHandle(r),o&&t.endIntersection.setHandle(r)}return{onDragStart:(t,r)=>vn(e,t,r),onHoveredChange:t=>{rr=t;const r=!!_e;let l=null;be(()=>{switch(t){case"handle":{const i=e.startIntersection.handle(),n=e.endIntersection.handle();r||(e.setActive(!0),i?.setActive(!1),n?.setActive(!1)),i?.setHoveredAsIntersection(!1),n?.setHoveredAsIntersection(!1),l=e.orientation;break}case"startIntersection":{const i=e.startIntersection.handle();r||i?.setActive(!0),i?.setHoveredAsIntersection(!0),l="both";break}case"endIntersection":{const i=e.endIntersection.handle();r||i?.setActive(!0),i?.setHoveredAsIntersection(!0),l="both";break}case null:{const i=e.startIntersection.handle(),n=e.endIntersection.handle();!r&&!e.focused()&&(e.setActive(!1),i?.setActive(!1),n?.setActive(!1)),i?.setHoveredAsIntersection(!1),n?.setHoveredAsIntersection(!1),l=null;break}}!r&&e.handleCursorStyle()&&ht(l)})}}},mn=e=>{Se.splice(Se.indexOf(e),1)},vn=(e,t,r)=>{_e={x:t.clientX,y:t.clientY},be(()=>{e.setDragging(!0),r==="startIntersection"&&e.startIntersection.handle()?.setDragging(!0),r==="endIntersection"&&e.endIntersection.handle()?.setDragging(!0)}),window.addEventListener("pointermove",nr),window.addEventListener("touchmove",ir),window.addEventListener("pointerup",Me),window.addEventListener("touchend",Me),window.addEventListener("contextmenu",Me)},nr=e=>lr(e.clientX,e.clientY,e.altKey),ir=e=>{e.touches[0]&&lr(e.touches[0].clientX,e.touches[0].clientY,e.altKey)},Lt=!1,lr=(e,t,r)=>{if(_e){Se.some(l=>l.dragging()&&l.altKey==="only")&&(r=!0),Se.some(l=>l.dragging()&&l.altKey===!1)&&(r=!1),Lt!==r&&(_e={x:e,y:t},Lt=r);for(const l of Se)l.dragging()&&l.onDrag(l.orientation==="horizontal"?e-_e.x:t-_e.y,r)}},Me=e=>{be(()=>{for(const t of Se)t.dragging()?(t.setDragging(!1),t.onDragEnd(e),!t.hovered()&&!t.hoveredAsIntersection()&&t.setActive(!1),!rr&&t.handleCursorStyle()&&ht(null)):Yr(t.hovered,t.focused,t.hoveredAsIntersection)&&(t.setActive(!0),t.handleCursorStyle()&&ht(t.orientation))}),un(),_e=null,window.removeEventListener("pointermove",nr),window.removeEventListener("touchmove",ir),window.removeEventListener("pointerup",Me),window.removeEventListener("touchend",Me),window.removeEventListener("contextmenu",Me)},yn=e=>{const t=ue({startIntersection:!0,endIntersection:!0,altKey:!0},e),[r,l]=Ae(t,["startIntersection","endIntersection","altKey","onHandleDragStart","onHandleDrag","onHandleDragEnd","contextId","ref","style","disabled","children","onMouseEnter","onMouseLeave","onKeyDown","onKeyUp","onFocus","onBlur","onPointerDown"]),[i,n]=U(null),[o,u]=U(!1),[c,s]=U(null),[g,f]=U(!1),[y,m]=U(!1),[a,h]=U(!1),[P,C]=U(null),[_,O]=U(null),$=x(()=>tr(r.contextId)),re=x(()=>{const z=i();if(!z)return;const d=$().panels(),[p,S]=He({panels:d,focusedElement:z}),w=p[p.length-1]?.data.id,b=S.reduce((I,D)=>I-L(D.data.minSize,$().rootSize()),1),v=p.reduce((I,D)=>I+L(D.data.minSize,$().rootSize()),0),E=p.reduce((I,D)=>I+L(D.size(),$().rootSize()),0);return{ariaControls:w,ariaValueMax:ie(b),ariaValueMin:ie(v),ariaValueNow:ie(E)}});let Q=null;return J(()=>{if(r.disabled===!0)return;const z=i();if(!z)return;const d={element:z,orientation:$().orientation(),handleCursorStyle:$().handleCursorStyle,altKey:r.altKey,startIntersection:{handle:P,setHandle:p=>{r.startIntersection===!0&&C(p)}},endIntersection:{handle:_,setHandle:p=>{r.endIntersection===!0&&O(p)}},hovered:c,focused:g,hoveredAsIntersection:o,setHoveredAsIntersection:u,active:y,setActive:m,dragging:a,setDragging:h,onDrag:(p,S)=>{if(r.onHandleDrag!==void 0){const w=new CustomEvent("drag",{cancelable:!0});if(r.onHandleDrag(w),w.defaultPrevented)return}$().onDrag(z,p,S)},onDragEnd:p=>{r.onHandleDragEnd?.(p),$().onDragEnd()}};Q=gn(d),Z(()=>{mn(d),Q=null})}),J(ot(c,()=>{Q?.onHoveredChange(c())})),F(Ft,ue({as:"button",ref(z){var d=It(n,r.ref);typeof d=="function"&&d(z)},get style(){return Et({position:"relative",cursor:$().handleCursorStyle()?"inherit":void 0,"touch-action":"none","flex-shrink":0},r.style)},get disabled(){return r.disabled},onBlur:z=>{ze(r.onBlur,z)||(f(!1),!c()&&m(!1))},onFocus:z=>{ze(r.onFocus,z)||c()||(f(!0),m(!0))},onKeyDown:z=>{if(ze(r.onKeyDown,z)||a())return;const d=i();if(!d)return;const p=r.altKey==="only"||r.altKey!==!1&&z.altKey;$().onKeyDown(d,z,p)},onKeyUp:z=>{ze(r.onKeyUp,z)||z.key!=="Tab"||f(!0)},onMouseEnter:z=>{ze(r.onMouseEnter,z)||r.disabled===!0||s("handle")},onMouseLeave:z=>{ze(r.onMouseLeave,z)||s(null)},onPointerDown:z=>{if(ze(r.onPointerDown,z)||ze(r.onHandleDragStart,z))return;const d=z.target;let p="handle";d.hasAttribute("data-corvu-resizable-handle-start-intersection")&&(p="startIntersection"),d.hasAttribute("data-corvu-resizable-handle-end-intersection")&&(p="endIntersection"),Q?.onDragStart(z,p)},role:"separator",get"aria-controls"(){return re()?.ariaControls},get"aria-orientation"(){return $().orientation()},get"aria-valuemax"(){return re()?.ariaValueMax},get"aria-valuemin"(){return re()?.ariaValueMin},get"aria-valuenow"(){return re()?.ariaValueNow},get"data-active"(){return tt(y())},get"data-dragging"(){return tt(a())},get"data-orientation"(){return $().orientation()},"data-corvu-resizable-handle":""},l,{get children(){return[F(ve,{get when(){return P()},get children(){var z=nn();return z.addEventListener("mouseleave",d=>{i()?.contains(d.relatedTarget)===!0?s("handle"):s(null)}),z.addEventListener("mouseenter",()=>s("startIntersection")),z.style.setProperty("position","absolute"),z.style.setProperty("aspect-ratio","1 / 1"),z.style.setProperty("top","0"),z.style.setProperty("left","0"),z.style.setProperty("z-index","1"),ee(d=>{var p=$().orientation()==="horizontal"?void 0:"100%",S=$().orientation()==="horizontal"?"100%":void 0,w=$().orientation()==="horizontal"?"translate3d(0, -100%, 0)":"translate3d(-100%, 0, 0)";return p!==d.e&&((d.e=p)!=null?z.style.setProperty("height",p):z.style.removeProperty("height")),S!==d.t&&((d.t=S)!=null?z.style.setProperty("width",S):z.style.removeProperty("width")),w!==d.a&&((d.a=w)!=null?z.style.setProperty("transform",w):z.style.removeProperty("transform")),d},{e:void 0,t:void 0,a:void 0}),z}}),x(()=>r.children),F(ve,{get when(){return _()},get children(){var z=ln();return z.addEventListener("mouseleave",d=>{i()?.contains(d.relatedTarget)===!0?s("handle"):s(null)}),z.addEventListener("mouseenter",()=>s("endIntersection")),z.style.setProperty("position","absolute"),z.style.setProperty("aspect-ratio","1 / 1"),z.style.setProperty("bottom","0"),z.style.setProperty("right","0"),z.style.setProperty("z-index","1"),ee(d=>{var p=$().orientation()==="horizontal"?void 0:"100%",S=$().orientation()==="horizontal"?"100%":void 0,w=$().orientation()==="horizontal"?"translate3d(0, 100%, 0)":"translate3d(100%, 0, 0)";return p!==d.e&&((d.e=p)!=null?z.style.setProperty("height",p):z.style.removeProperty("height")),S!==d.t&&((d.t=S)!=null?z.style.setProperty("width",S):z.style.removeProperty("width")),w!==d.a&&((d.a=w)!=null?z.style.setProperty("transform",w):z.style.removeProperty("transform")),d},{e:void 0,t:void 0,a:void 0}),z}})]}}))},hn=yn,or=ke(),pn=e=>e===void 0?or:xt(`resizable-panel-${e}`),bn=e=>{if(e===void 0){const r=$e(or);if(!r)throw new Error("[corvu]: Resizable panel context not found. Make sure to call usePanelContext under <Resizable.Panel>");return r}const t=Pt(`resizable-panel-${e}`);if(!t)throw new Error(`[corvu]: Resizable context with id "${e}" not found. Make sure to call usePanelContext under <Resizable.Panel contextId="${e}">`);return t},Sn=e=>{const t=ue({initialSize:null,minSize:0,maxSize:1,collapsible:!1,collapsedSize:0,collapseThreshold:.05,panelId:Dr()},e),[r,l]=Ae(t,["initialSize","minSize","maxSize","collapsible","collapsedSize","collapseThreshold","onResize","onCollapse","onExpand","contextId","panelId","ref","style","children"]),[i,n]=U(null),o=x(()=>tr(r.contextId)),[u,c]=U(null);J(()=>{const _=i();if(!_)return;const O=o(),$=te(()=>O.registerPanel({id:r.panelId,element:_,initialSize:r.initialSize,minSize:r.minSize,maxSize:r.maxSize,collapsible:r.collapsible,collapsedSize:r.collapsedSize,collapseThreshold:r.collapseThreshold,onResize:r.onResize}));c($),Z(()=>{O.unregisterPanel($.data.id)})});const s=()=>{const _=u();return _?_.size():typeof r.initialSize=="number"?r.initialSize:1},g=x(_=>{const O=u();if(r.collapsible!==!0)return!1;const $=O?O.size()===L(r.collapsedSize,o().rootSize()):!1;return O&&_!==$&&($&&r.onCollapse!==void 0?r.onCollapse(O.size()):!$&&r.onExpand!==void 0&&r.onExpand(O.size())),$}),f=(_,O)=>{const $=u();$&&$.resize(_,O??"both")},y=_=>{const O=u();O&&O.collapse(_??"both")},m=_=>{const O=u();O&&O.expand(_??"both")},a={get size(){return s()},get minSize(){return r.minSize},get maxSize(){return r.maxSize},get collapsible(){return r.collapsible},get collapsedSize(){return r.collapsedSize},get collapseThreshold(){return r.collapseThreshold},get collapsed(){return g()},resize:f,collapse:y,expand:m,get panelId(){return r.panelId}},h=Zt(()=>r.children),P=()=>{const _=h()();return Jt(_)?_(a):_};return x(()=>{const _=pn(r.contextId);return F(_.Provider,{value:{size:s,minSize:()=>r.minSize,maxSize:()=>r.maxSize,collapsible:()=>r.collapsible,collapsedSize:()=>r.collapsedSize,collapseThreshold:()=>r.collapseThreshold,collapsed:g,resize:f,collapse:y,expand:m,panelId:()=>r.panelId},get children(){return F(Ft,ue({as:"div",ref(O){var $=It(n,r.ref);typeof $=="function"&&$(O)},get style(){return Et({"flex-basis":s()*100+"%"},r.style)},get id(){return r.panelId},get"data-collapsed"(){return tt(g())},get"data-expanded"(){return tt(r.collapsible===!0&&!g())},get"data-orientation"(){return o().orientation()},"data-corvu-resizable-panel":""},l,{get children(){return te(()=>P())}}))}})})},zn=Sn,rt=e=>{let t=e.desiredPercentage>=0?1/0:-1/0,r=e.initialSizes;for(const l of e.resizeActions){const i=l.negate!==!0?e.desiredPercentage:-e.desiredPercentage;let[n,o,u]=nt({desiredPercentage:i,side:"preceding",panels:l.precedingPanels,initialSizes:r,initialSizesStartIndex:0,collapsible:e.collapsible,rootSize:e.resizableData.rootSize}),[c,s,g]=nt({desiredPercentage:i,side:"following",panels:l.followingPanels,initialSizes:r,initialSizesStartIndex:l.precedingPanels.length,collapsible:e.collapsible,rootSize:e.resizableData.rootSize});l.negate===!0&&(n=-n,c=-c),u&&(c=n),g&&(n=c),e.desiredPercentage>=0?t=Math.min(t,Math.min(n,c)):t=Math.max(t,Math.max(n,c)),r=[...o,...s]}return t},nt=e=>{e.desiredPercentage=ie(e.desiredPercentage);const t=wn({side:e.side,desiredPercentage:e.desiredPercentage});let r=0;const l=e.initialSizes.slice(e.initialSizesStartIndex,e.initialSizesStartIndex+e.panels.length);for(let m=e.side==="preceding"?e.panels.length-1:0;e.side==="preceding"?m>=0:m<e.panels.length;e.side==="preceding"?m--:m++){const a=e.panels[m],h=e.initialSizes[m+e.initialSizesStartIndex],P=L(a.data.collapsedSize??0,e.rootSize);if(a.data.collapsible&&h===P)continue;const C=ie(e.desiredPercentage-r);if(C===0)break;switch(t){case"precedingDecreasing":{const _=L(a.data.minSize,e.rootSize);l[m]=Math.max(_,h+C),r+=l[m]-h;break}case"followingDecreasing":{const _=L(a.data.minSize,e.rootSize);l[m]=Math.max(_,h-C),r-=l[m]-h;break}case"precedingIncreasing":{const _=L(a.data.maxSize,e.rootSize);l[m]=Math.min(_,h+C),r+=l[m]-h;break}case"followingIncreasing":{const _=L(a.data.maxSize,e.rootSize);l[m]=Math.min(_,h-C),r-=l[m]-h;break}}}if(r=ie(r),!e.collapsible||r===e.desiredPercentage)return[r,l,!1];const i=e.side==="preceding"?e.panels.length-1:0,n=e.panels[i];if(!n.data.collapsible)return[r,l,!1];const o=ie(e.desiredPercentage-r);let u=!1;const c=e.initialSizes[i+e.initialSizesStartIndex],s=L(n.data.minSize,e.rootSize),g=L(n.data.collapsedSize??0,e.rootSize),f=Math.min(L(n.data.collapseThreshold??0,e.rootSize),s-g),y=c===g;if(t==="precedingDecreasing"&&!y&&Math.abs(o)>=f)r-=l[i]-c,l[i]=g,r+=l[i]-c,u=!0;else if(t==="precedingIncreasing"&&y&&Math.abs(o)>=f){const m=L(n.data.minSize,e.rootSize);if(l[i]=m,Math.abs(o)>=m-g){const a=L(n.data.maxSize,e.rootSize);l[i]=Math.min(a,c+o)}else u=!0;r+=l[i]-c}else if(t==="followingDecreasing"&&!y&&Math.abs(o)>=f)r+=l[i]-c,l[i]=g,r-=l[i]-c,u=!0;else if(t==="followingIncreasing"&&y&&Math.abs(o)>=f){const m=L(n.data.minSize,e.rootSize);if(l[i]=m,Math.abs(o)>=m-g){const a=L(n.data.maxSize,e.rootSize);l[i]=Math.min(a,c-o)}else u=!0;r-=l[i]-c}return[r,l,u]},wn=e=>{switch(e.side){case"preceding":return e.desiredPercentage>=0?"precedingIncreasing":"precedingDecreasing";case"following":return e.desiredPercentage>=0?"followingDecreasing":"followingIncreasing"}},it=e=>{let t=e.initialSizes;for(const l of e.resizeActions){const[,i]=nt({desiredPercentage:l.deltaPercentage,side:"preceding",panels:l.precedingPanels,initialSizes:t,initialSizesStartIndex:0,collapsible:e.collapsible,rootSize:e.resizableData.rootSize}),[,n]=nt({desiredPercentage:l.deltaPercentage,side:"following",panels:l.followingPanels,initialSizes:t,initialSizesStartIndex:l.precedingPanels.length,collapsible:e.collapsible,rootSize:e.resizableData.rootSize});t=[...i,...n]}t=t.map(ie);const r=t.reduce((l,i)=>l+i,0);if(r!==1){const i=(r-1)/t.length;t=t.map(n=>n-i)}e.resizableData.setSizes(t.map(ie))},ut=e=>{let[t,r]=He({panels:e.panels,focusedElement:e.panel.data.element});const l=e.panels.indexOf(e.panel);if(l===0?e.strategy="following":l===e.panels.length-1&&(e.strategy="preceding"),e.strategy==="both"){const i=[...t,e.panel],n=[e.panel,...r],o=rt({desiredPercentage:e.deltaPercentage/2,initialSizes:e.initialSizes,collapsible:!0,resizeActions:[{precedingPanels:i,followingPanels:r},{precedingPanels:t,followingPanels:n,negate:!0}],resizableData:{rootSize:e.resizableData.rootSize}});it({initialSizes:e.initialSizes,collapsible:!0,resizeActions:[{precedingPanels:i,followingPanels:r,deltaPercentage:o},{precedingPanels:t,followingPanels:n,deltaPercentage:-o}],resizableData:e.resizableData})}else{t=e.strategy==="preceding"?t:[...t,e.panel],r=e.strategy==="following"?r:[e.panel,...r],e.strategy==="preceding"&&(e.deltaPercentage=-e.deltaPercentage);const i=rt({desiredPercentage:e.deltaPercentage,initialSizes:e.initialSizes,collapsible:e.collapsible,resizeActions:[{precedingPanels:t,followingPanels:r}],resizableData:{rootSize:e.resizableData.rootSize}});it({initialSizes:e.initialSizes,collapsible:!0,resizeActions:[{precedingPanels:t,followingPanels:r,deltaPercentage:i}],resizableData:e.resizableData})}},Nt=e=>{if(e.altKey&&e.panels.length>2){let t=e.panels.filter(m=>!!(e.handle.compareDocumentPosition(m.data.element)&Node.DOCUMENT_POSITION_PRECEDING)).length-1;const r=t===0;r&&(t++,e.deltaPercentage=-e.deltaPercentage);const l=e.panels[t],i=e.initialSizes[t],n=L(l.data.minSize,e.resizableData.rootSize)-i,o=L(l.data.maxSize,e.resizableData.rootSize)-i,u=Math.max(n,Math.min(e.deltaPercentage*2,o))/2,[c,s]=He({panels:e.panels,focusedElement:l.data.element}),g=[...c,l],f=[l,...s],y=rt({desiredPercentage:u,initialSizes:e.initialSizes,collapsible:!1,resizeActions:[{precedingPanels:g,followingPanels:s},{precedingPanels:c,followingPanels:f,negate:!0}],resizableData:{rootSize:e.resizableData.rootSize}});e.resizableData.handleCursorStyle===!0&&Ot({orientation:e.resizableData.orientation,desiredPercentage:e.deltaPercentage,distributablePercentage:y,revertConstraints:r}),it({initialSizes:e.initialSizes,collapsible:!1,resizeActions:[{precedingPanels:g,followingPanels:s,deltaPercentage:y},{precedingPanels:c,followingPanels:f,deltaPercentage:-y}],resizableData:e.resizableData})}else{const[t,r]=He({panels:e.panels,focusedElement:e.handle}),l=rt({desiredPercentage:e.deltaPercentage,initialSizes:e.initialSizes,collapsible:!0,resizeActions:[{precedingPanels:t,followingPanels:r}],resizableData:{rootSize:e.resizableData.rootSize}});if(it({initialSizes:e.initialSizes,collapsible:!0,resizeActions:[{precedingPanels:t,followingPanels:r,deltaPercentage:l}],resizableData:e.resizableData}),e.resizableData.handleCursorStyle){const i=ie(e.deltaPercentage),n=ie(l);let o=!1;const u=t[t.length-1];if(u.data.collapsible){const s=L(u.data.collapsedSize??0,e.resizableData.rootSize);(u.size()===s&&i>n||u.size()!==s&&i<n)&&(o=!0)}const c=r[0];if(c.data.collapsible){const s=L(c.data.collapsedSize??0,e.resizableData.rootSize);(c.size()===s&&i<n||c.size()!==s&&i>n)&&(o=!0)}Ot({orientation:e.resizableData.orientation,desiredPercentage:e.deltaPercentage,distributablePercentage:l,betweenCollapse:o})}}},xn=e=>{const t=ue({orientation:"horizontal",initialSizes:[],keyboardDelta:.1,handleCursorStyle:!0},e),[r,l]=Ae(t,["orientation","sizes","onSizesChange","initialSizes","keyboardDelta","handleCursorStyle","contextId","ref","style","children"]),[i,n]=en({value:()=>r.sizes,initialValue:[],onChange:r.onSizesChange}),[o,u]=U(null),c=rn({element:o,dimension:()=>r.orientation==="horizontal"?"width":"height"}),[s,g]=U([]),f=[],y=A=>{const T=s().filter(S=>!!(A.element.compareDocumentPosition(S.data.element)&Node.DOCUMENT_POSITION_PRECEDING)).length,k=f[T]===void 0||f[T]===A.id,K=i()[T]!==void 0;let z=null;A.initialSize!==null?z=L(A.initialSize,c()):r.initialSizes[T]!==void 0&&k&&(z=L(r.initialSizes[T],c())),z=z??.5,n(S=>{let w=[...S];const b=w.reduce((v,E)=>v+E,0);if((k&&!K||!k)&&b===1){const v=z/w.length;w=w.map(E=>E-v)}return k?(K||(w[T]=z),f[T]=A.id):(w.splice(T,0,z),f.splice(T,0,A.id)),w});const d=x(()=>{const S=f.indexOf(A.id);return i()[S]});J(()=>A.onResize?.(d()));const p={data:A,size:d,resize:(S,w)=>a(f.indexOf(A.id),S,w),collapse:S=>h(f.indexOf(A.id),S),expand:S=>P(f.indexOf(A.id),S)};return g(S=>{const w=[...S];return w.push(p),w.sort((b,v)=>qr(b.data.element,v.data.element)),w}),p},m=A=>{g(T=>T.filter(k=>k.data.id!==A));const M=f.indexOf(A);f.splice(M,1),n(T=>{let k=[...T];k.splice(M,1);const d=(k.reduce((p,S)=>p+S,0)-1)/k.length;return k=k.map(p=>p+d),k})};J(()=>{r.onSizesChange!==void 0&&r.onSizesChange(i())});const a=(A,M,T)=>{te(()=>{const k=s()[A];if(!k)return;const K=L(k.data.minSize,c()),z=L(k.data.maxSize,c()),d=L(M,c()),S=Math.max(K,Math.min(d,z))-i()[A];ut({deltaPercentage:S,strategy:T??"both",panel:k,panels:s(),initialSizes:s().map(w=>w.size()),collapsible:!1,resizableData:{rootSize:c(),orientation:r.orientation,setSizes:n}})})},h=(A,M)=>{te(()=>{const T=s()[A];if(!T)return;const k=i()[A],K=L(T.data.collapsedSize??0,c());if(!T.data.collapsible||k===K)return;const z=K-k;ut({deltaPercentage:z,strategy:M??"both",panel:T,panels:s(),initialSizes:s().map(d=>d.size()),collapsible:!0,resizableData:{rootSize:c(),orientation:r.orientation,setSizes:n}})})},P=(A,M)=>{te(()=>{const T=s()[A];if(!T)return;const k=i()[A],K=L(T.data.collapsedSize??0,c());if(!T.data.collapsible||k!==K)return;const d=L(T.data.minSize,c())-k;ut({deltaPercentage:d,strategy:M??"both",panel:T,panels:s(),initialSizes:s().map(p=>p.size()),collapsible:!0,resizableData:{rootSize:c(),orientation:r.orientation,setSizes:n}})})};let C=null,_=!1;const O=(A,M,T)=>{(C===null||_!==T)&&(C=s().map(k=>k.size()),_=T),Nt({deltaPercentage:M/c(),altKey:T,handle:A,panels:s(),initialSizes:C,resizableData:{rootSize:c(),handleCursorStyle:r.handleCursorStyle,orientation:r.orientation,setSizes:n}})},$=(A,M,T)=>{if(M.key==="Enter"){const[z,d]=He({panels:s(),focusedElement:A});let p=z[z.length-1];if((!p||!p.data.collapsible)&&(p=d[0],!p||!p.data.collapsible))return;const S=p.size(),w=L(p.data.collapsedSize??0,c());S===w?p.expand("following"):p.collapse("following");return}let k=null;if(r.orientation==="horizontal"&&M.key==="ArrowLeft"||r.orientation==="vertical"&&M.key==="ArrowUp"||M.key==="Home"?M.shiftKey||M.key==="Home"?k=-1:k=-L(r.keyboardDelta,c()):(r.orientation==="horizontal"&&M.key==="ArrowRight"||r.orientation==="vertical"&&M.key==="ArrowDown"||M.key==="End")&&(M.shiftKey||M.key==="End"?k=1:k=L(r.keyboardDelta,c())),k===null)return;M.preventDefault();const K=s().map(z=>z.size());Nt({deltaPercentage:k,altKey:T,handle:A,panels:s(),initialSizes:K,resizableData:{rootSize:c(),handleCursorStyle:!1,orientation:r.orientation,setSizes:n}})},re={get sizes(){return i()},setSizes:n,get orientation(){return r.orientation},get keyboardDelta(){return r.keyboardDelta},get handleCursorStyle(){return r.handleCursorStyle},resize:a,collapse:h,expand:P},Q=Zt(()=>r.children),Pe=()=>{const A=Q()();return Jt(A)?A(re):A};return x(()=>{const A=on(r.contextId),M=an(r.contextId);return F(A.Provider,{value:{sizes:i,setSizes:n,orientation:()=>r.orientation,keyboardDelta:()=>r.keyboardDelta,handleCursorStyle:()=>r.handleCursorStyle,resize:a,collapse:h,expand:P},get children(){return F(M.Provider,{value:{sizes:i,setSizes:n,orientation:()=>r.orientation,keyboardDelta:()=>r.keyboardDelta,handleCursorStyle:()=>r.handleCursorStyle,rootSize:c,panels:s,registerPanel:y,unregisterPanel:m,onDrag:O,onDragEnd:()=>C=null,onKeyDown:$,resize:a,collapse:h,expand:P},get children(){return F(Ft,ue({as:"div",ref(T){var k=It(u,r.ref);typeof k=="function"&&k(T)},get style(){return Et({display:"flex","flex-direction":r.orientation==="horizontal"?"row":"column"},r.style)},get"data-orientation"(){return r.orientation},"data-corvu-resizable-root":""},l,{get children(){return te(()=>Pe())}}))}})}})})},Pn=xn,En=Object.assign(Pn,{Panel:zn,Handle:hn,useContext:sn,usePanelContext:bn}),qe=En,In=G("<div><div>Select something from the menubar above");const Xe=()=>(()=>{var e=In(),t=e.firstChild;return e.style.setProperty("flex-grow","1"),t.style.setProperty("position","absolute"),t.style.setProperty("left","50%"),t.style.setProperty("top","50%"),t.style.setProperty("transform","translate(-50%,-50%)"),e})();var sr=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},B=(e,t,r)=>(sr(e,t,"read from private field"),r?r.call(e):t.get(e)),pt=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},Fn=(e,t,r,l)=>(sr(e,t,"write to private field"),t.set(e,r),r),we,ce,ge;const he={normalize(e){return e.replace(/^\/+/,"")},getParent(e){return e.split("/").slice(0,-1).join("/")},getName(e){return Cn(e.split("/"))},isAncestor(e,t){if(e===t)return!1;const r=e.split("/");return t.split("/").every((i,n)=>i===r[n])},rebase(e,t,r){return he.isAncestor(e,t)||e===t?e.replace(t,r):e},rename(e,t){return[...e.split("/").slice(0,-1),t].join("/")}};function Cn(e){return e[e.length-1]}const Dn=navigator.platform.startsWith("Mac"),_n=Dn?"metaKey":"ctrlKey",ft=Symbol("fallback");function Ut(e){for(const t of e)t.dispose()}function ar(e,t,r,l={}){const i=new Map;return Z(()=>Ut(i.values())),()=>{const o=e()||[];return o[$r],te(()=>{var u,c;if(!o.length)return Ut(i.values()),i.clear(),l.fallback?[Oe(m=>(i.set(ft,{dispose:m}),l.fallback()))]:[];const s=new Array(o.length),g=i.get(ft);if(!i.size||g){g?.dispose(),i.delete(ft);for(let y=0;y<o.length;y++){const m=o[y],a=t(m,y);n(s,m,y,a)}return s}const f=new Set(i.keys());for(let y=0;y<o.length;y++){const m=o[y],a=t(m,y);f.delete(a);const h=i.get(a);h?(s[y]=h.mapped,(u=h.setIndex)==null||u.call(h,y),h.setItem(()=>m)):n(s,m,y,a)}for(const y of f)(c=i.get(y))==null||c.dispose(),i.delete(y);return s})};function n(o,u,c,s){Oe(g=>{const[f,y]=U(u),m={setItem:y,dispose:g};if(r.length>1){const[a,h]=U(c);m.setIndex=h,m.mapped=r(f,a)}else m.mapped=r(f);i.set(s,m),o[c]=m.mapped})}}function $n(e){const{by:t}=e;return x(ar(()=>e.each,typeof t=="function"?t:r=>r[t],e.children,"fallback"in e?{fallback:()=>e.fallback}:void 0))}const kn=Yt?{equals:!1,name:"trigger"}:{equals:!1},An=Yt?{equals:!1,internal:!0}:kn;class Bt{constructor(t=Map){pt(this,we,void 0),Fn(this,we,new t)}dirty(t){var r;(r=B(this,we).get(t))==null||r.$$()}dirtyAll(){for(const t of B(this,we).values())t.$$()}track(t){if(!kr())return;let r=B(this,we).get(t);if(r)r.n++;else{const[l,i]=U(void 0,An);B(this,we).set(t,r={$:l,$$:i,n:1})}Z(()=>{--r.n===0&&queueMicrotask(()=>r.n===0&&B(this,we).delete(t))}),r.$()}}we=new WeakMap;const fe=Symbol("track-object");class Tn extends Map{constructor(t){if(super(),pt(this,ce,new Bt),pt(this,ge,new Bt),t)for(const r of t)super.set(...r)}[Symbol.iterator](){return this.entries()}get size(){return B(this,ce).track(fe),super.size}*keys(){B(this,ce).track(fe);for(const t of super.keys())yield t}*values(){B(this,ge).track(fe);for(const t of super.values())yield t}*entries(){B(this,ce).track(fe),B(this,ge).track(fe);for(const t of super.entries())yield t}forEach(t,r){B(this,ce).track(fe),B(this,ge).track(fe),super.forEach(t,r)}has(t){return B(this,ce).track(t),super.has(t)}get(t){return B(this,ge).track(t),super.get(t)}set(t,r){const l=!super.has(t),i=super.get(t)!==r,n=super.set(t,r);return(i||l)&&be(()=>{l&&(B(this,ce).dirty(fe),B(this,ce).dirty(t)),i&&(B(this,ge).dirty(fe),B(this,ge).dirty(t))}),n}delete(t){const r=super.get(t)!==void 0,l=super.delete(t);return l&&be(()=>{B(this,ce).dirty(fe),B(this,ge).dirty(fe),B(this,ce).dirty(t),r&&B(this,ge).dirty(t)}),l}clear(){super.size&&(super.clear(),be(()=>{B(this,ce).dirtyAll(),B(this,ge).dirtyAll()}))}}ce=new WeakMap;ge=new WeakMap;var Rn=G("<div>"),Wt=G("<button>"),cr=G("<span>"),Mn=G("<input>");const dr=ke();function Dt(){const e=$e(dr);if(!e)throw new Error("FileTreeContext is undefined");return e}const ur=ke();function st(){const e=$e(ur);if(!e)throw new Error("DirEntContext is undefined");return e}const fr=ke();function On(){const e=$e(fr);if(!e)throw new Error("IndentGuideContext is undefined");return e}function Ln(){const e=[],t=new Map,r=new Tn;let l=0;function i(s,g=1){const f={id:o(),refCount:g};return t.set(s,f),r.set(f.id,s),f}function n({oldPath:s,newPath:g}){const f=t.get(s);f&&(t.delete(s),t.set(g,f),r.set(f.id,g))}function o(){return e.pop()??(l++).toString()}function u(s){e.push(s)}function c(s){Z(()=>{s.refCount--,s.refCount<=0&&queueMicrotask(()=>{if(s.refCount>0)return;const g=r.get(s.id);u(s.id),r.delete(s.id),g&&t.delete(g)})})}return{beforeRename(s,g){const f=[{oldPath:s,newPath:g}];for(const y of t.keys())if(y.length>s.length&&y.slice(0,s.length)===s&&y[s.length]==="/"){const m=y.slice(s.length);f.push({oldPath:s+m,newPath:g+m})}f.forEach(n)},obtainId(s){let g=t.get(s);return g?g.refCount++:g=i(s),c(g),g.id},freezeId(s){const g=te(()=>r.get(s));if(g===void 0)return;const f=t.get(g);f!==void 0&&(f.refCount++,c(f))},idToPath(s){const g=r.get(s);if(g===void 0)throw new Error(`path not found for id: ${s}`);return g},pathToId(s,g=!0){let f=t.get(s);if(f===void 0){if(g)throw new Error(`node not found for path: ${s}`);f=i(s,0)}return f.id}}}function pe(e){const[t,r]=Ae(ue({base:""},e),["fs","base"]),{obtainId:l,freezeId:i,beforeRename:n,idToPath:o,pathToId:u}=Ln(),c=x(()=>l(t.base)),[s,g]=U(),f=ct(s);function y(b){g(b)}function m(b){s()===b&&g()}J(()=>{const b=s();b&&!e.fs.exists(o(b))&&g()});const[a,h]=U([],{equals:!1}),P=x(()=>Array.from(new Set(a().flat()))),C=ct(P,(b,v)=>v.includes(b));function _(b){h(v=>[...v,[b]])}function O(b){h(v=>v.map(E=>E.filter(I=>I!==b)))}function $(b){h(v=>{var E;if(v.length===0)return[[b]];if(v[v.length-1].length===0)return v[v.length-1]=[b],v;const D=v[v.length-1][0],N=z().findIndex(R=>R.id===D),V=z().findIndex(R=>R.id===b);return v[v.length-1]=z().slice(Math.min(N,V),Math.max(N,V)+1).map(R=>R.id),N>V&&((E=v[v.length-1])==null||E.reverse()),v})}function re(){h([])}J(me(P,b=>{J(()=>{e.fs.exists(o(b))||O(b)})}));const[Q,Pe]=U(new Array,{equals:!1}),Ee=ct(Q,(b,v)=>v.includes(b));function A(b){Pe(v=>v.filter(E=>E!==b))}function M(b){b!==c()&&!Q().includes(b)&&Pe(v=>[...v,b])}J(me(Q,b=>{J(()=>{e.fs.exists(o(b))||A(b)})}));const[T,k]=je({});function K(b){var v;return((v=T[b])==null?void 0:v.call(T))||[]}J(me(()=>[c(),...Q()],b=>{const v=x(ar(()=>e.fs.exists(o(b))?e.fs.readdir(o(b),{withFileTypes:!0}).map(I=>({id:l(I.path),type:I.type})):null,I=>I.id,I=>{const D=x(()=>d(o(I().id))),N=x(()=>he.getName(o(I().id)));return{id:I().id,get type(){return I().type},get path(){return o(I().id)},get indentation(){return D()},get name(){return N()},select(){_(I().id)},deselect(){O(I().id)},shiftSelect(){$(I().id)},get selected(){return C(I().id)},rename(V){p(o(I().id),V)},focus(){y(I().id)},blur(){m(I().id)},get focused(){return f(I().id)},get expand(){if(I().type!=="file")return()=>M(I().id)},get collapse(){if(I().type!=="file")return()=>A(I().id)},get expanded(){if(I().type!=="file")return Ee(I().id)}}})),E=x(()=>v().toSorted(e.sort??((I,D)=>I.type!==D.type?I.type==="dir"?-1:1:I.path.toLowerCase()<D.path.toLowerCase()?-1:1)));k(b,()=>E),Z(()=>k(b,void 0))}));const z=x(()=>{const b=new Array,v=[c()];for(;v.length>0;){const E=v.shift(),I=K(E);v.push(...I.filter(D=>D.type==="dir"&&D.expanded).map(D=>D.id)),b.splice(b.findIndex(D=>D.id===E)+1,0,...I)}return b});function d(b){return b.split("/").length-t.base.split("/").length}function p(b,v){be(()=>{var E;n(b,v),e.fs.rename(b,v),(E=e.onRename)==null||E.call(e,b,v)})}function S(b){const v=s();if(!v)throw new Error("Attempted to moveToPath without dirEnt focused");const E=u(b),D=(P().includes(v)?P():[v]).map(o),N=new Array;for(const R of D){if(R===b)throw new Error(`Cannot move ${R} into itself.`);if(he.isAncestor(b,R))throw new Error(`Cannot move because ${R} is ancestor of ${b}.`)}const V=D.sort((R,H)=>R.toLowerCase()<H.toLowerCase()?-1:1).map((R,H,j)=>{const W=j.slice(0,H).find(oe=>he.isAncestor(R,oe)),le=(W?[b,he.getName(W),R.replace(`${W}/`,"")]:[b,he.getName(R)]).filter(Boolean).join("/");return e.fs.exists(le)&&N.push({oldPath:R,newPath:le}),{oldPath:R,newPath:le,shouldRename:!W}});if(N.length>0)throw new Error(`Error while moving dirEnts. The following paths already exist:
${N.map(({newPath:R})=>R).join(`
`)}`);be(()=>{V.forEach(({oldPath:R,newPath:H,shouldRename:j})=>{j&&p(R,H)}),Ee(E)||M(E)})}const w={get fs(){return t.fs},get base(){return t.base},getDirEntsOfDirId:K,moveToPath:S,pathToId:u,expandDirById:M,collapseDirById:A,isDirExpandedById:Ee,selectDirEntById:_,deselectDirEntById:O,shiftSelectDirEntById:$,resetSelectedDirEntIds:re,focusDirEnt:y,blurDirEnt:m,isDirEntFocused:f};return ae(()=>P().forEach(i)),ae(()=>Q().forEach(i)),(()=>{var b=Rn();return We(b,ue(r,{onDragOver:v=>{var E;v.preventDefault(),(E=e.onDragOver)==null||E.call(e,v)},onDrop:v=>{var E;S(t.base),(E=e.onDrop)==null||E.call(e,v)},onPointerUp:v=>{var E;v.currentTarget===v.target&&re(),(E=e.onPointerUp)==null||E.call(e,v)}}),!1,!0),Y(b,F(dr.Provider,{value:w,get children(){return F($n,{get each(){return z()},by:v=>v.id,children:v=>F(ur.Provider,{value:v,get children(){return te(()=>e.children(v,w))}})})}})),b})()}pe.DirEnt=function(e){const t=ue({draggable:!0},e),r=Dt(),l=st(),i={ref(n){var o;J(()=>{l().focused&&n.focus()}),(o=e.ref)==null||o.call(e,n)},onKeyDown(n){var o;const u=l();switch(n.code){case"Space":u.type==="dir"?u.expanded?u.collapse():u.expand():(r.resetSelectedDirEntIds(),u.select());break}(o=e.onKeyDown)==null||o.call(e,n)},onPointerUp(n){var o;const u=l();be(()=>{n.shiftKey?l().shiftSelect():n[_n]?l().selected?l().deselect():l().select():(r.resetSelectedDirEntIds(),l().select()),u.type==="dir"&&(u.expanded?u.collapse():u.expand())}),(o=e.onPointerUp)==null||o.call(e,n)},onDragOver:n=>{var o;n.preventDefault(),(o=e.onDragOver)==null||o.call(e,n)},onDrop:n=>{var o;n.preventDefault(),n.stopPropagation();const u=l();u.type==="dir"?r.moveToPath(u.path):r.moveToPath(he.getParent(u.path)),(o=e.onDrop)==null||o.call(e,n)},onFocus(n){var o;l().focus(),(o=e.onFocus)==null||o.call(e,n)},onBlur(n){var o;l().blur(),(o=e.onBlur)==null||o.call(e,n)}};return F(ve,{get when(){return l().type==="dir"},get fallback(){return(()=>{var n=Wt();return We(n,ue(t,i),!1,!1),n})()},children:n=>F(ve,{get when(){return l().path},get children(){var o=Wt();return We(o,ue(t,i),!1,!0),Y(o,()=>e.children),o}})})};pe.IndentGuides=function(e){const t=st(),r=Dt();function l(o){const u=he.getParent(o);if(u===r.base)return!1;const c=r.getDirEntsOfDirId(r.pathToId(u));return c.findIndex(g=>g.path===o)===c.length-1}function i(o){return t().path.split("/").slice(0,o+2).join("/")}function n(o){const u=t().indentation-o===1;return u&&l(t().path)?"elbow":l(i(o))?"spacer":u?"tee":"pipe"}return F(_r,{get each(){return Array.from({length:t().indentation},(o,u)=>n(u))},children:o=>F(fr.Provider,{value:o,get children(){return e.render(o)}})})};pe.Expanded=function(e){const[,t]=Ae(e,["expanded","collapsed"]),r=st();return F(ve,{get when(){return r().type==="dir"},get children(){var l=cr();return We(l,t,!1,!0),Y(l,F(ve,{get when(){return r().expanded},get fallback(){return e.expanded},get children(){return e.collapsed}})),l}})};pe.Name=function(e){const t=st(),r=Dt();function l(i){const n=he.rename(t().path,i.value);if(n!==t().path){if(r.fs.exists(n))throw i.value=t().name,new Error(`Path ${n} already exists.`);t().rename(n),t().focus()}}return F(ve,{get when(){return e.editable},get fallback(){return(()=>{var i=cr();return Y(i,()=>t().name),ee(n=>{var o=e.class,u=e.style;return o!==n.e&&De(i,n.e=o),n.t=_t(i,u,n.t),n},{e:void 0,t:void 0}),i})()},get children(){var i=Mn();return i.addEventListener("blur",n=>{var o;r.fs.exists(t().path)&&l(n.currentTarget),(o=e.onBlur)==null||o.call(e,n)}),i.$$keydown=n=>{n.code==="Enter"&&l(n.currentTarget)},zt(n=>{Xt(()=>{n.focus();const o=n.value,u=o.indexOf("."),c=u===-1?o.length:u;n.setSelectionRange(0,c)})},i),Vt(i,"spellcheck",!1),ee(n=>{var o=e.class,u={all:"unset",...e.style};return o!==n.e&&De(i,n.e=o),n.t=_t(i,u,n.t),n},{e:void 0,t:void 0}),ee(()=>i.value=t().name),i}})};wt(["keydown"]);const Nn="defaults-module__container___jzd8f",Un="defaults-module__elbow___djaDw",Bn="defaults-module__pipe___hhrUb",Wn="defaults-module__arm___AjtFx",Le={container:Nn,elbow:Un,pipe:Bn,arm:Wn};var Ne=G("<span>");function Hn(e){const t=On();return(()=>{var r=Ne();return Y(r,F(vt,{get children(){return[F(xe,{get when(){return t()==="elbow"},get children(){var l=Ne();return ee(()=>De(l,Le.elbow)),l}}),F(xe,{get when(){return t()==="tee"},get children(){return[(()=>{var l=Ne();return ee(()=>De(l,Le.pipe)),l})(),(()=>{var l=Ne();return ee(()=>De(l,Le.arm)),l})()]}}),F(xe,{get when(){return t()==="pipe"},get children(){var l=Ne();return ee(()=>De(l,Le.pipe)),l}})]}})),ee(l=>{var i=Le.container,n=e.color,o=`${e.width}px`;return i!==l.e&&De(r,l.e=i),n!==l.t&&((l.t=n)!=null?r.style.setProperty("--color",n):r.style.removeProperty("--color")),o!==l.a&&((l.a=o)!=null?r.style.setProperty("width",o):r.style.removeProperty("width")),l},{e:void 0,t:void 0,a:void 0}),r})()}var jn=G("<div>");const Kn=e=>{let t=x(()=>Kr(e.vfs)),r=new vr,l=s=>r.get(s)?.()??!1,[i,n]=U(0),u=(()=>{var s=jn();return s.style.setProperty("width","100%"),s.style.setProperty("height","100%"),Y(s,F(ve,{get when(){return t()},children:g=>F(pe,{get fs(){return g()},style:{display:"grid",height:"100vh","align-content":"start"},children:f=>{ae(()=>{let a=f().path,h=()=>f().selected;ae(()=>{h()&&(n(P=>P+1),Z(()=>{n(P=>P-1)}))}),r.set(a,h),Z(()=>{r.get(a)===h&&r.delete(a)})});let[y,m]=U(!1);return F(pe.DirEnt,{get style(){return{"text-align":"left",display:"flex",margin:"0px",padding:"0px",border:"none",color:"white",background:f().selected?"blue":"none"}},get children(){return[F(pe.IndentGuides,{render:()=>F(Hn,{color:"white",width:15})}),F(pe.Expanded,{collapsed:"-",expanded:"+",style:{width:"15px","text-align":"center"}}),F(pe.Name,{get editable(){return y()},get style(){return{"margin-left":f().type==="file"?"7.5px":void 0}},onBlur:()=>m(!1)})]}})}})})),s})();return{fs:t,isSelected:l,selectionCount:i,Render:()=>u}};function bt(e){var t;return((t=e.split("/").slice(-1)[0])==null?void 0:t.split(".")[1])||""}function de(e){return e.replace(/^\/+/,"")}function St(e,t){const r=lt(e),l=r?e:new URL(e,"http://example.com/"),i=new URL(t,l);return de(r?i.href:i.pathname)}function lt(e){return e.startsWith("blob:")||e.startsWith("http:")||e.startsWith("https:")}function Gn(e,t){let r,l=()=>!r||r.state==="unresolved"?void 0:r.latest;[r]=et(()=>e(te(l)),n=>n,t);const i=()=>r();return Object.defineProperty(i,"latest",{get(){return r.latest}}),i}function Vn(e,t){const[r,l]=je({}),i={get(n){var o;return(o=r[n])==null?void 0:o.get()},invalidate(n){var o;return(o=r[n])==null?void 0:o.invalidate()},create(n){var o;return(o=r[n])==null?void 0:o.create()}};return J(me(()=>Object.keys(e()).filter(n=>e()[n]!==null),n=>{const o=bt(n),[u,c]=U(null,{equals:!1}),s=Gn(async()=>{var y,m;return((m=(y=t[o])==null?void 0:y.transform)==null?void 0:m.call(y,{path:n,source:e()[n],executables:i}))||e()[n]});function g(){var y;const m=s();if(!m)return;const a=new Blob([m],{type:`text/${((y=t[o])==null?void 0:y.type)||"plain"}`});return URL.createObjectURL(a)}const f=x(y=>(y&&URL.revokeObjectURL(y),u(),g()));l({[n]:{get:f,create:g,invalidate:c}}),Z(()=>l({[n]:void 0}))})),i}function Ye(e){return e.split("/").slice(0,-1).join("/")}function qn(e){const t=e.replace(/\*\*/g,".*").replace(/\*/g,"[^/]*").replace(/\?/g,".");return new RegExp(`^${t}$`)}function Xn(e){const[t,r]=je({}),l=Vn(()=>t,e),[i,n]=U(a=>{const h=qn(a);return P=>P.filter(C=>h.test(C))});function o(a,h){const P=x(()=>i()(a));J(me(()=>P()(m.getPaths()),C=>J(()=>h(C))))}function u(a){const h=a.split("/");if(!h.map((C,_)=>h.slice(0,_+1).join("/")).filter(Boolean).every(C=>C in t))throw`Path is invalid ${a}`;return!0}function c(a){if(t[a]===null)throw`Path is not a file: ${a}`}function s(a){return a=de(a),c(a),l.get(a)}function g(a){return a=de(a),c(a),l.invalidate(a)}function f(a){return a=de(a),c(a),l.create(a)}function y(a,h){return a=de(a),u(a),h?.withFileTypes?Object.entries(t).filter(([P])=>Ye(P)===a&&a!==P).map(([P,C])=>{var _;return{type:C===null?"dir":((_=e[bt(P)])==null?void 0:_.type)||"plain",path:P}}):Object.keys(t).filter(P=>Ye(P)===a)}const m={getExecutable:s,invalidateExecutable:g,createExecutable:f,getPaths:()=>Object.keys(t),getType(a){var h;return a=de(a),u(a),t[a]===null?"dir":((h=e[bt(a)])==null?void 0:h.type)||"plain"},readdir:y,mkdir(a,h){if(a=de(a),h?.recursive){const P=a.split("/");P.forEach((C,_)=>{r(P.slice(0,_+1).join("/"),null)});return}u(Ye(a)),r(a,null)},readFile(a){a=de(a);const h=t[a];if(h===null)throw`Path is not a file ${a}`;return h},rename(a,h){a=de(a),h=de(h),u(a),r(Tt(P=>{Object.keys(t).forEach(C=>{if(C.startsWith(a)){const _=C.replace(a,h);P[_]=P[C],delete P[C]}})}))},rm(a,h){if(a=de(a),(!h||!h.force)&&u(a),!h||!h.recursive){const P=Object.keys(l).filter(C=>C===a?!1:C.includes(a));if(P.length>0)throw`Directory is not empty ${P}`}r(Tt(P=>{Object.keys(P).filter(C=>C.includes(a)).forEach(C=>delete P[C])}))},writeFile(a,h){if(a=de(a),u(Ye(a)),t[a]===null)throw`A directory already exist with the same name: ${a}`;r(a,h)},watchExecutable(a,h){o(a,P=>h(m.getExecutable(P),P))},watchFile(a,h){o(a,P=>h(m.readFile(P),P))},watchDir(a,h){h(m.readdir(a,{withFileTypes:!0}),a)},watchPaths(a){J(()=>a(m.getPaths()))},setMatch:n};return m}function Yn(e,t){const r=X.createSourceFile("",e,X.ScriptTarget.Latest,!0,X.ScriptKind.TS);let l=!1;const i=X.transform(r,[o=>{const u=c=>{if((X.isImportDeclaration(c)||X.isExportDeclaration(c))&&c.moduleSpecifier&&X.isStringLiteral(c.moduleSpecifier)){const s=X.isImportDeclaration(c),g=c.moduleSpecifier.text,f=t(c.moduleSpecifier.text,s);if(f===null){l=!0;return}if(c.moduleSpecifier.text=f,g!==c.moduleSpecifier.text)return l=!0,s?X.factory.updateImportDeclaration(c,c.modifiers,c.importClause,X.factory.createStringLiteral(f),c.assertClause):X.factory.updateExportDeclaration(c,c.modifiers,!1,c.exportClause,X.factory.createStringLiteral(f),c.assertClause)}return X.visitEachChild(c,u,o)};return c=>X.visitNode(c,u)}]);return i.transformed[0]?l?X.createPrinter({newLine:X.NewLineKind.LineFeed}).printFile(i.transformed[0]):e:void 0}const Ht=typeof DOMParser<"u"?new DOMParser:void 0,jt=typeof XMLSerializer<"u"?new XMLSerializer:void 0;function Jn({path:e,source:t,executables:r}){if(!Ht||!jt)throw"`parseHtml` can only be used in environments where DOMParser and XMLSerializer are available. Please use `parseHtmlWorker` for a worker-friendly alternative.";const l=Ht.parseFromString(t,"text/html"),i={select(n,o){return Array.from(l.querySelectorAll(n)).forEach(o),i},bindLinkHref(){return i.select("link[href]",n=>{const o=n.getAttribute("href");if(lt(o))return;const u=r.get(St(e,o));u&&n.setAttribute("href",u)})},bindScriptSrc(){return i.select("script[src]",n=>{const o=n.getAttribute("src");if(lt(o))return;const u=r.get(St(e,n.getAttribute("src")));u&&n.setAttribute("src",u)})},transformModuleScriptContent(n){return i.select('script[type="module"]',o=>{o.type!=="module"||!o.textContent||(o.textContent=n({path:e,source:o.textContent,executables:r}))})},toString(){return jt.serializeToString(l)}};return i}const Zn=`<html>
    <head></head>
    <body style="background-color: black; color: lime; margin: 0;">
        <script type="module">
            import "./index.ts";
        <\/script>
    </body>
</html>
`,Qn=`// @ts-ignore
import * as _ecs from "ecs-lib@0.8.0-pre.2";
type Ecs = typeof import("ecs-lib");
const _ecs2 = _ecs as Ecs;
let world = new _ecs2.default();
let ecs = _ecs2.default;

type ECS = typeof world;

let sources = new Map<
  string,
  {
    url: string;
    code: Promise<{
      onUnload?: (ecsy: Ecs["default"], world: ECS) => void;
    }>;
  }
>();

window.addEventListener("message", (e) => {
  let msg = e.data;
  if (msg.type == "UpdateSource") {
    let path = msg.path;
    let url = msg.url;
    let code = import(url);
    sources.set(path, {
      url,
      code,
    });
  } else if (msg.type == "DisposeSource") {
    let path = msg.path;
    let node = sources.get(path);
    if (node != undefined) {
      sources.delete(path);
      (async () => {
        let code2 = await node.code;
        code2.onUnload?.(ecs, world);
      })();
    }
  }
});

document.body.append(document.createTextNode("Hello World!"));
`;var ei=G("<iframe style=flex-grow:1;>");let ti=await import(qt);console.log(ti);const ri=window.location.href,gt=new URL(ri),Je=gt.protocol+gt.host+gt.pathname;function ni(){const e=({path:t,source:r,executables:l})=>Yn(r,i=>{if(i=="prelude"){let n=qt;return n.startsWith("http:")||n.startsWith("https:")?n:(n.startsWith("/")&&(n=n.slice(1)),Je+n)}if(i=="prelude/solid-js"){let n=Lr;return n.startsWith("http:")||n.startsWith("https:")?n:(n.startsWith("/")&&(n=n.slice(1)),Je+n)}if(i=="prelude/solid-js/store"){let n=Ur;return n.startsWith("http:")||n.startsWith("https:")?n:(n.startsWith("/")&&(n=n.slice(1)),Je+n)}if(i=="prelude/pixi.js"){let n=Nr;return n.startsWith("http:")||n.startsWith("https:")?n:(n.startsWith("/")&&(n=n.slice(1)),Je+n)}if(i.startsWith(".")){const n=l.get(St(t,i));if(!n)throw"url is undefined";return n}else return lt(i)?i:`https://esm.sh/${i}`});return Xn({css:{type:"css"},js:{type:"javascript",transform:e},ts:{type:"javascript",transform({path:t,source:r,executables:l}){return e({path:t,source:X.transpile(r,{module:Or.ES2022}),executables:l})}},html:{type:"html",transform(t){return Jn(t).transformModuleScriptContent(e).bindScriptSrc().bindLinkHref().toString()}}})}const Kt=e=>{let[t,r]=U(),l=ni();l.writeFile("index.html",Zn),l.writeFile("index.ts",Qn);let i;{let c=x(()=>e.vfs.rootFolder());i=x(()=>c()())}let n;{let c=x(()=>{let s=i();if(s.type!="Success")return s;let g=s.value,f;for(let y of g.contents)if(y.name==Ue&&y.type=="Folder"){f=y.id;break}return f==null?mt("Source folder not found."):Be(g.openFolderById(f))});n=x(()=>{let s=c();return s.type!="Success"?s:s.value()})}let o;{let c=x(()=>{let s=n();if(s.type!="Success")return s;let g=s.value;return Be(x(me(()=>g.contents,f=>x(()=>{if(f.type=="File")return g.openFileById(f.id)}))))});o=x(()=>{let s=c();if(s.type!="Success")return s;let g=s.value(),f=[];for(let y of g){let m=y();if(m==null)continue;let a=m();if(a.type!="Success")return a;f.push(a.value)}return Be(f)})}let u=x(()=>{let c=o();return c.type=="Pending"?[]:c.type=="Failed"?(console.log(c.message),[]):c.value});return Xt(()=>{let c=x(()=>{let g=t();if(g==null)return;let f=g;if(f.contentWindow==null)return;let[m]=et(()=>new Promise(a=>{let h=()=>{f.removeEventListener("load",h),a(!0)};f.addEventListener("load",h)}));return m}),s=x(()=>c()?.()??!1);ae(()=>{if(!s())return;let g=t();if(g==null)return;let y=g.contentWindow;y!=null&&ae(ot(()=>e.vfsDocUrl,m=>{y.postMessage({type:"SetDocUrl",params:{docUrl:m}})}))}),l.mkdir("user_code"),ae(()=>{if(!s())return;let g=t();if(g==null)return;let y=g.contentWindow;y!=null&&ae(me(u,m=>{ae(()=>{let a="user_code/"+m.name(),h=m.doc.source;te(()=>l.writeFile(a,h)),Z(()=>{l.rm(a)}),ae(()=>{let P=l.getExecutable(a);P!=null&&(y.postMessage({type:"UpdateSource",url:P}),Z(()=>{y.postMessage({type:"DisposeSource",url:P})}))})})}))})}),(()=>{var c=ei(),s=r;return typeof s=="function"?zt(s,c):r=c,ee(()=>Vt(c,"src",l.getExecutable("index.html"))),c})()};var ii=G('<div><div><div>Select an example to load:</div><div><table class=table><thead></thead><tbody></tbody></table></div><button class="btn btn-primary">Load Example'),li=G("<tr><td>");const Gt={"Mario Clone":{skipPathCharCount:27,sources:Object.assign({}),data:Object.assign({})}},oi=e=>{let[t,r]=Ae(e,["vfs","onDone"]),[l,i]=je({selectedExampleByName:void 0});return(()=>{var n=ii(),o=n.firstChild,u=o.firstChild,c=u.nextSibling,s=c.firstChild,g=s.firstChild,f=g.nextSibling,y=c.nextSibling;return We(n,r,!1,!0),o.style.setProperty("width","100%"),o.style.setProperty("height","100%"),o.style.setProperty("display","flex"),o.style.setProperty("flex-direction","column"),o.style.setProperty("overflow","hidden"),c.style.setProperty("flex-grow","1"),c.style.setProperty("overflow-y","auto"),Y(f,F(Ar,{get each(){return Object.keys(Gt)},children:m=>{let a=x(()=>l.selectedExampleByName==m);return(()=>{var h=li(),P=h.firstChild;return h.$$click=()=>{i("selectedExampleByName",m)},h.style.setProperty("cursor","pointer"),Y(P,m),ee(C=>yr(h,{"hover:bg-base-300":!0,"bg-base-300":a()},C)),h})()}})),y.$$click=async()=>{if(l.selectedExampleByName==null)return;let m=Gt[l.selectedExampleByName];m!=null&&(await si(t.vfs,m),t.onDone())},ee(()=>y.disabled=l.selectedExampleByName==null),n})()};async function si(e,t){if(!window.confirm("Are you sure you want to load it?, (it will replace your current file system)"))return;let r;{let n=await new Promise(o=>{Oe(u=>{let c=e.rootFolder();ae(()=>{let s=c();if(s.type=="Pending")return;if(s.type=="Failed"){u(),o($t(s.message));return}let g=s.value;te(()=>{let f=g.contents;for(let y of f)g.removeFileOrFolderById(y.id)}),u(),o(Ze(g))})})});if(n.type=="Err")return n;r=n.value}let l=async(n,o)=>{if(o.length==0)return Ze({folder:n,cleanup:()=>{}});let u=o[0],c=o.slice(1),s=n.getOrCreateFolder(u);if(s.type=="Err")return s;let g=s.value.id;return new Promise(f=>{Oe(y=>{let m=n.openFolderById(g);ae(ot(m,a=>{if(a.type=="Pending")return;if(a.type=="Failed"){y(),f($t(a.message));return}let h=a.value;(async()=>{let P=await l(h,c);if(P.type=="Err"){y(),f(P);return}let C=P.value;f(Ze({folder:C.folder,cleanup:()=>{C.cleanup(),y()}}))})()}))})})},i=[];try{let n=new Map;for(let o of Object.entries({...t.sources,...t.data})){let u=o[0].slice(t.skipPathCharCount),c=o[1],s=u.split("/");if(s.length==0)continue;let f=s.slice(0,s.length-1).join("/"),y=n.get(f);if(y==null){let P=s.slice(0,s.length-1),C=await l(r,P);if(C.type=="Err"){console.log(C.message);continue}i.push(C.value.cleanup),y=C.value.folder,n.set(f,y)}let m=s[s.length-1],a;if(m.endsWith(".ts"))a={source:c};else if(m.endsWith(".json"))a=await(await fetch(c)).json();else if(m.endsWith(".png")){let C=await(await fetch(c)).blob();a={mimeType:C.type,data:new Uint8Array(await C.arrayBuffer())}}else continue;let h=y.createFile(m,a);h.type=="Err"&&console.log(h.message)}}finally{i.forEach(n=>n())}}wt(["click"]);var ai=G('<h3 class="text-lg font-bold">Connection Manager'),ci=G('<h3 class="text-lg font-bold">File Explorer'),di=G('<div><div style=margin-bottom:5px;><button class="btn btn-primary">New '),ui=G('<li><button class="btn btn-xs btn-secondary">Enable BNA'),fi=G('<div class="size-full rounded-sm transition-colors group-data-active:bg-corvu-300 group-data-dragging:bg-corvu-100">'),gi=G('<div><ul class="menu menu-horizontal bg-base-200 rounded-box"><li><i class="fa-solid fa-network-wired"></i></li><li><i class="fa-solid fa-folder-tree"></i></li><li><label><input type=checkbox class="checkbox checkbox-xs"style=display:inline-block;>Show Game</label></li><li><select class="select select-xs"><option value=monaco>Monaco</option><option value=codemirror>Code Mirror</option></select></li><li><button class="btn btn-xs btn-primary">Load Example...</button></li><li><i class="fa-solid fa-download"></i></li></ul><div>'),mi=G('<li><i class="fa-solid fa-upload"></i><input type=file hidden>'),vi=G('<div><div class="bg-base-200 rounded-box"><div class="bg-base-300 rounded-box"><div></div><button class="btn btn-primary"><i class="fa-solid fa-xmark"></i></button></div><div>');const Li=e=>{let[t,r]=je({showGame:!1,useCodeMirror:!1,overlayApp:void 0}),l=Kn({get vfs(){return e.vfs}}),i=x(()=>q(e.vfs)),n=()=>l.selectionCount(),o=x(()=>{if(n()==1){if(l.isSelected("images"))return"Images";if(l.isSelected("texture_atlases"))return"Texture Atlases";if(l.isSelected("levels"))return"Levels";if(l.isSelected(Ue))return"Source"}}),u=x(()=>{let d=i();if(d.type!="Success")return d;let p=d.value;return q(p.rootFolder())}),c=x(()=>{let d=u();return d.type!="Success"?d:d.value()}),s=d=>{let p=x(()=>{let S=c();if(S.type!="Success")return S;let w=S.value,b=x(()=>{let E=te(()=>w.getFolderId(d));if(E!=null)return q(E);let I=w.createFolder(d);return I.type=="Err"?Re(I.message):q(I.value.id)}),v=x(()=>{let E=b();if(E.type!="Success")return E;let I=E.value;return q(w.openFolderById(I))});return q(x(()=>{let E=v();return E.type!="Success"?E:E.value()}))});return x(()=>{let S=p();return S.type!="Success"?S:S.value()})},g=s(hr),f=s(pr),y=s(br),m=s(Ue);ae(ot(m,d=>{if(d.type!="Success")return;let p=d.value;Mr(p),jr(p)}));let a=x(()=>{if(n()!=1)return;let d=g();if(d.type!="Success")return;let S=d.value.contents;for(let w of S)if(w.type=="File"&&l.isSelected("images/"+w.name))return w.id}),h=x(()=>{if(n()!=1)return;let d=f();if(d.type!="Success")return;let S=d.value.contents;for(let w of S)if(w.type=="File"&&l.isSelected("texture_atlases/"+w.name))return w.id}),P=x(()=>{if(n()!=1)return;let d=y();if(d.type!="Success")return;let S=d.value.contents;for(let w of S)if(w.type=="File"&&l.isSelected("levels/"+w.name))return w.id}),C=x(()=>{if(n()!=1)return;let d=m();if(d.type!="Success")return;let S=d.value.contents;for(let w of S)if(w.type=="File"&&l.isSelected(Ue+"/"+w.name))return w.name});x(()=>{if(n()!=1)return;let d=m();if(d.type!="Success")return;let S=d.value.contents;for(let w of S)if(w.type=="File"&&l.isSelected(Ue+"/"+w.name))return w.id});const _=()=>{r("overlayApp",new at({Title:()=>ai(),View:()=>F(e.ConnectionManagementUi,{})}))},O=()=>{let d=y();if(d.type!="Success")return;let p=d.value,S=window.prompt("Enter name for level:");if(S==null||(S=S.trim(),S==""))return;S+=".json";let w=Fr.create({tileToShortIdTable:[],mapData:Array(10).fill(void 0).map(E=>Array(10).fill(void 0).map(I=>0))}),b=new Cr;b.createEntity([w]);let v=p.createFile(S,b.toJson());v.type!="Err"&&v.value.id},$=()=>{let d=m();if(d.type!="Success")return;let p=d.value,S=window.prompt("Enter name of source file:");if(S==null||(S=S.trim(),S==""))return;S+=".ts";let w=p.createFile(S,{source:""});w.type!="Err"&&w.value.id},re=()=>{r("overlayApp",new at({Title:()=>ci(),View:()=>(()=>{var d=di(),p=d.firstChild,S=p.firstChild;return S.firstChild,d.style.setProperty("flex-grow","1"),d.style.setProperty("display","flex"),d.style.setProperty("flex-direction","column"),S.$$click=()=>{let w=o();if(w!=null)switch(w){case"Images":break;case"Texture Atlases":break;case"Levels":O();break;case"Source":$();break}},Y(S,()=>{let w=o();if(w!=null)switch(w){case"Images":return"Image";case"Texture Atlases":return"Texture Atlas";case"Levels":return"Level";case"Source":return"Source"}},null),Y(d,F(l.Render,{}),null),ee(()=>S.disabled=o()==null),d})()}))},Q=()=>{r("overlayApp",new at({Title:()=>"Examples",View:()=>F(oi,{get vfs(){return e.vfs},onDone:async()=>{r("overlayApp",void 0),await e.flushRepo(),window.location.reload()}})}))};let Pe=x(()=>{let d=g();if(d.type!="Success")return;let p=d.value,S=a();if(S!=null)return p.openFileById(S)}),Ee=x(()=>{let d=Pe();if(d==null)return;let p=d();if(p.type=="Success")return p.value}),A=x(()=>{let d=Ee();if(d==null)return;let p=d.doc.mimeType,S=d.doc.data,w=new Blob([S],{type:p}),b=URL.createObjectURL(w);Z(()=>{URL.revokeObjectURL(b)});let[v]=et(()=>new Promise((E,I)=>{let D=new Image;D.src=b,D.onload=N=>{E(D)},D.onerror=N=>{I(N)}}));return v}),M=x(()=>A()?.()),T;{let d=x(()=>{let p=g();if(p.type!="Success")return p;let S=p.value,w=x(me(()=>S.contents,b=>x(()=>{if(b.type=="File")return S.openFileById(b.id)})));return q(x(()=>{let b=[],v=w();for(let E of v){let I=E();if(I==null)continue;let D=I();if(D.type!="Success")return D;b.push(D.value)}return q(b)}))});T=x(()=>{let p=d();return p.type!="Success"?p:p.value()})}let k;{let d=x(()=>{let v=f();if(v.type!="Success")return v;let E=v.value,I=x(me(()=>E.contents,D=>x(()=>{if(D.type=="File")return E.openFileById(D.id)})));return q(x(()=>{let D=[],N=I();for(let V of N){let R=V();if(R==null)continue;let H=R();if(H.type!="Success")return H;D.push(H.value)}return q(D)}))}),p=x(()=>{let v=T();if(v.type!="Success")return v;let E=v.value,I=new Map;for(let D of E)I.set(D.name(),D);return q(I)}),S=x(()=>{let v=d();return v.type!="Success"?v:v.value()}),w=x(()=>S().type),b=x(()=>{let v=p();if(v.type!="Success")return v;let E=v.value;if(w()!="Success")return S();let I=x(()=>{let D=S();if(D.type!="Success")throw new Error("Unreachable");return D.value});return q(x(me(I,D=>x(()=>{let N=Sr.create(zr,D.docHandle);if(N.type=="Err")return Re(N.message);let V=N.value;return q(x(()=>{let R=V,H=R.entitiesWithComponentType(kt);if(H.length!=1)return Re("Expected expect exactly one texture atlas entity.");let j=H[0],W=R.getComponent(j,kt)?.state;if(W==null)return Re("Texture atlas not found in texture atlas file.");let oe=R.entitiesWithComponentType(At).flatMap(Ke=>wr(R.getComponent(Ke,At)?.state).map(Ge=>({frameId:Ke,frame:Ge}))),se=W,Ie=se.imageRef,ye=E.get(Ie);return ye==null?Re("Texture atlas referenced image not found."):q(x(()=>{let Ke=new Blob([ye.doc.data],{type:ye.doc.mimeType}),Ge=URL.createObjectURL(Ke);Z(()=>URL.revokeObjectURL(Ge));let[gr]=et(()=>new Promise(Fe=>{let Te=new Image;Te.src=Ge,Te.onerror=()=>{Fe(xr("Failed to load image."))},Te.onload=()=>{Fe(Ze(Te))}}));return q(x(()=>{let Fe=gr();if(Fe==null)return Pr();if(Fe.type=="Err")return Re(Fe.message);let Te=Fe.value;return q({textureAtlasFilename:D.name,textureAtlas:se,image:Te,frames:oe})}))}))}))}))))});k=x(()=>{let v=[],E=b();if(E.type!="Success")return E;let I=E.value();for(let D of I){let N=D();if(N.type!="Success")return N;let V=N.value();if(V.type!="Success")return V;let R=V.value();if(R.type!="Success")return R;let H=R.value();if(H.type!="Success")return H;let j=H.value;v.push(j)}return q(v)})}let K=x(()=>{let d=M();if(d!=null)return()=>F(Tr,{initImage:d});let p=h();if(p!=null){let b=i();if(b.type!="Success")return t.showGame?()=>{}:Xe;let v=b.value,E=new Er({vfs:v,imagesFolder:g,textureAtlasesFolder:f,textureAtlasFileId:()=>p});return()=>F(E.Render,{style:{"flex-grow":"1"}})}let S=P();if(S!=null){let b=i();if(b.type!="Success")return t.showGame?()=>{}:Xe;let v=b.value,E=new Ir({vfs:v,imagesFolder:g,textureAtlasesFolder:f,levelFileId:()=>S,textureAtlasWithImageAndFramesList:k});return()=>F(E.Render,{style:{"flex-grow":"1"}})}let w=C();if(w!=null){let b=m();return b.type!="Success"?t.showGame?()=>{}:Xe:(b.value,()=>F(vt,{get children(){return[F(xe,{get when(){return t.useCodeMirror},get children(){return F(Hr,{path:w})}}),F(xe,{get when(){return!t.useCodeMirror},get children(){return F(Rr,{path:w})}})]}}))}return t.showGame?()=>{}:Xe}),z=()=>x(()=>K()({}));return(()=>{var d=gi(),p=d.firstChild,S=p.firstChild,w=S.nextSibling,b=w.nextSibling,v=b.firstChild,E=v.firstChild,I=b.nextSibling,D=I.firstChild,N=I.nextSibling,V=N.firstChild,R=N.nextSibling,H=p.nextSibling;return d.style.setProperty("flex-grow","1"),d.style.setProperty("overflow","hidden"),d.style.setProperty("display","flex"),d.style.setProperty("flex-direction","column"),d.style.setProperty("position","relative"),Y(d,a,p),S.$$click=()=>_(),w.$$click=()=>re(),E.addEventListener("change",j=>{r("showGame",j.currentTarget.checked)}),D.addEventListener("change",j=>{r("useCodeMirror",j.currentTarget.value=="codemirror")}),V.$$click=()=>Q(),Y(p,F(ve,{get when(){return!e.broadcastNetworkAdapterIsEnabled},get children(){var j=ui(),W=j.firstChild;return W.$$click=()=>{e.enableBroadcastNetworkAdapter()},j}}),R),R.$$click=()=>Br({vfs:e.vfs}),Y(p,()=>te(()=>{let j;return(()=>{var W=mi(),le=W.firstChild,oe=le.nextSibling;W.$$click=()=>{j.click()},oe.addEventListener("change",()=>{let Ie=j.files;Ie!=null&&Ie.length==1&&(async()=>(await Wr({file:Ie[0],vfs:e.vfs}),await e.flushRepo(),window.location.reload()))()});var se=j;return typeof se=="function"?zt(se,oe):j=oe,W})()}),null),H.style.setProperty("flex-grow","1"),H.style.setProperty("display","flex"),H.style.setProperty("flex-direction","row"),H.style.setProperty("overflow","hidden"),Y(H,F(vt,{get children(){return[F(xe,{get when(){return!t.showGame},get children(){return F(z,{})}}),F(xe,{get when(){return x(()=>!!t.showGame)()&&K()({})==null},get children(){return F(Kt,{get vfsDocUrl(){return e.vfsDocUrl},get vfs(){return e.vfs}})}}),F(xe,{get when(){return x(()=>!!t.showGame)()&&K()({})!=null},get children(){return F(qe,{orientation:"horizontal",style:{"flex-grow":"1",overflow:"hidden"},get children(){return[F(qe.Panel,{style:{display:"flex",overflow:"hidden"},get children(){return F(z,{})}}),F(qe.Handle,{"aria-label":"Resize Handle",class:"group basis-3 px-0.75",get children(){return fi()}}),F(qe.Panel,{style:{display:"flex",overflow:"hidden"},get children(){return F(Kt,{get vfsDocUrl(){return e.vfsDocUrl},get vfs(){return e.vfs}})}})]}})}})]}})),Y(d,F(ve,{get when(){return t.overlayApp?.value},keyed:!0,children:j=>(()=>{var W=vi(),le=W.firstChild,oe=le.firstChild,se=oe.firstChild,Ie=se.nextSibling,ye=oe.nextSibling;return W.style.setProperty("position","absolute"),W.style.setProperty("left","0"),W.style.setProperty("top","0"),W.style.setProperty("bottom","0"),W.style.setProperty("right","0"),W.style.setProperty("display","flex"),W.style.setProperty("overflow","hidden"),le.style.setProperty("flex-grow","1"),le.style.setProperty("margin","5%"),le.style.setProperty("display","flex"),le.style.setProperty("flex-direction","column"),le.style.setProperty("overflow","hidden"),oe.style.setProperty("display","flex"),oe.style.setProperty("flex-direction","row"),oe.style.setProperty("padding","10px"),se.style.setProperty("flex-grow","1"),se.style.setProperty("display","flex"),se.style.setProperty("flex-direction","row"),se.style.setProperty("align-items","center"),se.style.setProperty("overflow","hidden"),Y(se,F(j.Title,{})),Ie.$$click=()=>r("overlayApp",void 0),ye.style.setProperty("flex-grow","1"),ye.style.setProperty("display","flex"),ye.style.setProperty("padding","10px"),ye.style.setProperty("overflow","hidden"),Y(ye,F(j.View,{})),W})()}),null),ee(()=>E.checked=t.showGame),ee(()=>D.value=t.useCodeMirror?"codemirror":"monaco"),d})()};wt(["click"]);export{Li as default};
