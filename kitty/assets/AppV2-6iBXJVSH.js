import{k as Ne,l as st,D as lr,t as j,n as Be,i as Y,q as Fe,j as Pt,u as mt,s as Lt,d as vt,R as or,libUrl as Nt,S as Le,w as ar,x as It,y as qe,z as q,A as Ae,I as sr,T as cr,L as dr,N as rt,E as ur,r as fr,B as Et,f as Ft,c as gr,e as mr,F as vr,G as yr,H as hr,K as pr,EcsWorld as br}from"./lib-CvNVz1PI.js";import{O as Z,u as Re,q as z,Z as De,n as _e,W as $e,l as E,K as ce,Y as ee,c as H,p as oe,N as et,S as fe,s as X,w as Sr,b as ye,v as nt,J as ze,m as ae,I as zr,Q as Bt,M as Se,h as ct,a as wr,g as xr,D as Ut,t as dt,F as Pr}from"./dev-B9-ass9r.js";import{a as yt}from"./dev-CC7pdsS5.js";import"./index-XNH-lkY3.js";import Ir from"./PixelEditor-ocA06Brg.js";import Er,{mountAutomergeFolderToMonacoVfsWhileMounted as Fr}from"./ScriptEditor-BZAKKYP-.js";import{c as Cr,p as Dr,t as _r,r as $r,i as kr}from"./index-BFsIGCf5.js";import Ar,{ModuleKind as Tr}from"typescript";import{solidjsUrl as Rr}from"./solid-js-C16mITwu.js";import{pixijsUrl as Mr}from"./pixi-js-CTVzrHHI.js";import{solidjsStoreUrl as Or}from"./solid-js-store-D4PqY48D.js";import{e as Lr,i as Nr}from"./index-BAG0iWgA.js";import Br,{mountAutomergeFolderToCodeMirrorVfsWhileMounted as Ur}from"./CodeMirror-CA44buzz.js";import"./ColourPicker-l30c-hik.js";import"./FederatedEventTarget-DFQx8mKK.js";import"./Filter-BDK7ILDO.js";import"./State-3sV0XrC-.js";import"./CanvasTextSystem-BKHjFPHo.js";import"./colorToUniform-W8Zlj3HA.js";import"./SharedSystems-BwGi1NkL.js";import"./AnimatedSprite-CrPahPC5.js";import"./WebGLRenderer-DzfsPnmv.js";import"./WebGPURenderer-DziseXTR.js";import"./index-DTYtQKXs.js";function Hr(e){let t={},r=i=>{if(i=i.trim(),i.startsWith("/")||(i="/"+i),i.endsWith("/")&&(i=i.slice(0,i.length-1)),i=i.trim(),t[i]!=null){let n=t[i];return n.refCount++,Z(()=>{n.refCount--,n.refCount==0&&n.dispose()}),n.fileOrFolder}else{if(i==""){let{folder:p,dispose:h}=Re(I=>({folder:e.rootFolder(),dispose:I}));t[i]={fileOrFolder:z(()=>Ne({type:"Folder",value:p})),refCount:1,dispose:h};let w=t[i];return Z(()=>{w.refCount--,w.refCount==0&&w.dispose()}),t[i].fileOrFolder}let n=i.lastIndexOf("/")??0,a=i.slice(n+1),m=i.slice(0,n+1),c=r(m),{fileOrFolder:o,dispose:f}=Re(p=>({fileOrFolder:z(()=>{let w=c();if(w.type!="Success")return w;let I=w.value;if(I.type!="Folder")return st("Tried to read a file like it was a folder");let _=I.value();if(_.type!="Success")return _;let R=_.value,O=R.contents.find(J=>J.name==a);if(O==null)return st("File or folder not found");let C=O,Q;switch(C.type){case"File":{Q={type:"File",value:R.openFileById(C.id)};break}case"Folder":{Q={type:"Folder",value:R.openFolderById(C.id)};break}}return Ne(Q)}),dispose:p}));t[i]={fileOrFolder:o,refCount:1,dispose:f};let d=t[i];return Z(()=>{d.refCount--,d.refCount==0&&d.dispose()}),t[i].fileOrFolder}};e.rootFolder();function l(i,n){let a=r(i)();if(a.type=="Pending")return n?.withFileTypes?[{type:"File",path:"Loading..."}]:["Loading..."];if(a.type=="Failed")return n?.withFileTypes?[{type:"File",path:"Error"}]:["Error"];let m=a.value;if(m.type!="Folder")return[];let c=m.value();if(c.type=="Pending")return n?.withFileTypes?[{type:"File",path:"Loading..."}]:["Loading..."];if(c.type=="Failed")return n?.withFileTypes?[{type:"File",path:"Error"}]:["Error"];let f=c.value.contents;return n?.withFileTypes?f.map(d=>{let p;switch(d.type){case"File":p="file";break;case"Folder":p="dir";break}return{type:p,path:(i!=""&&i!="/"?i+"/":i)+d.name}}):f.map(d=>(i!=""&&i!="/"?i+"/":i)+d.name)}return{exists(i){return r(i)().type=="Success"},getType(i){let a=r(i)();if(a.type!="Success")return"file";switch(a.value.type){case"File":return"file";case"Folder":return"dir"}},readdir:l,mkdir(i,n){throw new Error("TODO")},readFile(i){throw new Error("TODO")},rename(i,n){throw new Error("TODO")},rm(i,n){throw new Error("TODO")},writeFile(i,n){throw new Error("TODO")}}}var Ye=new Map,ht=(e,t)=>{if(Ye.has(e))return Ye.get(e);const r=_e(t);return Ye.set(e,r),r},pt=e=>{const t=Ye.get(e);if(t)return De(t)},Wr=/((?:--)?(?:\w+-?)+)\s*:\s*([^;]*)/g;function Kr(e){const t={};let r;for(;r=Wr.exec(e);)t[r[1]]=r[2];return t}function bt(e,t){return typeof t=="string"&&(t=Kr(t)),{...e,...t}}var pe=(e,t)=>(e&&(typeof e=="function"?e(t):e[0](e[1],t)),t.defaultPrevented),Gr=(e,t)=>{const r=e.compareDocumentPosition(t);return r&Node.DOCUMENT_POSITION_PRECEDING||r&Node.DOCUMENT_POSITION_CONTAINS?1:r&Node.DOCUMENT_POSITION_FOLLOWING||r&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:0},Ct=e=>typeof e=="function"?e():e,jr=e=>(...t)=>{for(const r of e)r&&r(...t)},St=(...e)=>jr(e),Vr=(...e)=>e.some(t=>!!t()),Ht=e=>typeof e=="function"&&e.length>0,Je=e=>e?"":void 0,qr=e=>{const[t,r]=$e(e,["as"]),l=z(()=>t.as??"div");return z(()=>{const n=l();switch(typeof n){case"function":return ee(()=>n(r));case"string":return E(lr,ce({component:n},r))}})},zt=qr,Yr=e=>{let t,r=!1;return()=>r?t:(r=!0,t=z(e))},Wt=Yr;function Jr(e){const[t,r]=H(e.initialValue),l=()=>e.value?.()!==void 0,i=()=>l()?e.value?.():t();return[i,a=>ee(()=>{let m;return typeof a=="function"?m=a(i()):m=a,Object.is(m,i())||(l()||r(m),e.onChange?.(m)),m})]}var Xr=Jr,Zr=e=>{const[t,r]=H(0);oe(()=>{const n=Ct(e.element);if(!n)return;i(n);const a=new ResizeObserver(l);a.observe(n),Z(()=>{a.disconnect()})});const l=([n])=>{i(n.target)},i=n=>{switch(Ct(e.dimension)){case"width":r(n.offsetWidth);break;case"height":r(n.offsetHeight);break}};return t},Qr=Zr,en=j("<div data-corvu-resizable-handle-start-intersection>"),tn=j("<div data-corvu-resizable-handle-end-intersection>"),Kt=_e(),rn=e=>e===void 0?Kt:ht(`resizable-${e}`),nn=e=>{if(e===void 0){const r=De(Kt);if(!r)throw new Error("[corvu]: Resizable context not found. Make sure to wrap Resizable components in <Resizable.Root>");return r}const t=pt(`resizable-${e}`);if(!t)throw new Error(`[corvu]: Resizable context with id "${e}" not found. Make sure to wrap Resizable components in <Resizable.Root contextId="${e}">`);return t},Gt=_e(),ln=e=>e===void 0?Gt:ht(`resizable-internal-${e}`),jt=e=>{if(e===void 0){const r=De(Gt);if(!r)throw new Error("[corvu]: Resizable context not found. Make sure to wrap Resizable components in <Resizable.Root>");return r}const t=pt(`resizable-internal-${e}`);if(!t)throw new Error(`[corvu]: Resizable context with id "${e}" not found. Make sure to wrap Resizable components in <Resizable.Root contextId="${e}">`);return t},L=(e,t)=>{if(typeof e=="number")return e;if(!e.endsWith("px"))throw new Error(`[corvu] Sizes must be a number or a string ending with 'px'. Got ${e}`);return re(parseFloat(e)/t)},Ue=e=>{const t=e.panels.filter(l=>!!(e.focusedElement.compareDocumentPosition(l.data.element)&Node.DOCUMENT_POSITION_PRECEDING)),r=e.panels.filter(l=>!!(e.focusedElement.compareDocumentPosition(l.data.element)&Node.DOCUMENT_POSITION_FOLLOWING));return[t,r]},on=6,re=e=>parseFloat(e.toFixed(on)),ut=null,Ee=null,te=0,an={1:"e-resize",2:"w-resize",3:"ew-resize",4:"s-resize",8:"n-resize",12:"ns-resize",5:"se-resize",9:"ne-resize",6:"sw-resize",10:"nw-resize"},it=null,wt=()=>{if(!ut){Ee&&(it=null,Ee.remove(),Ee=null);return}let e=an[te]??null;if(e===null)switch(ut){case"horizontal":e="col-resize";break;case"vertical":e="row-resize";break;case"both":e="move";break}e!==it&&(it=e,Ee||(Ee=document.createElement("style"),document.head.appendChild(Ee)),Ee.innerHTML=`*{cursor: ${e}!important;}`)},Dt=(e,t)=>{switch(e){case"horizontal":t===1?(te|=1,te&=-3):t===2?(te|=2,te&=-2):t===3?te|=3:te&=-4;break;case"vertical":t===1?(te|=4,te&=-9):t===2?(te|=8,te&=-5):t===3?te|=12:te&=-13;break}wt()},sn=()=>{te=0,wt()},ft=e=>{ut=e,wt()},_t=e=>{if(re(e.distributablePercentage)!==re(e.desiredPercentage)){let t=null;e.betweenCollapse===!0?t=3:e.desiredPercentage<e.distributablePercentage&&e.revertConstraints!==!0||e.desiredPercentage>e.distributablePercentage&&e.revertConstraints===!0?t=1:t=2,Dt(e.orientation,t)}else Dt(e.orientation,0)},he=[],Ce=null,Vt=null,cn=1,Ke=(e,t)=>Math.abs(e-t)<=cn,dn=e=>{he.push(e);for(const t of he)for(const r of he){if(t.orientation===r.orientation||t.element===r.element)continue;const l=t.element.getBoundingClientRect(),i=r.element.getBoundingClientRect();if(t.orientation==="horizontal"&&(l.left>i.right||l.right<i.left)||t.orientation==="vertical"&&(l.top>i.bottom||l.bottom<i.top))continue;const n=t.orientation==="horizontal"?Ke(l.top,i.bottom):Ke(l.left,i.right),a=t.orientation==="horizontal"?Ke(l.bottom,i.top):Ke(l.right,i.left);n&&t.startIntersection.setHandle(r),a&&t.endIntersection.setHandle(r)}return{onDragStart:(t,r)=>fn(e,t,r),onHoveredChange:t=>{Vt=t;const r=!!Ce;let l=null;ye(()=>{switch(t){case"handle":{const i=e.startIntersection.handle(),n=e.endIntersection.handle();r||(e.setActive(!0),i?.setActive(!1),n?.setActive(!1)),i?.setHoveredAsIntersection(!1),n?.setHoveredAsIntersection(!1),l=e.orientation;break}case"startIntersection":{const i=e.startIntersection.handle();r||i?.setActive(!0),i?.setHoveredAsIntersection(!0),l="both";break}case"endIntersection":{const i=e.endIntersection.handle();r||i?.setActive(!0),i?.setHoveredAsIntersection(!0),l="both";break}case null:{const i=e.startIntersection.handle(),n=e.endIntersection.handle();!r&&!e.focused()&&(e.setActive(!1),i?.setActive(!1),n?.setActive(!1)),i?.setHoveredAsIntersection(!1),n?.setHoveredAsIntersection(!1),l=null;break}}!r&&e.handleCursorStyle()&&ft(l)})}}},un=e=>{he.splice(he.indexOf(e),1)},fn=(e,t,r)=>{Ce={x:t.clientX,y:t.clientY},ye(()=>{e.setDragging(!0),r==="startIntersection"&&e.startIntersection.handle()?.setDragging(!0),r==="endIntersection"&&e.endIntersection.handle()?.setDragging(!0)}),window.addEventListener("pointermove",qt),window.addEventListener("touchmove",Yt),window.addEventListener("pointerup",Te),window.addEventListener("touchend",Te),window.addEventListener("contextmenu",Te)},qt=e=>Jt(e.clientX,e.clientY,e.altKey),Yt=e=>{e.touches[0]&&Jt(e.touches[0].clientX,e.touches[0].clientY,e.altKey)},$t=!1,Jt=(e,t,r)=>{if(Ce){he.some(l=>l.dragging()&&l.altKey==="only")&&(r=!0),he.some(l=>l.dragging()&&l.altKey===!1)&&(r=!1),$t!==r&&(Ce={x:e,y:t},$t=r);for(const l of he)l.dragging()&&l.onDrag(l.orientation==="horizontal"?e-Ce.x:t-Ce.y,r)}},Te=e=>{ye(()=>{for(const t of he)t.dragging()?(t.setDragging(!1),t.onDragEnd(e),!t.hovered()&&!t.hoveredAsIntersection()&&t.setActive(!1),!Vt&&t.handleCursorStyle()&&ft(null)):Vr(t.hovered,t.focused,t.hoveredAsIntersection)&&(t.setActive(!0),t.handleCursorStyle()&&ft(t.orientation))}),sn(),Ce=null,window.removeEventListener("pointermove",qt),window.removeEventListener("touchmove",Yt),window.removeEventListener("pointerup",Te),window.removeEventListener("touchend",Te),window.removeEventListener("contextmenu",Te)},gn=e=>{const t=ce({startIntersection:!0,endIntersection:!0,altKey:!0},e),[r,l]=$e(t,["startIntersection","endIntersection","altKey","onHandleDragStart","onHandleDrag","onHandleDragEnd","contextId","ref","style","disabled","children","onMouseEnter","onMouseLeave","onKeyDown","onKeyUp","onFocus","onBlur","onPointerDown"]),[i,n]=H(null),[a,m]=H(!1),[c,o]=H(null),[f,d]=H(!1),[p,h]=H(!1),[w,I]=H(!1),[_,R]=H(null),[A,O]=H(null),C=z(()=>jt(r.contextId)),Q=z(()=>{const b=i();if(!b)return;const s=C().panels(),[g,y]=Ue({panels:s,focusedElement:b}),S=g[g.length-1]?.data.id,v=y.reduce((P,F)=>P-L(F.data.minSize,C().rootSize()),1),u=g.reduce((P,F)=>P+L(F.data.minSize,C().rootSize()),0),x=g.reduce((P,F)=>P+L(F.size(),C().rootSize()),0);return{ariaControls:S,ariaValueMax:re(v),ariaValueMin:re(u),ariaValueNow:re(x)}});let J=null;return oe(()=>{if(r.disabled===!0)return;const b=i();if(!b)return;const s={element:b,orientation:C().orientation(),handleCursorStyle:C().handleCursorStyle,altKey:r.altKey,startIntersection:{handle:_,setHandle:g=>{r.startIntersection===!0&&R(g)}},endIntersection:{handle:A,setHandle:g=>{r.endIntersection===!0&&O(g)}},hovered:c,focused:f,hoveredAsIntersection:a,setHoveredAsIntersection:m,active:p,setActive:h,dragging:w,setDragging:I,onDrag:(g,y)=>{if(r.onHandleDrag!==void 0){const S=new CustomEvent("drag",{cancelable:!0});if(r.onHandleDrag(S),S.defaultPrevented)return}C().onDrag(b,g,y)},onDragEnd:g=>{r.onHandleDragEnd?.(g),C().onDragEnd()}};J=dn(s),Z(()=>{un(s),J=null})}),oe(et(c,()=>{J?.onHoveredChange(c())})),E(zt,ce({as:"button",ref(b){var s=St(n,r.ref);typeof s=="function"&&s(b)},get style(){return bt({position:"relative",cursor:C().handleCursorStyle()?"inherit":void 0,"touch-action":"none","flex-shrink":0},r.style)},get disabled(){return r.disabled},onBlur:b=>{pe(r.onBlur,b)||(d(!1),!c()&&h(!1))},onFocus:b=>{pe(r.onFocus,b)||c()||(d(!0),h(!0))},onKeyDown:b=>{if(pe(r.onKeyDown,b)||w())return;const s=i();if(!s)return;const g=r.altKey==="only"||r.altKey!==!1&&b.altKey;C().onKeyDown(s,b,g)},onKeyUp:b=>{pe(r.onKeyUp,b)||b.key!=="Tab"||d(!0)},onMouseEnter:b=>{pe(r.onMouseEnter,b)||r.disabled===!0||o("handle")},onMouseLeave:b=>{pe(r.onMouseLeave,b)||o(null)},onPointerDown:b=>{if(pe(r.onPointerDown,b)||pe(r.onHandleDragStart,b))return;const s=b.target;let g="handle";s.hasAttribute("data-corvu-resizable-handle-start-intersection")&&(g="startIntersection"),s.hasAttribute("data-corvu-resizable-handle-end-intersection")&&(g="endIntersection"),J?.onDragStart(b,g)},role:"separator",get"aria-controls"(){return Q()?.ariaControls},get"aria-orientation"(){return C().orientation()},get"aria-valuemax"(){return Q()?.ariaValueMax},get"aria-valuemin"(){return Q()?.ariaValueMin},get"aria-valuenow"(){return Q()?.ariaValueNow},get"data-active"(){return Je(p())},get"data-dragging"(){return Je(w())},get"data-orientation"(){return C().orientation()},"data-corvu-resizable-handle":""},l,{get children(){return[E(fe,{get when(){return _()},get children(){var b=en();return b.addEventListener("mouseleave",s=>{i()?.contains(s.relatedTarget)===!0?o("handle"):o(null)}),b.addEventListener("mouseenter",()=>o("startIntersection")),b.style.setProperty("position","absolute"),b.style.setProperty("aspect-ratio","1 / 1"),b.style.setProperty("top","0"),b.style.setProperty("left","0"),b.style.setProperty("z-index","1"),X(s=>{var g=C().orientation()==="horizontal"?void 0:"100%",y=C().orientation()==="horizontal"?"100%":void 0,S=C().orientation()==="horizontal"?"translate3d(0, -100%, 0)":"translate3d(-100%, 0, 0)";return g!==s.e&&((s.e=g)!=null?b.style.setProperty("height",g):b.style.removeProperty("height")),y!==s.t&&((s.t=y)!=null?b.style.setProperty("width",y):b.style.removeProperty("width")),S!==s.a&&((s.a=S)!=null?b.style.setProperty("transform",S):b.style.removeProperty("transform")),s},{e:void 0,t:void 0,a:void 0}),b}}),z(()=>r.children),E(fe,{get when(){return A()},get children(){var b=tn();return b.addEventListener("mouseleave",s=>{i()?.contains(s.relatedTarget)===!0?o("handle"):o(null)}),b.addEventListener("mouseenter",()=>o("endIntersection")),b.style.setProperty("position","absolute"),b.style.setProperty("aspect-ratio","1 / 1"),b.style.setProperty("bottom","0"),b.style.setProperty("right","0"),b.style.setProperty("z-index","1"),X(s=>{var g=C().orientation()==="horizontal"?void 0:"100%",y=C().orientation()==="horizontal"?"100%":void 0,S=C().orientation()==="horizontal"?"translate3d(0, 100%, 0)":"translate3d(100%, 0, 0)";return g!==s.e&&((s.e=g)!=null?b.style.setProperty("height",g):b.style.removeProperty("height")),y!==s.t&&((s.t=y)!=null?b.style.setProperty("width",y):b.style.removeProperty("width")),S!==s.a&&((s.a=S)!=null?b.style.setProperty("transform",S):b.style.removeProperty("transform")),s},{e:void 0,t:void 0,a:void 0}),b}})]}}))},mn=gn,Xt=_e(),vn=e=>e===void 0?Xt:ht(`resizable-panel-${e}`),yn=e=>{if(e===void 0){const r=De(Xt);if(!r)throw new Error("[corvu]: Resizable panel context not found. Make sure to call usePanelContext under <Resizable.Panel>");return r}const t=pt(`resizable-panel-${e}`);if(!t)throw new Error(`[corvu]: Resizable context with id "${e}" not found. Make sure to call usePanelContext under <Resizable.Panel contextId="${e}">`);return t},hn=e=>{const t=ce({initialSize:null,minSize:0,maxSize:1,collapsible:!1,collapsedSize:0,collapseThreshold:.05,panelId:Sr()},e),[r,l]=$e(t,["initialSize","minSize","maxSize","collapsible","collapsedSize","collapseThreshold","onResize","onCollapse","onExpand","contextId","panelId","ref","style","children"]),[i,n]=H(null),a=z(()=>jt(r.contextId)),[m,c]=H(null);oe(()=>{const A=i();if(!A)return;const O=a(),C=ee(()=>O.registerPanel({id:r.panelId,element:A,initialSize:r.initialSize,minSize:r.minSize,maxSize:r.maxSize,collapsible:r.collapsible,collapsedSize:r.collapsedSize,collapseThreshold:r.collapseThreshold,onResize:r.onResize}));c(C),Z(()=>{O.unregisterPanel(C.data.id)})});const o=()=>{const A=m();return A?A.size():typeof r.initialSize=="number"?r.initialSize:1},f=z(A=>{const O=m();if(r.collapsible!==!0)return!1;const C=O?O.size()===L(r.collapsedSize,a().rootSize()):!1;return O&&A!==C&&(C&&r.onCollapse!==void 0?r.onCollapse(O.size()):!C&&r.onExpand!==void 0&&r.onExpand(O.size())),C}),d=(A,O)=>{const C=m();C&&C.resize(A,O??"both")},p=A=>{const O=m();O&&O.collapse(A??"both")},h=A=>{const O=m();O&&O.expand(A??"both")},w={get size(){return o()},get minSize(){return r.minSize},get maxSize(){return r.maxSize},get collapsible(){return r.collapsible},get collapsedSize(){return r.collapsedSize},get collapseThreshold(){return r.collapseThreshold},get collapsed(){return f()},resize:d,collapse:p,expand:h,get panelId(){return r.panelId}},I=Wt(()=>r.children),_=()=>{const A=I()();return Ht(A)?A(w):A};return z(()=>{const A=vn(r.contextId);return E(A.Provider,{value:{size:o,minSize:()=>r.minSize,maxSize:()=>r.maxSize,collapsible:()=>r.collapsible,collapsedSize:()=>r.collapsedSize,collapseThreshold:()=>r.collapseThreshold,collapsed:f,resize:d,collapse:p,expand:h,panelId:()=>r.panelId},get children(){return E(zt,ce({as:"div",ref(O){var C=St(n,r.ref);typeof C=="function"&&C(O)},get style(){return bt({"flex-basis":o()*100+"%"},r.style)},get id(){return r.panelId},get"data-collapsed"(){return Je(f())},get"data-expanded"(){return Je(r.collapsible===!0&&!f())},get"data-orientation"(){return a().orientation()},"data-corvu-resizable-panel":""},l,{get children(){return ee(()=>_())}}))}})})},pn=hn,Xe=e=>{let t=e.desiredPercentage>=0?1/0:-1/0,r=e.initialSizes;for(const l of e.resizeActions){const i=l.negate!==!0?e.desiredPercentage:-e.desiredPercentage;let[n,a,m]=Ze({desiredPercentage:i,side:"preceding",panels:l.precedingPanels,initialSizes:r,initialSizesStartIndex:0,collapsible:e.collapsible,rootSize:e.resizableData.rootSize}),[c,o,f]=Ze({desiredPercentage:i,side:"following",panels:l.followingPanels,initialSizes:r,initialSizesStartIndex:l.precedingPanels.length,collapsible:e.collapsible,rootSize:e.resizableData.rootSize});l.negate===!0&&(n=-n,c=-c),m&&(c=n),f&&(n=c),e.desiredPercentage>=0?t=Math.min(t,Math.min(n,c)):t=Math.max(t,Math.max(n,c)),r=[...a,...o]}return t},Ze=e=>{e.desiredPercentage=re(e.desiredPercentage);const t=bn({side:e.side,desiredPercentage:e.desiredPercentage});let r=0;const l=e.initialSizes.slice(e.initialSizesStartIndex,e.initialSizesStartIndex+e.panels.length);for(let h=e.side==="preceding"?e.panels.length-1:0;e.side==="preceding"?h>=0:h<e.panels.length;e.side==="preceding"?h--:h++){const w=e.panels[h],I=e.initialSizes[h+e.initialSizesStartIndex],_=L(w.data.collapsedSize??0,e.rootSize);if(w.data.collapsible&&I===_)continue;const R=re(e.desiredPercentage-r);if(R===0)break;switch(t){case"precedingDecreasing":{const A=L(w.data.minSize,e.rootSize);l[h]=Math.max(A,I+R),r+=l[h]-I;break}case"followingDecreasing":{const A=L(w.data.minSize,e.rootSize);l[h]=Math.max(A,I-R),r-=l[h]-I;break}case"precedingIncreasing":{const A=L(w.data.maxSize,e.rootSize);l[h]=Math.min(A,I+R),r+=l[h]-I;break}case"followingIncreasing":{const A=L(w.data.maxSize,e.rootSize);l[h]=Math.min(A,I-R),r-=l[h]-I;break}}}if(r=re(r),!e.collapsible||r===e.desiredPercentage)return[r,l,!1];const i=e.side==="preceding"?e.panels.length-1:0,n=e.panels[i];if(!n.data.collapsible)return[r,l,!1];const a=re(e.desiredPercentage-r);let m=!1;const c=e.initialSizes[i+e.initialSizesStartIndex],o=L(n.data.minSize,e.rootSize),f=L(n.data.collapsedSize??0,e.rootSize),d=Math.min(L(n.data.collapseThreshold??0,e.rootSize),o-f),p=c===f;if(t==="precedingDecreasing"&&!p&&Math.abs(a)>=d)r-=l[i]-c,l[i]=f,r+=l[i]-c,m=!0;else if(t==="precedingIncreasing"&&p&&Math.abs(a)>=d){const h=L(n.data.minSize,e.rootSize);if(l[i]=h,Math.abs(a)>=h-f){const w=L(n.data.maxSize,e.rootSize);l[i]=Math.min(w,c+a)}else m=!0;r+=l[i]-c}else if(t==="followingDecreasing"&&!p&&Math.abs(a)>=d)r+=l[i]-c,l[i]=f,r-=l[i]-c,m=!0;else if(t==="followingIncreasing"&&p&&Math.abs(a)>=d){const h=L(n.data.minSize,e.rootSize);if(l[i]=h,Math.abs(a)>=h-f){const w=L(n.data.maxSize,e.rootSize);l[i]=Math.min(w,c-a)}else m=!0;r-=l[i]-c}return[r,l,m]},bn=e=>{switch(e.side){case"preceding":return e.desiredPercentage>=0?"precedingIncreasing":"precedingDecreasing";case"following":return e.desiredPercentage>=0?"followingDecreasing":"followingIncreasing"}},Qe=e=>{let t=e.initialSizes;for(const l of e.resizeActions){const[,i]=Ze({desiredPercentage:l.deltaPercentage,side:"preceding",panels:l.precedingPanels,initialSizes:t,initialSizesStartIndex:0,collapsible:e.collapsible,rootSize:e.resizableData.rootSize}),[,n]=Ze({desiredPercentage:l.deltaPercentage,side:"following",panels:l.followingPanels,initialSizes:t,initialSizesStartIndex:l.precedingPanels.length,collapsible:e.collapsible,rootSize:e.resizableData.rootSize});t=[...i,...n]}t=t.map(re);const r=t.reduce((l,i)=>l+i,0);if(r!==1){const i=(r-1)/t.length;t=t.map(n=>n-i)}e.resizableData.setSizes(t.map(re))},lt=e=>{let[t,r]=Ue({panels:e.panels,focusedElement:e.panel.data.element});const l=e.panels.indexOf(e.panel);if(l===0?e.strategy="following":l===e.panels.length-1&&(e.strategy="preceding"),e.strategy==="both"){const i=[...t,e.panel],n=[e.panel,...r],a=Xe({desiredPercentage:e.deltaPercentage/2,initialSizes:e.initialSizes,collapsible:!0,resizeActions:[{precedingPanels:i,followingPanels:r},{precedingPanels:t,followingPanels:n,negate:!0}],resizableData:{rootSize:e.resizableData.rootSize}});Qe({initialSizes:e.initialSizes,collapsible:!0,resizeActions:[{precedingPanels:i,followingPanels:r,deltaPercentage:a},{precedingPanels:t,followingPanels:n,deltaPercentage:-a}],resizableData:e.resizableData})}else{t=e.strategy==="preceding"?t:[...t,e.panel],r=e.strategy==="following"?r:[e.panel,...r],e.strategy==="preceding"&&(e.deltaPercentage=-e.deltaPercentage);const i=Xe({desiredPercentage:e.deltaPercentage,initialSizes:e.initialSizes,collapsible:e.collapsible,resizeActions:[{precedingPanels:t,followingPanels:r}],resizableData:{rootSize:e.resizableData.rootSize}});Qe({initialSizes:e.initialSizes,collapsible:!0,resizeActions:[{precedingPanels:t,followingPanels:r,deltaPercentage:i}],resizableData:e.resizableData})}},kt=e=>{if(e.altKey&&e.panels.length>2){let t=e.panels.filter(h=>!!(e.handle.compareDocumentPosition(h.data.element)&Node.DOCUMENT_POSITION_PRECEDING)).length-1;const r=t===0;r&&(t++,e.deltaPercentage=-e.deltaPercentage);const l=e.panels[t],i=e.initialSizes[t],n=L(l.data.minSize,e.resizableData.rootSize)-i,a=L(l.data.maxSize,e.resizableData.rootSize)-i,m=Math.max(n,Math.min(e.deltaPercentage*2,a))/2,[c,o]=Ue({panels:e.panels,focusedElement:l.data.element}),f=[...c,l],d=[l,...o],p=Xe({desiredPercentage:m,initialSizes:e.initialSizes,collapsible:!1,resizeActions:[{precedingPanels:f,followingPanels:o},{precedingPanels:c,followingPanels:d,negate:!0}],resizableData:{rootSize:e.resizableData.rootSize}});e.resizableData.handleCursorStyle===!0&&_t({orientation:e.resizableData.orientation,desiredPercentage:e.deltaPercentage,distributablePercentage:p,revertConstraints:r}),Qe({initialSizes:e.initialSizes,collapsible:!1,resizeActions:[{precedingPanels:f,followingPanels:o,deltaPercentage:p},{precedingPanels:c,followingPanels:d,deltaPercentage:-p}],resizableData:e.resizableData})}else{const[t,r]=Ue({panels:e.panels,focusedElement:e.handle}),l=Xe({desiredPercentage:e.deltaPercentage,initialSizes:e.initialSizes,collapsible:!0,resizeActions:[{precedingPanels:t,followingPanels:r}],resizableData:{rootSize:e.resizableData.rootSize}});if(Qe({initialSizes:e.initialSizes,collapsible:!0,resizeActions:[{precedingPanels:t,followingPanels:r,deltaPercentage:l}],resizableData:e.resizableData}),e.resizableData.handleCursorStyle){const i=re(e.deltaPercentage),n=re(l);let a=!1;const m=t[t.length-1];if(m.data.collapsible){const o=L(m.data.collapsedSize??0,e.resizableData.rootSize);(m.size()===o&&i>n||m.size()!==o&&i<n)&&(a=!0)}const c=r[0];if(c.data.collapsible){const o=L(c.data.collapsedSize??0,e.resizableData.rootSize);(c.size()===o&&i<n||c.size()!==o&&i>n)&&(a=!0)}_t({orientation:e.resizableData.orientation,desiredPercentage:e.deltaPercentage,distributablePercentage:l,betweenCollapse:a})}}},Sn=e=>{const t=ce({orientation:"horizontal",initialSizes:[],keyboardDelta:.1,handleCursorStyle:!0},e),[r,l]=$e(t,["orientation","sizes","onSizesChange","initialSizes","keyboardDelta","handleCursorStyle","contextId","ref","style","children"]),[i,n]=Xr({value:()=>r.sizes,initialValue:[],onChange:r.onSizesChange}),[a,m]=H(null),c=Qr({element:a,dimension:()=>r.orientation==="horizontal"?"width":"height"}),[o,f]=H([]),d=[],p=$=>{const k=o().filter(y=>!!($.element.compareDocumentPosition(y.data.element)&Node.DOCUMENT_POSITION_PRECEDING)).length,D=d[k]===void 0||d[k]===$.id,G=i()[k]!==void 0;let b=null;$.initialSize!==null?b=L($.initialSize,c()):r.initialSizes[k]!==void 0&&D&&(b=L(r.initialSizes[k],c())),b=b??.5,n(y=>{let S=[...y];const v=S.reduce((u,x)=>u+x,0);if((D&&!G||!D)&&v===1){const u=b/S.length;S=S.map(x=>x-u)}return D?(G||(S[k]=b),d[k]=$.id):(S.splice(k,0,b),d.splice(k,0,$.id)),S});const s=z(()=>{const y=d.indexOf($.id);return i()[y]});oe(()=>$.onResize?.(s()));const g={data:$,size:s,resize:(y,S)=>w(d.indexOf($.id),y,S),collapse:y=>I(d.indexOf($.id),y),expand:y=>_(d.indexOf($.id),y)};return f(y=>{const S=[...y];return S.push(g),S.sort((v,u)=>Gr(v.data.element,u.data.element)),S}),g},h=$=>{f(k=>k.filter(D=>D.data.id!==$));const M=d.indexOf($);d.splice(M,1),n(k=>{let D=[...k];D.splice(M,1);const s=(D.reduce((g,y)=>g+y,0)-1)/D.length;return D=D.map(g=>g+s),D})};oe(()=>{r.onSizesChange!==void 0&&r.onSizesChange(i())});const w=($,M,k)=>{ee(()=>{const D=o()[$];if(!D)return;const G=L(D.data.minSize,c()),b=L(D.data.maxSize,c()),s=L(M,c()),y=Math.max(G,Math.min(s,b))-i()[$];lt({deltaPercentage:y,strategy:k??"both",panel:D,panels:o(),initialSizes:o().map(S=>S.size()),collapsible:!1,resizableData:{rootSize:c(),orientation:r.orientation,setSizes:n}})})},I=($,M)=>{ee(()=>{const k=o()[$];if(!k)return;const D=i()[$],G=L(k.data.collapsedSize??0,c());if(!k.data.collapsible||D===G)return;const b=G-D;lt({deltaPercentage:b,strategy:M??"both",panel:k,panels:o(),initialSizes:o().map(s=>s.size()),collapsible:!0,resizableData:{rootSize:c(),orientation:r.orientation,setSizes:n}})})},_=($,M)=>{ee(()=>{const k=o()[$];if(!k)return;const D=i()[$],G=L(k.data.collapsedSize??0,c());if(!k.data.collapsible||D!==G)return;const s=L(k.data.minSize,c())-D;lt({deltaPercentage:s,strategy:M??"both",panel:k,panels:o(),initialSizes:o().map(g=>g.size()),collapsible:!0,resizableData:{rootSize:c(),orientation:r.orientation,setSizes:n}})})};let R=null,A=!1;const O=($,M,k)=>{(R===null||A!==k)&&(R=o().map(D=>D.size()),A=k),kt({deltaPercentage:M/c(),altKey:k,handle:$,panels:o(),initialSizes:R,resizableData:{rootSize:c(),handleCursorStyle:r.handleCursorStyle,orientation:r.orientation,setSizes:n}})},C=($,M,k)=>{if(M.key==="Enter"){const[b,s]=Ue({panels:o(),focusedElement:$});let g=b[b.length-1];if((!g||!g.data.collapsible)&&(g=s[0],!g||!g.data.collapsible))return;const y=g.size(),S=L(g.data.collapsedSize??0,c());y===S?g.expand("following"):g.collapse("following");return}let D=null;if(r.orientation==="horizontal"&&M.key==="ArrowLeft"||r.orientation==="vertical"&&M.key==="ArrowUp"||M.key==="Home"?M.shiftKey||M.key==="Home"?D=-1:D=-L(r.keyboardDelta,c()):(r.orientation==="horizontal"&&M.key==="ArrowRight"||r.orientation==="vertical"&&M.key==="ArrowDown"||M.key==="End")&&(M.shiftKey||M.key==="End"?D=1:D=L(r.keyboardDelta,c())),D===null)return;M.preventDefault();const G=o().map(b=>b.size());kt({deltaPercentage:D,altKey:k,handle:$,panels:o(),initialSizes:G,resizableData:{rootSize:c(),handleCursorStyle:!1,orientation:r.orientation,setSizes:n}})},Q={get sizes(){return i()},setSizes:n,get orientation(){return r.orientation},get keyboardDelta(){return r.keyboardDelta},get handleCursorStyle(){return r.handleCursorStyle},resize:w,collapse:I,expand:_},J=Wt(()=>r.children),we=()=>{const $=J()();return Ht($)?$(Q):$};return z(()=>{const $=rn(r.contextId),M=ln(r.contextId);return E($.Provider,{value:{sizes:i,setSizes:n,orientation:()=>r.orientation,keyboardDelta:()=>r.keyboardDelta,handleCursorStyle:()=>r.handleCursorStyle,resize:w,collapse:I,expand:_},get children(){return E(M.Provider,{value:{sizes:i,setSizes:n,orientation:()=>r.orientation,keyboardDelta:()=>r.keyboardDelta,handleCursorStyle:()=>r.handleCursorStyle,rootSize:c,panels:o,registerPanel:p,unregisterPanel:h,onDrag:O,onDragEnd:()=>R=null,onKeyDown:C,resize:w,collapse:I,expand:_},get children(){return E(zt,ce({as:"div",ref(k){var D=St(m,r.ref);typeof D=="function"&&D(k)},get style(){return bt({display:"flex","flex-direction":r.orientation==="horizontal"?"row":"column"},r.style)},get"data-orientation"(){return r.orientation},"data-corvu-resizable-root":""},l,{get children(){return ee(()=>we())}}))}})}})})},zn=Sn,wn=Object.assign(zn,{Panel:pn,Handle:mn,useContext:nn,usePanelContext:yn}),Ge=wn,xn=j("<div><div>Select something from the menubar above");const je=()=>(()=>{var e=xn(),t=e.firstChild;return e.style.setProperty("flex-grow","1"),t.style.setProperty("position","absolute"),t.style.setProperty("left","50%"),t.style.setProperty("top","50%"),t.style.setProperty("transform","translate(-50%,-50%)"),e})();var Zt=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},B=(e,t,r)=>(Zt(e,t,"read from private field"),r?r.call(e):t.get(e)),gt=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},Pn=(e,t,r,l)=>(Zt(e,t,"write to private field"),t.set(e,r),r),be,se,ue;const me={normalize(e){return e.replace(/^\/+/,"")},getParent(e){return e.split("/").slice(0,-1).join("/")},getName(e){return In(e.split("/"))},isAncestor(e,t){if(e===t)return!1;const r=e.split("/");return t.split("/").every((i,n)=>i===r[n])},rebase(e,t,r){return me.isAncestor(e,t)||e===t?e.replace(t,r):e},rename(e,t){return[...e.split("/").slice(0,-1),t].join("/")}};function In(e){return e[e.length-1]}const En=navigator.platform.startsWith("Mac"),Fn=En?"metaKey":"ctrlKey",ot=Symbol("fallback");function At(e){for(const t of e)t.dispose()}function Qt(e,t,r,l={}){const i=new Map;return Z(()=>At(i.values())),()=>{const a=e()||[];return a[wr],ee(()=>{var m,c;if(!a.length)return At(i.values()),i.clear(),l.fallback?[Re(h=>(i.set(ot,{dispose:h}),l.fallback()))]:[];const o=new Array(a.length),f=i.get(ot);if(!i.size||f){f?.dispose(),i.delete(ot);for(let p=0;p<a.length;p++){const h=a[p],w=t(h,p);n(o,h,p,w)}return o}const d=new Set(i.keys());for(let p=0;p<a.length;p++){const h=a[p],w=t(h,p);d.delete(w);const I=i.get(w);I?(o[p]=I.mapped,(m=I.setIndex)==null||m.call(I,p),I.setItem(()=>h)):n(o,h,p,w)}for(const p of d)(c=i.get(p))==null||c.dispose(),i.delete(p);return o})};function n(a,m,c,o){Re(f=>{const[d,p]=H(m),h={setItem:p,dispose:f};if(r.length>1){const[w,I]=H(c);h.setIndex=I,h.mapped=r(d,w)}else h.mapped=r(d);i.set(o,h),a[c]=h.mapped})}}function Cn(e){const{by:t}=e;return z(Qt(()=>e.each,typeof t=="function"?t:r=>r[t],e.children,"fallback"in e?{fallback:()=>e.fallback}:void 0))}const Dn=Ut?{equals:!1,name:"trigger"}:{equals:!1},_n=Ut?{equals:!1,internal:!0}:Dn;class Tt{constructor(t=Map){gt(this,be,void 0),Pn(this,be,new t)}dirty(t){var r;(r=B(this,be).get(t))==null||r.$$()}dirtyAll(){for(const t of B(this,be).values())t.$$()}track(t){if(!xr())return;let r=B(this,be).get(t);if(r)r.n++;else{const[l,i]=H(void 0,_n);B(this,be).set(t,r={$:l,$$:i,n:1})}Z(()=>{--r.n===0&&queueMicrotask(()=>r.n===0&&B(this,be).delete(t))}),r.$()}}be=new WeakMap;const de=Symbol("track-object");class $n extends Map{constructor(t){if(super(),gt(this,se,new Tt),gt(this,ue,new Tt),t)for(const r of t)super.set(...r)}[Symbol.iterator](){return this.entries()}get size(){return B(this,se).track(de),super.size}*keys(){B(this,se).track(de);for(const t of super.keys())yield t}*values(){B(this,ue).track(de);for(const t of super.values())yield t}*entries(){B(this,se).track(de),B(this,ue).track(de);for(const t of super.entries())yield t}forEach(t,r){B(this,se).track(de),B(this,ue).track(de),super.forEach(t,r)}has(t){return B(this,se).track(t),super.has(t)}get(t){return B(this,ue).track(t),super.get(t)}set(t,r){const l=!super.has(t),i=super.get(t)!==r,n=super.set(t,r);return(i||l)&&ye(()=>{l&&(B(this,se).dirty(de),B(this,se).dirty(t)),i&&(B(this,ue).dirty(de),B(this,ue).dirty(t))}),n}delete(t){const r=super.get(t)!==void 0,l=super.delete(t);return l&&ye(()=>{B(this,se).dirty(de),B(this,ue).dirty(de),B(this,se).dirty(t),r&&B(this,ue).dirty(t)}),l}clear(){super.size&&(super.clear(),ye(()=>{B(this,se).dirtyAll(),B(this,ue).dirtyAll()}))}}se=new WeakMap;ue=new WeakMap;var kn=j("<div>"),Rt=j("<button>"),er=j("<span>"),An=j("<input>");const tr=_e();function xt(){const e=De(tr);if(!e)throw new Error("FileTreeContext is undefined");return e}const rr=_e();function tt(){const e=De(rr);if(!e)throw new Error("DirEntContext is undefined");return e}const nr=_e();function Tn(){const e=De(nr);if(!e)throw new Error("IndentGuideContext is undefined");return e}function Rn(){const e=[],t=new Map,r=new $n;let l=0;function i(o,f=1){const d={id:a(),refCount:f};return t.set(o,d),r.set(d.id,o),d}function n({oldPath:o,newPath:f}){const d=t.get(o);d&&(t.delete(o),t.set(f,d),r.set(d.id,f))}function a(){return e.pop()??(l++).toString()}function m(o){e.push(o)}function c(o){Z(()=>{o.refCount--,o.refCount<=0&&queueMicrotask(()=>{if(o.refCount>0)return;const f=r.get(o.id);m(o.id),r.delete(o.id),f&&t.delete(f)})})}return{beforeRename(o,f){const d=[{oldPath:o,newPath:f}];for(const p of t.keys())if(p.length>o.length&&p.slice(0,o.length)===o&&p[o.length]==="/"){const h=p.slice(o.length);d.push({oldPath:o+h,newPath:f+h})}d.forEach(n)},obtainId(o){let f=t.get(o);return f?f.refCount++:f=i(o),c(f),f.id},freezeId(o){const f=ee(()=>r.get(o));if(f===void 0)return;const d=t.get(f);d!==void 0&&(d.refCount++,c(d))},idToPath(o){const f=r.get(o);if(f===void 0)throw new Error(`path not found for id: ${o}`);return f},pathToId(o,f=!0){let d=t.get(o);if(d===void 0){if(f)throw new Error(`node not found for path: ${o}`);d=i(o,0)}return d.id}}}function ve(e){const[t,r]=$e(ce({base:""},e),["fs","base"]),{obtainId:l,freezeId:i,beforeRename:n,idToPath:a,pathToId:m}=Rn(),c=z(()=>l(t.base)),[o,f]=H(),d=nt(o);function p(v){f(v)}function h(v){o()===v&&f()}oe(()=>{const v=o();v&&!e.fs.exists(a(v))&&f()});const[w,I]=H([],{equals:!1}),_=z(()=>Array.from(new Set(w().flat()))),R=nt(_,(v,u)=>u.includes(v));function A(v){I(u=>[...u,[v]])}function O(v){I(u=>u.map(x=>x.filter(P=>P!==v)))}function C(v){I(u=>{var x;if(u.length===0)return[[v]];if(u[u.length-1].length===0)return u[u.length-1]=[v],u;const F=u[u.length-1][0],N=b().findIndex(T=>T.id===F),V=b().findIndex(T=>T.id===v);return u[u.length-1]=b().slice(Math.min(N,V),Math.max(N,V)+1).map(T=>T.id),N>V&&((x=u[u.length-1])==null||x.reverse()),u})}function Q(){I([])}oe(ze(_,v=>{oe(()=>{e.fs.exists(a(v))||O(v)})}));const[J,we]=H(new Array,{equals:!1}),xe=nt(J,(v,u)=>u.includes(v));function $(v){we(u=>u.filter(x=>x!==v))}function M(v){v!==c()&&!J().includes(v)&&we(u=>[...u,v])}oe(ze(J,v=>{oe(()=>{e.fs.exists(a(v))||$(v)})}));const[k,D]=yt({});function G(v){var u;return((u=k[v])==null?void 0:u.call(k))||[]}oe(ze(()=>[c(),...J()],v=>{const u=z(Qt(()=>e.fs.exists(a(v))?e.fs.readdir(a(v),{withFileTypes:!0}).map(P=>({id:l(P.path),type:P.type})):null,P=>P.id,P=>{const F=z(()=>s(a(P().id))),N=z(()=>me.getName(a(P().id)));return{id:P().id,get type(){return P().type},get path(){return a(P().id)},get indentation(){return F()},get name(){return N()},select(){A(P().id)},deselect(){O(P().id)},shiftSelect(){C(P().id)},get selected(){return R(P().id)},rename(V){g(a(P().id),V)},focus(){p(P().id)},blur(){h(P().id)},get focused(){return d(P().id)},get expand(){if(P().type!=="file")return()=>M(P().id)},get collapse(){if(P().type!=="file")return()=>$(P().id)},get expanded(){if(P().type!=="file")return xe(P().id)}}})),x=z(()=>u().toSorted(e.sort??((P,F)=>P.type!==F.type?P.type==="dir"?-1:1:P.path.toLowerCase()<F.path.toLowerCase()?-1:1)));D(v,()=>x),Z(()=>D(v,void 0))}));const b=z(()=>{const v=new Array,u=[c()];for(;u.length>0;){const x=u.shift(),P=G(x);u.push(...P.filter(F=>F.type==="dir"&&F.expanded).map(F=>F.id)),v.splice(v.findIndex(F=>F.id===x)+1,0,...P)}return v});function s(v){return v.split("/").length-t.base.split("/").length}function g(v,u){ye(()=>{var x;n(v,u),e.fs.rename(v,u),(x=e.onRename)==null||x.call(e,v,u)})}function y(v){const u=o();if(!u)throw new Error("Attempted to moveToPath without dirEnt focused");const x=m(v),F=(_().includes(u)?_():[u]).map(a),N=new Array;for(const T of F){if(T===v)throw new Error(`Cannot move ${T} into itself.`);if(me.isAncestor(v,T))throw new Error(`Cannot move because ${T} is ancestor of ${v}.`)}const V=F.sort((T,W)=>T.toLowerCase()<W.toLowerCase()?-1:1).map((T,W,K)=>{const U=K.slice(0,W).find(ie=>me.isAncestor(T,ie)),ne=(U?[v,me.getName(U),T.replace(`${U}/`,"")]:[v,me.getName(T)]).filter(Boolean).join("/");return e.fs.exists(ne)&&N.push({oldPath:T,newPath:ne}),{oldPath:T,newPath:ne,shouldRename:!U}});if(N.length>0)throw new Error(`Error while moving dirEnts. The following paths already exist:
${N.map(({newPath:T})=>T).join(`
`)}`);ye(()=>{V.forEach(({oldPath:T,newPath:W,shouldRename:K})=>{K&&g(T,W)}),xe(x)||M(x)})}const S={get fs(){return t.fs},get base(){return t.base},getDirEntsOfDirId:G,moveToPath:y,pathToId:m,expandDirById:M,collapseDirById:$,isDirExpandedById:xe,selectDirEntById:A,deselectDirEntById:O,shiftSelectDirEntById:C,resetSelectedDirEntIds:Q,focusDirEnt:p,blurDirEnt:h,isDirEntFocused:d};return ae(()=>_().forEach(i)),ae(()=>J().forEach(i)),(()=>{var v=kn();return Be(v,ce(r,{onDragOver:u=>{var x;u.preventDefault(),(x=e.onDragOver)==null||x.call(e,u)},onDrop:u=>{var x;y(t.base),(x=e.onDrop)==null||x.call(e,u)},onPointerUp:u=>{var x;u.currentTarget===u.target&&Q(),(x=e.onPointerUp)==null||x.call(e,u)}}),!1,!0),Y(v,E(tr.Provider,{value:S,get children(){return E(Cn,{get each(){return b()},by:u=>u.id,children:u=>E(rr.Provider,{value:u,get children(){return ee(()=>e.children(u,S))}})})}})),v})()}ve.DirEnt=function(e){const t=ce({draggable:!0},e),r=xt(),l=tt(),i={ref(n){var a;oe(()=>{l().focused&&n.focus()}),(a=e.ref)==null||a.call(e,n)},onKeyDown(n){var a;const m=l();switch(n.code){case"Space":m.type==="dir"?m.expanded?m.collapse():m.expand():(r.resetSelectedDirEntIds(),m.select());break}(a=e.onKeyDown)==null||a.call(e,n)},onPointerUp(n){var a;const m=l();ye(()=>{n.shiftKey?l().shiftSelect():n[Fn]?l().selected?l().deselect():l().select():(r.resetSelectedDirEntIds(),l().select()),m.type==="dir"&&(m.expanded?m.collapse():m.expand())}),(a=e.onPointerUp)==null||a.call(e,n)},onDragOver:n=>{var a;n.preventDefault(),(a=e.onDragOver)==null||a.call(e,n)},onDrop:n=>{var a;n.preventDefault(),n.stopPropagation();const m=l();m.type==="dir"?r.moveToPath(m.path):r.moveToPath(me.getParent(m.path)),(a=e.onDrop)==null||a.call(e,n)},onFocus(n){var a;l().focus(),(a=e.onFocus)==null||a.call(e,n)},onBlur(n){var a;l().blur(),(a=e.onBlur)==null||a.call(e,n)}};return E(fe,{get when(){return l().type==="dir"},get fallback(){return(()=>{var n=Rt();return Be(n,ce(t,i),!1,!1),n})()},children:n=>E(fe,{get when(){return l().path},get children(){var a=Rt();return Be(a,ce(t,i),!1,!0),Y(a,()=>e.children),a}})})};ve.IndentGuides=function(e){const t=tt(),r=xt();function l(a){const m=me.getParent(a);if(m===r.base)return!1;const c=r.getDirEntsOfDirId(r.pathToId(m));return c.findIndex(f=>f.path===a)===c.length-1}function i(a){return t().path.split("/").slice(0,a+2).join("/")}function n(a){const m=t().indentation-a===1;return m&&l(t().path)?"elbow":l(i(a))?"spacer":m?"tee":"pipe"}return E(zr,{get each(){return Array.from({length:t().indentation},(a,m)=>n(m))},children:a=>E(nr.Provider,{value:a,get children(){return e.render(a)}})})};ve.Expanded=function(e){const[,t]=$e(e,["expanded","collapsed"]),r=tt();return E(fe,{get when(){return r().type==="dir"},get children(){var l=er();return Be(l,t,!1,!0),Y(l,E(fe,{get when(){return r().expanded},get fallback(){return e.expanded},get children(){return e.collapsed}})),l}})};ve.Name=function(e){const t=tt(),r=xt();function l(i){const n=me.rename(t().path,i.value);if(n!==t().path){if(r.fs.exists(n))throw i.value=t().name,new Error(`Path ${n} already exists.`);t().rename(n),t().focus()}}return E(fe,{get when(){return e.editable},get fallback(){return(()=>{var i=er();return Y(i,()=>t().name),X(n=>{var a=e.class,m=e.style;return a!==n.e&&Fe(i,n.e=a),n.t=Pt(i,m,n.t),n},{e:void 0,t:void 0}),i})()},get children(){var i=An();return i.addEventListener("blur",n=>{var a;r.fs.exists(t().path)&&l(n.currentTarget),(a=e.onBlur)==null||a.call(e,n)}),i.$$keydown=n=>{n.code==="Enter"&&l(n.currentTarget)},mt(n=>{Bt(()=>{n.focus();const a=n.value,m=a.indexOf("."),c=m===-1?a.length:m;n.setSelectionRange(0,c)})},i),Lt(i,"spellcheck",!1),X(n=>{var a=e.class,m={all:"unset",...e.style};return a!==n.e&&Fe(i,n.e=a),n.t=Pt(i,m,n.t),n},{e:void 0,t:void 0}),X(()=>i.value=t().name),i}})};vt(["keydown"]);const Mn="defaults-module__container___jzd8f",On="defaults-module__elbow___djaDw",Ln="defaults-module__pipe___hhrUb",Nn="defaults-module__arm___AjtFx",Me={container:Mn,elbow:On,pipe:Ln,arm:Nn};var Oe=j("<span>");function Bn(e){const t=Tn();return(()=>{var r=Oe();return Y(r,E(ct,{get children(){return[E(Se,{get when(){return t()==="elbow"},get children(){var l=Oe();return X(()=>Fe(l,Me.elbow)),l}}),E(Se,{get when(){return t()==="tee"},get children(){return[(()=>{var l=Oe();return X(()=>Fe(l,Me.pipe)),l})(),(()=>{var l=Oe();return X(()=>Fe(l,Me.arm)),l})()]}}),E(Se,{get when(){return t()==="pipe"},get children(){var l=Oe();return X(()=>Fe(l,Me.pipe)),l}})]}})),X(l=>{var i=Me.container,n=e.color,a=`${e.width}px`;return i!==l.e&&Fe(r,l.e=i),n!==l.t&&((l.t=n)!=null?r.style.setProperty("--color",n):r.style.removeProperty("--color")),a!==l.a&&((l.a=a)!=null?r.style.setProperty("width",a):r.style.removeProperty("width")),l},{e:void 0,t:void 0,a:void 0}),r})()}var Un=j("<div>");const Hn=e=>{let t=z(()=>Hr(e.vfs)),r=new or,l=o=>r.get(o)?.()??!1,[i,n]=H(0),m=(()=>{var o=Un();return o.style.setProperty("width","100%"),o.style.setProperty("height","100%"),Y(o,E(fe,{get when(){return t()},children:f=>E(ve,{get fs(){return f()},style:{display:"grid",height:"100vh","align-content":"start"},children:d=>{ae(()=>{let w=d().path,I=()=>d().selected;ae(()=>{I()&&(n(_=>_+1),Z(()=>{n(_=>_-1)}))}),r.set(w,I),Z(()=>{r.get(w)===I&&r.delete(w)})});let[p,h]=H(!1);return E(ve.DirEnt,{get style(){return{"text-align":"left",display:"flex",margin:"0px",padding:"0px",border:"none",color:"white",background:d().selected?"blue":"none"}},get children(){return[E(ve.IndentGuides,{render:()=>E(Bn,{color:"white",width:15})}),E(ve.Expanded,{collapsed:"-",expanded:"+",style:{width:"15px","text-align":"center"}}),E(ve.Name,{get editable(){return p()},get style(){return{"margin-left":d().type==="file"?"7.5px":void 0}},onBlur:()=>h(!1)})]}})}})})),o})();return{fs:t,isSelected:l,selectionCount:i,Render:()=>m}},Wn=`<html>
    <head></head>
    <body style="background-color: black; color: lime; margin: 0;">
        <script type="module">
            import "./index.ts";
        <\/script>
    </body>
</html>
`,Kn=`// @ts-ignore
import * as _ecs from "ecs-lib@0.8.0-pre.2";
type Ecs = typeof import("ecs-lib");
const _ecs2 = _ecs as Ecs;
let world = new _ecs2.default();
let ecs = _ecs2.default;

type ECS = typeof world;

let sources = new Map<
  string,
  {
    url: string;
    code: Promise<{
      onUnload?: (ecsy: Ecs["default"], world: ECS) => void;
    }>;
  }
>();

window.addEventListener("message", (e) => {
  let msg = e.data;
  if (msg.type == "UpdateSource") {
    let path = msg.path;
    let url = msg.url;
    let code = import(url);
    sources.set(path, {
      url,
      code,
    });
  } else if (msg.type == "DisposeSource") {
    let path = msg.path;
    let node = sources.get(path);
    if (node != undefined) {
      sources.delete(path);
      (async () => {
        let code2 = await node.code;
        code2.onUnload?.(ecs, world);
      })();
    }
  }
});

document.body.append(document.createTextNode("Hello World!"));
`;var Gn=j("<iframe style=flex-grow:1;>");let jn=await import(Nt);console.log(jn);const Vn=window.location.href,at=new URL(Vn),Ve=at.protocol+at.host+at.pathname;function qn(){const e=({path:t,source:r,executables:l})=>_r(r,i=>{if(i=="prelude"){let n=Nt;return n.startsWith("http:")||n.startsWith("https:")?n:(n.startsWith("/")&&(n=n.slice(1)),Ve+n)}if(i=="prelude/solid-js"){let n=Rr;return n.startsWith("http:")||n.startsWith("https:")?n:(n.startsWith("/")&&(n=n.slice(1)),Ve+n)}if(i=="prelude/solid-js/store"){let n=Or;return n.startsWith("http:")||n.startsWith("https:")?n:(n.startsWith("/")&&(n=n.slice(1)),Ve+n)}if(i=="prelude/pixi.js"){let n=Mr;return n.startsWith("http:")||n.startsWith("https:")?n:(n.startsWith("/")&&(n=n.slice(1)),Ve+n)}if(i.startsWith(".")){const n=l.get($r(t,i));if(!n)throw"url is undefined";return n}else return kr(i)?i:`https://esm.sh/${i}`});return Cr({css:{type:"css"},js:{type:"javascript",transform:e},ts:{type:"javascript",transform({path:t,source:r,executables:l}){return e({path:t,source:Ar.transpile(r,{module:Tr.ES2022}),executables:l})}},html:{type:"html",transform(t){return Dr(t).transformModuleScriptContent(e).bindScriptSrc().bindLinkHref().toString()}}})}const Mt=e=>{let[t,r]=H(),l=qn();l.writeFile("index.html",Wn),l.writeFile("index.ts",Kn);let i;{let c=z(()=>e.vfs.rootFolder());i=z(()=>c()())}let n;{let c=z(()=>{let o=i();if(o.type!="Success")return o;let f=o.value,d;for(let p of f.contents)if(p.name==Le&&p.type=="Folder"){d=p.id;break}return d==null?st("Source folder not found."):Ne(f.openFolderById(d))});n=z(()=>{let o=c();return o.type!="Success"?o:o.value()})}let a;{let c=z(()=>{let o=n();if(o.type!="Success")return o;let f=o.value;return Ne(z(ze(()=>f.contents,d=>z(()=>{if(d.type=="File")return f.openFileById(d.id)}))))});a=z(()=>{let o=c();if(o.type!="Success")return o;let f=o.value(),d=[];for(let p of f){let h=p();if(h==null)continue;let w=h();if(w.type!="Success")return w;d.push(w.value)}return Ne(d)})}let m=z(()=>{let c=a();return c.type=="Pending"?[]:c.type=="Failed"?(console.log(c.message),[]):c.value});return Bt(()=>{let c=z(()=>{let f=t();if(f==null)return;let d=f;if(d.contentWindow==null)return;let[h]=dt(()=>new Promise(w=>{let I=()=>{d.removeEventListener("load",I),w(!0)};d.addEventListener("load",I)}));return h}),o=z(()=>c()?.()??!1);ae(()=>{if(!o())return;let f=t();if(f==null)return;let p=f.contentWindow;p!=null&&ae(et(()=>e.vfsDocUrl,h=>{p.postMessage({type:"SetDocUrl",params:{docUrl:h}})}))}),l.mkdir("user_code"),ae(()=>{if(!o())return;let f=t();if(f==null)return;let p=f.contentWindow;p!=null&&ae(ze(m,h=>{ae(()=>{let w="user_code/"+h.name(),I=h.doc.source;ee(()=>l.writeFile(w,I)),Z(()=>{l.rm(w)}),ae(()=>{let _=l.getExecutable(w);_!=null&&(p.postMessage({type:"UpdateSource",url:_}),Z(()=>{p.postMessage({type:"DisposeSource",url:_})}))})})}))})}),(()=>{var c=Gn(),o=r;return typeof o=="function"?mt(o,c):r=c,X(()=>Lt(c,"src",l.getExecutable("index.html"))),c})()};var Yn=j('<div><div><div>Select an example to load:</div><div><table class=table><thead></thead><tbody></tbody></table></div><button class="btn btn-primary">Load Example'),Jn=j("<tr><td>");const Ot={"Mario Clone":{skipPathCharCount:27,sources:Object.assign({}),data:Object.assign({})}},Xn=e=>{let[t,r]=$e(e,["vfs","onDone"]),[l,i]=yt({selectedExampleByName:void 0});return(()=>{var n=Yn(),a=n.firstChild,m=a.firstChild,c=m.nextSibling,o=c.firstChild,f=o.firstChild,d=f.nextSibling,p=c.nextSibling;return Be(n,r,!1,!0),a.style.setProperty("width","100%"),a.style.setProperty("height","100%"),a.style.setProperty("display","flex"),a.style.setProperty("flex-direction","column"),a.style.setProperty("overflow","hidden"),c.style.setProperty("flex-grow","1"),c.style.setProperty("overflow-y","auto"),Y(d,E(Pr,{get each(){return Object.keys(Ot)},children:h=>{let w=z(()=>l.selectedExampleByName==h);return(()=>{var I=Jn(),_=I.firstChild;return I.$$click=()=>{i("selectedExampleByName",h)},I.style.setProperty("cursor","pointer"),Y(_,h),X(R=>ar(I,{"hover:bg-base-300":!0,"bg-base-300":w()},R)),I})()}})),p.$$click=async()=>{if(l.selectedExampleByName==null)return;let h=Ot[l.selectedExampleByName];h!=null&&(await Zn(t.vfs,h),t.onDone())},X(()=>p.disabled=l.selectedExampleByName==null),n})()};async function Zn(e,t){if(!window.confirm("Are you sure you want to load it?, (it will replace your current file system)"))return;let r;{let n=await new Promise(a=>{Re(m=>{let c=e.rootFolder();ae(()=>{let o=c();if(o.type=="Pending")return;if(o.type=="Failed"){m(),a(It(o.message));return}let f=o.value;ee(()=>{let d=f.contents;for(let p of d)f.removeFileOrFolderById(p.id)}),m(),a(qe(f))})})});if(n.type=="Err")return n;r=n.value}let l=async(n,a)=>{if(a.length==0)return qe({folder:n,cleanup:()=>{}});let m=a[0],c=a.slice(1),o=n.getOrCreateFolder(m);if(o.type=="Err")return o;let f=o.value.id;return new Promise(d=>{Re(p=>{let h=n.openFolderById(f);ae(et(h,w=>{if(w.type=="Pending")return;if(w.type=="Failed"){p(),d(It(w.message));return}let I=w.value;(async()=>{let _=await l(I,c);if(_.type=="Err"){p(),d(_);return}let R=_.value;d(qe({folder:R.folder,cleanup:()=>{R.cleanup(),p()}}))})()}))})})},i=[];try{let n=new Map;for(let a of Object.entries({...t.sources,...t.data})){let m=a[0].slice(t.skipPathCharCount),c=a[1],o=m.split("/");if(o.length==0)continue;let d=o.slice(0,o.length-1).join("/"),p=n.get(d);if(p==null){let _=o.slice(0,o.length-1),R=await l(r,_);if(R.type=="Err"){console.log(R.message);continue}i.push(R.value.cleanup),p=R.value.folder,n.set(d,p)}let h=o[o.length-1],w;if(h.endsWith(".ts"))w={source:c};else if(h.endsWith(".json"))w=await(await fetch(c)).json();else if(h.endsWith(".png")){let R=await(await fetch(c)).blob();w={mimeType:R.type,data:new Uint8Array(await R.arrayBuffer())}}else continue;let I=p.createFile(h,w);I.type=="Err"&&console.log(I.message)}}finally{i.forEach(n=>n())}}vt(["click"]);var Qn=j('<h3 class="text-lg font-bold">Connection Manager'),ei=j('<h3 class="text-lg font-bold">File Explorer'),ti=j('<div><div style=margin-bottom:5px;><button class="btn btn-primary">New '),ri=j('<li><button class="btn btn-xs btn-secondary">Enable BNA'),ni=j('<div class="size-full rounded-sm transition-colors group-data-active:bg-corvu-300 group-data-dragging:bg-corvu-100">'),ii=j('<div><ul class="menu menu-horizontal bg-base-200 rounded-box"><li><i class="fa-solid fa-network-wired"></i></li><li><i class="fa-solid fa-folder-tree"></i></li><li><label><input type=checkbox class="checkbox checkbox-xs"style=display:inline-block;>Show Game</label></li><li><select class="select select-xs"><option value=monaco>Monaco</option><option value=codemirror>Code Mirror</option></select></li><li><button class="btn btn-xs btn-primary">Load Example...</button></li><li><i class="fa-solid fa-download"></i></li></ul><div>'),li=j('<li><i class="fa-solid fa-upload"></i><input type=file hidden>'),oi=j('<div><div class="bg-base-200 rounded-box"><div class="bg-base-300 rounded-box"><div></div><button class="btn btn-primary"><i class="fa-solid fa-xmark"></i></button></div><div>');const $i=e=>{let[t,r]=yt({showGame:!1,useCodeMirror:!1,overlayApp:void 0}),l=Hn({get vfs(){return e.vfs}}),i=z(()=>q(e.vfs)),n=()=>l.selectionCount(),a=z(()=>{if(n()==1){if(l.isSelected("images"))return"Images";if(l.isSelected("texture_atlases"))return"Texture Atlases";if(l.isSelected("levels"))return"Levels";if(l.isSelected(Le))return"Source"}}),m=z(()=>{let s=i();if(s.type!="Success")return s;let g=s.value;return q(g.rootFolder())}),c=z(()=>{let s=m();return s.type!="Success"?s:s.value()}),o=s=>{let g=z(()=>{let y=c();if(y.type!="Success")return y;let S=y.value,v=z(()=>{let x=ee(()=>S.getFolderId(s));if(x!=null)return q(x);let P=S.createFolder(s);return P.type=="Err"?Ae(P.message):q(P.value.id)}),u=z(()=>{let x=v();if(x.type!="Success")return x;let P=x.value;return q(S.openFolderById(P))});return q(z(()=>{let x=u();return x.type!="Success"?x:x.value()}))});return z(()=>{let y=g();return y.type!="Success"?y:y.value()})},f=o(sr),d=o(cr),p=o(dr),h=o(Le);ae(et(h,s=>{if(s.type!="Success")return;let g=s.value;Fr(g),Ur(g)}));let w=z(()=>{if(n()!=1)return;let s=f();if(s.type!="Success")return;let y=s.value.contents;for(let S of y)if(S.type=="File"&&l.isSelected("images/"+S.name))return S.id}),I=z(()=>{if(n()!=1)return;let s=d();if(s.type!="Success")return;let y=s.value.contents;for(let S of y)if(S.type=="File"&&l.isSelected("texture_atlases/"+S.name))return S.id}),_=z(()=>{if(n()!=1)return;let s=p();if(s.type!="Success")return;let y=s.value.contents;for(let S of y)if(S.type=="File"&&l.isSelected("levels/"+S.name))return S.id}),R=z(()=>{if(n()!=1)return;let s=h();if(s.type!="Success")return;let y=s.value.contents;for(let S of y)if(S.type=="File"&&l.isSelected(Le+"/"+S.name))return S.name});z(()=>{if(n()!=1)return;let s=h();if(s.type!="Success")return;let y=s.value.contents;for(let S of y)if(S.type=="File"&&l.isSelected(Le+"/"+S.name))return S.id});const A=()=>{r("overlayApp",new rt({Title:()=>Qn(),View:()=>E(e.ConnectionManagementUi,{})}))},O=()=>{let s=p();if(s.type!="Success")return;let g=s.value,y=window.prompt("Enter name for level:");if(y==null||(y=y.trim(),y==""))return;y+=".json";let S=pr.create({tileToShortIdTable:[],mapData:Array(10).fill(void 0).map(x=>Array(10).fill(void 0).map(P=>0))}),v=new br;v.createEntity([S]);let u=g.createFile(y,v.toJson());u.type!="Err"&&u.value.id},C=()=>{let s=h();if(s.type!="Success")return;let g=s.value,y=window.prompt("Enter name of source file:");if(y==null||(y=y.trim(),y==""))return;y+=".ts";let S=g.createFile(y,{source:""});S.type!="Err"&&S.value.id},Q=()=>{r("overlayApp",new rt({Title:()=>ei(),View:()=>(()=>{var s=ti(),g=s.firstChild,y=g.firstChild;return y.firstChild,s.style.setProperty("flex-grow","1"),s.style.setProperty("display","flex"),s.style.setProperty("flex-direction","column"),y.$$click=()=>{let S=a();if(S!=null)switch(S){case"Images":break;case"Texture Atlases":break;case"Levels":O();break;case"Source":C();break}},Y(y,()=>{let S=a();if(S!=null)switch(S){case"Images":return"Image";case"Texture Atlases":return"Texture Atlas";case"Levels":return"Level";case"Source":return"Source"}},null),Y(s,E(l.Render,{}),null),X(()=>y.disabled=a()==null),s})()}))},J=()=>{r("overlayApp",new rt({Title:()=>"Examples",View:()=>E(Xn,{get vfs(){return e.vfs},onDone:async()=>{r("overlayApp",void 0),await e.flushRepo(),window.location.reload()}})}))};let we=z(()=>{let s=f();if(s.type!="Success")return;let g=s.value,y=w();if(y!=null)return g.openFileById(y)}),xe=z(()=>{let s=we();if(s==null)return;let g=s();if(g.type=="Success")return g.value}),$=z(()=>{let s=xe();if(s==null)return;let g=s.doc.mimeType,y=s.doc.data,S=new Blob([y],{type:g}),v=URL.createObjectURL(S);Z(()=>{URL.revokeObjectURL(v)});let[u]=dt(()=>new Promise((x,P)=>{let F=new Image;F.src=v,F.onload=N=>{x(F)},F.onerror=N=>{P(N)}}));return u}),M=z(()=>$()?.()),k;{let s=z(()=>{let g=f();if(g.type!="Success")return g;let y=g.value,S=z(ze(()=>y.contents,v=>z(()=>{if(v.type=="File")return y.openFileById(v.id)})));return q(z(()=>{let v=[],u=S();for(let x of u){let P=x();if(P==null)continue;let F=P();if(F.type!="Success")return F;v.push(F.value)}return q(v)}))});k=z(()=>{let g=s();return g.type!="Success"?g:g.value()})}let D;{let s=z(()=>{let u=d();if(u.type!="Success")return u;let x=u.value,P=z(ze(()=>x.contents,F=>z(()=>{if(F.type=="File")return x.openFileById(F.id)})));return q(z(()=>{let F=[],N=P();for(let V of N){let T=V();if(T==null)continue;let W=T();if(W.type!="Success")return W;F.push(W.value)}return q(F)}))}),g=z(()=>{let u=k();if(u.type!="Success")return u;let x=u.value,P=new Map;for(let F of x)P.set(F.name(),F);return q(P)}),y=z(()=>{let u=s();return u.type!="Success"?u:u.value()}),S=z(()=>y().type),v=z(()=>{let u=g();if(u.type!="Success")return u;let x=u.value;if(S()!="Success")return y();let P=z(()=>{let F=y();if(F.type!="Success")throw new Error("Unreachable");return F.value});return q(z(ze(P,F=>z(()=>{let N=ur.create(fr,F.docHandle);if(N.type=="Err")return Ae(N.message);let V=N.value;return q(z(()=>{let T=V,W=T.entitiesWithComponentType(Et);if(W.length!=1)return Ae("Expected expect exactly one texture atlas entity.");let K=W[0],U=T.getComponent(K,Et)?.state;if(U==null)return Ae("Texture atlas not found in texture atlas file.");let ie=T.entitiesWithComponentType(Ft).flatMap(He=>gr(T.getComponent(He,Ft)?.state).map(We=>({frameId:He,frame:We}))),le=U,Pe=le.imageRef,ge=x.get(Pe);return ge==null?Ae("Texture atlas referenced image not found."):q(z(()=>{let He=new Blob([ge.doc.data],{type:ge.doc.mimeType}),We=URL.createObjectURL(He);Z(()=>URL.revokeObjectURL(We));let[ir]=dt(()=>new Promise(Ie=>{let ke=new Image;ke.src=We,ke.onerror=()=>{Ie(mr("Failed to load image."))},ke.onload=()=>{Ie(qe(ke))}}));return q(z(()=>{let Ie=ir();if(Ie==null)return vr();if(Ie.type=="Err")return Ae(Ie.message);let ke=Ie.value;return q({textureAtlasFilename:F.name,textureAtlas:le,image:ke,frames:ie})}))}))}))}))))});D=z(()=>{let u=[],x=v();if(x.type!="Success")return x;let P=x.value();for(let F of P){let N=F();if(N.type!="Success")return N;let V=N.value();if(V.type!="Success")return V;let T=V.value();if(T.type!="Success")return T;let W=T.value();if(W.type!="Success")return W;let K=W.value;u.push(K)}return q(u)})}let G=z(()=>{let s=M();if(s!=null)return()=>E(Ir,{initImage:s});let g=I();if(g!=null){let v=i();if(v.type!="Success")return t.showGame?()=>{}:je;let u=v.value,x=new yr({vfs:u,imagesFolder:f,textureAtlasesFolder:d,textureAtlasFileId:()=>g});return()=>E(x.Render,{style:{"flex-grow":"1"}})}let y=_();if(y!=null){let v=i();if(v.type!="Success")return t.showGame?()=>{}:je;let u=v.value,x=new hr({vfs:u,imagesFolder:f,textureAtlasesFolder:d,levelFileId:()=>y,textureAtlasWithImageAndFramesList:D});return()=>E(x.Render,{style:{"flex-grow":"1"}})}let S=R();if(S!=null){let v=h();return v.type!="Success"?t.showGame?()=>{}:je:(v.value,()=>E(ct,{get children(){return[E(Se,{get when(){return t.useCodeMirror},get children(){return E(Br,{path:S})}}),E(Se,{get when(){return!t.useCodeMirror},get children(){return E(Er,{path:S})}})]}}))}return t.showGame?()=>{}:je}),b=()=>z(()=>G()({}));return(()=>{var s=ii(),g=s.firstChild,y=g.firstChild,S=y.nextSibling,v=S.nextSibling,u=v.firstChild,x=u.firstChild,P=v.nextSibling,F=P.firstChild,N=P.nextSibling,V=N.firstChild,T=N.nextSibling,W=g.nextSibling;return s.style.setProperty("flex-grow","1"),s.style.setProperty("overflow","hidden"),s.style.setProperty("display","flex"),s.style.setProperty("flex-direction","column"),s.style.setProperty("position","relative"),Y(s,w,g),y.$$click=()=>A(),S.$$click=()=>Q(),x.addEventListener("change",K=>{r("showGame",K.currentTarget.checked)}),F.addEventListener("change",K=>{r("useCodeMirror",K.currentTarget.value=="codemirror")}),V.$$click=()=>J(),Y(g,E(fe,{get when(){return!e.broadcastNetworkAdapterIsEnabled},get children(){var K=ri(),U=K.firstChild;return U.$$click=()=>{e.enableBroadcastNetworkAdapter()},K}}),T),T.$$click=()=>Lr({vfs:e.vfs}),Y(g,()=>ee(()=>{let K;return(()=>{var U=li(),ne=U.firstChild,ie=ne.nextSibling;U.$$click=()=>{K.click()},ie.addEventListener("change",()=>{let Pe=K.files;Pe!=null&&Pe.length==1&&(async()=>(await Nr({file:Pe[0],vfs:e.vfs}),await e.flushRepo(),window.location.reload()))()});var le=K;return typeof le=="function"?mt(le,ie):K=ie,U})()}),null),W.style.setProperty("flex-grow","1"),W.style.setProperty("display","flex"),W.style.setProperty("flex-direction","row"),W.style.setProperty("overflow","hidden"),Y(W,E(ct,{get children(){return[E(Se,{get when(){return!t.showGame},get children(){return E(b,{})}}),E(Se,{get when(){return z(()=>!!t.showGame)()&&G()({})==null},get children(){return E(Mt,{get vfsDocUrl(){return e.vfsDocUrl},get vfs(){return e.vfs}})}}),E(Se,{get when(){return z(()=>!!t.showGame)()&&G()({})!=null},get children(){return E(Ge,{orientation:"horizontal",style:{"flex-grow":"1",overflow:"hidden"},get children(){return[E(Ge.Panel,{style:{display:"flex",overflow:"hidden"},get children(){return E(b,{})}}),E(Ge.Handle,{"aria-label":"Resize Handle",class:"group basis-3 px-0.75",get children(){return ni()}}),E(Ge.Panel,{style:{display:"flex",overflow:"hidden"},get children(){return E(Mt,{get vfsDocUrl(){return e.vfsDocUrl},get vfs(){return e.vfs}})}})]}})}})]}})),Y(s,E(fe,{get when(){return t.overlayApp?.value},keyed:!0,children:K=>(()=>{var U=oi(),ne=U.firstChild,ie=ne.firstChild,le=ie.firstChild,Pe=le.nextSibling,ge=ie.nextSibling;return U.style.setProperty("position","absolute"),U.style.setProperty("left","0"),U.style.setProperty("top","0"),U.style.setProperty("bottom","0"),U.style.setProperty("right","0"),U.style.setProperty("display","flex"),U.style.setProperty("overflow","hidden"),ne.style.setProperty("flex-grow","1"),ne.style.setProperty("margin","5%"),ne.style.setProperty("display","flex"),ne.style.setProperty("flex-direction","column"),ne.style.setProperty("overflow","hidden"),ie.style.setProperty("display","flex"),ie.style.setProperty("flex-direction","row"),ie.style.setProperty("padding","10px"),le.style.setProperty("flex-grow","1"),le.style.setProperty("display","flex"),le.style.setProperty("flex-direction","row"),le.style.setProperty("align-items","center"),le.style.setProperty("overflow","hidden"),Y(le,E(K.Title,{})),Pe.$$click=()=>r("overlayApp",void 0),ge.style.setProperty("flex-grow","1"),ge.style.setProperty("display","flex"),ge.style.setProperty("padding","10px"),ge.style.setProperty("overflow","hidden"),Y(ge,E(K.View,{})),U})()}),null),X(()=>x.checked=t.showGame),X(()=>F.value=t.useCodeMirror?"codemirror":"monaco"),s})()};vt(["click"]);export{$i as default};
