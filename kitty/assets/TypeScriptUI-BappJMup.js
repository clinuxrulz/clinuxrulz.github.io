import{u as h,t as y}from"./lib-BglJtDE2.js";import{w as S,E as c,b as U,j as g,o as k,t as C,a as x,c as E,d as L,e as _,f as b,g as j,k as M,i as R,h as W,l as F,m as $,n as H,p as D}from"./index-DTYtQKXs.js";import{m as O,q as m,c as f,Q as T,O as G}from"./dev-B9-ass9r.js";import{c as I,p as q,t as z,r as A,i as J}from"./index-BFsIGCf5.js";import K,{ModuleKind as Q}from"typescript";import{E as V}from"./index-D5qnU5um.js";import"./index-XNH-lkY3.js";import"./dev-CC7pdsS5.js";var B=y("<div style=all:initial;width:100%;height:100%;overflow:auto;><div>");const N=new Worker(new URL(""+new URL("worker-CdeRgnG1.js",import.meta.url).href,import.meta.url),{type:"module"}),u=S(N);await u.initialize();function X(){const s=({path:t,source:a,executables:l})=>z(a,i=>{if(i=="prelude"||i.startsWith(".")){i=="prelude"&&(i="node_modules/prelude/index.ts");const d=l.get(A(t,i));if(!d)throw"url is undefined";return d}else return J(i)?i:`https://esm.sh/${i}`});return I({css:{type:"css"},js:{type:"javascript",transform:s},ts:{type:"javascript",transform({path:t,source:a,executables:l}){return s({path:t,source:K.transpile(a,{module:Q.ES2022}),executables:l})}},html:{type:"html",transform(t){return q(t).transformModuleScriptContent(s).bindScriptSrc().bindLinkHref().toString()}}})}const oe=s=>{O(()=>{u.updateFile({path:"/node_modules/prelude/index.ts",code:s.preludeSource})});let t=X();t.mkdir("node_modules/prelude",{recursive:!0}),t.writeFile("node_modules/prelude/index.ts",s.preludeSource);const a="index.ts";t.writeFile(a,s.initSource);let l;{let o=m(()=>{let e=t.getExecutable("node_modules/prelude/index.ts");if(e==null)return;G(()=>URL.revokeObjectURL(e));let[n,r]=f();return(async()=>{let w=await import(e);r(w)})(),n});l=m(()=>o()?.())}let i=0,d;s.onInit({refresh:()=>{let o=l(),e=t.getExecutable(a);if(o==null||e==null||e==d)return;d=e;let n=++i,r=new V;o.withWorld(s.registry,r,async()=>{await import(e),URL.revokeObjectURL(e),n==i&&s.onWorldUpdate(r)})}});let[v,p]=f();return T(()=>{let o=v();if(o==null)return;let e=()=>{let r=n.state.doc.toString();t.writeFile(a,r)},n=new c({extensions:[U,g({typescript:!0,jsx:!0}),k,C.of({worker:u,path:a}),x({override:[D()]}),E(),L(),_(),b({}),j(),M.of([{key:"Tab",preventDefault:!0,shift:R,run:r=>W(r.state)?$(r):F(r)}]),H.of("  "),c.updateListener.of(r=>{r.docChanged&&e()})],parent:o});n.dispatch({changes:{from:0,to:n.state.doc.length,insert:s.initSource}})}),(()=>{var o=B(),e=o.firstChild,n=p;return typeof n=="function"?h(n,e):p=e,o})()};export{oe as default};
