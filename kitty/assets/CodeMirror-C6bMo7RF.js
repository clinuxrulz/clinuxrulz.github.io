import{R as F,u as w,t as M,a as C}from"./lib-BglJtDE2.js";import{w as b,E as k,b as I,j as S,o as T,t as g,a as x,c as A,d as L,e as W,f as _,g as $,k as j,i as R,h as H,l as U,m as V,n as q,p as B}from"./index-DTYtQKXs.js";import{Q as D,m as n,J as E,N as u,O as z,q as G,Y as J}from"./dev-B9-ass9r.js";import"./index-XNH-lkY3.js";import"./dev-CC7pdsS5.js";var N=M("<div style=all:initial;width:100%;height:100%;overflow:auto;><div>");const O=new Worker(new URL(""+new URL("worker-CF7x7hqh.js",import.meta.url).href,import.meta.url),{type:"module"}),h=b(O);await h.initialize();let m=new F;function P(c){let f=(i,o,t)=>{n(E(()=>t.contents,a=>n(()=>{switch(a.type){case"File":{let e=a.id,r=i+a.name,s=o+a.name,l=t.openFileById(e);n(u(l,d=>{if(d.type!="Success")return;let p=d.value;n(u(()=>p.doc.source,y=>{h.updateFile({path:s,code:y})},{defer:!0}));let v={file:p};m.set(r,v),z(()=>{h.deleteFile(s),m.get(r)===v&&m.delete(r)})}));break}case"Folder":{let e=a.id,r=t.openFolderById(e);n(u(r,s=>{if(s.type!="Success")return;let l=s.value;f(i+a.name+"/",o+a.name+"/",l)}));break}}})))};f("","file:///",c)}const ee=c=>{const f="index.ts";let i;return D(()=>{let o=()=>{},t=new k({extensions:[I,S({typescript:!0,jsx:!0}),T,g.of({worker:h,path:f}),x({override:[B()]}),A(),L(),W(),_({}),$(),j.of([{key:"Tab",preventDefault:!0,shift:R,run:e=>H(e.state)?V(e):U(e)}]),q.of("  "),k.updateListener.of(e=>{e.docChanged&&o()})],parent:i});n(u(()=>c.path,e=>{if(e==null)return;let r=t.state.facet(g);r!=null&&(r.path=e)}));let a=G(()=>{if(c.path!=null)return m.get(c.path)});n(u(a,e=>{if(e==null)return;let r=e.file;t.dispatch({changes:{from:0,to:t.state.doc.length,insert:J(()=>r.doc.source)}});let s=!1,l=!1;o=()=>{if(!s){l=!0;try{let d=t.state.doc.toString();if(d==null)return;r.docHandle.change(p=>{C(p,["source"],d)})}finally{l=!1}}},n(u(()=>r.doc.source,d=>{if(!l){s=!0;try{t.dispatch({changes:{from:0,to:t.state.doc.length,insert:d}})}finally{s=!1}}}))}))}),(()=>{var o=N(),t=o.firstChild,a=i;typeof a=="function"?w(a,o):i=o;var e=i;return typeof e=="function"?w(e,t):i=t,o})()};export{ee as default,P as mountAutomergeFolderToCodeMirrorVfsWhileMounted};
