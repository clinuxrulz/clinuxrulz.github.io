import{Vec2 as p,s as z,t as j,e as Ie,o as ke,b as Be,U as rt,i as V,u as Pe,c as xe,d as ot}from"./lib-CyJlAutA.js";import{q as b,m as W,N as ye,O as le,Y as ze,l as Y,s as K,S as X,b as Q,t as Ze,c as Se,Q as Ae}from"./dev-B9-ass9r.js";import{a as pe}from"./dev-CC7pdsS5.js";import{C as ee,a as it}from"./ColourPicker-m0wAGaE7.js";import{a as lt}from"./index-Cb-QPvdN.js";import"./index-XNH-lkY3.js";class nt{constructor(e){}}function ie(D,e,o,g,u){let f=o-D,s=g-e,r=Math.abs(f),t=Math.abs(s),i=Math.sign(f),l=Math.sign(s);if(o+=i,g+=l,++r,++t,r>t){let a=t%r,d=0,v=r,y=e,P=D;for(;P!=o;P+=i)u(P,y),d+=a,d>=v&&(y+=l,d-=v)}else if(r<t){let a=r%t,d=0,v=t,y=D,P=e;for(;P!=g;P+=l)u(y,P),d+=a,d>=v&&(y+=i,d-=v)}else for(let a=D,d=e;a!=o;a+=i,d+=l)u(a,d)}function we(D,e,o,g,u){let f=e+g,s=D+o;for(let r=D;r<=D+o;++r)u(r,e),u(r,f);for(let r=e+1;r<=e+g-1;++r)u(D,r),u(s,r)}function me(D,e,o,g,u){if(o==0){for(let F=e;F<=e+g;++F)u(D,F);return}if(g==0){for(let F=D;F<=D+o;++F)u(F,e);return}let f=D+(o>>1),s=D+o-(o>>1),r=e+(g>>1),t=e+g-(g>>1),i=.5*o,l=.5*g,a=0,d=Math.ceil(l),v=l,y=i,P=v*v*a*a+y*y*d*d-v*v*y*y,k=2*v*v*a+v*v,I=-2*y*y*d+y*y,U=2*v*v,_=2*y*y,Z,A,R=()=>{a==Z&&d==A||(Z=a,A=d,u(f+a,r+d),u(s-a,r+d),u(f+a,t-d),u(s-a,t-d))};for(;a<=i;){R(),++a,P+=k,k+=U;let F=d;for(;P>0;)if(--d,P+=I,I+=_,d<0){for(d=F-1;d>=0;--d)R();return}for(;P<0;)++d,I-=_,P-=I;let te=d;for(d=F-1;d>te;--d)R();d=te}}function We(D,e,o,g){let u=o*o;for(let f=-(o-1);f<=o-1;++f){let s=f*f;for(let r=-(o-1);r<=o-1;++r){let t=r*r;s+t<u&&g(D+f,e+r)}}}function st(D,e,o,g){let u=[];for(u.push(e),u.push(D);u.length>=2;){let f=u.pop(),s=u.pop();if(o(f,s)){for(let r=f;o(r,s);++r)g(r,s),o(r,s-1)&&(u.push(s-1),u.push(r)),o(r,s+1)&&(u.push(s+1),u.push(r));for(let r=f-1;o(r,s);--r)g(r,s),o(r,s-1)&&(u.push(s-1),u.push(r)),o(r,s+1)&&(u.push(s+1),u.push(r))}}}var at=j("<svg><rect stroke=black stroke-width=2 fill=none pointer-events=none></svg>",!1,!0);class dt{instructions;overlaySvgUI;dragStart;dragEnd;disableOneFingerPan=()=>!0;constructor(e){let[o,g]=pe({dragging:!1}),u=b(()=>{let s=e.mousePos();if(s==null)return;let r=e.screenPtToWorldPt(s);if(r!=null)return p.create(Math.floor(r.x),Math.floor(r.y))}),f=s=>{let r=e.readPixel(s);if(r==null)return;let t=e.currentColour();return t.r==r.r&&t.g==r.g&&t.b==r.b&&t.a==r.a?void 0:(e.writePixel(s,t),{displayName:"Draw Pixel",run(l){l?e.writePixel(s,r):e.writePixel(s,t)}})};W(ye([()=>o.dragging],()=>{if(!o.dragging)return;let s,r=[];le(()=>{if(r.length!=0){let t=r;t.reverse(),r=[];let i={displayName:t[0].displayName,run(l){for(let a of t)a.run(l)}};e.undoManager.pushUndoUnit(i)}}),W(ye(u,()=>{let t=u();if(!t)return;let i=e.strokeThickness();if(i>1){if(s==null)We(t.x,t.y,i,(l,a)=>{let d=p.create(l,a);e.writePixel(d,e.currentColour())}),s=t;else{let l=s;We(t.x,t.y,i,(a,d)=>{let v=a-t.x+l.x,y=d-t.y+l.y;ie(v,y,a,d,(P,k)=>{let I=p.create(P,k);e.writePixel(I,e.currentColour())})}),s=t}return}if(s==null){let l=f(t);l!=null&&r.push(l),s=t}else{let l=[],a=p.zero,d=ze(()=>e.currentColour());ie(s.x,s.y,t.x,t.y,(P,k)=>{a=p.create(P,k),l.push(e.readPixel(a)??new ee(0,0,0,0)),e.writePixel(a,d)});let v=s;s=t;let y={displayName:"Draw Pixel",run(P){if(P){let k=0;ie(v.x,v.y,t.x,t.y,(I,U)=>{a=p.create(I,U),e.writePixel(a,l[k++])})}else ie(v.x,v.y,t.x,t.y,(k,I)=>{a=p.create(k,I),e.writePixel(a,d)})}};r.push(y)}}))})),this.instructions=()=>"Click to draw pixels, press escape when done.",this.overlaySvgUI=()=>{let s=b(()=>{let r=u();if(r==null)return;let t=p.create(1,1).add(r),i=e.worldPtToScreenPt(r);if(i==null)return;let l=e.worldPtToScreenPt(t);if(l!=null)return{x:i.x-1,y:i.y-1,w:l.x-i.x+2,h:l.y-i.y+2}});return Y(X,{get when(){return s()},children:r=>(()=>{var t=at();return K(i=>{var l=r().x,a=r().y,d=r().w,v=r().h;return l!==i.e&&z(t,"x",i.e=l),a!==i.t&&z(t,"y",i.t=a),d!==i.a&&z(t,"width",i.a=d),v!==i.o&&z(t,"height",i.o=v),i},{e:void 0,t:void 0,a:void 0,o:void 0}),t})()})},this.dragStart=()=>{g("dragging",!0)},this.dragEnd=()=>{g("dragging",!1)}}}var ut=j("<svg><rect stroke=black stroke-width=2 fill=none pointer-events=none></svg>",!1,!0);class ct{instructions;overlaySvgUI;click;constructor(e){let o=b(()=>{let g=e.mousePos();if(g==null)return;let u=e.screenPtToWorldPt(g);if(u!=null)return p.create(Math.floor(u.x),Math.floor(u.y))});this.instructions=()=>"Click on a pixel to grab the colour of.",this.overlaySvgUI=()=>{let g=b(()=>{let u=o();if(u==null)return;let f=p.create(1,1).add(u),s=e.worldPtToScreenPt(u);if(s==null)return;let r=e.worldPtToScreenPt(f);if(r!=null)return{x:s.x-1,y:s.y-1,w:r.x-s.x+2,h:r.y-s.y+2}});return Y(X,{get when(){return g()},children:u=>(()=>{var f=ut();return K(s=>{var r=u().x,t=u().y,i=u().w,l=u().h;return r!==s.e&&z(f,"x",s.e=r),t!==s.t&&z(f,"y",s.t=t),i!==s.a&&z(f,"width",s.a=i),l!==s.o&&z(f,"height",s.o=l),s},{e:void 0,t:void 0,a:void 0,o:void 0}),f})()})},this.click=()=>{let g=o();if(g==null)return;let u=e.readPixel(g);u!=null&&e.setCurrentColour(u)}}}var vt=j("<svg><rect stroke=black stroke-width=2 fill=none pointer-events=none></svg>",!1,!0);class gt{instructions;overlaySvgUI;dragStart;dragEnd;disableOneFingerPan=()=>!0;constructor(e){let[o,g]=pe({dragging:!1}),u=b(()=>{let s=e.mousePos();if(s==null)return;let r=e.screenPtToWorldPt(s);if(r!=null)return p.create(Math.floor(r.x),Math.floor(r.y))}),f=s=>{let r=e.readPixel(s);if(r==null)return;let t=new ee(0,0,0,0);return t.r==r.r&&t.g==r.g&&t.b==r.b&&t.a==r.a?void 0:(e.writePixel(s,t),{displayName:"Draw Pixel",run(l){l?e.writePixel(s,r):e.writePixel(s,t)}})};W(ye([()=>o.dragging],()=>{if(!o.dragging)return;let s=[];le(()=>{if(s.length!=0){let r=s;s=[];let t={displayName:r[0].displayName,run(i){for(let l of r)l.run(i)}};e.undoManager.pushUndoUnit(t)}}),W(ye(u,()=>{let r=u();if(!r)return;let t=f(r);t!=null&&s.push(t)}))})),this.instructions=()=>"Click to draw pixels, press escape when done.",this.overlaySvgUI=()=>{let s=b(()=>{let r=u();if(r==null)return;let t=p.create(1,1).add(r),i=e.worldPtToScreenPt(r);if(i==null)return;let l=e.worldPtToScreenPt(t);if(l!=null)return{x:i.x-1,y:i.y-1,w:l.x-i.x+2,h:l.y-i.y+2}});return Y(X,{get when(){return s()},children:r=>(()=>{var t=vt();return K(i=>{var l=r().x,a=r().y,d=r().w,v=r().h;return l!==i.e&&z(t,"x",i.e=l),a!==i.t&&z(t,"y",i.t=a),d!==i.a&&z(t,"width",i.a=d),v!==i.o&&z(t,"height",i.o=v),i},{e:void 0,t:void 0,a:void 0,o:void 0}),t})()})},this.dragStart=()=>{g("dragging",!0)},this.dragEnd=()=>{g("dragging",!1)}}}class De{db;constructor(e){this.db=e}static init(){return new Promise(e=>{let o=window.indexedDB.open("pixel-editor",1);o.onerror=()=>{e(Ie("Failed to load database."))},o.onupgradeneeded=()=>{var g=o.result;g.objectStoreNames.contains("previous_work")||g.createObjectStore("previous_work")},o.onsuccess=()=>{let g=o.result;e(ke(new De(g)))}})}loadPreviousWork(){return new Promise(e=>{let g=this.db.transaction("previous_work","readwrite").objectStore("previous_work").get("image");g.onerror=u=>{e(Ie("Failed to load previous work."))},g.onsuccess=u=>{let f=g.result;if(f==null){e(ke(void 0));return}e(ke(f))}})}saveWork(e){return new Promise(o=>{let g=this.db.transaction("previous_work","readwrite").objectStore("previous_work").put(e,"image");g.onerror=()=>{o(Ie("Failed to save work."))},g.onsuccess=()=>{o(ke({}))}})}}var ft=j("<svg><rect stroke=black stroke-width=2 fill=none pointer-events=none></svg>",!1,!0);class yt{overlaySvgUI;dragStart;dragEnd;disableOneFingerPan=()=>!0;constructor(e){let[o,g]=pe({pt1:void 0}),u=b(()=>{let r=e.mousePos();if(r==null)return;let t=e.screenPtToWorldPt(r);if(t!=null)return p.create(Math.floor(t.x),Math.floor(t.y))},void 0,{equals:(r,t)=>r==null||t==null?r==t:r.x==t.x&&r.y==t.y}),f=b(()=>{if(o.pt1==null)return;let r=u();if(r!=null)return{pt1:o.pt1,pt2:r}}),s=()=>{};{let r=b(()=>f()!=null);W(()=>{if(!r())return;let t=f,i=[];W(()=>{let l=t(),a=e.currentColour();ie(l.pt1.x,l.pt1.y,l.pt2.x,l.pt2.y,(v,y)=>{let P=p.create(v,y),k=e.readPixel(P)??new ee(0,0,0,0);e.writePixel(P,a),i.push(k)});let d=!1;s=()=>{d=!0;let v=i.splice(0,i.length),y=l.pt1.x,P=l.pt1.y,k=l.pt2.x,I=l.pt2.y,U=e.currentColour(),_={displayName:"Draw Line",run(Z){if(Z){let A=0;ie(y,P,k,I,(R,F)=>{let te=p.create(R,F);e.writePixel(te,v[A++])})}else ie(y,P,k,I,(A,R)=>{let F=p.create(A,R);e.writePixel(F,U)})}};e.undoManager.pushUndoUnit(_),g("pt1",void 0)},le(()=>{if(d)return;let v=0;ie(l.pt1.x,l.pt1.y,l.pt2.x,l.pt2.y,(y,P)=>{let k=p.create(y,P);e.writePixel(k,i[v++])}),i.splice(0,i.length)})})})}this.overlaySvgUI=()=>{let r=b(()=>{let t=u();if(t==null)return;let i=p.create(1,1).add(t),l=e.worldPtToScreenPt(t);if(l==null)return;let a=e.worldPtToScreenPt(i);if(a!=null)return{x:l.x-1,y:l.y-1,w:a.x-l.x+2,h:a.y-l.y+2}});return Y(X,{get when(){return r()},children:t=>(()=>{var i=ft();return K(l=>{var a=t().x,d=t().y,v=t().w,y=t().h;return a!==l.e&&z(i,"x",l.e=a),d!==l.t&&z(i,"y",l.t=d),v!==l.a&&z(i,"width",l.a=v),y!==l.o&&z(i,"height",l.o=y),l},{e:void 0,t:void 0,a:void 0,o:void 0}),i})()})},this.dragStart=()=>{if(o.pt1==null){let r=u();r!=null&&g("pt1",r);return}},this.dragEnd=()=>{u()!=null&&s()}}}var pt=j("<svg><rect stroke=black stroke-width=2 fill=none pointer-events=none></svg>",!1,!0);class ht{overlaySvgUI;dragStart;dragEnd;disableOneFingerPan=()=>!0;done;constructor(e){let[o,g]=pe({pos:void 0,size:void 0,isDragging:!1}),u=b(()=>{let t=e.mousePos();if(t==null)return;let i=e.screenPtToWorldPt(t);if(i!=null)return p.create(Math.floor(i.x),Math.floor(i.y))},void 0,{equals:(t,i)=>t==null||i==null?t==i:t.x==i.x&&t.y==i.y});W(()=>{if(!o.isDragging||o.pos==null)return;let t=u();if(t!=null){let i=Math.min(o.pos.x,t.x),l=Math.min(o.pos.y,t.y),a=Math.max(o.pos.x,t.x),d=Math.max(o.pos.y,t.y);if(i==a&&l==d)return;Q(()=>{(i!=o.pos?.x||l!=o.pos?.y)&&g("pos",p.create(i,l)),g("size",p.create(a-i,d-l))})}});let f=b(()=>o.pos!=null&&o.size!=null),s=b(()=>{if(!f())return;let t=()=>o.pos,i=()=>o.size;return new Be({mousePos:e.mousePos,screenPtToWorldPt:e.screenPtToWorldPt,worldPtToScreenPt:e.worldPtToScreenPt,rect:{pos:t,size:b(()=>p.create(i().x+1,i().y+1)),setPos:l=>{g("pos",p.create(Math.round(l.x),Math.round(l.y)))},setSize:l=>{g("size",p.create(Math.round(l.x)-1,Math.round(l.y)-1))}}})}),r=()=>{};W(()=>{if(!f())return;let t=()=>o.pos,i=()=>o.size,l=[],a=b(()=>({pos:t(),size:i()}));W(()=>{let d=e.currentColour(),{pos:v,size:y}=a();me(v.x,v.y,y.x,y.y,(k,I)=>{let U=p.create(k,I),_=e.readPixel(U)??new ee(0,0,0,0);l.push(_)}),me(v.x,v.y,y.x,y.y,(k,I)=>{let U=p.create(k,I);e.writePixel(U,d)});let P=!1;r=()=>{P=!0;let k=l.splice(0,l.length),I=e.currentColour(),U={displayName:"Draw Line",run(_){if(_){let Z=0;me(v.x,v.y,y.x,y.y,(A,R)=>{let F=p.create(A,R);e.writePixel(F,k[Z++])})}else me(v.x,v.y,y.x,y.y,(Z,A)=>{let R=p.create(Z,A);e.writePixel(R,I)})}};e.undoManager.pushUndoUnit(U),Q(()=>{g("pos",void 0),g("size",void 0)})},le(()=>{if(P){debugger;return}let k=0;me(v.x,v.y,y.x,y.y,(I,U)=>{let _=p.create(I,U);e.writePixel(_,l[k++])}),l.splice(0,l.length)})})}),this.overlaySvgUI=()=>{let t=b(()=>{let i=s();if(i!=null&&i.isOverAnchor())return;let l=u();if(l==null)return;let a=p.create(1,1).add(l),d=e.worldPtToScreenPt(l);if(d==null)return;let v=e.worldPtToScreenPt(a);if(v!=null)return{x:d.x-1,y:d.y-1,w:v.x-d.x+2,h:v.y-d.y+2}});return[Y(X,{get when(){return t()},children:i=>(()=>{var l=pt();return K(a=>{var d=i().x,v=i().y,y=i().w,P=i().h;return d!==a.e&&z(l,"x",a.e=d),v!==a.t&&z(l,"y",a.t=v),y!==a.a&&z(l,"width",a.a=y),P!==a.o&&z(l,"height",a.o=P),a},{e:void 0,t:void 0,a:void 0,o:void 0}),l})()}),Y(X,{get when(){return s()},children:i=>b(()=>i().overlaySvgUI({}))})]},this.dragStart=()=>{let t=s();if(t!=null&&t.isOverAnchor()){t.dragStart();return}if(o.pos!=null&&o.size!=null&&r(),g("isDragging",!0),o.pos==null){let i=u();i!=null&&g("pos",i);return}},this.dragEnd=()=>{s()?.dragEnd?.(),g("isDragging",!1),u()!=null},this.done=()=>{debugger;o.pos!=null&&o.size!=null&&r()}}}var Pt=j("<svg><rect stroke=black stroke-width=2 fill=none pointer-events=none></svg>",!1,!0);class xt{overlaySvgUI;click;disableOneFingerPan=()=>!0;constructor(e){let o=b(()=>{let u=e.mousePos();if(u==null)return;let f=e.screenPtToWorldPt(u);if(f!=null)return p.create(Math.floor(f.x),Math.floor(f.y))}),g=()=>{let u=o();if(u==null)return;let f=e.readPixel(u)??new ee(0,0,0,0),s=p.zero,r=new ee(0,0,0,0),t=e.currentColour();if(t.r==f.r&&t.g==f.g&&t.b==f.b&&t.a==f.a)return;let i=[];st(u.x,u.y,(a,d)=>(s=p.create(a,d),e.isInBounds(s)?(e.readPixel(s,r),r.r==f.r&&r.g==f.g&&r.b==f.b&&r.a==f.a):!1),(a,d)=>{s=p.create(a,d),i.push(s),e.writePixel(s,t)});let l={displayName:"Flood Fill",run(a){if(a)for(let d of i)e.writePixel(d,f);else for(let d of i)e.writePixel(d,t)}};e.undoManager.pushUndoUnit(l)};this.overlaySvgUI=()=>{let u=b(()=>{let f=o();if(f==null)return;let s=p.create(1,1).add(f),r=e.worldPtToScreenPt(f);if(r==null)return;let t=e.worldPtToScreenPt(s);if(t!=null)return{x:r.x-1,y:r.y-1,w:t.x-r.x+2,h:t.y-r.y+2}});return Y(X,{get when(){return u()},children:f=>(()=>{var s=Pt();return K(r=>{var t=f().x,i=f().y,l=f().w,a=f().h;return t!==r.e&&z(s,"x",r.e=t),i!==r.t&&z(s,"y",r.t=i),l!==r.a&&z(s,"width",r.a=l),a!==r.o&&z(s,"height",r.o=a),r},{e:void 0,t:void 0,a:void 0,o:void 0}),s})()})},this.click=()=>{o()!=null&&g()}}}var wt=j("<svg><rect stroke=black stroke-width=2 fill=none pointer-events=none></svg>",!1,!0);class mt{overlaySvgUI;dragStart;dragEnd;disableOneFingerPan=()=>!0;done;constructor(e){let[o,g]=pe({pos:void 0,size:void 0,isDragging:!1}),u=b(()=>{let t=e.mousePos();if(t==null)return;let i=e.screenPtToWorldPt(t);if(i!=null)return p.create(Math.floor(i.x),Math.floor(i.y))},void 0,{equals:(t,i)=>t==null||i==null?t==i:t.x==i.x&&t.y==i.y});W(()=>{if(!o.isDragging||o.pos==null)return;let t=u();if(t!=null){let i=Math.min(o.pos.x,t.x),l=Math.min(o.pos.y,t.y),a=Math.max(o.pos.x,t.x),d=Math.max(o.pos.y,t.y);if(i==a&&l==d)return;Q(()=>{(i!=o.pos?.x||l!=o.pos?.y)&&g("pos",p.create(i,l)),g("size",p.create(a-i,d-l))})}});let f=b(()=>o.pos!=null&&o.size!=null),s=b(()=>{if(!f())return;let t=()=>o.pos,i=()=>o.size;return new Be({mousePos:e.mousePos,screenPtToWorldPt:e.screenPtToWorldPt,worldPtToScreenPt:e.worldPtToScreenPt,rect:{pos:t,size:b(()=>p.create(i().x+1,i().y+1)),setPos:l=>{g("pos",p.create(Math.round(l.x),Math.round(l.y)))},setSize:l=>{g("size",p.create(Math.round(l.x)-1,Math.round(l.y)-1))}}})}),r=()=>{};W(()=>{if(!f())return;let t=()=>o.pos,i=()=>o.size,l=[],a=b(()=>({pos:t(),size:i()}));W(()=>{let d=e.currentColour(),{pos:v,size:y}=a();we(v.x,v.y,y.x,y.y,(k,I)=>{let U=p.create(k,I),_=e.readPixel(U)??new ee(0,0,0,0);l.push(_)}),we(v.x,v.y,y.x,y.y,(k,I)=>{let U=p.create(k,I);e.writePixel(U,d)});let P=!1;r=()=>{P=!0;let k=l.splice(0,l.length),I=e.currentColour(),U={displayName:"Draw Line",run(_){if(_){let Z=0;we(v.x,v.y,y.x,y.y,(A,R)=>{let F=p.create(A,R);e.writePixel(F,k[Z++])})}else we(v.x,v.y,y.x,y.y,(Z,A)=>{let R=p.create(Z,A);e.writePixel(R,I)})}};e.undoManager.pushUndoUnit(U),Q(()=>{g("pos",void 0),g("size",void 0)})},le(()=>{if(P){debugger;return}let k=0;we(v.x,v.y,y.x,y.y,(I,U)=>{let _=p.create(I,U);e.writePixel(_,l[k++])}),l.splice(0,l.length)})})}),this.overlaySvgUI=()=>{let t=b(()=>{let i=s();if(i!=null&&i.isOverAnchor())return;let l=u();if(l==null)return;let a=p.create(1,1).add(l),d=e.worldPtToScreenPt(l);if(d==null)return;let v=e.worldPtToScreenPt(a);if(v!=null)return{x:d.x-1,y:d.y-1,w:v.x-d.x+2,h:v.y-d.y+2}});return[Y(X,{get when(){return t()},children:i=>(()=>{var l=wt();return K(a=>{var d=i().x,v=i().y,y=i().w,P=i().h;return d!==a.e&&z(l,"x",a.e=d),v!==a.t&&z(l,"y",a.t=v),y!==a.a&&z(l,"width",a.a=y),P!==a.o&&z(l,"height",a.o=P),a},{e:void 0,t:void 0,a:void 0,o:void 0}),l})()}),Y(X,{get when(){return s()},children:i=>b(()=>i().overlaySvgUI({}))})]},this.dragStart=()=>{let t=s();if(t!=null&&t.isOverAnchor()){t.dragStart();return}if(o.pos!=null&&o.size!=null&&r(),g("isDragging",!0),o.pos==null){let i=u();i!=null&&g("pos",i);return}},this.dragEnd=()=>{s()?.dragEnd?.(),g("isDragging",!1),u()!=null},this.done=()=>{debugger;o.pos!=null&&o.size!=null&&r()}}}var Re=j("<div>"),bt=j('<div><div><div><button class=btn><i class="fa-solid fa-trash-can"></i></button><button class=btn><i class="fa-solid fa-hand"></i></button><button class=btn><i class="fa-solid fa-floppy-disk"></i></button><button class=btn><i class="fas fa-undo"></i></button><button class=btn><i class="fas fa-redo"></i></button><button class=btn><i class="fa-solid fa-eraser"></i></button><button class=btn><i class="fa-solid fa-pencil"></i></button><button class=btn><i class="fa-solid fa-eye-dropper"></i></button><button class=btn><i class="fa-solid fa-palette"></i></button><button class=btn>/</button><button class=btn>&square;</button><button class=btn>O</button><button class=btn><i class="fa-solid fa-fill-drip"></i></button></div></div><div><div><canvas></canvas><div></div><div>'),kt=j('<button class=btn><i class="fa-solid fa-folder-open">'),St=j("<input type=file accept=image/png hidden>"),zt=j("<button class=btn>"),Ne=j("<br>"),It=j("<svg>"),Dt=j("<svg><rect stroke=black stroke-width=2 fill=none></svg>",!1,!0);const Ct=2e3,Lt=D=>{let[e,o]=pe({minPt:p.zero,size:p.create(10,10),mousePos:void 0,pan:p.create(-1,-1),scale:30,touches:[],isPanning:!1,panningFrom:void 0,isTouchPanZoom:!1,touchPanZoomFrom:void 0,touchPanZoomInitScale:void 0,touchPanZoomInitGap:void 0,mode:"Idle",currentColour:new ee(0,255,0,255),showColourPicker:!1,strokeThickness:1,isLoading:!1,autoSaving:!1});const g=new rt;let u;{let[n]=Ze(De.init);u=b(()=>{let c=n();if(c!=null){if(c.type=="Err"){console.log("Load storage error: "+c.message);return}return c.value}})}let f;{let n=!1,c;f=()=>{n||(n=!0,c!=null&&clearTimeout(c),o("autoSaving",!0),c=window.setTimeout(()=>{let x=y();if(x==null)return;let h=u();h!=null&&(async()=>{let m=await x.image.convertToBlob(),M=await h.saveWork(m);M.type=="Err"&&console.log(M.message),o("autoSaving",!1),n=!1})()},Ct))}}let s=n=>n.multScalar(1/e.scale).add(e.pan),r=n=>n.sub(e.pan).multScalar(e.scale),[t,i]=Se(),[l,a]=Se();W(()=>{let n=l();if(n==null)return;let c=new ResizeObserver(()=>{let x=n.getBoundingClientRect();n.width=x.width,n.height=x.height,_()});c.observe(n),le(()=>{c.unobserve(n),c.disconnect()})});let d=b(()=>{let n=l();if(n!=null)return n.getContext("2d")}),v=n=>{let c=new ImageData(n.size.x,n.size.y),x=new OffscreenCanvas(n.size.x,n.size.y),h=x.getContext("2d");if(h!=null)return{image:x,imageData:c,ctx:h}},[y,P]=Se(ze(()=>v({size:e.size}))),k=n=>{let c=(()=>{let x=y();if(x==null){let $=v({size:n.size});return $!=null&&P($),$}let h=new OffscreenCanvas(n.size.x,n.size.y),m=h.getContext("2d");if(m==null)return;m.putImageData(x.imageData,e.minPt.x-n.minPt.x,e.minPt.y-n.minPt.y);let M=m.getImageData(0,0,h.width,h.height);return{image:h,imageData:M,ctx:m}})();return Q(()=>{o("minPt",n.minPt),o("size",n.size)}),P(c),c},I=b(()=>y()!=null);W(()=>{if(!I()||ze(()=>y())==null)return;if(D.initImage!=null){let h=D.initImage;ze(()=>{let m=k({minPt:p.zero,size:p.create(h.width,h.height)});if(m==null)return;m.ctx.drawImage(h,0,0);let M=m.ctx.getImageData(0,0,h.width,h.height);P({image:m.image,imageData:M,ctx:m.ctx})});return}let c=u();if(c==null)return;o("isLoading",!0);let[x]=Ze(()=>c.loadPreviousWork());W(()=>{let h=x();if(h==null){o("isLoading",!1);return}if(h.type=="Err"){o("isLoading",!1),console.log(h.message);return}let m=h.value;if(m==null){o("isLoading",!1);return}let M=URL.createObjectURL(m),$=new Image;$.src=M,$.onerror=()=>{o("isLoading",!1),console.log("Failed to load previous work")},$.onload=()=>{o("isLoading",!1);let N=k({minPt:p.zero,size:p.create($.width,$.height)});if(N==null)return;N.ctx.drawImage($,0,0);let re=N.ctx.getImageData(0,0,$.width,$.height);P({image:N.image,imageData:re,ctx:N.ctx}),Z()}})});let U=!1;function _(){let n=l();if(n==null)return;let c=d();if(c==null)return;let x=y();x!=null&&(U&&(x.ctx.putImageData(x.imageData,0,0),U=!1),c.clearRect(0,0,n.width,n.height),c.save(),c.imageSmoothingEnabled=!1,c.scale(e.scale,e.scale),c.translate(-e.pan.x,-e.pan.y),c.drawImage(x.image,e.minPt.x,e.minPt.y,e.size.x,e.size.y),c.restore())}let Z=(()=>{let n=!1;return()=>{n||(n=!0,requestAnimationFrame(()=>{n=!1,_()}))}})();const A=10,R=A*A;let F={undoManager:g,snapDist:()=>A,snapDistSquared:()=>R,mousePos:()=>e.mousePos,screenPtToWorldPt:s,worldPtToScreenPt:r,currentColour:()=>e.currentColour,setCurrentColour(n){o("currentColour",n)},strokeThickness:()=>e.strokeThickness,isInBounds(n){let c=y();return c==null?!1:n.x>=e.minPt.x&&n.x<e.minPt.x+c.imageData.width&&n.y>=e.minPt.y&&n.y<e.minPt.y+c.imageData.height},readPixel(n,c){let x=y();if(x==null)return;if(c=c??new ee(0,0,0,0),n.x<e.minPt.x||n.x>=e.minPt.x+x.imageData.width||n.y<e.minPt.y||n.y>=e.minPt.y+x.imageData.height)return c.r=0,c.g=0,c.b=0,c.a=0,c;let h=x.imageData.data,m=x.imageData.width*(n.y-e.minPt.y)+(n.x-e.minPt.x)<<2;return c.r=h[m],c.g=h[m+1],c.b=h[m+2],c.a=h[m+3],c},writePixel(n,c){let x=y();if(x==null)return;let h,m,M;if(n.x<e.minPt.x||n.x>=e.minPt.x+x.imageData.width||n.y<e.minPt.y||n.y>=e.minPt.y+x.imageData.height?(h=p.create(Math.min(e.minPt.x,n.x),Math.min(e.minPt.y,n.y)),m=p.create(Math.max(e.size.x+(e.minPt.x-h.x),-e.minPt.x+n.x+1),Math.max(e.size.y+(e.minPt.y-h.y),-e.minPt.y+n.y+1)),M=k({minPt:h,size:m})):(h=e.minPt,m=e.size,M=x),M==null)return;let $=M.imageData.data,N=M.imageData.width*(n.y-h.y)+(n.x-h.x)<<2;$[N]=c.r,$[N+1]=c.g,$[N+2]=c.b,$[N+3]=c.a,U=!0,Z(),f()}},te,Ye=b(()=>(te?.done?.(),e.mode)),ne=b(()=>{switch(Ye()){case"Idle":return new nt(F);case"Draw Pixels":return new dt(F);case"Erase Pixels":return new gt(F);case"Eye Dropper":return new ct(F);case"Draw Lines":return new yt(F);case"Draw Rect":return new mt(F);case"Draw Ellipse":return new ht(F);case"Flood Fill":return new xt(F)}});W(()=>{te=ne()});let je=b(()=>ne().instructions),Xe=b(()=>ne().overlaySvgUI),Ce=b(()=>ne().disableOneFingerPan?.()??!1);W(ye([()=>e.pan,()=>e.scale],()=>{Z()}));let Fe=n=>{if(e.mousePos==null)return;let c=s(e.mousePos);if(c==null)return;let x=e.scale*n,h=c.sub(e.mousePos.multScalar(1/x));Q(()=>{o("pan",h),o("scale",e.scale*n)})};W(ye([()=>e.isTouchPanZoom,()=>e.touchPanZoomFrom,()=>e.touchPanZoomInitGap,()=>e.touchPanZoomInitScale,()=>e.touches,()=>e.mousePos,Ce],()=>{if(!e.isTouchPanZoom||e.touchPanZoomFrom==null||e.mousePos==null||e.touchPanZoomInitScale==null||Ce()&&e.touches.length==1)return;let n=s(e.mousePos);if(n==null)return;let c;e.touches.length!=2?c=void 0:c=e.touches[1].pos.sub(e.touches[0].pos).length();let x=e.touchPanZoomFrom.sub(n),h=e.touchPanZoomInitScale;Q(()=>{if(o("pan",m=>m.add(x)),e.touchPanZoomInitGap!=null&&c!=null){let m=h*c/e.touchPanZoomInitGap;o("scale",m)}})}));let Me=()=>{if(e.touches.length==0||e.mousePos==null)return;let n;e.touches.length!=2?n=void 0:n=e.touches[1].pos.sub(e.touches[0].pos).length();let c=s(e.mousePos);c!=null&&Q(()=>{o("isTouchPanZoom",!0),o("touchPanZoomFrom",c),o("touchPanZoomInitGap",n),o("touchPanZoomInitScale",e.scale)})},qe=()=>{Q(()=>{o("isTouchPanZoom",!1),o("touchPanZoomFrom",void 0),o("touchPanZoomInitGap",void 0),o("touchPanZoomInitScale",void 0)})},Ge=n=>{n.deltaY>0?Fe(1/1.1):n.deltaY<0&&Fe(1.1/1)},He=n=>{n.preventDefault();let c=l();if(c==null)return;c.setPointerCapture(n.pointerId);let x=c.getBoundingClientRect(),h=n.pointerId,m=p.create(n.clientX-x.left,n.clientY-x.top),M=[...e.touches,{id:h,pos:m}];Q(()=>{o("touches",M),o("mousePos",M[0].pos)}),Me(),M.length==1&&ne().dragStart?.()},Ue=n=>{n.preventDefault();let c=l();if(c==null)return;c.releasePointerCapture(n.pointerId);let x=n.pointerId,h=e.touches.filter(({id:m})=>m!=x);qe(),h.length==0&&(ne().dragEnd?.(),Je()),Q(()=>{o("touches",h),n.pointerType!="mouse"&&o("mousePos",h.length!=0?h[0].pos:void 0)}),h.length!=0&&Me()},Ve=n=>{Ue(n)},Qe=n=>{n.preventDefault();let c=l();if(c==null)return;let x=c.getBoundingClientRect(),h=n.pointerId,m=e.touches.findIndex(({id:$})=>$==h),M=p.create(n.clientX-x.left,n.clientY-x.top);m!=-1&&o("touches",m,"pos",()=>M),(m==0||m==-1)&&o("mousePos",M)},Ke=n=>{n.preventDefault(),e.touches.length==0&&o("mousePos",void 0)},Je=()=>{ne().click?.()},$e=n=>{n.key=="Escape"&&o("mode","Idle")};document.addEventListener("keydown",$e),le(()=>{document.removeEventListener("keydown",$e)});let et=()=>{if(!window.confirm("Are you sure you want to delete this drawing and start again?"))return;let n=p.create(10,10),c=v({size:n});c!=null&&Q(()=>{o("size",n),P(c),g.clear(),Z(),f()})},tt=async()=>{let n=y();if(n==null)return;let c=await n.image.convertToBlob({type:"image/png"});lt.saveAs(c,"sprite-sheet.png")};return(()=>{var n=bt(),c=n.firstChild,x=c.firstChild,h=x.firstChild,m=h.nextSibling,M=m.nextSibling,$=M.nextSibling,N=$.nextSibling,re=N.nextSibling,de=re.nextSibling,ue=de.nextSibling,oe=ue.nextSibling,ce=oe.nextSibling,ve=ce.nextSibling,ge=ve.nextSibling,he=ge.nextSibling,J=c.nextSibling,G=J.firstChild,be=G.firstChild,se=be.nextSibling,ae=se.nextSibling;n.style.setProperty("position","relative"),n.style.setProperty("flex-grow","1"),n.style.setProperty("display","flex"),n.style.setProperty("flex-direction","row"),c.style.setProperty("background-color","dimgray"),x.style.setProperty("display","grid"),x.style.setProperty("grid-template-columns","auto auto"),h.$$click=()=>et(),h.style.setProperty("font-size","20pt"),h.style.setProperty("padding","5pt"),m.$$click=()=>o("mode","Idle"),m.style.setProperty("font-size","20pt"),m.style.setProperty("padding","5pt"),V(x,()=>{let w;return[(()=>{var T=kt();return T.$$click=()=>{w.click()},T.style.setProperty("font-size","20pt"),T.style.setProperty("padding","5pt"),T})(),(()=>{var T=St();T.$$input=()=>{if(w.files?.length!=1)return;let C=w.files[0],B=URL.createObjectURL(C),S=new Image;S.src=B,S.onerror=()=>{URL.revokeObjectURL(B),console.log("Failed to load image.")},S.onload=()=>{let E=k({minPt:p.zero,size:p.create(S.width,S.height)});if(E==null){URL.revokeObjectURL(B);return}E.ctx.drawImage(S,0,0);let O=E.ctx.getImageData(0,0,S.width,S.height);P({image:E.image,imageData:O,ctx:E.ctx}),Z(),g.clear(),f(),URL.revokeObjectURL(B)}};var L=w;return typeof L=="function"?Pe(L,T):w=T,T})()]},M),M.$$click=()=>tt(),M.style.setProperty("font-size","20pt"),M.style.setProperty("padding","5pt"),$.$$click=()=>g.undo(),$.style.setProperty("font-size","20pt"),$.style.setProperty("padding","5pt"),N.$$click=()=>g.redo(),N.style.setProperty("font-size","20pt"),N.style.setProperty("padding","5pt"),re.$$click=()=>{e.mode=="Erase Pixels"?o("mode","Idle"):o("mode","Erase Pixels")},re.style.setProperty("font-size","20pt"),re.style.setProperty("padding","5pt"),de.$$click=()=>{e.mode=="Draw Pixels"?o("mode","Idle"):o("mode","Draw Pixels")},de.style.setProperty("font-size","20pt"),de.style.setProperty("padding","5pt"),ue.$$click=()=>{e.mode=="Eye Dropper"?o("mode","Idle"):o("mode","Eye Dropper")},ue.style.setProperty("font-size","20pt"),ue.style.setProperty("padding","5pt"),oe.$$click=()=>{o("showColourPicker",w=>!w)};var Te=i;typeof Te=="function"?Pe(Te,oe):i=oe,oe.style.setProperty("font-size","20pt"),oe.style.setProperty("padding","5pt"),ce.$$click=()=>{o("mode","Draw Lines")},ce.style.setProperty("font-size","20pt"),ce.style.setProperty("padding","5pt"),ve.$$click=()=>{o("mode","Draw Rect")},ve.style.setProperty("font-size","20pt"),ve.style.setProperty("padding","5pt"),ge.$$click=()=>{o("mode","Draw Ellipse")},ge.style.setProperty("font-size","20pt"),ge.style.setProperty("padding","5pt"),he.$$click=()=>{o("mode","Flood Fill")},he.style.setProperty("font-size","20pt"),he.style.setProperty("padding","5pt"),V(c,Y(X,{get when(){return e.mode=="Draw Pixels"},get children(){var w=Re();return w.style.setProperty("display","grid"),w.style.setProperty("grid-template-columns","auto auto"),V(w,()=>Array(10).fill(void 0).map((T,L)=>L+1).map(T=>(()=>{var L=zt();return L.$$click=()=>{o("strokeThickness",T)},L.style.setProperty("font-size","20pt"),L.style.setProperty("padding","5pt"),V(L,()=>T.toString(16).toLocaleUpperCase()),K(C=>(C=e.strokeThickness==T?"blue":void 0)!=null?L.style.setProperty("background-color",C):L.style.removeProperty("background-color")),L})())),w}}),null),J.style.setProperty("position","relative"),J.style.setProperty("flex-grow","1"),J.style.setProperty("display","flex"),J.style.setProperty("flex-direction","column"),J.style.setProperty("background-color","#DDD"),J.style.setProperty("background-image","linear-gradient(45deg, #FFFFFF 25%, transparent 25%), linear-gradient(-45deg, #FFFFFF 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #FFFFFF 75%), linear-gradient(-45deg, transparent 75%, #FFFFFF 75%)"),J.style.setProperty("background-size","20px 20px"),J.style.setProperty("background-position","0 0, 0 10px, 10px -10px, -10px 0px"),G.$$contextmenu=w=>(w.preventDefault(),!1),xe(G,"pointerleave",Ke),xe(G,"pointermove",Qe),xe(G,"pointercancel",Ve),xe(G,"pointerup",Ue),xe(G,"pointerdown",He),G.addEventListener("wheel",Ge),G.style.setProperty("flex-grow","1"),G.style.setProperty("display","flex"),G.style.setProperty("flex-direction","column"),G.style.setProperty("touch-action","none");var Ee=a;return typeof Ee=="function"?Pe(Ee,be):a=be,be.style.setProperty("flex-grow","1"),se.style.setProperty("position","absolute"),se.style.setProperty("left","0"),se.style.setProperty("top","0"),V(se,(()=>{var w=b(()=>!!e.isLoading);return()=>w()?["Loading...",Ne()]:void 0})(),null),V(se,(()=>{var w=b(()=>!!e.autoSaving);return()=>w()?["Saving...",Ne()]:void 0})(),null),V(se,()=>je()?.({}),null),ae.style.setProperty("position","absolute"),ae.style.setProperty("left","0"),ae.style.setProperty("top","0"),ae.style.setProperty("right","0"),ae.style.setProperty("bottom","0"),ae.style.setProperty("overflow","hidden"),V(ae,()=>{let[w,T]=Se();Ae(()=>{let S=w(),E=S?.parentElement,O=new ResizeObserver(()=>{let H=E.getBoundingClientRect();S.setAttribute("width",`${H.width}`),S.setAttribute("height",`${H.height}`)});O.observe(E),le(()=>{O.unobserve(E),O.disconnect()})});let L=b(()=>r(e.minPt)),C=b(()=>r(e.minPt.add(e.size))),B=b(()=>{let S=L();if(S==null)return;let E=C();if(E!=null)return{pt:S,size:E.sub(S)}});return(()=>{var S=It(),E=T;return typeof E=="function"?Pe(E,S):T=S,V(S,Y(X,{get when(){return B()},children:O=>(()=>{var H=Dt();return K(q=>{var fe=O().pt.x,Le=O().pt.y,Oe=O().size.x,_e=O().size.y;return fe!==q.e&&z(H,"x",q.e=fe),Le!==q.t&&z(H,"y",q.t=Le),Oe!==q.a&&z(H,"width",q.a=Oe),_e!==q.o&&z(H,"height",q.o=_e),q},{e:void 0,t:void 0,a:void 0,o:void 0}),H})()}),null),V(S,Y(X,{get when(){return Xe()},children:O=>b(()=>O()({}))}),null),S})()}),V(n,Y(X,{get when(){return e.showColourPicker},get children(){return Y(X,{get when(){return t()},children:w=>{let T,L=b(()=>{let B=w().getBoundingClientRect();return p.create(B.right,B.top)});return Ae(()=>{T.focus()}),(()=>{var C=Re(),B=T;return typeof B=="function"?Pe(B,C):T=C,C.style.setProperty("position","absolute"),C.style.setProperty("display","flex"),C.style.setProperty("flex-direction","column"),C.style.setProperty("width","300px"),C.style.setProperty("height","300px"),C.style.setProperty("background-color","white"),C.style.setProperty("padding","20px"),C.style.setProperty("border","1px solid black"),V(C,Y(it,{get colour(){return e.currentColour},onColour:S=>o("currentColour",S)})),K(S=>{var E=`${L().x}px`,O=`${L().y}px`;return E!==S.e&&((S.e=E)!=null?C.style.setProperty("left",E):C.style.removeProperty("left")),O!==S.t&&((S.t=O)!=null?C.style.setProperty("top",O):C.style.removeProperty("top")),S},{e:void 0,t:void 0}),C})()}})}}),null),K(w=>{var T=!g.canUndo(),L=!g.canRedo(),C=e.mode=="Erase Pixels"?"blue":void 0,B=e.mode=="Draw Pixels"?"blue":void 0,S=e.mode=="Eye Dropper"?"blue":void 0,E=e.showColourPicker?"blue":void 0,O=e.mode=="Draw Lines"?"blue":void 0,H=e.mode=="Draw Rect"?"blue":void 0,q=e.mode=="Draw Ellipse"?"blue":void 0,fe=e.mode=="Flood Fill"?"blue":void 0;return T!==w.e&&($.disabled=w.e=T),L!==w.t&&(N.disabled=w.t=L),C!==w.a&&((w.a=C)!=null?re.style.setProperty("background-color",C):re.style.removeProperty("background-color")),B!==w.o&&((w.o=B)!=null?de.style.setProperty("background-color",B):de.style.removeProperty("background-color")),S!==w.i&&((w.i=S)!=null?ue.style.setProperty("background-color",S):ue.style.removeProperty("background-color")),E!==w.n&&((w.n=E)!=null?oe.style.setProperty("background-color",E):oe.style.removeProperty("background-color")),O!==w.s&&((w.s=O)!=null?ce.style.setProperty("background-color",O):ce.style.removeProperty("background-color")),H!==w.h&&((w.h=H)!=null?ve.style.setProperty("background-color",H):ve.style.removeProperty("background-color")),q!==w.r&&((w.r=q)!=null?ge.style.setProperty("background-color",q):ge.style.removeProperty("background-color")),fe!==w.d&&((w.d=fe)!=null?he.style.setProperty("background-color",fe):he.style.removeProperty("background-color")),w},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),n})()};ot(["click","contextmenu","input"]);export{Lt as default};
