import{c as oe,l as Ye,z as fe,A as Ve,a as g,g as ee,H as ae,i as K,b as N,S as We,N as ne,e as T,s as p,$ as q,f as Fe,t as L,B as ce,a3 as Re,m as Be,y as Ge}from"./index.5aba22ff.js";import{m as Oe,a as Xe,S as Ue}from"./SvgWithPanZoomState.e2089103.js";import{u as je,v as ve,m as E,P as Ze,b as ze}from"./PropertiesForm.c69fa44e.js";import{V as I,a as le}from"./Vec3.ce1f4f7a.js";import{o as ge}from"./utils.6e3ab489.js";import{D as Je}from"./DrawLinesMode.1925dcb4.js";import{R as ke}from"./Ray3D.5e4c723f.js";import{P as Ke,L as ie}from"./Line2D.139781b3.js";import{L as me}from"./Line3D.2b8117f1.js";import{o as pe}from"./PanelUtils.894b6d74.js";import{R as ye}from"./Ray2D.01cdc921.js";import{U as qe}from"./UndoManager.be70fe9a.js";import"./Component.6024a649.js";import"./Plane3D.472a05fa.js";import"./Component.fa73bdbc.js";const Qe=L('<button class="btn btn-primary" style="margin-left: 0px; margin-right: 10px;">Close</button>'),et=L('<div style="flex-grow: 1; display: flex; flex-direction: column;"><div><h3 style="display: inline;">Simple Wall Sheeting Takeoff</h3><input type="button" class="btn btn-primary" style="margin-left: 10px;" value="Draw Lines"><input type="button" class="btn btn-primary" style="margin-left: 10px" value="Delete"></div><div style="flex-grow: 1; display: flex; flex-direction: row;"><div></div><div style="flex-grow: 1; display: flex; flex-direction: column; position: relative;"><div style="position: absolute; left: 0; top: 0; background-color: rgba(0,0,0,0.5); color: blue;"></div></div></div></div>'),tt=L('<svg><line y1="0" y2="0" stroke="red" stroke-width="2" vector-effect="non-scaling-stroke"></line></svg>',4,!0),nt=L('<svg><line x1="0" x2="0" stroke="green" stroke-width="2" vector-effect="non-scaling-stroke"></line></svg>',4,!0),lt=L('<svg><line stroke="black" stroke-width="2" vector-effect="non-scaling-stroke"></line></svg>',4,!0),it=L('<svg><path stroke="none"></path></svg>',4,!0),rt=L('<svg><line stroke-width="2" vector-effect="non-scaling-stroke" pointer-events="none"></line></svg>',4,!0),at=L('<svg><rect stroke="blue" stroke-width="2" fill="none" vector-effect="non-scaling-stroke"></rect></svg>',4,!0),ot=L('<svg><rect stroke="none" fill="blue" opacity="0.25" vector-effect="non-scaling-stroke"></rect></svg>',4,!0),st=L('<svg><text text-anchor="middle" dominant-baseline="central"></text></svg>',4,!0),ut=L('<svg><line stroke-width="2" stroke="black" stroke-dasharray="10 5" vector-effect="non-scaling-stroke" pointer-events="none"></line></svg>',4,!0),dt=L('<svg><circle stroke="none" pointer-events="none"></circle></svg>',4,!0),Se=10,ht=Se*Se,ft={type:"Gable",length:6e3,eaveHeight:2400,pitch:10},we={type:"Skillion",length:6e3,eaveHeight:2400,pitch:10,reverse:!1},ct={type:"Free Hand"},Et=C=>{let[t,h]=oe({svgWidth:void 0,svgHeight:void 0,wallShape:{...we},sheetCover:762,pastSlabDist:20,backCutErrorAllowance:5,startSheetAt:"Left",mkMode:void 0,mousePos:void 0,lines:[]}),[Y,V]=Ye(void 0);const[x,W]=oe({...Oe(),scale:.1});let O=()=>!1,$=new Xe({state:x,setState:W,disablePan:O}),X=e=>{h("mousePos",I.create(e.offsetX,e.offsetY)),$.onMouseDown(e)},U=e=>{h("mousePos",I.create(e.offsetX,e.offsetY));let n=A();n.click?.call(n,e.ctrlKey),$.onMouseUp(e)},F=e=>{h("mousePos",I.create(e.offsetX,e.offsetY)),$.onMouseMove(e)},Z=e=>{$.onWheel(e)},z=e=>{let n=Y();if(n!=null&&e.touches.length!=0){let a=n.getBoundingClientRect(),u=e.touches[0].clientX-a.left,o=e.touches[0].clientY-a.top;h("mousePos",I.create(u,o))}$.onTouchStart(e),e.preventDefault()},f=e=>{let n=Y();if(n!=null&&e.touches.length!=0){let a=n.getBoundingClientRect(),u=e.touches[0].clientX-a.left,o=e.touches[0].clientY-a.top;h("mousePos",I.create(u,o))}$.onTouchMove(e),e.preventDefault()},m=e=>{let n=Y();if(n!=null&&e.touches.length!=0){let a=n.getBoundingClientRect(),u=e.touches[0].clientX-a.left,o=e.touches[0].clientY-a.top;h("mousePos",I.create(u,o))}$.onTouchEnd(e),e.preventDefault()},v=e=>{h("mousePos",void 0)},c=e=>{if(e.key=="Escape"){let n=A();n.cancel?.call(n),Pe()}else if(e.key=="Delete"){let a=A().deleteAction?.call(void 0);if(a==null)return;a()}};document.addEventListener("keydown",c),fe(()=>{document.removeEventListener("keydown",c)}),Ve(()=>{let e=Y();if(e!=null){e.addEventListener("mouseout",v);let n=e;fe(()=>{n.removeEventListener("mouseout",v)})}});let w=({svgWidth:e,svgHeight:n})=>{let a=ce(()=>e()),u=ce(()=>n());ee(()=>{h("svgWidth",o=>e),h("svgHeight",o=>n),W("panX",-.2*a/x.scale),W("panY",-.8*u/x.scale)})},k=g(()=>t.svgWidth?.call(void 0)),M=g(()=>t.svgHeight?.call(void 0)),_=(e,n)=>{let a=Math.pow(10,n);return Math.round(e*a)/a},R=()=>[E({displayName:()=>"Length",value:()=>t.wallShape.type!="Gable"?0:t.wallShape.length,setValue:e=>{h("wallShape",n=>n.type!="Gable"?n:{...n,length:e})}}),E({displayName:()=>"Eave Height",value:()=>t.wallShape.type!="Gable"?0:t.wallShape.eaveHeight,setValue:e=>{h("wallShape",n=>n.type!="Gable"?n:{...n,eaveHeight:e})}}),E({displayName:()=>"Pitch",value:()=>t.wallShape.type!="Gable"?0:_(t.wallShape.pitch,3),setValue:e=>{h("wallShape",n=>n.type!="Gable"?n:{...n,pitch:e})}}),E({displayName:()=>"Apex Height",value:()=>t.wallShape.type!="Gable"?0:_(t.wallShape.eaveHeight+.5*t.wallShape.length*Math.tan(t.wallShape.pitch*Math.PI/180),3),setValue:e=>{h("wallShape",n=>n.type!="Gable"?n:{...n,pitch:Math.atan((e-n.eaveHeight)/(.5*n.length))*180/Math.PI})}})],P=()=>{let e=g(()=>t.wallShape.type!="Skillion"?0:t.wallShape.eaveHeight+t.wallShape.length*Math.tan(t.wallShape.pitch*Math.PI/180)),n=u=>{let o=e();ee(()=>{h("wallShape",b=>{if(b.type!="Skillion")return b;let G=Math.atan((o-u)/b.length)*180/Math.PI;return{...b,eaveHeight:u,pitch:G}})})},a=u=>{h("wallShape",o=>{if(o.type!="Skillion")return o;let b=Math.atan((u-o.eaveHeight)/o.length)*180/Math.PI;return{...o,pitch:b}})};return[E({displayName:()=>"Length",value:()=>t.wallShape.type!="Skillion"?0:t.wallShape.length,setValue:u=>{h("wallShape",o=>o.type!="Skillion"?o:{...o,length:u})}}),E({displayName:()=>"Eave Height",value:()=>t.wallShape.type!="Skillion"?0:_(t.wallShape.eaveHeight,3),setValue:u=>{h("wallShape",o=>o.type!="Skillion"?o:{...o,eaveHeight:u})}}),E({displayName:()=>"Pitch",value:()=>t.wallShape.type!="Skillion"?0:_(t.wallShape.pitch,6),setValue:u=>{h("wallShape",o=>o.type!="Skillion"?o:{...o,pitch:u})}}),ze({displayName:()=>"Reverse Skillion",value:()=>t.wallShape.type!="Skillion"?!1:t.wallShape.reverse,setValue:u=>{h("wallShape",o=>o.type!="Skillion"?o:{...o,reverse:u})}}),E({displayName:()=>"Left Height",value:()=>t.wallShape.type!="Skillion"?0:t.wallShape.reverse?_(e(),3):_(t.wallShape.eaveHeight,3),setValue:u=>{if(t.wallShape.type!="Skillion")return 0;t.wallShape.reverse?a(u):n(u)}}),E({displayName:()=>"Right Height",value:()=>t.wallShape.type!="Skillion"?0:t.wallShape.reverse?_(t.wallShape.eaveHeight,3):_(e(),3),setValue:u=>{if(t.wallShape.type!="Skillion")return 0;t.wallShape.reverse?n(u):a(u)}})]},B=g(()=>{switch(t.wallShape.type){case"Gable":return R();case"Skillion":return P();case"Free Hand":return[je({displayName:()=>"Outline",value:()=>"Use Draw Lines"})]}}),te=g(()=>[{displayName:"Properties",fields:[ve({displayName:()=>"Shape",value:()=>t.wallShape.type,setValue:e=>{switch(e){case"Gable":ee(()=>{h("wallShape",ae({...ft})),h("startSheetAt","Centre")});break;case"Skillion":ee(()=>{h("wallShape",ae({...we})),h("startSheetAt","Left")});break;case"Free Hand":ee(()=>{h("wallShape",ae({...ct})),h("startSheetAt","Left")});break}},possibleValues:g(()=>["Gable","Skillion","Free Hand"])}),...B(),E({displayName:()=>"Sheet Cover",value:()=>t.sheetCover,setValue:e=>h("sheetCover",e)}),E({displayName:()=>"Past Slab Dist",value:()=>t.pastSlabDist,setValue:e=>h("pastSlabDist",e)}),E({displayName:()=>"Back Cut Error Allowance",value:()=>t.backCutErrorAllowance,setValue:e=>h("backCutErrorAllowance",e)}),ve({displayName:()=>"Start Sheet At",value:()=>t.startSheetAt,setValue:e=>h("startSheetAt",e),possibleValues:g(()=>["Left","Right","Centre"])})],expanded:()=>!0}]),_e=g(()=>t.wallShape.type!="Gable"?[]:[I.create(0,0),I.create(t.wallShape.length,0),I.create(t.wallShape.length,t.wallShape.eaveHeight),I.create(.5*t.wallShape.length,t.wallShape.eaveHeight+.5*t.wallShape.length*Math.tan(t.wallShape.pitch*Math.PI/180)),I.create(0,t.wallShape.eaveHeight)]),$e=g(()=>{if(t.wallShape.type!="Skillion")return[];let e=t.wallShape.eaveHeight,n=t.wallShape.eaveHeight+t.wallShape.length*Math.tan(t.wallShape.pitch*Math.PI/180),a=t.wallShape.reverse?n:e,u=t.wallShape.reverse?e:n;return[I.create(0,0),I.create(t.wallShape.length,0),I.create(t.wallShape.length,u),I.create(0,a)]}),re=g(()=>t.wallShape.type!="Free Hand"?[]:gt(t.lines.map(({line:n})=>n))),se;{let e=[];se=g(()=>{let n=re().length;for(;e.length<n;)e.push(Re());return e.slice(0,n)})}let xe=g(()=>{let e=re(),n=se();return e.map((a,u)=>({outline:a,colour:n[u]}))}),be=g(()=>{let e=re();if(e.length==0)return[];let n,a;for(let u of e){let o=0;for(let b=0;b<u.length;++b){let G=(b+1)%u.length,j=u[b],J=u[G];o+=j.cross(J)}o=Math.abs(o),(n==null||o>n)&&(n=o,a=u)}return a??[]}),Q=g(()=>{switch(t.wallShape.type){case"Gable":return _e();case"Skillion":return $e();case"Free Hand":return be()}}),Me=g(()=>{let e=Q();if(e.length<3)return[];let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let r of e)n=Math.min(n,r.x),a=Math.max(a,r.x);let u=a-n,o=Math.ceil(u/t.sheetCover),b;switch(t.startSheetAt){case"Left":b=n;break;case"Right":b=a-o*t.sheetCover;break;case"Centre":b=.5*(n+a)-.5*o*t.sheetCover;break}let G=[],j={minY:0,maxY:0},J={minY:0,maxY:0};for(let r=0;r<o;++r){let d=b+r*t.sheetCover,l=d+t.sheetCover,i=ge(e,d,j),s=ge(e,l,J),y=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY;i!=null&&(y=Math.min(y,i.minY),S=Math.max(S,i.maxY)),s!=null&&(y=Math.min(y,s.minY),S=Math.max(S,s.maxY));for(let D of e)d<=D.x&&D.x<=l&&(y=Math.min(y,D.y),S=Math.max(S,D.y));if(!Number.isFinite(y))continue;let H;Math.abs(y)<=.001?H=t.pastSlabDist:H=0,G.push({pos:I.create(d,y-H),length:S-y+H+t.backCutErrorAllowance})}return G}),ue=e=>$.worldPtToScreenPt(e.xy()),de=g(()=>{if(t.mousePos==null)return;let e=$.screenPtToWorldPt(t.mousePos.x,t.mousePos.y);return ke.create(le.create(e.x,e.y,1e5),le.negUnitZ)}),Ie=e=>{h("mkMode",()=>e)},Pe=()=>{h("mkMode",void 0)},Ne=()=>{Ie(()=>new Je({undoManager:new qe,cameraLookDir:()=>le.negUnitZ,projectPtToScreen:ue,mousePos:()=>t.mousePos,mouseRay:de,otherSnapPoints:g(()=>[le.zero]),existingLines:g(()=>t.lines.map(({id:e,line:n})=>({id:e,line:me.create(n.v1.toVec3(),n.v2.toVec3())}))),createLine:e=>{let n=Ge(),a=ie.create(e.v1.xy(),e.v2.xy());return h("lines",[...t.lines,{id:n,line:a}]),{id:n}},updateLine:({id:e,line:n})=>{let a=t.lines.findIndex(({id:o})=>o==e);if(a==-1)return;let u=ie.create(n.v1.xy(),n.v2.xy());h("lines",a,"line",u)},destroyLine:e=>(h("lines",t.lines.filter(({id:n})=>n!==e)),{undelete:()=>{}}),allowAlignAll:()=>!0}))},A=g(()=>t.mkMode==null?new vt({projectPtToScreen:ue,mousePos:()=>t.mousePos,mouseRay:de,existingLines:g(()=>t.lines.map(({id:e,line:n})=>({id:e,line:me.create(n.v1.toVec3(),n.v2.toVec3())}))),deleteLinesById:e=>{let n=new Set;for(let a of e)n.add(a);h("lines",t.lines.filter(({id:a})=>!n.has(a)))}}):t.mkMode()),He=g(()=>{let e=A();return e.instructions?.call(e,{})}),Ee=g(()=>A().overlayUI),Le=()=>N(ne,{get when(){return Ee()},children:e=>Be(()=>e()({}))}),Ce=g(()=>A().snapPoints?.call(void 0)??[]),Te=g(()=>A().dottedWorkingLines?.call(void 0)??[]),Ae=g(()=>{let e=A(),n=new Set;for(let a of e.highlightedObjectsById?.call(void 0)??[])typeof a=="string"&&n.add(a);return n}),De=g(()=>{let e=A(),n=new Set;for(let a of e.selectedObjectsById?.call(void 0)??[])typeof a=="string"&&n.add(a);return n}),he=g(()=>A().deleteAction?.call(void 0));return(()=>{const e=et.cloneNode(!0),n=e.firstChild,a=n.firstChild,u=a.nextSibling,o=u.nextSibling,b=n.nextSibling,G=b.firstChild,j=G.nextSibling,J=j.firstChild;return K(n,N(We,{get when(){return C.onClose!=null},get children(){const r=Qe.cloneNode(!0);return r.$$click=()=>{C.onClose!=null&&C.onClose()},r}}),a),u.$$click=()=>Ne(),o.$$click=()=>{let r=he();r?.()},K(G,N(Ze,{get fieldGroups(){return te()}})),K(j,N(Ue,{showGrid:!0,gridScale:100,fontSize:12,state:x,style:{"flex-grow":"1"},onRefSvg:r=>{V(r)},onInit:w,onMouseDown:X,onMouseUp:U,onMouseMove:F,onWheel:Z,onTouchStart:z,onTouchMove:f,onTouchEnd:m,get children(){return[N(ne,{get when(){return k()},children:r=>(()=>{const d=tt.cloneNode(!0);return T(l=>{const i=x.panX,s=x.panX+r()/x.scale;return i!==l._v$&&p(d,"x1",l._v$=i),s!==l._v$2&&p(d,"x2",l._v$2=s),l},{_v$:void 0,_v$2:void 0}),d})()}),N(ne,{get when(){return M()},children:r=>(()=>{const d=nt.cloneNode(!0);return T(l=>{const i=x.panY,s=x.panY+r()/x.scale;return i!==l._v$3&&p(d,"y1",l._v$3=i),s!==l._v$4&&p(d,"y2",l._v$4=s),l},{_v$3:void 0,_v$4:void 0}),d})()}),N(q,{get each(){return[...Array(Q().length).keys()]},children:r=>{let d=g(()=>Q()[r]),l=g(()=>Q()[(r+1)%Q().length]);return(()=>{const i=lt.cloneNode(!0);return T(s=>{const y=d().x,S=-d().y,H=l().x,D=-l().y;return y!==s._v$5&&p(i,"x1",s._v$5=y),S!==s._v$6&&p(i,"y1",s._v$6=S),H!==s._v$7&&p(i,"x2",s._v$7=H),D!==s._v$8&&p(i,"y2",s._v$8=D),s},{_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0}),i})()}}),N(q,{get each(){return xe()},children:r=>{let d=g(()=>{let l=r.outline;if(l.length<3)return;let i="M"+l[0].x+" "+-l[0].y;for(let s=1;s<l.length;++s)i+=" L"+l[s].x+" "+-l[s].y;return i+="Z",i});return N(ne,{get when(){return d()},children:l=>(()=>{const i=it.cloneNode(!0);return T(s=>{const y=l(),S=r.colour;return y!==s._v$9&&p(i,"d",s._v$9=y),S!==s._v$10&&p(i,"fill",s._v$10=S),s},{_v$9:void 0,_v$10:void 0}),i})()})}}),N(q,{get each(){return t.lines},children:r=>{let d=g(()=>De().has(r.id)?"green":Ae().has(r.id)?"blue":"black");return(()=>{const l=rt.cloneNode(!0);return T(i=>{const s=r.line.v1.x,y=-r.line.v1.y,S=r.line.v2.x,H=-r.line.v2.y,D=d();return s!==i._v$11&&p(l,"x1",i._v$11=s),y!==i._v$12&&p(l,"y1",i._v$12=y),S!==i._v$13&&p(l,"x2",i._v$13=S),H!==i._v$14&&p(l,"y2",i._v$14=H),D!==i._v$15&&p(l,"stroke",i._v$15=D),i},{_v$11:void 0,_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0}),l})()}}),N(q,{get each(){return Me()},children:r=>[(()=>{const d=at.cloneNode(!0);return T(l=>{const i=r.pos.x,s=-(r.pos.y+r.length),y=t.sheetCover,S=r.length;return i!==l._v$16&&p(d,"x",l._v$16=i),s!==l._v$17&&p(d,"y",l._v$17=s),y!==l._v$18&&p(d,"width",l._v$18=y),S!==l._v$19&&p(d,"height",l._v$19=S),l},{_v$16:void 0,_v$17:void 0,_v$18:void 0,_v$19:void 0}),d})(),(()=>{const d=ot.cloneNode(!0);return T(l=>{const i=r.pos.x,s=-(r.pos.y+r.length),y=t.sheetCover,S=r.length;return i!==l._v$20&&p(d,"x",l._v$20=i),s!==l._v$21&&p(d,"y",l._v$21=s),y!==l._v$22&&p(d,"width",l._v$22=y),S!==l._v$23&&p(d,"height",l._v$23=S),l},{_v$20:void 0,_v$21:void 0,_v$22:void 0,_v$23:void 0}),d})(),(()=>{const d=st.cloneNode(!0);return K(d,()=>Math.round(r.length)+"mm"),T(()=>p(d,"transform","translate("+(r.pos.x+.5*t.sheetCover)+" "+-(r.pos.y+.5*r.length)+") scale(10) rotate(-90)")),d})()]}),N(q,{get each(){return Te()},children:r=>(()=>{const d=ut.cloneNode(!0);return T(l=>{const i=r.v1.x,s=-r.v1.y,y=r.v2.x,S=-r.v2.y;return i!==l._v$24&&p(d,"x1",l._v$24=i),s!==l._v$25&&p(d,"y1",l._v$25=s),y!==l._v$26&&p(d,"x2",l._v$26=y),S!==l._v$27&&p(d,"y2",l._v$27=S),l},{_v$24:void 0,_v$25:void 0,_v$26:void 0,_v$27:void 0}),d})()}),N(q,{get each(){return Ce()},children:r=>{let d=g(()=>r.highlighted()?"green":"blue");return(()=>{const l=dt.cloneNode(!0);return T(i=>{const s=r.pt().x,y=-r.pt().y,S=5/x.scale,H=d();return s!==i._v$28&&p(l,"cx",i._v$28=s),y!==i._v$29&&p(l,"cy",i._v$29=y),S!==i._v$30&&p(l,"r",i._v$30=S),H!==i._v$31&&p(l,"fill",i._v$31=H),i},{_v$28:void 0,_v$29:void 0,_v$30:void 0,_v$31:void 0}),l})()}})]}}),J),K(J,He),K(j,N(Le,{}),null),T(()=>o.disabled=he()==null),e})()};class vt{constructor(t){let[h,Y]=oe({selectedLinesById:[]}),V=g(()=>{let x=t.mousePos();if(x==null)return;let W=t.mouseRay();if(W==null)return;let O,$;for(let X of t.existingLines()){let U=ke.create(X.line.v1,X.line.v2.sub(X.line.v1)),F=W.closestTimeOnThisRayWithOtherRay(U);if(F==null)continue;let Z=W.positionFromTime(F),z=Math.max(0,Math.min(1,U.closestTimeToPoint(Z))),f=U.positionFromTime(z),m=t.projectPtToScreen(f);if(m==null)continue;let v=x.distanceSquared(m);v>ht||(O==null||v<O)&&(O=v,$=X)}return $});this.highlightedObjectsById=g(()=>pe(V()?.id)),this.selectedObjectsById=()=>h.selectedLinesById,this.click=()=>{Y("selectedLinesById",pe(V()?.id))},this.deleteAction=g(()=>{if(h.selectedLinesById.length!=0)return()=>{t.deleteLinesById(h.selectedLinesById)}})}}function gt(C){let t=0,h=f=>f.x+"_"+f.y,Y={},V=[],x=f=>{let m=h(f),v=Y[m];return v==null&&(v={id:t++,pt:f},V.push(v),Y[m]=v),v},W=(f,m)=>Math.min(f.id,m.id)+"_"+Math.max(f.id,m.id),O={},$=[],X=(f,m)=>{let v=W(f,m),c=O[v];if(c==null){let w={id:t++,origin:f,twin:void 0},k={id:t++,origin:m,twin:w};w.twin=k,c=[w,k],$.push(c[0],c[1]),O[v]=c}return c},U=[],F=.001;for(let f=0;f<C.length-1;++f){let m=C[f],v=m.length(),c=ye.fromOriginDirection(m.v1,m.v2.sub(m.v1));for(let w=f+1;w<C.length;++w){let k=C[w],M=k.length(),_=Ke.fromPointToPoint(k.v1,k.v2),R=ye.fromOriginDirection(k.v1,k.v2.sub(k.v1)),P=c.intersectionTime(_);if(P==null||P<=0-F/v||P>=1+F/v)continue;let B=c.pointFromTime(P),te=R.closestTimeToPoint(B);te<=0-F/M||te>=1+F/M||U.push({line1Idx:f,line2Idx:w,point:B})}}for(let f=0;f<C.length;++f){let m=C[f],v=f,c=[x(m.v1),...U.flatMap(({line1Idx:w,line2Idx:k,point:M})=>w!=v&&k!=v?[]:x(M)),x(m.v2)];for(let w=0;w<c.length-1;++w)X(c[w],c[w+1])}for(;;){let f=!1;for(let m=V.length-1;m>=0;--m){let v=V[m],c=0;for(let w of $)w.origin===v&&++c;c<2&&(V.splice(m,1),c!=0&&($=$.filter(({origin:w,twin:k})=>w!==v&&k.origin!==v),f=!0))}if(!f)break}for(let f of $){if(f.next!=null)continue;let m=ie.create(f.origin.pt,f.twin.origin.pt),v=m.v2.sub(m.v1).normalize();if(Number.isNaN(v.x))continue;let c=2*Math.PI,w=f.twin;for(let k of $){if(k==f||k==f.twin||k.origin!==f.twin.origin)continue;let M=ie.create(k.origin.pt,k.twin.origin.pt),_=M.v2.sub(M.v1).normalize();if(Number.isNaN(_.x))continue;let R=v.dot(_),P=v.cross(_),B=Math.atan2(P,R);B=Math.PI-B,B<c&&(c=B,w=k)}f.next=w}let Z=new Set,z=[];for(let f of $){if(Z.has(f))continue;let m=f,v=m,c=[],w=new Set;for(;;){c.push(v.origin.pt),w.add(v);let k=v.next;if(k==null)break;if(v=k,v==m){for(;;){let M=!1;for(let _=0;_<c.length;++_){let R=(_+1)%c.length,P=(_+2)%c.length;if(c[_]==c[P]){c.splice(R,1),M=!0;break}}if(!M)break}for(let M=0;M<c.length;++M){let _=c[M],R=c[(M+1)%c.length];for(let P of $)if(P.origin.pt===_&&P.twin.origin.pt===R){Z.add(P);break}}c.length>=3&&z.push(c);break}if(w.has(v))break}}return z}Fe(["click"]);export{Et as default};
