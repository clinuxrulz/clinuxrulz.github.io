import{f as W,c as U,o as X,a as M,A as Y,i as o,b as c,S as C,e as x,C as Z,I as ee,t as h,P as te,Q as ne,J as V,_ as z,M as F,d as re,R as I,H as f,T as ie,U as se,V as le}from"./index.5aba22ff.js";const oe=h('<button class="btn btn-primary">Close</button>'),ae=h("<br>"),de=h('<button class="btn btn-primary" style="margin-left: 10px;">Open</button>'),ce=h('<button class="btn btn-primary" style="margin-left: 10px;">New</button>'),ue=h('<div style="flex-grow: 1; display: flex; flex-direction: column; overflow: hidden;"><div><h2>Flashing Jobs Overview</h2>Search:<input type="text"><button class="btn btn-primary">Clear</button><button class="btn btn-primary" style="margin-left: 10px;">Delete</button></div><div style="flex-grow: 1; overflow: auto; border: 1px solid black;"><table class="table" tabindex="0"><thead><tr><th style="white-space: nowrap;">Job #</th><th style="white-space: nowrap;">Order #</th><th style="white-space: nowrap;">Customer</th><th style="white-space: nowrap;">Site Contact</th><th style="white-space: nowrap;">Site Address</th><th style="white-space: nowrap;">Supplier Name</th><th style="white-space: nowrap;">Supplier Email</th><th style="white-space: nowrap;">Supplier Contact</th><th style="white-space: nowrap;">Required on site</th></tr></thead><tbody></tbody></table></div></div>'),we=h('<tr><td style="white-space: nowrap;"></td><td style="white-space: nowrap;"></td><td style="white-space: nowrap;"></td><td style="white-space: nowrap;"></td><td style="white-space: nowrap;"></td><td style="white-space: nowrap;"></td><td style="white-space: nowrap;"></td><td style="white-space: nowrap;"></td><td style="white-space: nowrap;"></td></tr>'),be=a=>{let[e,d]=U({searchText:"",flashingJobRows:[]});const p=async()=>{let i=await te(),s=[];for(let l of i)s.push({jobNumber:l.jobNumber,orderNumber:l.orderNumber,customerName:l.customerName,siteContactName:l.siteContactName,siteAddress:l.siteAddress,supplierName:l.supplierName,supplierEmail:l.supplierEmail,supplierContactName:l.supplierContactName,requiredOnSiteDate:l.requiredOnSiteDate});d("flashingJobRows",s)};X(()=>{p()});const m=M(()=>e.searchText==""?e.flashingJobRows:(()=>{let i=e.searchText.toLowerCase();return e.flashingJobRows.filter(s=>{for(let l in s){if(!s.hasOwnProperty(l))continue;let g=s[l];if(g!=null&&g.toString().toLowerCase().includes(i))return!0}return!1})})()),$=()=>{d("searchText","")},_=i=>{d("searchText",i)},y=()=>{d("selectedRowIndex",void 0)},r=i=>{d("selectedRowIndex",i)};Y(()=>{e.searchText,y()});const n=()=>{if(e.selectedRowIndex==null||a.onOpen==null)return;let i=m();if(e.selectedRowIndex<0||e.selectedRowIndex>=i.length)return;let s=i[e.selectedRowIndex].jobNumber;a.onOpen(s)},u=()=>{a.onNew!=null&&a.onNew()},b=async()=>{if(e.selectedRowIndex==null)return;let i=m();if(e.selectedRowIndex<0||e.selectedRowIndex>=i.length)return;let s=i[e.selectedRowIndex].jobNumber;if(window.confirm("Are you sure you wish to delete job # "+s+"?"))try{await ne({jobNumber:s}),await p()}catch(l){alert(l)}},J=i=>{switch(i.key){case"Escape":{y();break}case"ArrowDown":{e.selectedRowIndex!=null&&e.selectedRowIndex<e.flashingJobRows.length-1&&r(e.selectedRowIndex+1);break}case"ArrowUp":{e.selectedRowIndex!=null&&e.selectedRowIndex>0&&r(e.selectedRowIndex-1);break}}};return(()=>{const i=ue.cloneNode(!0),s=i.firstChild,l=s.firstChild,g=l.nextSibling,S=g.nextSibling,R=S.nextSibling,O=R.nextSibling,H=s.nextSibling,k=H.firstChild,K=k.firstChild,Q=K.nextSibling;return o(s,c(C,{get when(){return a.onClose!=null},get children(){return[(()=>{const t=oe.cloneNode(!0);return t.$$click=()=>{a.onClose!=null&&a.onClose()},t})(),ae.cloneNode(!0)]}}),g),S.$$input=t=>{let w=t.target;_(w.value)},R.$$click=()=>$(),O.$$click=()=>b(),o(s,c(C,{get when(){return a.onOpen!=null},get children(){const t=de.cloneNode(!0);return t.$$click=()=>n(),x(()=>t.disabled=e.selectedRowIndex==null),t}}),null),o(s,c(C,{get when(){return a.onNew!=null},get children(){const t=ce.cloneNode(!0);return t.$$click=()=>u(),t}}),null),k.$$keydown=J,o(Q,c(ee,{get each(){return m()},children:(t,w)=>{let v=M(()=>e.selectedRowIndex==null?!1:e.selectedRowIndex==w);return(()=>{const N=we.cloneNode(!0),E=N.firstChild,A=E.nextSibling,T=A.nextSibling,j=T.nextSibling,D=j.nextSibling,q=D.nextSibling,L=q.nextSibling,P=L.nextSibling,B=P.nextSibling;return N.$$click=()=>r(w),o(E,()=>t().jobNumber),o(A,()=>t().orderNumber),o(T,()=>t().customerName),o(j,()=>t().siteContactName),o(D,()=>t().siteAddress),o(q,()=>t().supplierName),o(L,()=>t().supplierEmail),o(P,()=>t().supplierContactName),o(B,()=>t().requiredOnSiteDate?.toLocaleDateString("en-AU")),x(G=>Z(N,v()?"background: #80FF80; cursor: pointer;":"cursor: pointer;",G)),N})()}})),x(t=>{const w=e.searchText=="",v=e.selectedRowIndex==null;return w!==t._v$&&(R.disabled=t._v$=w),v!==t._v$2&&(O.disabled=t._v$2=v),t},{_v$:void 0,_v$2:void 0}),x(()=>S.value=e.searchText),i})()};W(["click","input","keydown"]);const he=V(()=>z(()=>import("./Flashing.6f39137f.js"),["Flashing.6f39137f.js","index.5aba22ff.js","index.8628b9c4.css","SvgWithPanZoomState.e2089103.js","Vec3.ce1f4f7a.js","FlashingRenderer.e92cafa9.js","Line2D.139781b3.js","Ray2D.01cdc921.js","PanelUtils.894b6d74.js","Component.6024a649.js","Component.fa73bdbc.js","PropertiesForm.c69fa44e.js"],import.meta.url)),pe=V(()=>z(()=>import("./FlashingJob.1d46810c.js"),["FlashingJob.1d46810c.js","FlashingJob.03c5bc52.css","index.5aba22ff.js","index.8628b9c4.css","index.57dedfe4.js","FlashingRenderer.e92cafa9.js","Vec3.ce1f4f7a.js","SvgWithPanZoomState.e2089103.js","Dialog.aed5b9f2.js"],import.meta.url)),ge=a=>{const[e,d]=U({view:{type:"Jobs Overview"}}),p=async r=>{let n;try{n=await I({jobNumber:r})}catch(u){alert(u);return}d("view",f({type:"Job",jobNumber:r,init:{orderNumber:n.orderNumber,customerName:n.customerName,siteContactName:n.siteContactName,siteAddress:n.siteAddress,supplierName:n.supplierContactName,supplierEmail:n.supplierEmail,supplierContactName:n.supplierContactName,requiredOnSiteDate:n.requiredOnSiteDate}}))},m=async()=>{let r;try{let{jobNumber:n}=await ie();r=n}catch(n){alert(n);return}d("view",f({type:"Job",jobNumber:r}))},$=async r=>{let n=await I({jobNumber:r}),u=await se({jobNumber:r}),b={jobNumber:r,customerName:n.customerName};d("view",f({type:"Flashing",id:u.id,forJob:b,init:u}))},_=async(r,n)=>{let u=await I({jobNumber:r}),b=await le({flashingId:n}),J={jobNumber:r,customerName:u.customerName};d("view",f({type:"Flashing",id:b.id,forJob:J,init:b}))},y=()=>{d("view",f({type:"Jobs Overview"}))};return c(re,{get children(){return[c(F,{get when(){return e.view.type=="Jobs Overview"},get children(){return c(be,{get onClose(){return a.onClose},onOpen:p,onNew:m})}}),c(F,{get when(){return e.view.type=="Job"},get children(){return c(pe,{get rootDiv(){return a.rootDiv},get jobNumber(){return(()=>e.view.type!="Job"?"":e.view.jobNumber)()},get init(){return(()=>{if(e.view.type=="Job")return e.view.init})()},onClose:()=>y(),onNewFlashing:()=>{e.view.type=="Job"&&$(e.view.jobNumber)},onOpenFlashing:r=>{e.view.type=="Job"&&_(e.view.jobNumber,r)}})}}),c(F,{get when(){return e.view.type=="Flashing"},get children(){return c(he,{get id(){return e.view.type=="Flashing"?e.view.id:""},get forJob(){return e.view.type=="Flashing"?e.view.forJob:{jobNumber:"",customerName:""}},get init(){return e.view.type=="Flashing"?e.view.init:void 0},onClose:()=>{e.view.type=="Flashing"&&p(e.view.forJob.jobNumber)}})}})]}})};export{ge as default};
