(function(){"use strict";var wu=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(t=t||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,o;r.ready=new Promise(function(s,a){n=s,o=a});var i=Object.assign({},r),u="./this.program",c=(s,a)=>{throw a},f=typeof window=="object",p=typeof importScripts=="function",g=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="";function m(s){return r.locateFile?r.locateFile(s,y):y+s}var _,E,x;function k(s){if(s instanceof gi)return;z("exiting due to exception: "+s)}var A,L,D;g?(p?y=require("path").dirname(y)+"/":y=__dirname+"/",D=()=>{L||(A=require("fs"),L=require("path"))},_=function(a,l){return D(),a=L.normalize(a),A.readFileSync(a,l?void 0:"utf8")},x=s=>{var a=_(s,!0);return a.buffer||(a=new Uint8Array(a)),a},E=(s,a,l)=>{D(),s=L.normalize(s),A.readFile(s,function(h,d){h?l(h):a(d.buffer)})},process.argv.length>1&&(u=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(s){if(!(s instanceof gi))throw s}),process.on("unhandledRejection",function(s){throw s}),c=(s,a)=>{if(Va())throw process.exitCode=s,a;k(a),process.exit(s)},r.inspect=function(){return"[Emscripten Module object]"}):(f||p)&&(p?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),t&&(y=t),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",_=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.send(null),a.responseText},p&&(x=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),E=(s,a,l)=>{var h=new XMLHttpRequest;h.open("GET",s,!0),h.responseType="arraybuffer",h.onload=()=>{if(h.status==200||h.status==0&&h.response){a(h.response);return}l()},h.onerror=l,h.send(null)});var q=r.print||console.log.bind(console),z=r.printErr||console.warn.bind(console);Object.assign(r,i),i=null,r.arguments&&r.arguments,r.thisProgram&&(u=r.thisProgram),r.quit&&(c=r.quit);var ae=4,te;r.wasmBinary&&(te=r.wasmBinary);var ee=r.noExitRuntime||!0;typeof WebAssembly!="object"&&Ht("no native wasm support detected");var pe,Oe=!1;function Ie(s,a){s||Ht(a)}var We=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Me(s,a,l){for(var h=a+l,d=a;s[d]&&!(d>=h);)++d;if(d-a>16&&s.buffer&&We)return We.decode(s.subarray(a,d));for(var w="";a<d;){var b=s[a++];if(!(b&128)){w+=String.fromCharCode(b);continue}var S=s[a++]&63;if((b&224)==192){w+=String.fromCharCode((b&31)<<6|S);continue}var T=s[a++]&63;if((b&240)==224?b=(b&15)<<12|S<<6|T:b=(b&7)<<18|S<<12|T<<6|s[a++]&63,b<65536)w+=String.fromCharCode(b);else{var P=b-65536;w+=String.fromCharCode(55296|P>>10,56320|P&1023)}}return w}function se(s,a){return s?Me(ze,s,a):""}function Ee(s,a,l,h){if(!(h>0))return 0;for(var d=l,w=l+h-1,b=0;b<s.length;++b){var S=s.charCodeAt(b);if(S>=55296&&S<=57343){var T=s.charCodeAt(++b);S=65536+((S&1023)<<10)|T&1023}if(S<=127){if(l>=w)break;a[l++]=S}else if(S<=2047){if(l+1>=w)break;a[l++]=192|S>>6,a[l++]=128|S&63}else if(S<=65535){if(l+2>=w)break;a[l++]=224|S>>12,a[l++]=128|S>>6&63,a[l++]=128|S&63}else{if(l+3>=w)break;a[l++]=240|S>>18,a[l++]=128|S>>12&63,a[l++]=128|S>>6&63,a[l++]=128|S&63}}return a[l]=0,l-d}function ke(s,a,l){return Ee(s,ze,a,l)}function fe(s){for(var a=0,l=0;l<s.length;++l){var h=s.charCodeAt(l);h>=55296&&h<=57343&&(h=65536+((h&1023)<<10)|s.charCodeAt(++l)&1023),h<=127?++a:h<=2047?a+=2:h<=65535?a+=3:a+=4}return a}var me=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Ue(s,a){for(var l=s,h=l>>1,d=h+a/2;!(h>=d)&&$r[h];)++h;if(l=h<<1,l-s>32&&me)return me.decode(ze.subarray(s,l));for(var w="",b=0;!(b>=a/2);++b){var S=Nt[s+b*2>>1];if(S==0)break;w+=String.fromCharCode(S)}return w}function Ye(s,a,l){if(l===void 0&&(l=2147483647),l<2)return 0;l-=2;for(var h=a,d=l<s.length*2?l/2:s.length,w=0;w<d;++w){var b=s.charCodeAt(w);Nt[a>>1]=b,a+=2}return Nt[a>>1]=0,a-h}function ye(s){return s.length*2}function De(s,a){for(var l=0,h="";!(l>=a/4);){var d=B[s+l*4>>2];if(d==0)break;if(++l,d>=65536){var w=d-65536;h+=String.fromCharCode(55296|w>>10,56320|w&1023)}else h+=String.fromCharCode(d)}return h}function Yr(s,a,l){if(l===void 0&&(l=2147483647),l<4)return 0;for(var h=a,d=h+l-4,w=0;w<s.length;++w){var b=s.charCodeAt(w);if(b>=55296&&b<=57343){var S=s.charCodeAt(++w);b=65536+((b&1023)<<10)|S&1023}if(B[a>>2]=b,a+=4,a+4>d)break}return B[a>>2]=0,a-h}function Qo(s){for(var a=0,l=0;l<s.length;++l){var h=s.charCodeAt(l);h>=55296&&h<=57343&&++l,a+=4}return a}function Fn(s){var a=fe(s)+1,l=Ct(a);return l&&Ee(s,Ge,l,a),l}function qr(s,a){Ge.set(s,a)}function In(s,a,l){for(var h=0;h<s.length;++h)Ge[a++>>0]=s.charCodeAt(h);l||(Ge[a>>0]=0)}var St,Ge,ze,Nt,$r,B,J,at,Ia;function Ga(s){St=s,r.HEAP8=Ge=new Int8Array(s),r.HEAP16=Nt=new Int16Array(s),r.HEAP32=B=new Int32Array(s),r.HEAPU8=ze=new Uint8Array(s),r.HEAPU16=$r=new Uint16Array(s),r.HEAPU32=J=new Uint32Array(s),r.HEAPF32=at=new Float32Array(s),r.HEAPF64=Ia=new Float64Array(s)}r.INITIAL_MEMORY;var Na,Ha=[],Wa=[],za=[];function Va(){return ee}function zp(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Yp(r.preRun.shift());ei(Ha)}function Vp(){!r.noFSInit&&!v.init.initialized&&v.init(),v.ignorePermissions=!1,ei(Wa)}function Xp(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)$p(r.postRun.shift());ei(za)}function Yp(s){Ha.unshift(s)}function qp(s){Wa.unshift(s)}function $p(s){za.unshift(s)}var Jt=0,jr=null;function Tg(s){return s}function Jo(s){Jt++,r.monitorRunDependencies&&r.monitorRunDependencies(Jt)}function Gn(s){if(Jt--,r.monitorRunDependencies&&r.monitorRunDependencies(Jt),Jt==0&&jr){var a=jr;jr=null,a()}}function Ht(s){r.onAbort&&r.onAbort(s),s="Aborted("+s+")",z(s),Oe=!0,s+=". Build with -sASSERTIONS for more info.";var a=new WebAssembly.RuntimeError(s);throw o(a),a}var jp="data:application/octet-stream;base64,";function Xa(s){return s.startsWith(jp)}function Ya(s){return s.startsWith("file://")}var je;je="replicad_single.wasm",Xa(je)||(je=m(je));function qa(s){try{if(s==je&&te)return new Uint8Array(te);if(x)return x(s);throw"both async and sync fetching of the wasm failed"}catch(a){Ht(a)}}function Zp(){if(!te&&(f||p)){if(typeof fetch=="function"&&!Ya(je))return fetch(je,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+je+"'";return s.arrayBuffer()}).catch(function(){return qa(je)});if(E)return new Promise(function(s,a){E(je,function(l){s(new Uint8Array(l))},a)})}return Promise.resolve().then(function(){return qa(je)})}function Kp(){var s={a:Sg};function a(b,S){var T=b.exports;r.asm=T,pe=r.asm.oa,Ga(pe.buffer),Na=r.asm.va,qp(r.asm.pa),Gn()}Jo();function l(b){a(b.instance)}function h(b){return Zp().then(function(S){return WebAssembly.instantiate(S,s)}).then(function(S){return S}).then(b,function(S){z("failed to asynchronously prepare wasm: "+S),Ht(S)})}function d(){return!te&&typeof WebAssembly.instantiateStreaming=="function"&&!Xa(je)&&!Ya(je)&&!g&&typeof fetch=="function"?fetch(je,{credentials:"same-origin"}).then(function(b){var S=WebAssembly.instantiateStreaming(b,s);return S.then(l,function(T){return z("wasm streaming compile failed: "+T),z("falling back to ArrayBuffer instantiation"),h(l)})}):h(l)}if(r.instantiateWasm)try{var w=r.instantiateWasm(s,a);return w}catch(b){return z("Module.instantiateWasm callback failed with error: "+b),!1}return d().catch(o),{}}var Be,_t;function Qp(){return r.HEAP8.length}function ei(s){for(;s.length>0;){var a=s.shift();if(typeof a=="function"){a(r);continue}var l=a.func;typeof l=="number"?a.arg===void 0?Hn(l)():Hn(l)(a.arg):l(a.arg===void 0?null:a.arg)}}var Nn=[];function Hn(s){var a=Nn[s];return a||(s>=Nn.length&&(Nn.length=s+1),Nn[s]=a=Na.get(s)),a}function Jp(s,a,l,h){Ht("Assertion failed: "+se(s)+", at: "+[a?se(a):"unknown filename",l,h?se(h):"unknown function"])}function ed(s){return Ct(s+24)+24}function td(s){this.excPtr=s,this.ptr=s-24,this.set_type=function(a){J[this.ptr+4>>2]=a},this.get_type=function(){return J[this.ptr+4>>2]},this.set_destructor=function(a){J[this.ptr+8>>2]=a},this.get_destructor=function(){return J[this.ptr+8>>2]},this.set_refcount=function(a){B[this.ptr>>2]=a},this.set_caught=function(a){a=a?1:0,Ge[this.ptr+12>>0]=a},this.get_caught=function(){return Ge[this.ptr+12>>0]!=0},this.set_rethrown=function(a){a=a?1:0,Ge[this.ptr+13>>0]=a},this.get_rethrown=function(){return Ge[this.ptr+13>>0]!=0},this.init=function(a,l){this.set_adjusted_ptr(0),this.set_type(a),this.set_destructor(l),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var a=B[this.ptr>>2];B[this.ptr>>2]=a+1},this.release_ref=function(){var a=B[this.ptr>>2];return B[this.ptr>>2]=a-1,a===1},this.set_adjusted_ptr=function(a){J[this.ptr+16>>2]=a},this.get_adjusted_ptr=function(){return J[this.ptr+16>>2]},this.get_exception_ptr=function(){var a=yu(this.get_type());if(a)return J[this.excPtr>>2];var l=this.get_adjusted_ptr();return l!==0?l:this.excPtr}}function rd(s,a,l){var h=new td(s);throw h.init(a,l),s}var re={isAbs:s=>s.charAt(0)==="/",splitPath:s=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return a.exec(s).slice(1)},normalizeArray:(s,a)=>{for(var l=0,h=s.length-1;h>=0;h--){var d=s[h];d==="."?s.splice(h,1):d===".."?(s.splice(h,1),l++):l&&(s.splice(h,1),l--)}if(a)for(;l;l--)s.unshift("..");return s},normalize:s=>{var a=re.isAbs(s),l=s.substr(-1)==="/";return s=re.normalizeArray(s.split("/").filter(h=>!!h),!a).join("/"),!s&&!a&&(s="."),s&&l&&(s+="/"),(a?"/":"")+s},dirname:s=>{var a=re.splitPath(s),l=a[0],h=a[1];return!l&&!h?".":(h&&(h=h.substr(0,h.length-1)),l+h)},basename:s=>{if(s==="/")return"/";s=re.normalize(s),s=s.replace(/\/$/,"");var a=s.lastIndexOf("/");return a===-1?s:s.substr(a+1)},join:function(){var s=Array.prototype.slice.call(arguments,0);return re.normalize(s.join("/"))},join2:(s,a)=>re.normalize(s+"/"+a)};function nd(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var s=new Uint8Array(1);return function(){return crypto.getRandomValues(s),s[0]}}else if(g)try{var a=require("crypto");return function(){return a.randomBytes(1)[0]}}catch{}return function(){Ht("randomDevice")}}var Et={resolve:function(){for(var s="",a=!1,l=arguments.length-1;l>=-1&&!a;l--){var h=l>=0?arguments[l]:v.cwd();if(typeof h!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!h)return"";s=h+"/"+s,a=re.isAbs(h)}return s=re.normalizeArray(s.split("/").filter(d=>!!d),!a).join("/"),(a?"/":"")+s||"."},relative:(s,a)=>{s=Et.resolve(s).substr(1),a=Et.resolve(a).substr(1);function l(P){for(var M=0;M<P.length&&P[M]==="";M++);for(var U=P.length-1;U>=0&&P[U]==="";U--);return M>U?[]:P.slice(M,U-M+1)}for(var h=l(s.split("/")),d=l(a.split("/")),w=Math.min(h.length,d.length),b=w,S=0;S<w;S++)if(h[S]!==d[S]){b=S;break}for(var T=[],S=b;S<h.length;S++)T.push("..");return T=T.concat(d.slice(b)),T.join("/")}},er={ttys:[],init:function(){},shutdown:function(){},register:function(s,a){er.ttys[s]={input:[],output:[],ops:a},v.registerDevice(s,er.stream_ops)},stream_ops:{open:function(s){var a=er.ttys[s.node.rdev];if(!a)throw new v.ErrnoError(43);s.tty=a,s.seekable=!1},close:function(s){s.tty.ops.flush(s.tty)},flush:function(s){s.tty.ops.flush(s.tty)},read:function(s,a,l,h,d){if(!s.tty||!s.tty.ops.get_char)throw new v.ErrnoError(60);for(var w=0,b=0;b<h;b++){var S;try{S=s.tty.ops.get_char(s.tty)}catch{throw new v.ErrnoError(29)}if(S===void 0&&w===0)throw new v.ErrnoError(6);if(S==null)break;w++,a[l+b]=S}return w&&(s.node.timestamp=Date.now()),w},write:function(s,a,l,h,d){if(!s.tty||!s.tty.ops.put_char)throw new v.ErrnoError(60);try{for(var w=0;w<h;w++)s.tty.ops.put_char(s.tty,a[l+w])}catch{throw new v.ErrnoError(29)}return h&&(s.node.timestamp=Date.now()),w}},default_tty_ops:{get_char:function(s){if(!s.input.length){var a=null;if(g){var l=256,h=Buffer.alloc(l),d=0;try{d=A.readSync(process.stdin.fd,h,0,l,-1)}catch(w){if(w.toString().includes("EOF"))d=0;else throw w}d>0?a=h.slice(0,d).toString("utf-8"):a=null}else typeof window<"u"&&typeof window.prompt=="function"?(a=window.prompt("Input: "),a!==null&&(a+=`
`)):typeof readline=="function"&&(a=readline(),a!==null&&(a+=`
`));if(!a)return null;s.input=ro(a,!0)}return s.input.shift()},put_char:function(s,a){a===null||a===10?(q(Me(s.output,0)),s.output=[]):a!=0&&s.output.push(a)},flush:function(s){s.output&&s.output.length>0&&(q(Me(s.output,0)),s.output=[])}},default_tty1_ops:{put_char:function(s,a){a===null||a===10?(z(Me(s.output,0)),s.output=[]):a!=0&&s.output.push(a)},flush:function(s){s.output&&s.output.length>0&&(z(Me(s.output,0)),s.output=[])}}};function od(s,a){ze.fill(0,s,s+a)}function id(s,a){return Math.ceil(s/a)*a}function $a(s){s=id(s,65536);var a=mu(65536,s);return a?(od(a,s),a):0}var K={ops_table:null,mount:function(s){return K.createNode(null,"/",16895,0)},createNode:function(s,a,l,h){if(v.isBlkdev(l)||v.isFIFO(l))throw new v.ErrnoError(63);K.ops_table||(K.ops_table={dir:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr,lookup:K.node_ops.lookup,mknod:K.node_ops.mknod,rename:K.node_ops.rename,unlink:K.node_ops.unlink,rmdir:K.node_ops.rmdir,readdir:K.node_ops.readdir,symlink:K.node_ops.symlink},stream:{llseek:K.stream_ops.llseek}},file:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr},stream:{llseek:K.stream_ops.llseek,read:K.stream_ops.read,write:K.stream_ops.write,allocate:K.stream_ops.allocate,mmap:K.stream_ops.mmap,msync:K.stream_ops.msync}},link:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr,readlink:K.node_ops.readlink},stream:{}},chrdev:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr},stream:v.chrdev_stream_ops}});var d=v.createNode(s,a,l,h);return v.isDir(d.mode)?(d.node_ops=K.ops_table.dir.node,d.stream_ops=K.ops_table.dir.stream,d.contents={}):v.isFile(d.mode)?(d.node_ops=K.ops_table.file.node,d.stream_ops=K.ops_table.file.stream,d.usedBytes=0,d.contents=null):v.isLink(d.mode)?(d.node_ops=K.ops_table.link.node,d.stream_ops=K.ops_table.link.stream):v.isChrdev(d.mode)&&(d.node_ops=K.ops_table.chrdev.node,d.stream_ops=K.ops_table.chrdev.stream),d.timestamp=Date.now(),s&&(s.contents[a]=d,s.timestamp=d.timestamp),d},getFileDataAsTypedArray:function(s){return s.contents?s.contents.subarray?s.contents.subarray(0,s.usedBytes):new Uint8Array(s.contents):new Uint8Array(0)},expandFileStorage:function(s,a){var l=s.contents?s.contents.length:0;if(!(l>=a)){var h=1024*1024;a=Math.max(a,l*(l<h?2:1.125)>>>0),l!=0&&(a=Math.max(a,256));var d=s.contents;s.contents=new Uint8Array(a),s.usedBytes>0&&s.contents.set(d.subarray(0,s.usedBytes),0)}},resizeFileStorage:function(s,a){if(s.usedBytes!=a)if(a==0)s.contents=null,s.usedBytes=0;else{var l=s.contents;s.contents=new Uint8Array(a),l&&s.contents.set(l.subarray(0,Math.min(a,s.usedBytes))),s.usedBytes=a}},node_ops:{getattr:function(s){var a={};return a.dev=v.isChrdev(s.mode)?s.id:1,a.ino=s.id,a.mode=s.mode,a.nlink=1,a.uid=0,a.gid=0,a.rdev=s.rdev,v.isDir(s.mode)?a.size=4096:v.isFile(s.mode)?a.size=s.usedBytes:v.isLink(s.mode)?a.size=s.link.length:a.size=0,a.atime=new Date(s.timestamp),a.mtime=new Date(s.timestamp),a.ctime=new Date(s.timestamp),a.blksize=4096,a.blocks=Math.ceil(a.size/a.blksize),a},setattr:function(s,a){a.mode!==void 0&&(s.mode=a.mode),a.timestamp!==void 0&&(s.timestamp=a.timestamp),a.size!==void 0&&K.resizeFileStorage(s,a.size)},lookup:function(s,a){throw v.genericErrors[44]},mknod:function(s,a,l,h){return K.createNode(s,a,l,h)},rename:function(s,a,l){if(v.isDir(s.mode)){var h;try{h=v.lookupNode(a,l)}catch{}if(h)for(var d in h.contents)throw new v.ErrnoError(55)}delete s.parent.contents[s.name],s.parent.timestamp=Date.now(),s.name=l,a.contents[l]=s,a.timestamp=s.parent.timestamp,s.parent=a},unlink:function(s,a){delete s.contents[a],s.timestamp=Date.now()},rmdir:function(s,a){var l=v.lookupNode(s,a);for(var h in l.contents)throw new v.ErrnoError(55);delete s.contents[a],s.timestamp=Date.now()},readdir:function(s){var a=[".",".."];for(var l in s.contents)!s.contents.hasOwnProperty(l)||a.push(l);return a},symlink:function(s,a,l){var h=K.createNode(s,a,41471,0);return h.link=l,h},readlink:function(s){if(!v.isLink(s.mode))throw new v.ErrnoError(28);return s.link}},stream_ops:{read:function(s,a,l,h,d){var w=s.node.contents;if(d>=s.node.usedBytes)return 0;var b=Math.min(s.node.usedBytes-d,h);if(b>8&&w.subarray)a.set(w.subarray(d,d+b),l);else for(var S=0;S<b;S++)a[l+S]=w[d+S];return b},write:function(s,a,l,h,d,w){if(a.buffer===Ge.buffer&&(w=!1),!h)return 0;var b=s.node;if(b.timestamp=Date.now(),a.subarray&&(!b.contents||b.contents.subarray)){if(w)return b.contents=a.subarray(l,l+h),b.usedBytes=h,h;if(b.usedBytes===0&&d===0)return b.contents=a.slice(l,l+h),b.usedBytes=h,h;if(d+h<=b.usedBytes)return b.contents.set(a.subarray(l,l+h),d),h}if(K.expandFileStorage(b,d+h),b.contents.subarray&&a.subarray)b.contents.set(a.subarray(l,l+h),d);else for(var S=0;S<h;S++)b.contents[d+S]=a[l+S];return b.usedBytes=Math.max(b.usedBytes,d+h),h},llseek:function(s,a,l){var h=a;if(l===1?h+=s.position:l===2&&v.isFile(s.node.mode)&&(h+=s.node.usedBytes),h<0)throw new v.ErrnoError(28);return h},allocate:function(s,a,l){K.expandFileStorage(s.node,a+l),s.node.usedBytes=Math.max(s.node.usedBytes,a+l)},mmap:function(s,a,l,h,d){if(!v.isFile(s.node.mode))throw new v.ErrnoError(43);var w,b,S=s.node.contents;if(!(d&2)&&S.buffer===St)b=!1,w=S.byteOffset;else{if((l>0||l+a<S.length)&&(S.subarray?S=S.subarray(l,l+a):S=Array.prototype.slice.call(S,l,l+a)),b=!0,w=$a(a),!w)throw new v.ErrnoError(48);Ge.set(S,w)}return{ptr:w,allocated:b}},msync:function(s,a,l,h,d){if(!v.isFile(s.node.mode))throw new v.ErrnoError(43);return d&2||K.stream_ops.write(s,a,0,h,l,!1),0}}};function sd(s,a,l,h){var d=h?"":"al "+s;E(s,function(w){Ie(w,'Loading data file "'+s+'" failed (no arrayBuffer).'),a(new Uint8Array(w)),d&&Gn()},function(w){if(l)l();else throw'Loading data file "'+s+'" failed.'}),d&&Jo()}var v={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(s,a={})=>{if(s=Et.resolve(v.cwd(),s),!s)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(a=Object.assign(l,a),a.recurse_count>8)throw new v.ErrnoError(32);for(var h=re.normalizeArray(s.split("/").filter(U=>!!U),!1),d=v.root,w="/",b=0;b<h.length;b++){var S=b===h.length-1;if(S&&a.parent)break;if(d=v.lookupNode(d,h[b]),w=re.join2(w,h[b]),v.isMountpoint(d)&&(!S||S&&a.follow_mount)&&(d=d.mounted.root),!S||a.follow)for(var T=0;v.isLink(d.mode);){var P=v.readlink(w);w=Et.resolve(re.dirname(w),P);var M=v.lookupPath(w,{recurse_count:a.recurse_count+1});if(d=M.node,T++>40)throw new v.ErrnoError(32)}}return{path:w,node:d}},getPath:s=>{for(var a;;){if(v.isRoot(s)){var l=s.mount.mountpoint;return a?l[l.length-1]!=="/"?l+"/"+a:l+a:l}a=a?s.name+"/"+a:s.name,s=s.parent}},hashName:(s,a)=>{for(var l=0,h=0;h<a.length;h++)l=(l<<5)-l+a.charCodeAt(h)|0;return(s+l>>>0)%v.nameTable.length},hashAddNode:s=>{var a=v.hashName(s.parent.id,s.name);s.name_next=v.nameTable[a],v.nameTable[a]=s},hashRemoveNode:s=>{var a=v.hashName(s.parent.id,s.name);if(v.nameTable[a]===s)v.nameTable[a]=s.name_next;else for(var l=v.nameTable[a];l;){if(l.name_next===s){l.name_next=s.name_next;break}l=l.name_next}},lookupNode:(s,a)=>{var l=v.mayLookup(s);if(l)throw new v.ErrnoError(l,s);for(var h=v.hashName(s.id,a),d=v.nameTable[h];d;d=d.name_next){var w=d.name;if(d.parent.id===s.id&&w===a)return d}return v.lookup(s,a)},createNode:(s,a,l,h)=>{var d=new v.FSNode(s,a,l,h);return v.hashAddNode(d),d},destroyNode:s=>{v.hashRemoveNode(s)},isRoot:s=>s===s.parent,isMountpoint:s=>!!s.mounted,isFile:s=>(s&61440)===32768,isDir:s=>(s&61440)===16384,isLink:s=>(s&61440)===40960,isChrdev:s=>(s&61440)===8192,isBlkdev:s=>(s&61440)===24576,isFIFO:s=>(s&61440)===4096,isSocket:s=>(s&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:s=>{var a=v.flagModes[s];if(typeof a>"u")throw new Error("Unknown file open mode: "+s);return a},flagsToPermissionString:s=>{var a=["r","w","rw"][s&3];return s&512&&(a+="w"),a},nodePermissions:(s,a)=>v.ignorePermissions?0:a.includes("r")&&!(s.mode&292)||a.includes("w")&&!(s.mode&146)||a.includes("x")&&!(s.mode&73)?2:0,mayLookup:s=>{var a=v.nodePermissions(s,"x");return a||(s.node_ops.lookup?0:2)},mayCreate:(s,a)=>{try{var l=v.lookupNode(s,a);return 20}catch{}return v.nodePermissions(s,"wx")},mayDelete:(s,a,l)=>{var h;try{h=v.lookupNode(s,a)}catch(w){return w.errno}var d=v.nodePermissions(s,"wx");if(d)return d;if(l){if(!v.isDir(h.mode))return 54;if(v.isRoot(h)||v.getPath(h)===v.cwd())return 10}else if(v.isDir(h.mode))return 31;return 0},mayOpen:(s,a)=>s?v.isLink(s.mode)?32:v.isDir(s.mode)&&(v.flagsToPermissionString(a)!=="r"||a&512)?31:v.nodePermissions(s,v.flagsToPermissionString(a)):44,MAX_OPEN_FDS:4096,nextfd:(s=0,a=v.MAX_OPEN_FDS)=>{for(var l=s;l<=a;l++)if(!v.streams[l])return l;throw new v.ErrnoError(33)},getStream:s=>v.streams[s],createStream:(s,a,l)=>{v.FSStream||(v.FSStream=function(){this.shared={}},v.FSStream.prototype={},Object.defineProperties(v.FSStream.prototype,{object:{get:function(){return this.node},set:function(d){this.node=d}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(d){this.shared.flags=d}},position:{get:function(){return this.shared.position},set:function(d){this.shared.position=d}}})),s=Object.assign(new v.FSStream,s);var h=v.nextfd(a,l);return s.fd=h,v.streams[h]=s,s},closeStream:s=>{v.streams[s]=null},chrdev_stream_ops:{open:s=>{var a=v.getDevice(s.node.rdev);s.stream_ops=a.stream_ops,s.stream_ops.open&&s.stream_ops.open(s)},llseek:()=>{throw new v.ErrnoError(70)}},major:s=>s>>8,minor:s=>s&255,makedev:(s,a)=>s<<8|a,registerDevice:(s,a)=>{v.devices[s]={stream_ops:a}},getDevice:s=>v.devices[s],getMounts:s=>{for(var a=[],l=[s];l.length;){var h=l.pop();a.push(h),l.push.apply(l,h.mounts)}return a},syncfs:(s,a)=>{typeof s=="function"&&(a=s,s=!1),v.syncFSRequests++,v.syncFSRequests>1&&z("warning: "+v.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var l=v.getMounts(v.root.mount),h=0;function d(b){return v.syncFSRequests--,a(b)}function w(b){if(b)return w.errored?void 0:(w.errored=!0,d(b));++h>=l.length&&d(null)}l.forEach(b=>{if(!b.type.syncfs)return w(null);b.type.syncfs(b,s,w)})},mount:(s,a,l)=>{var h=l==="/",d=!l,w;if(h&&v.root)throw new v.ErrnoError(10);if(!h&&!d){var b=v.lookupPath(l,{follow_mount:!1});if(l=b.path,w=b.node,v.isMountpoint(w))throw new v.ErrnoError(10);if(!v.isDir(w.mode))throw new v.ErrnoError(54)}var S={type:s,opts:a,mountpoint:l,mounts:[]},T=s.mount(S);return T.mount=S,S.root=T,h?v.root=T:w&&(w.mounted=S,w.mount&&w.mount.mounts.push(S)),T},unmount:s=>{var a=v.lookupPath(s,{follow_mount:!1});if(!v.isMountpoint(a.node))throw new v.ErrnoError(28);var l=a.node,h=l.mounted,d=v.getMounts(h);Object.keys(v.nameTable).forEach(b=>{for(var S=v.nameTable[b];S;){var T=S.name_next;d.includes(S.mount)&&v.destroyNode(S),S=T}}),l.mounted=null;var w=l.mount.mounts.indexOf(h);l.mount.mounts.splice(w,1)},lookup:(s,a)=>s.node_ops.lookup(s,a),mknod:(s,a,l)=>{var h=v.lookupPath(s,{parent:!0}),d=h.node,w=re.basename(s);if(!w||w==="."||w==="..")throw new v.ErrnoError(28);var b=v.mayCreate(d,w);if(b)throw new v.ErrnoError(b);if(!d.node_ops.mknod)throw new v.ErrnoError(63);return d.node_ops.mknod(d,w,a,l)},create:(s,a)=>(a=a!==void 0?a:438,a&=4095,a|=32768,v.mknod(s,a,0)),mkdir:(s,a)=>(a=a!==void 0?a:511,a&=1023,a|=16384,v.mknod(s,a,0)),mkdirTree:(s,a)=>{for(var l=s.split("/"),h="",d=0;d<l.length;++d)if(!!l[d]){h+="/"+l[d];try{v.mkdir(h,a)}catch(w){if(w.errno!=20)throw w}}},mkdev:(s,a,l)=>(typeof l>"u"&&(l=a,a=438),a|=8192,v.mknod(s,a,l)),symlink:(s,a)=>{if(!Et.resolve(s))throw new v.ErrnoError(44);var l=v.lookupPath(a,{parent:!0}),h=l.node;if(!h)throw new v.ErrnoError(44);var d=re.basename(a),w=v.mayCreate(h,d);if(w)throw new v.ErrnoError(w);if(!h.node_ops.symlink)throw new v.ErrnoError(63);return h.node_ops.symlink(h,d,s)},rename:(s,a)=>{var l=re.dirname(s),h=re.dirname(a),d=re.basename(s),w=re.basename(a),b,S,T;if(b=v.lookupPath(s,{parent:!0}),S=b.node,b=v.lookupPath(a,{parent:!0}),T=b.node,!S||!T)throw new v.ErrnoError(44);if(S.mount!==T.mount)throw new v.ErrnoError(75);var P=v.lookupNode(S,d),M=Et.relative(s,h);if(M.charAt(0)!==".")throw new v.ErrnoError(28);if(M=Et.relative(a,l),M.charAt(0)!==".")throw new v.ErrnoError(55);var U;try{U=v.lookupNode(T,w)}catch{}if(P!==U){var O=v.isDir(P.mode),I=v.mayDelete(S,d,O);if(I)throw new v.ErrnoError(I);if(I=U?v.mayDelete(T,w,O):v.mayCreate(T,w),I)throw new v.ErrnoError(I);if(!S.node_ops.rename)throw new v.ErrnoError(63);if(v.isMountpoint(P)||U&&v.isMountpoint(U))throw new v.ErrnoError(10);if(T!==S&&(I=v.nodePermissions(S,"w"),I))throw new v.ErrnoError(I);v.hashRemoveNode(P);try{S.node_ops.rename(P,T,w)}catch(V){throw V}finally{v.hashAddNode(P)}}},rmdir:s=>{var a=v.lookupPath(s,{parent:!0}),l=a.node,h=re.basename(s),d=v.lookupNode(l,h),w=v.mayDelete(l,h,!0);if(w)throw new v.ErrnoError(w);if(!l.node_ops.rmdir)throw new v.ErrnoError(63);if(v.isMountpoint(d))throw new v.ErrnoError(10);l.node_ops.rmdir(l,h),v.destroyNode(d)},readdir:s=>{var a=v.lookupPath(s,{follow:!0}),l=a.node;if(!l.node_ops.readdir)throw new v.ErrnoError(54);return l.node_ops.readdir(l)},unlink:s=>{var a=v.lookupPath(s,{parent:!0}),l=a.node;if(!l)throw new v.ErrnoError(44);var h=re.basename(s),d=v.lookupNode(l,h),w=v.mayDelete(l,h,!1);if(w)throw new v.ErrnoError(w);if(!l.node_ops.unlink)throw new v.ErrnoError(63);if(v.isMountpoint(d))throw new v.ErrnoError(10);l.node_ops.unlink(l,h),v.destroyNode(d)},readlink:s=>{var a=v.lookupPath(s),l=a.node;if(!l)throw new v.ErrnoError(44);if(!l.node_ops.readlink)throw new v.ErrnoError(28);return Et.resolve(v.getPath(l.parent),l.node_ops.readlink(l))},stat:(s,a)=>{var l=v.lookupPath(s,{follow:!a}),h=l.node;if(!h)throw new v.ErrnoError(44);if(!h.node_ops.getattr)throw new v.ErrnoError(63);return h.node_ops.getattr(h)},lstat:s=>v.stat(s,!0),chmod:(s,a,l)=>{var h;if(typeof s=="string"){var d=v.lookupPath(s,{follow:!l});h=d.node}else h=s;if(!h.node_ops.setattr)throw new v.ErrnoError(63);h.node_ops.setattr(h,{mode:a&4095|h.mode&-4096,timestamp:Date.now()})},lchmod:(s,a)=>{v.chmod(s,a,!0)},fchmod:(s,a)=>{var l=v.getStream(s);if(!l)throw new v.ErrnoError(8);v.chmod(l.node,a)},chown:(s,a,l,h)=>{var d;if(typeof s=="string"){var w=v.lookupPath(s,{follow:!h});d=w.node}else d=s;if(!d.node_ops.setattr)throw new v.ErrnoError(63);d.node_ops.setattr(d,{timestamp:Date.now()})},lchown:(s,a,l)=>{v.chown(s,a,l,!0)},fchown:(s,a,l)=>{var h=v.getStream(s);if(!h)throw new v.ErrnoError(8);v.chown(h.node,a,l)},truncate:(s,a)=>{if(a<0)throw new v.ErrnoError(28);var l;if(typeof s=="string"){var h=v.lookupPath(s,{follow:!0});l=h.node}else l=s;if(!l.node_ops.setattr)throw new v.ErrnoError(63);if(v.isDir(l.mode))throw new v.ErrnoError(31);if(!v.isFile(l.mode))throw new v.ErrnoError(28);var d=v.nodePermissions(l,"w");if(d)throw new v.ErrnoError(d);l.node_ops.setattr(l,{size:a,timestamp:Date.now()})},ftruncate:(s,a)=>{var l=v.getStream(s);if(!l)throw new v.ErrnoError(8);if((l.flags&2097155)===0)throw new v.ErrnoError(28);v.truncate(l.node,a)},utime:(s,a,l)=>{var h=v.lookupPath(s,{follow:!0}),d=h.node;d.node_ops.setattr(d,{timestamp:Math.max(a,l)})},open:(s,a,l)=>{if(s==="")throw new v.ErrnoError(44);a=typeof a=="string"?v.modeStringToFlags(a):a,l=typeof l>"u"?438:l,a&64?l=l&4095|32768:l=0;var h;if(typeof s=="object")h=s;else{s=re.normalize(s);try{var d=v.lookupPath(s,{follow:!(a&131072)});h=d.node}catch{}}var w=!1;if(a&64)if(h){if(a&128)throw new v.ErrnoError(20)}else h=v.mknod(s,l,0),w=!0;if(!h)throw new v.ErrnoError(44);if(v.isChrdev(h.mode)&&(a&=-513),a&65536&&!v.isDir(h.mode))throw new v.ErrnoError(54);if(!w){var b=v.mayOpen(h,a);if(b)throw new v.ErrnoError(b)}a&512&&!w&&v.truncate(h,0),a&=-131713;var S=v.createStream({node:h,path:v.getPath(h),flags:a,seekable:!0,position:0,stream_ops:h.stream_ops,ungotten:[],error:!1});return S.stream_ops.open&&S.stream_ops.open(S),r.logReadFiles&&!(a&1)&&(v.readFiles||(v.readFiles={}),s in v.readFiles||(v.readFiles[s]=1)),S},close:s=>{if(v.isClosed(s))throw new v.ErrnoError(8);s.getdents&&(s.getdents=null);try{s.stream_ops.close&&s.stream_ops.close(s)}catch(a){throw a}finally{v.closeStream(s.fd)}s.fd=null},isClosed:s=>s.fd===null,llseek:(s,a,l)=>{if(v.isClosed(s))throw new v.ErrnoError(8);if(!s.seekable||!s.stream_ops.llseek)throw new v.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new v.ErrnoError(28);return s.position=s.stream_ops.llseek(s,a,l),s.ungotten=[],s.position},read:(s,a,l,h,d)=>{if(h<0||d<0)throw new v.ErrnoError(28);if(v.isClosed(s))throw new v.ErrnoError(8);if((s.flags&2097155)===1)throw new v.ErrnoError(8);if(v.isDir(s.node.mode))throw new v.ErrnoError(31);if(!s.stream_ops.read)throw new v.ErrnoError(28);var w=typeof d<"u";if(!w)d=s.position;else if(!s.seekable)throw new v.ErrnoError(70);var b=s.stream_ops.read(s,a,l,h,d);return w||(s.position+=b),b},write:(s,a,l,h,d,w)=>{if(h<0||d<0)throw new v.ErrnoError(28);if(v.isClosed(s))throw new v.ErrnoError(8);if((s.flags&2097155)===0)throw new v.ErrnoError(8);if(v.isDir(s.node.mode))throw new v.ErrnoError(31);if(!s.stream_ops.write)throw new v.ErrnoError(28);s.seekable&&s.flags&1024&&v.llseek(s,0,2);var b=typeof d<"u";if(!b)d=s.position;else if(!s.seekable)throw new v.ErrnoError(70);var S=s.stream_ops.write(s,a,l,h,d,w);return b||(s.position+=S),S},allocate:(s,a,l)=>{if(v.isClosed(s))throw new v.ErrnoError(8);if(a<0||l<=0)throw new v.ErrnoError(28);if((s.flags&2097155)===0)throw new v.ErrnoError(8);if(!v.isFile(s.node.mode)&&!v.isDir(s.node.mode))throw new v.ErrnoError(43);if(!s.stream_ops.allocate)throw new v.ErrnoError(138);s.stream_ops.allocate(s,a,l)},mmap:(s,a,l,h,d)=>{if((h&2)!==0&&(d&2)===0&&(s.flags&2097155)!==2)throw new v.ErrnoError(2);if((s.flags&2097155)===1)throw new v.ErrnoError(2);if(!s.stream_ops.mmap)throw new v.ErrnoError(43);return s.stream_ops.mmap(s,a,l,h,d)},msync:(s,a,l,h,d)=>!s||!s.stream_ops.msync?0:s.stream_ops.msync(s,a,l,h,d),munmap:s=>0,ioctl:(s,a,l)=>{if(!s.stream_ops.ioctl)throw new v.ErrnoError(59);return s.stream_ops.ioctl(s,a,l)},readFile:(s,a={})=>{if(a.flags=a.flags||0,a.encoding=a.encoding||"binary",a.encoding!=="utf8"&&a.encoding!=="binary")throw new Error('Invalid encoding type "'+a.encoding+'"');var l,h=v.open(s,a.flags),d=v.stat(s),w=d.size,b=new Uint8Array(w);return v.read(h,b,0,w,0),a.encoding==="utf8"?l=Me(b,0):a.encoding==="binary"&&(l=b),v.close(h),l},writeFile:(s,a,l={})=>{l.flags=l.flags||577;var h=v.open(s,l.flags,l.mode);if(typeof a=="string"){var d=new Uint8Array(fe(a)+1),w=Ee(a,d,0,d.length);v.write(h,d,0,w,void 0,l.canOwn)}else if(ArrayBuffer.isView(a))v.write(h,a,0,a.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");v.close(h)},cwd:()=>v.currentPath,chdir:s=>{var a=v.lookupPath(s,{follow:!0});if(a.node===null)throw new v.ErrnoError(44);if(!v.isDir(a.node.mode))throw new v.ErrnoError(54);var l=v.nodePermissions(a.node,"x");if(l)throw new v.ErrnoError(l);v.currentPath=a.path},createDefaultDirectories:()=>{v.mkdir("/tmp"),v.mkdir("/home"),v.mkdir("/home/web_user")},createDefaultDevices:()=>{v.mkdir("/dev"),v.registerDevice(v.makedev(1,3),{read:()=>0,write:(a,l,h,d,w)=>d}),v.mkdev("/dev/null",v.makedev(1,3)),er.register(v.makedev(5,0),er.default_tty_ops),er.register(v.makedev(6,0),er.default_tty1_ops),v.mkdev("/dev/tty",v.makedev(5,0)),v.mkdev("/dev/tty1",v.makedev(6,0));var s=nd();v.createDevice("/dev","random",s),v.createDevice("/dev","urandom",s),v.mkdir("/dev/shm"),v.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{v.mkdir("/proc");var s=v.mkdir("/proc/self");v.mkdir("/proc/self/fd"),v.mount({mount:()=>{var a=v.createNode(s,"fd",16895,73);return a.node_ops={lookup:(l,h)=>{var d=+h,w=v.getStream(d);if(!w)throw new v.ErrnoError(8);var b={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>w.path}};return b.parent=b,b}},a}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?v.createDevice("/dev","stdin",r.stdin):v.symlink("/dev/tty","/dev/stdin"),r.stdout?v.createDevice("/dev","stdout",null,r.stdout):v.symlink("/dev/tty","/dev/stdout"),r.stderr?v.createDevice("/dev","stderr",null,r.stderr):v.symlink("/dev/tty1","/dev/stderr"),v.open("/dev/stdin",0),v.open("/dev/stdout",1),v.open("/dev/stderr",1)},ensureErrnoError:()=>{v.ErrnoError||(v.ErrnoError=function(a,l){this.node=l,this.setErrno=function(h){this.errno=h},this.setErrno(a),this.message="FS error"},v.ErrnoError.prototype=new Error,v.ErrnoError.prototype.constructor=v.ErrnoError,[44].forEach(s=>{v.genericErrors[s]=new v.ErrnoError(s),v.genericErrors[s].stack="<generic error, no stack>"}))},staticInit:()=>{v.ensureErrnoError(),v.nameTable=new Array(4096),v.mount(K,{},"/"),v.createDefaultDirectories(),v.createDefaultDevices(),v.createSpecialDirectories(),v.filesystems={MEMFS:K}},init:(s,a,l)=>{v.init.initialized=!0,v.ensureErrnoError(),r.stdin=s||r.stdin,r.stdout=a||r.stdout,r.stderr=l||r.stderr,v.createStandardStreams()},quit:()=>{v.init.initialized=!1;for(var s=0;s<v.streams.length;s++){var a=v.streams[s];!a||v.close(a)}},getMode:(s,a)=>{var l=0;return s&&(l|=365),a&&(l|=146),l},findObject:(s,a)=>{var l=v.analyzePath(s,a);return l.exists?l.object:null},analyzePath:(s,a)=>{try{var l=v.lookupPath(s,{follow:!a});s=l.path}catch{}var h={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=v.lookupPath(s,{parent:!0});h.parentExists=!0,h.parentPath=l.path,h.parentObject=l.node,h.name=re.basename(s),l=v.lookupPath(s,{follow:!a}),h.exists=!0,h.path=l.path,h.object=l.node,h.name=l.node.name,h.isRoot=l.path==="/"}catch(d){h.error=d.errno}return h},createPath:(s,a,l,h)=>{s=typeof s=="string"?s:v.getPath(s);for(var d=a.split("/").reverse();d.length;){var w=d.pop();if(!!w){var b=re.join2(s,w);try{v.mkdir(b)}catch{}s=b}}return b},createFile:(s,a,l,h,d)=>{var w=re.join2(typeof s=="string"?s:v.getPath(s),a),b=v.getMode(h,d);return v.create(w,b)},createDataFile:(s,a,l,h,d,w)=>{var b=a;s&&(s=typeof s=="string"?s:v.getPath(s),b=a?re.join2(s,a):s);var S=v.getMode(h,d),T=v.create(b,S);if(l){if(typeof l=="string"){for(var P=new Array(l.length),M=0,U=l.length;M<U;++M)P[M]=l.charCodeAt(M);l=P}v.chmod(T,S|146);var O=v.open(T,577);v.write(O,l,0,l.length,0,w),v.close(O),v.chmod(T,S)}return T},createDevice:(s,a,l,h)=>{var d=re.join2(typeof s=="string"?s:v.getPath(s),a),w=v.getMode(!!l,!!h);v.createDevice.major||(v.createDevice.major=64);var b=v.makedev(v.createDevice.major++,0);return v.registerDevice(b,{open:S=>{S.seekable=!1},close:S=>{h&&h.buffer&&h.buffer.length&&h(10)},read:(S,T,P,M,U)=>{for(var O=0,I=0;I<M;I++){var V;try{V=l()}catch{throw new v.ErrnoError(29)}if(V===void 0&&O===0)throw new v.ErrnoError(6);if(V==null)break;O++,T[P+I]=V}return O&&(S.node.timestamp=Date.now()),O},write:(S,T,P,M,U)=>{for(var O=0;O<M;O++)try{h(T[P+O])}catch{throw new v.ErrnoError(29)}return M&&(S.node.timestamp=Date.now()),O}}),v.mkdev(d,w,b)},forceLoadFile:s=>{if(s.isDevice||s.isFolder||s.link||s.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(_)try{s.contents=ro(_(s.url),!0),s.usedBytes=s.contents.length}catch{throw new v.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(s,a,l,h,d)=>{function w(){this.lengthKnown=!1,this.chunks=[]}if(w.prototype.get=function(I){if(!(I>this.length-1||I<0)){var V=I%this.chunkSize,ie=I/this.chunkSize|0;return this.getter(ie)[V]}},w.prototype.setDataGetter=function(I){this.getter=I},w.prototype.cacheLength=function(){var I=new XMLHttpRequest;if(I.open("HEAD",l,!1),I.send(null),!(I.status>=200&&I.status<300||I.status===304))throw new Error("Couldn't load "+l+". Status: "+I.status);var V=Number(I.getResponseHeader("Content-length")),ie,we=(ie=I.getResponseHeader("Accept-Ranges"))&&ie==="bytes",Te=(ie=I.getResponseHeader("Content-Encoding"))&&ie==="gzip",R=1024*1024;we||(R=V);var W=(le,Ze)=>{if(le>Ze)throw new Error("invalid range ("+le+", "+Ze+") or no bytes requested!");if(Ze>V-1)throw new Error("only "+V+" bytes available! programmer error!");var xe=new XMLHttpRequest;if(xe.open("GET",l,!1),V!==R&&xe.setRequestHeader("Range","bytes="+le+"-"+Ze),xe.responseType="arraybuffer",xe.overrideMimeType&&xe.overrideMimeType("text/plain; charset=x-user-defined"),xe.send(null),!(xe.status>=200&&xe.status<300||xe.status===304))throw new Error("Couldn't load "+l+". Status: "+xe.status);return xe.response!==void 0?new Uint8Array(xe.response||[]):ro(xe.responseText||"",!0)},Ae=this;Ae.setDataGetter(le=>{var Ze=le*R,xe=(le+1)*R-1;if(xe=Math.min(xe,V-1),typeof Ae.chunks[le]>"u"&&(Ae.chunks[le]=W(Ze,xe)),typeof Ae.chunks[le]>"u")throw new Error("doXHR failed!");return Ae.chunks[le]}),(Te||!V)&&(R=V=1,V=this.getter(0).length,R=V,q("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=V,this._chunkSize=R,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!p)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var b=new w;Object.defineProperties(b,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var S={isDevice:!1,contents:b}}else var S={isDevice:!1,url:l};var T=v.createFile(s,a,S,h,d);S.contents?T.contents=S.contents:S.url&&(T.contents=null,T.url=S.url),Object.defineProperties(T,{usedBytes:{get:function(){return this.contents.length}}});var P={},M=Object.keys(T.stream_ops);M.forEach(O=>{var I=T.stream_ops[O];P[O]=function(){return v.forceLoadFile(T),I.apply(null,arguments)}});function U(O,I,V,ie,we){var Te=O.node.contents;if(we>=Te.length)return 0;var R=Math.min(Te.length-we,ie);if(Te.slice)for(var W=0;W<R;W++)I[V+W]=Te[we+W];else for(var W=0;W<R;W++)I[V+W]=Te.get(we+W);return R}return P.read=(O,I,V,ie,we)=>(v.forceLoadFile(T),U(O,I,V,ie,we)),P.mmap=(O,I,V,ie,we)=>{v.forceLoadFile(T);var Te=$a(I);if(!Te)throw new v.ErrnoError(48);return U(O,Ge,Te,I,V),{ptr:Te,allocated:!0}},T.stream_ops=P,T},createPreloadedFile:(s,a,l,h,d,w,b,S,T,P)=>{var M=a?Et.resolve(re.join2(s,a)):s;function U(O){function I(V){P&&P(),S||v.createDataFile(s,a,V,h,d,T),w&&w(),Gn()}Browser.handledByPreloadPlugin(O,M,I,()=>{b&&b(),Gn()})||I(O)}Jo(),typeof l=="string"?sd(l,O=>U(O),b):U(l)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(s,a,l)=>{a=a||(()=>{}),l=l||(()=>{});var h=v.indexedDB();try{var d=h.open(v.DB_NAME(),v.DB_VERSION)}catch(w){return l(w)}d.onupgradeneeded=()=>{q("creating db");var w=d.result;w.createObjectStore(v.DB_STORE_NAME)},d.onsuccess=()=>{var w=d.result,b=w.transaction([v.DB_STORE_NAME],"readwrite"),S=b.objectStore(v.DB_STORE_NAME),T=0,P=0,M=s.length;function U(){P==0?a():l()}s.forEach(O=>{var I=S.put(v.analyzePath(O).object.contents,O);I.onsuccess=()=>{T++,T+P==M&&U()},I.onerror=()=>{P++,T+P==M&&U()}}),b.onerror=l},d.onerror=l},loadFilesFromDB:(s,a,l)=>{a=a||(()=>{}),l=l||(()=>{});var h=v.indexedDB();try{var d=h.open(v.DB_NAME(),v.DB_VERSION)}catch(w){return l(w)}d.onupgradeneeded=l,d.onsuccess=()=>{var w=d.result;try{var b=w.transaction([v.DB_STORE_NAME],"readonly")}catch(O){l(O);return}var S=b.objectStore(v.DB_STORE_NAME),T=0,P=0,M=s.length;function U(){P==0?a():l()}s.forEach(O=>{var I=S.get(O);I.onsuccess=()=>{v.analyzePath(O).exists&&v.unlink(O),v.createDataFile(re.dirname(O),re.basename(O),I.result,!0,!0,!0),T++,T+P==M&&U()},I.onerror=()=>{P++,T+P==M&&U()}}),b.onerror=l},d.onerror=l}},ne={DEFAULT_POLLMASK:5,calculateAt:function(s,a,l){if(re.isAbs(a))return a;var h;if(s===-100)h=v.cwd();else{var d=v.getStream(s);if(!d)throw new v.ErrnoError(8);h=d.path}if(a.length==0){if(!l)throw new v.ErrnoError(44);return h}return re.join2(h,a)},doStat:function(s,a,l){try{var h=s(a)}catch(d){if(d&&d.node&&re.normalize(a)!==re.normalize(v.getPath(d.node)))return-54;throw d}return B[l>>2]=h.dev,B[l+4>>2]=0,B[l+8>>2]=h.ino,B[l+12>>2]=h.mode,B[l+16>>2]=h.nlink,B[l+20>>2]=h.uid,B[l+24>>2]=h.gid,B[l+28>>2]=h.rdev,B[l+32>>2]=0,_t=[h.size>>>0,(Be=h.size,+Math.abs(Be)>=1?Be>0?(Math.min(+Math.floor(Be/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Be-+(~~Be>>>0))/4294967296)>>>0:0)],B[l+40>>2]=_t[0],B[l+44>>2]=_t[1],B[l+48>>2]=4096,B[l+52>>2]=h.blocks,B[l+56>>2]=h.atime.getTime()/1e3|0,B[l+60>>2]=0,B[l+64>>2]=h.mtime.getTime()/1e3|0,B[l+68>>2]=0,B[l+72>>2]=h.ctime.getTime()/1e3|0,B[l+76>>2]=0,_t=[h.ino>>>0,(Be=h.ino,+Math.abs(Be)>=1?Be>0?(Math.min(+Math.floor(Be/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Be-+(~~Be>>>0))/4294967296)>>>0:0)],B[l+80>>2]=_t[0],B[l+84>>2]=_t[1],0},doMsync:function(s,a,l,h,d){var w=ze.slice(s,s+l);v.msync(a,w,d,l,h)},varargs:void 0,get:function(){ne.varargs+=4;var s=B[ne.varargs-4>>2];return s},getStr:function(s){var a=se(s);return a},getStreamFromFD:function(s){var a=v.getStream(s);if(!a)throw new v.ErrnoError(8);return a}};function ad(s,a){try{return s=ne.getStr(s),v.chmod(s,a),0}catch(l){if(typeof v>"u"||!(l instanceof v.ErrnoError))throw l;return-l.errno}}function ud(s,a,l,h){try{if(a=ne.getStr(a),a=ne.calculateAt(s,a),l&-8)return-28;var d=v.lookupPath(a,{follow:!0}),w=d.node;if(!w)return-44;var b="";return l&4&&(b+="r"),l&2&&(b+="w"),l&1&&(b+="x"),b&&v.nodePermissions(w,b)?-2:0}catch(S){if(typeof v>"u"||!(S instanceof v.ErrnoError))throw S;return-S.errno}}function ld(s){return B[du()>>2]=s,s}function cd(s,a,l){ne.varargs=l;try{var h=ne.getStreamFromFD(s);switch(a){case 0:{var d=ne.get();if(d<0)return-28;var w;return w=v.createStream(h,d),w.fd}case 1:case 2:return 0;case 3:return h.flags;case 4:{var d=ne.get();return h.flags|=d,0}case 5:{var d=ne.get(),b=0;return Nt[d+b>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return ld(28),-1;default:return-28}}catch(S){if(typeof v>"u"||!(S instanceof v.ErrnoError))throw S;return-S.errno}}function fd(s,a){try{var l=ne.getStreamFromFD(s);return ne.doStat(v.stat,l.path,a)}catch(h){if(typeof v>"u"||!(h instanceof v.ErrnoError))throw h;return-h.errno}}function hd(s,a,l){ne.varargs=l;try{var h=ne.getStreamFromFD(s);switch(a){case 21509:case 21505:return h.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return h.tty?0:-59;case 21519:{if(!h.tty)return-59;var d=ne.get();return B[d>>2]=0,0}case 21520:return h.tty?-28:-59;case 21531:{var d=ne.get();return v.ioctl(h,a,d)}case 21523:return h.tty?0:-59;case 21524:return h.tty?0:-59;default:Ht("bad ioctl syscall "+a)}}catch(w){if(typeof v>"u"||!(w instanceof v.ErrnoError))throw w;return-w.errno}}function pd(s,a){try{return s=ne.getStr(s),ne.doStat(v.lstat,s,a)}catch(l){if(typeof v>"u"||!(l instanceof v.ErrnoError))throw l;return-l.errno}}function dd(s,a,l,h){try{a=ne.getStr(a);var d=h&256,w=h&4096;return h=h&-4353,a=ne.calculateAt(s,a,w),ne.doStat(d?v.lstat:v.stat,a,l)}catch(b){if(typeof v>"u"||!(b instanceof v.ErrnoError))throw b;return-b.errno}}function vd(s,a,l,h){ne.varargs=h;try{a=ne.getStr(a),a=ne.calculateAt(s,a);var d=h?ne.get():0;return v.open(a,l,d).fd}catch(w){if(typeof v>"u"||!(w instanceof v.ErrnoError))throw w;return-w.errno}}function gd(s,a){try{return s=ne.getStr(s),ne.doStat(v.stat,s,a)}catch(l){if(typeof v>"u"||!(l instanceof v.ErrnoError))throw l;return-l.errno}}function md(s,a,l,h,d){}function Wn(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}function yd(){for(var s=new Array(256),a=0;a<256;++a)s[a]=String.fromCharCode(a);ja=s}var ja=void 0;function Ve(s){for(var a="",l=s;ze[l];)a+=ja[ze[l++]];return a}var br={},tr={},zn={},wd=48,bd=57;function Vn(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var a=s.charCodeAt(0);return a>=wd&&a<=bd?"_"+s:s}function Xn(s,a){return s=Vn(s),new Function("body","return function "+s+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(a)}function ti(s,a){var l=Xn(a,function(h){this.name=a,this.message=h;var d=new Error(h).stack;d!==void 0&&(this.stack=this.toString()+`
`+d.replace(/^Error(:[^\n]*)?\n/,""))});return l.prototype=Object.create(s.prototype),l.prototype.constructor=l,l.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},l}var Sr=void 0;function oe(s){throw new Sr(s)}var Za=void 0;function Yn(s){throw new Za(s)}function rr(s,a,l){s.forEach(function(S){zn[S]=a});function h(S){var T=l(S);T.length!==s.length&&Yn("Mismatched type converter count");for(var P=0;P<s.length;++P)pt(s[P],T[P])}var d=new Array(a.length),w=[],b=0;a.forEach((S,T)=>{tr.hasOwnProperty(S)?d[T]=tr[S]:(w.push(S),br.hasOwnProperty(S)||(br[S]=[]),br[S].push(()=>{d[T]=tr[S],++b,b===w.length&&h(d)}))}),w.length===0&&h(d)}function pt(s,a,l={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");var h=a.name;if(s||oe('type "'+h+'" must have a positive integer typeid pointer'),tr.hasOwnProperty(s)){if(l.ignoreDuplicateRegistrations)return;oe("Cannot register type '"+h+"' twice")}if(tr[s]=a,delete zn[s],br.hasOwnProperty(s)){var d=br[s];delete br[s],d.forEach(w=>w())}}function Sd(s,a,l,h,d){var w=Wn(l);a=Ve(a),pt(s,{name:a,fromWireType:function(b){return!!b},toWireType:function(b,S){return S?h:d},argPackAdvance:8,readValueFromPointer:function(b){var S;if(l===1)S=Ge;else if(l===2)S=Nt;else if(l===4)S=B;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(S[b>>w])},destructorFunction:null})}function _d(s){if(!(this instanceof Wt)||!(s instanceof Wt))return!1;for(var a=this.$$.ptrType.registeredClass,l=this.$$.ptr,h=s.$$.ptrType.registeredClass,d=s.$$.ptr;a.baseClass;)l=a.upcast(l),a=a.baseClass;for(;h.baseClass;)d=h.upcast(d),h=h.baseClass;return a===h&&l===d}function Ed(s){return{count:s.count,deleteScheduled:s.deleteScheduled,preservePointerOnDelete:s.preservePointerOnDelete,ptr:s.ptr,ptrType:s.ptrType,smartPtr:s.smartPtr,smartPtrType:s.smartPtrType}}function ri(s){function a(l){return l.$$.ptrType.registeredClass.name}oe(a(s)+" instance already deleted")}var ni=!1;function Ka(s){}function Td(s){s.smartPtr?s.smartPtrType.rawDestructor(s.smartPtr):s.ptrType.registeredClass.rawDestructor(s.ptr)}function Qa(s){s.count.value-=1;var a=s.count.value===0;a&&Td(s)}function Ja(s,a,l){if(a===l)return s;if(l.baseClass===void 0)return null;var h=Ja(s,a,l.baseClass);return h===null?null:l.downcast(h)}var eu={};function xd(){return Object.keys(Qr).length}function Cd(){var s=[];for(var a in Qr)Qr.hasOwnProperty(a)&&s.push(Qr[a]);return s}var Zr=[];function oi(){for(;Zr.length;){var s=Zr.pop();s.$$.deleteScheduled=!1,s.delete()}}var Kr=void 0;function kd(s){Kr=s,Zr.length&&Kr&&Kr(oi)}function Pd(){r.getInheritedInstanceCount=xd,r.getLiveInheritedInstances=Cd,r.flushPendingDeletes=oi,r.setDelayFunction=kd}var Qr={};function Ad(s,a){for(a===void 0&&oe("ptr should not be undefined");s.baseClass;)a=s.upcast(a),s=s.baseClass;return a}function Rd(s,a){return a=Ad(s,a),Qr[a]}function qn(s,a){(!a.ptrType||!a.ptr)&&Yn("makeClassHandle requires ptr and ptrType");var l=!!a.smartPtrType,h=!!a.smartPtr;return l!==h&&Yn("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Jr(Object.create(s,{$$:{value:a}}))}function Od(s){var a=this.getPointee(s);if(!a)return this.destructor(s),null;var l=Rd(this.registeredClass,a);if(l!==void 0){if(l.$$.count.value===0)return l.$$.ptr=a,l.$$.smartPtr=s,l.clone();var h=l.clone();return this.destructor(s),h}function d(){return this.isSmartPointer?qn(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:a,smartPtrType:this,smartPtr:s}):qn(this.registeredClass.instancePrototype,{ptrType:this,ptr:s})}var w=this.registeredClass.getActualType(a),b=eu[w];if(!b)return d.call(this);var S;this.isConst?S=b.constPointerType:S=b.pointerType;var T=Ja(a,this.registeredClass,S.registeredClass);return T===null?d.call(this):this.isSmartPointer?qn(S.registeredClass.instancePrototype,{ptrType:S,ptr:T,smartPtrType:this,smartPtr:s}):qn(S.registeredClass.instancePrototype,{ptrType:S,ptr:T})}function Jr(s){return typeof FinalizationRegistry>"u"?(Jr=a=>a,s):(ni=new FinalizationRegistry(a=>{Qa(a.$$)}),Jr=a=>{var l=a.$$,h=!!l.smartPtr;if(h){var d={$$:l};ni.register(a,d,a)}return a},Ka=a=>ni.unregister(a),Jr(s))}function Dd(){if(this.$$.ptr||ri(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var s=Jr(Object.create(Object.getPrototypeOf(this),{$$:{value:Ed(this.$$)}}));return s.$$.count.value+=1,s.$$.deleteScheduled=!1,s}function Ld(){this.$$.ptr||ri(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&oe("Object already scheduled for deletion"),Ka(this),Qa(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Md(){return!this.$$.ptr}function Ud(){return this.$$.ptr||ri(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&oe("Object already scheduled for deletion"),Zr.push(this),Zr.length===1&&Kr&&Kr(oi),this.$$.deleteScheduled=!0,this}function Bd(){Wt.prototype.isAliasOf=_d,Wt.prototype.clone=Dd,Wt.prototype.delete=Ld,Wt.prototype.isDeleted=Md,Wt.prototype.deleteLater=Ud}function Wt(){}function ii(s,a,l){if(s[a].overloadTable===void 0){var h=s[a];s[a]=function(){return s[a].overloadTable.hasOwnProperty(arguments.length)||oe("Function '"+l+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[a].overloadTable+")!"),s[a].overloadTable[arguments.length].apply(this,arguments)},s[a].overloadTable=[],s[a].overloadTable[h.argCount]=h}}function tu(s,a,l){r.hasOwnProperty(s)?((l===void 0||r[s].overloadTable!==void 0&&r[s].overloadTable[l]!==void 0)&&oe("Cannot register public name '"+s+"' twice"),ii(r,s,s),r.hasOwnProperty(l)&&oe("Cannot register multiple overloads of a function with the same number of arguments ("+l+")!"),r[s].overloadTable[l]=a):(r[s]=a,l!==void 0&&(r[s].numArguments=l))}function Fd(s,a,l,h,d,w,b,S){this.name=s,this.constructor=a,this.instancePrototype=l,this.rawDestructor=h,this.baseClass=d,this.getActualType=w,this.upcast=b,this.downcast=S,this.pureVirtualFunctions=[]}function si(s,a,l){for(;a!==l;)a.upcast||oe("Expected null or instance of "+l.name+", got an instance of "+a.name),s=a.upcast(s),a=a.baseClass;return s}function Id(s,a){if(a===null)return this.isReference&&oe("null is not a valid "+this.name),0;a.$$||oe('Cannot pass "'+fi(a)+'" as a '+this.name),a.$$.ptr||oe("Cannot pass deleted object as a pointer of type "+this.name);var l=a.$$.ptrType.registeredClass,h=si(a.$$.ptr,l,this.registeredClass);return h}function Gd(s,a){var l;if(a===null)return this.isReference&&oe("null is not a valid "+this.name),this.isSmartPointer?(l=this.rawConstructor(),s!==null&&s.push(this.rawDestructor,l),l):0;a.$$||oe('Cannot pass "'+fi(a)+'" as a '+this.name),a.$$.ptr||oe("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&a.$$.ptrType.isConst&&oe("Cannot convert argument of type "+(a.$$.smartPtrType?a.$$.smartPtrType.name:a.$$.ptrType.name)+" to parameter type "+this.name);var h=a.$$.ptrType.registeredClass;if(l=si(a.$$.ptr,h,this.registeredClass),this.isSmartPointer)switch(a.$$.smartPtr===void 0&&oe("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:a.$$.smartPtrType===this?l=a.$$.smartPtr:oe("Cannot convert argument of type "+(a.$$.smartPtrType?a.$$.smartPtrType.name:a.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:l=a.$$.smartPtr;break;case 2:if(a.$$.smartPtrType===this)l=a.$$.smartPtr;else{var d=a.clone();l=this.rawShare(l,Pe.toHandle(function(){d.delete()})),s!==null&&s.push(this.rawDestructor,l)}break;default:oe("Unsupporting sharing policy")}return l}function Nd(s,a){if(a===null)return this.isReference&&oe("null is not a valid "+this.name),0;a.$$||oe('Cannot pass "'+fi(a)+'" as a '+this.name),a.$$.ptr||oe("Cannot pass deleted object as a pointer of type "+this.name),a.$$.ptrType.isConst&&oe("Cannot convert argument of type "+a.$$.ptrType.name+" to parameter type "+this.name);var l=a.$$.ptrType.registeredClass,h=si(a.$$.ptr,l,this.registeredClass);return h}function $n(s){return this.fromWireType(J[s>>2])}function Hd(s){return this.rawGetPointee&&(s=this.rawGetPointee(s)),s}function Wd(s){this.rawDestructor&&this.rawDestructor(s)}function zd(s){s!==null&&s.delete()}function Vd(){Tt.prototype.getPointee=Hd,Tt.prototype.destructor=Wd,Tt.prototype.argPackAdvance=8,Tt.prototype.readValueFromPointer=$n,Tt.prototype.deleteObject=zd,Tt.prototype.fromWireType=Od}function Tt(s,a,l,h,d,w,b,S,T,P,M){this.name=s,this.registeredClass=a,this.isReference=l,this.isConst=h,this.isSmartPointer=d,this.pointeeType=w,this.sharingPolicy=b,this.rawGetPointee=S,this.rawConstructor=T,this.rawShare=P,this.rawDestructor=M,!d&&a.baseClass===void 0?h?(this.toWireType=Id,this.destructorFunction=null):(this.toWireType=Nd,this.destructorFunction=null):this.toWireType=Gd}function Xd(s,a,l){r.hasOwnProperty(s)||Yn("Replacing nonexistant public symbol"),r[s].overloadTable!==void 0&&l!==void 0?r[s].overloadTable[l]=a:(r[s]=a,r[s].argCount=l)}function Yd(s,a,l){var h=r["dynCall_"+s];return l&&l.length?h.apply(null,[a].concat(l)):h.call(null,a)}function qd(s,a,l){return s.includes("j")?Yd(s,a,l):Hn(a).apply(null,l)}function $d(s,a){var l=[];return function(){return l.length=0,Object.assign(l,arguments),qd(s,a,l)}}function nr(s,a){s=Ve(s);function l(){return s.includes("j")?$d(s,a):Hn(a)}var h=l();return typeof h!="function"&&oe("unknown function pointer with signature "+s+": "+a),h}var ru=void 0;function nu(s){var a=vu(s),l=Ve(a);return kt(a),l}function jn(s,a){var l=[],h={};function d(w){if(!h[w]&&!tr[w]){if(zn[w]){zn[w].forEach(d);return}l.push(w),h[w]=!0}}throw a.forEach(d),new ru(s+": "+l.map(nu).join([", "]))}function jd(s,a,l,h,d,w,b,S,T,P,M,U,O){M=Ve(M),w=nr(d,w),S&&(S=nr(b,S)),P&&(P=nr(T,P)),O=nr(U,O);var I=Vn(M);tu(I,function(){jn("Cannot construct "+M+" due to unbound types",[h])}),rr([s,a,l],h?[h]:[],function(V){V=V[0];var ie,we;h?(ie=V.registeredClass,we=ie.instancePrototype):we=Wt.prototype;var Te=Xn(I,function(){if(Object.getPrototypeOf(this)!==R)throw new Sr("Use 'new' to construct "+M);if(W.constructor_body===void 0)throw new Sr(M+" has no accessible constructor");var xe=W.constructor_body[arguments.length];if(xe===void 0)throw new Sr("Tried to invoke ctor of "+M+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(W.constructor_body).toString()+") parameters instead!");return xe.apply(this,arguments)}),R=Object.create(we,{constructor:{value:Te}});Te.prototype=R;var W=new Fd(M,Te,R,O,ie,w,S,P),Ae=new Tt(M,W,!0,!1,!1),le=new Tt(M+"*",W,!1,!1,!1),Ze=new Tt(M+" const*",W,!1,!0,!1);return eu[s]={pointerType:le,constPointerType:Ze},Xd(I,Te),[Ae,le,Ze]})}function ou(s,a){if(!(s instanceof Function))throw new TypeError("new_ called with constructor type "+typeof s+" which is not a function");var l=Xn(s.name||"unknownFunctionName",function(){});l.prototype=s.prototype;var h=new l,d=s.apply(h,a);return d instanceof Object?d:h}function iu(s){for(;s.length;){var a=s.pop(),l=s.pop();l(a)}}function ai(s,a,l,h,d){var w=a.length;w<2&&oe("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var b=a[1]!==null&&l!==null,S=!1,T=1;T<a.length;++T)if(a[T]!==null&&a[T].destructorFunction===void 0){S=!0;break}for(var P=a[0].name!=="void",M="",U="",T=0;T<w-2;++T)M+=(T!==0?", ":"")+"arg"+T,U+=(T!==0?", ":"")+"arg"+T+"Wired";var O="return function "+Vn(s)+"("+M+`) {
if (arguments.length !== `+(w-2)+`) {
throwBindingError('function `+s+" called with ' + arguments.length + ' arguments, expected "+(w-2)+` args!');
}
`;S&&(O+=`var destructors = [];
`);var I=S?"destructors":"null",V=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],ie=[oe,h,d,iu,a[0],a[1]];b&&(O+="var thisWired = classParam.toWireType("+I+`, this);
`);for(var T=0;T<w-2;++T)O+="var arg"+T+"Wired = argType"+T+".toWireType("+I+", arg"+T+"); // "+a[T+2].name+`
`,V.push("argType"+T),ie.push(a[T+2]);if(b&&(U="thisWired"+(U.length>0?", ":"")+U),O+=(P?"var rv = ":"")+"invoker(fn"+(U.length>0?", ":"")+U+`);
`,S)O+=`runDestructors(destructors);
`;else for(var T=b?1:2;T<a.length;++T){var we=T===1?"thisWired":"arg"+(T-2)+"Wired";a[T].destructorFunction!==null&&(O+=we+"_dtor("+we+"); // "+a[T].name+`
`,V.push(we+"_dtor"),ie.push(a[T].destructorFunction))}P&&(O+=`var ret = retType.fromWireType(rv);
return ret;
`),O+=`}
`,V.push(O);var Te=ou(Function,V).apply(null,ie);return Te}function ui(s,a){for(var l=[],h=0;h<s;h++)l.push(B[(a>>2)+h]);return l}function Zd(s,a,l,h,d,w,b){var S=ui(l,h);a=Ve(a),w=nr(d,w),rr([],[s],function(T){T=T[0];var P=T.name+"."+a;function M(){jn("Cannot call "+P+" due to unbound types",S)}a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var U=T.registeredClass.constructor;return U[a]===void 0?(M.argCount=l-1,U[a]=M):(ii(U,a,P),U[a].overloadTable[l-1]=M),rr([],S,function(O){var I=[O[0],null].concat(O.slice(1)),V=ai(P,I,null,w,b);return U[a].overloadTable===void 0?(V.argCount=l-1,U[a]=V):U[a].overloadTable[l-1]=V,[]}),[]})}function Kd(s,a,l,h,d,w){Ie(a>0);var b=ui(a,l);d=nr(h,d),rr([],[s],function(S){S=S[0];var T="constructor "+S.name;if(S.registeredClass.constructor_body===void 0&&(S.registeredClass.constructor_body=[]),S.registeredClass.constructor_body[a-1]!==void 0)throw new Sr("Cannot register multiple constructors with identical number of parameters ("+(a-1)+") for class '"+S.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return S.registeredClass.constructor_body[a-1]=()=>{jn("Cannot construct "+S.name+" due to unbound types",b)},rr([],b,function(P){return P.splice(1,0,null),S.registeredClass.constructor_body[a-1]=ai(T,P,null,d,w),[]}),[]})}function Qd(s,a,l,h,d,w,b,S){var T=ui(l,h);a=Ve(a),w=nr(d,w),rr([],[s],function(P){P=P[0];var M=P.name+"."+a;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),S&&P.registeredClass.pureVirtualFunctions.push(a);function U(){jn("Cannot call "+M+" due to unbound types",T)}var O=P.registeredClass.instancePrototype,I=O[a];return I===void 0||I.overloadTable===void 0&&I.className!==P.name&&I.argCount===l-2?(U.argCount=l-2,U.className=P.name,O[a]=U):(ii(O,a,M),O[a].overloadTable[l-2]=U),rr([],T,function(V){var ie=ai(M,V,P,w,b);return O[a].overloadTable===void 0?(ie.argCount=l-2,O[a]=ie):O[a].overloadTable[l-2]=ie,[]}),[]})}var li=[],ut=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function ci(s){s>4&&--ut[s].refcount===0&&(ut[s]=void 0,li.push(s))}function Jd(){for(var s=0,a=5;a<ut.length;++a)ut[a]!==void 0&&++s;return s}function ev(){for(var s=5;s<ut.length;++s)if(ut[s]!==void 0)return ut[s];return null}function tv(){r.count_emval_handles=Jd,r.get_first_emval=ev}var Pe={toValue:s=>(s||oe("Cannot use deleted val. handle = "+s),ut[s].value),toHandle:s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var a=li.length?li.pop():ut.length;return ut[a]={refcount:1,value:s},a}}}};function rv(s,a){a=Ve(a),pt(s,{name:a,fromWireType:function(l){var h=Pe.toValue(l);return ci(l),h},toWireType:function(l,h){return Pe.toHandle(h)},argPackAdvance:8,readValueFromPointer:$n,destructorFunction:null})}function nv(s,a,l){switch(a){case 0:return function(h){var d=l?Ge:ze;return this.fromWireType(d[h])};case 1:return function(h){var d=l?Nt:$r;return this.fromWireType(d[h>>1])};case 2:return function(h){var d=l?B:J;return this.fromWireType(d[h>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function ov(s,a,l,h){var d=Wn(l);a=Ve(a);function w(){}w.values={},pt(s,{name:a,constructor:w,fromWireType:function(b){return this.constructor.values[b]},toWireType:function(b,S){return S.value},argPackAdvance:8,readValueFromPointer:nv(a,d,h),destructorFunction:null}),tu(a,w)}function Zn(s,a){var l=tr[s];return l===void 0&&oe(a+" has unknown type "+nu(s)),l}function iv(s,a,l){var h=Zn(s,"enum");a=Ve(a);var d=h.constructor,w=Object.create(h.constructor.prototype,{value:{value:l},constructor:{value:Xn(h.name+"_"+a,function(){})}});d.values[l]=w,d[a]=w}function fi(s){if(s===null)return"null";var a=typeof s;return a==="object"||a==="array"||a==="function"?s.toString():""+s}function sv(s,a){switch(a){case 2:return function(l){return this.fromWireType(at[l>>2])};case 3:return function(l){return this.fromWireType(Ia[l>>3])};default:throw new TypeError("Unknown float type: "+s)}}function av(s,a,l){var h=Wn(l);a=Ve(a),pt(s,{name:a,fromWireType:function(d){return d},toWireType:function(d,w){return w},argPackAdvance:8,readValueFromPointer:sv(a,h),destructorFunction:null})}function uv(s,a,l){switch(a){case 0:return l?function(d){return Ge[d]}:function(d){return ze[d]};case 1:return l?function(d){return Nt[d>>1]}:function(d){return $r[d>>1]};case 2:return l?function(d){return B[d>>2]}:function(d){return J[d>>2]};default:throw new TypeError("Unknown integer type: "+s)}}function lv(s,a,l,h,d){a=Ve(a);var w=Wn(l),b=U=>U;if(h===0){var S=32-8*l;b=U=>U<<S>>>S}var T=a.includes("unsigned"),P=(U,O)=>{},M;T?M=function(U,O){return P(O,this.name),O>>>0}:M=function(U,O){return P(O,this.name),O},pt(s,{name:a,fromWireType:b,toWireType:M,argPackAdvance:8,readValueFromPointer:uv(a,w,h!==0),destructorFunction:null})}function cv(s,a,l){var h=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],d=h[a];function w(b){b=b>>2;var S=J,T=S[b],P=S[b+1];return new d(St,P,T)}l=Ve(l),pt(s,{name:l,fromWireType:w,argPackAdvance:8,readValueFromPointer:w},{ignoreDuplicateRegistrations:!0})}function fv(s,a){a=Ve(a);var l=a==="std::string";pt(s,{name:a,fromWireType:function(h){var d=J[h>>2],w;if(l)for(var b=h+4,S=0;S<=d;++S){var T=h+4+S;if(S==d||ze[T]==0){var P=T-b,M=se(b,P);w===void 0?w=M:(w+=String.fromCharCode(0),w+=M),b=T+1}}else{for(var U=new Array(d),S=0;S<d;++S)U[S]=String.fromCharCode(ze[h+4+S]);w=U.join("")}return kt(h),w},toWireType:function(h,d){d instanceof ArrayBuffer&&(d=new Uint8Array(d));var w,b=typeof d=="string";b||d instanceof Uint8Array||d instanceof Uint8ClampedArray||d instanceof Int8Array||oe("Cannot pass non-string to std::string"),l&&b?w=()=>fe(d):w=()=>d.length;var S=w(),T=Ct(4+S+1);if(J[T>>2]=S,l&&b)ke(d,T+4,S+1);else if(b)for(var P=0;P<S;++P){var M=d.charCodeAt(P);M>255&&(kt(T),oe("String has UTF-16 code units that do not fit in 8 bits")),ze[T+4+P]=M}else for(var P=0;P<S;++P)ze[T+4+P]=d[P];return h!==null&&h.push(kt,T),T},argPackAdvance:8,readValueFromPointer:$n,destructorFunction:function(h){kt(h)}})}function hv(s,a,l){l=Ve(l);var h,d,w,b,S;a===2?(h=Ue,d=Ye,b=ye,w=()=>$r,S=1):a===4&&(h=De,d=Yr,b=Qo,w=()=>J,S=2),pt(s,{name:l,fromWireType:function(T){for(var P=J[T>>2],M=w(),U,O=T+4,I=0;I<=P;++I){var V=T+4+I*a;if(I==P||M[V>>S]==0){var ie=V-O,we=h(O,ie);U===void 0?U=we:(U+=String.fromCharCode(0),U+=we),O=V+a}}return kt(T),U},toWireType:function(T,P){typeof P!="string"&&oe("Cannot pass non-string to C++ string type "+l);var M=b(P),U=Ct(4+M+a);return J[U>>2]=M>>S,d(P,U+4,M+a),T!==null&&T.push(kt,U),U},argPackAdvance:8,readValueFromPointer:$n,destructorFunction:function(T){kt(T)}})}function pv(s,a){a=Ve(a),pt(s,{isVoid:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(l,h){}})}function dv(){return Date.now()}var vv=!0;function gv(){return vv}function mv(s,a,l){s=Pe.toValue(s),a=Zn(a,"emval::as");var h=[],d=Pe.toHandle(h);return B[l>>2]=d,a.toWireType(h,s)}function yv(s){var a=[];return B[s>>2]=Pe.toHandle(a),a}var wv={};function hi(s){var a=wv[s];return a===void 0?Ve(s):a}var pi=[];function bv(s,a,l,h,d){return s=pi[s],a=Pe.toValue(a),l=hi(l),s(a,l,yv(h),d)}function su(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Sv(s){return s===0?Pe.toHandle(su()):(s=hi(s),Pe.toHandle(su()[s]))}function _v(s){var a=pi.length;return pi.push(s),a}function Ev(s,a){for(var l=new Array(s),h=0;h<s;++h)l[h]=Zn(J[a+h*ae>>2],"parameter "+h);return l}var au=[];function Tv(s,a){var l=Ev(s,a),h=l[0],d=h.name+"_$"+l.slice(1).map(function(V){return V.name}).join("_")+"$",w=au[d];if(w!==void 0)return w;for(var b=["retType"],S=[h],T="",P=0;P<s-1;++P)T+=(P!==0?", ":"")+"arg"+P,b.push("argType"+P),S.push(l[1+P]);for(var M=Vn("methodCaller_"+d),U="return function "+M+`(handle, name, destructors, args) {
`,O=0,P=0;P<s-1;++P)U+="    var arg"+P+" = argType"+P+".readValueFromPointer(args"+(O?"+"+O:"")+`);
`,O+=l[P+1].argPackAdvance;U+="    var rv = handle[name]("+T+`);
`;for(var P=0;P<s-1;++P)l[P+1].deleteObject&&(U+="    argType"+P+".deleteObject(arg"+P+`);
`);h.isVoid||(U+=`    return retType.toWireType(destructors, rv);
`),U+=`};
`,b.push(U);var I=ou(Function,b).apply(null,S);return w=_v(I),au[d]=w,w}function xv(s,a){return s=Pe.toValue(s),a=Pe.toValue(a),Pe.toHandle(s[a])}function Cv(s){s>4&&(ut[s].refcount+=1)}function kv(s){return Pe.toHandle(hi(s))}function Pv(s){var a=Pe.toValue(s);iu(a),ci(s)}function Av(s,a,l){s=Pe.toValue(s),a=Pe.toValue(a),l=Pe.toValue(l),s[a]=l}function Rv(s,a){s=Zn(s,"_emval_take_value");var l=s.readValueFromPointer(a);return Pe.toHandle(l)}function Ov(s){return s=Pe.toValue(s),Pe.toHandle(typeof s)}function Dv(s,a){var l=new Date(B[s>>2]*1e3);B[a>>2]=l.getSeconds(),B[a+4>>2]=l.getMinutes(),B[a+8>>2]=l.getHours(),B[a+12>>2]=l.getDate(),B[a+16>>2]=l.getMonth(),B[a+20>>2]=l.getFullYear()-1900,B[a+24>>2]=l.getDay();var h=new Date(l.getFullYear(),0,1),d=(l.getTime()-h.getTime())/(1e3*60*60*24)|0;B[a+28>>2]=d,B[a+36>>2]=-(l.getTimezoneOffset()*60);var w=new Date(l.getFullYear(),6,1).getTimezoneOffset(),b=h.getTimezoneOffset(),S=(w!=b&&l.getTimezoneOffset()==Math.min(b,w))|0;B[a+32>>2]=S}function Lv(s,a,l,h,d,w){try{var b=v.getStream(d);b&&(l&2&&ne.doMsync(s,b,a,h,w),v.munmap(b))}catch(S){if(typeof v>"u"||!(S instanceof v.ErrnoError))throw S;return-S.errno}}function Mv(s,a,l){var h=new Date().getFullYear(),d=new Date(h,0,1),w=new Date(h,6,1),b=d.getTimezoneOffset(),S=w.getTimezoneOffset(),T=Math.max(b,S);B[s>>2]=T*60,B[a>>2]=Number(b!=S);function P(V){var ie=V.toTimeString().match(/\(([A-Za-z ]+)\)$/);return ie?ie[1]:"GMT"}var M=P(d),U=P(w),O=Fn(M),I=Fn(U);S<b?(J[l>>2]=O,J[l+4>>2]=I):(J[l>>2]=I,J[l+4>>2]=O)}function di(s,a,l){di.called||(di.called=!0,Mv(s,a,l))}function Uv(){Ht("")}function uu(){return 2147483648}function Bv(){return uu()}function Fv(s,a,l){ze.copyWithin(s,a,a+l)}function Iv(s){try{return pe.grow(s-St.byteLength+65535>>>16),Ga(pe.buffer),1}catch{}}function Gv(s){var a=ze.length;s=s>>>0;var l=uu();if(s>l)return!1;let h=(T,P)=>T+(P-T%P)%P;for(var d=1;d<=4;d*=2){var w=a*(1+.2/d);w=Math.min(w,s+100663296);var b=Math.min(l,h(Math.max(s,w),65536)),S=Iv(b);if(S)return!0}return!1}var vi={};function Nv(){return u||"./this.program"}function en(){if(!en.strings){var s=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",a={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:s,_:Nv()};for(var l in vi)vi[l]===void 0?delete a[l]:a[l]=vi[l];var h=[];for(var l in a)h.push(l+"="+a[l]);en.strings=h}return en.strings}function Hv(s,a){var l=0;return en().forEach(function(h,d){var w=a+l;J[s+d*4>>2]=w,In(h,w),l+=h.length+1}),0}function Wv(s,a){var l=en();J[s>>2]=l.length;var h=0;return l.forEach(function(d){h+=d.length+1}),J[a>>2]=h,0}function zv(s){_g(s)}function Vv(s){try{var a=ne.getStreamFromFD(s);return v.close(a),0}catch(l){if(typeof v>"u"||!(l instanceof v.ErrnoError))throw l;return l.errno}}function Xv(s,a,l,h){for(var d=0,w=0;w<l;w++){var b=J[a>>2],S=J[a+4>>2];a+=8;var T=v.read(s,Ge,b,S,h);if(T<0)return-1;if(d+=T,T<S)break}return d}function Yv(s,a,l,h){try{var d=ne.getStreamFromFD(s),w=Xv(d,a,l);return B[h>>2]=w,0}catch(b){if(typeof v>"u"||!(b instanceof v.ErrnoError))throw b;return b.errno}}function qv(s,a){return a+2097152>>>0<4194305-!!s?(s>>>0)+a*4294967296:NaN}function $v(s,a,l,h,d){try{var w=qv(a,l);if(isNaN(w))return 61;var b=ne.getStreamFromFD(s);return v.llseek(b,w,h),_t=[b.position>>>0,(Be=b.position,+Math.abs(Be)>=1?Be>0?(Math.min(+Math.floor(Be/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Be-+(~~Be>>>0))/4294967296)>>>0:0)],B[d>>2]=_t[0],B[d+4>>2]=_t[1],b.getdents&&w===0&&h===0&&(b.getdents=null),0}catch(S){if(typeof v>"u"||!(S instanceof v.ErrnoError))throw S;return S.errno}}function jv(s,a,l,h){for(var d=0,w=0;w<l;w++){var b=J[a>>2],S=J[a+4>>2];a+=8;var T=v.write(s,Ge,b,S,h);if(T<0)return-1;d+=T}return d}function Zv(s,a,l,h){try{var d=ne.getStreamFromFD(s),w=jv(d,a,l);return J[h>>2]=w,0}catch(b){if(typeof v>"u"||!(b instanceof v.ErrnoError))throw b;return b.errno}}function lu(s){for(var a=s.split("."),l=0;l<4;l++){var h=Number(a[l]);if(isNaN(h))return null;a[l]=h}return(a[0]|a[1]<<8|a[2]<<16|a[3]<<24)>>>0}function tn(s){return parseInt(s)}function Kv(s){var a,l,h,d,w=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,b=[];if(!w.test(s))return null;if(s==="::")return[0,0,0,0,0,0,0,0];for(s.startsWith("::")?s=s.replace("::","Z:"):s=s.replace("::",":Z:"),s.indexOf(".")>0?(s=s.replace(new RegExp("[.]","g"),":"),a=s.split(":"),a[a.length-4]=tn(a[a.length-4])+tn(a[a.length-3])*256,a[a.length-3]=tn(a[a.length-2])+tn(a[a.length-1])*256,a=a.slice(0,a.length-2)):a=s.split(":"),h=0,d=0,l=0;l<a.length;l++)if(typeof a[l]=="string")if(a[l]==="Z"){for(d=0;d<8-a.length+1;d++)b[l+d]=0;h=d-1}else b[l+h]=gu(parseInt(a[l],16));else b[l+h]=a[l];return[b[1]<<16|b[0],b[3]<<16|b[2],b[5]<<16|b[4],b[7]<<16|b[6]]}var zt={address_map:{id:1,addrs:{},names:{}},lookup_name:function(s){var a=lu(s);if(a!==null||(a=Kv(s),a!==null))return s;var l;if(zt.address_map.addrs[s])l=zt.address_map.addrs[s];else{var h=zt.address_map.id++;Ie(h<65535,"exceeded max address mappings of 65535"),l="172.29."+(h&255)+"."+(h&65280),zt.address_map.names[l]=s,zt.address_map.addrs[s]=l}return l},lookup_addr:function(s){return zt.address_map.names[s]?zt.address_map.names[s]:null}};function Qv(s){var a=Ct(20),l=Ct(s.length+1);ke(s,l,s.length+1),J[a>>2]=l;var h=Ct(4);J[h>>2]=0,J[a+4>>2]=h;var d=2;B[a+8>>2]=d,B[a+12>>2]=4;var w=Ct(12);return J[w>>2]=w+8,J[w+4>>2]=0,B[w+8>>2]=lu(zt.lookup_name(s)),J[a+16>>2]=w,a}function Jv(s){return Qv(se(s))}function eg(s){var a=s.getExtension("ANGLE_instanced_arrays");if(a)return s.vertexAttribDivisor=function(l,h){a.vertexAttribDivisorANGLE(l,h)},s.drawArraysInstanced=function(l,h,d,w){a.drawArraysInstancedANGLE(l,h,d,w)},s.drawElementsInstanced=function(l,h,d,w,b){a.drawElementsInstancedANGLE(l,h,d,w,b)},1}function tg(s){var a=s.getExtension("OES_vertex_array_object");if(a)return s.createVertexArray=function(){return a.createVertexArrayOES()},s.deleteVertexArray=function(l){a.deleteVertexArrayOES(l)},s.bindVertexArray=function(l){a.bindVertexArrayOES(l)},s.isVertexArray=function(l){return a.isVertexArrayOES(l)},1}function rg(s){var a=s.getExtension("WEBGL_draw_buffers");if(a)return s.drawBuffers=function(l,h){a.drawBuffersWEBGL(l,h)},1}function ng(s){return!!(s.multiDrawWebgl=s.getExtension("WEBGL_multi_draw"))}var de={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(a){de.lastError||(de.lastError=a)},getNewId:function(s){for(var a=de.counter++,l=s.length;l<a;l++)s[l]=null;return a},getSource:function(s,a,l,h){for(var d="",w=0;w<a;++w){var b=h?B[h+w*4>>2]:-1;d+=se(B[l+w*4>>2],b<0?void 0:b)}return d},createContext:function(s,a){if(!s.getContextSafariWebGL2Fixed){let d=function(w,b){var S=s.getContextSafariWebGL2Fixed(w,b);return w=="webgl"==S instanceof WebGLRenderingContext?S:null};s.getContextSafariWebGL2Fixed=s.getContext,s.getContext=d}var l=s.getContext("webgl",a);if(!l)return 0;var h=de.registerContext(l,a);return h},registerContext:function(s,a){var l=de.getNewId(de.contexts),h={handle:l,attributes:a,version:a.majorVersion,GLctx:s};return s.canvas&&(s.canvas.GLctxObject=h),de.contexts[l]=h,(typeof a.enableExtensionsByDefault>"u"||a.enableExtensionsByDefault)&&de.initExtensions(h),l},makeContextCurrent:function(s){return de.currentContext=de.contexts[s],r.ctx=qe=de.currentContext&&de.currentContext.GLctx,!(s&&!qe)},getContext:function(s){return de.contexts[s]},deleteContext:function(s){de.currentContext===de.contexts[s]&&(de.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(de.contexts[s].GLctx.canvas),de.contexts[s]&&de.contexts[s].GLctx.canvas&&(de.contexts[s].GLctx.canvas.GLctxObject=void 0),de.contexts[s]=null},initExtensions:function(s){if(s||(s=de.currentContext),!s.initExtensionsDone){s.initExtensionsDone=!0;var a=s.GLctx;eg(a),tg(a),rg(a),a.disjointTimerQueryExt=a.getExtension("EXT_disjoint_timer_query"),ng(a);var l=a.getSupportedExtensions()||[];l.forEach(function(h){!h.includes("lose_context")&&!h.includes("debug")&&a.getExtension(h)})}}};function cu(s){return s.slice(-1)=="]"&&s.lastIndexOf("[")}function og(s){var a=s.uniformLocsById,l=s.uniformSizeAndIdsByName,h,d;if(!a)for(s.uniformLocsById=a={},s.uniformArrayNamesById={},h=0;h<qe.getProgramParameter(s,35718);++h){var w=qe.getActiveUniform(s,h),b=w.name,S=w.size,T=cu(b),P=T>0?b.slice(0,T):b,M=s.uniformIdCounter;for(s.uniformIdCounter+=S,l[P]=[S,M],d=0;d<S;++d)a[M]=d,s.uniformArrayNamesById[M++]=P}}function ig(s,a){if(a=se(a),s=de.programs[s]){og(s);var l=s.uniformLocsById,h=0,d=a,w=cu(a);w>0&&(h=tn(a.slice(w+1))>>>0,d=a.slice(0,w));var b=s.uniformSizeAndIdsByName[d];if(b&&h<b[0]&&(h+=b[1],l[h]=l[h]||qe.getUniformLocation(s,a)))return h}else de.recordError(1281);return-1}function Vt(s){var a=qe.currentProgram;if(a){var l=a.uniformLocsById[s];return typeof l=="number"&&(a.uniformLocsById[s]=l=qe.getUniformLocation(a,a.uniformArrayNamesById[s]+(l>0?"["+l+"]":""))),l}else de.recordError(1282)}function sg(s,a){qe.uniform1f(Vt(s),a)}function ag(s,a){qe.uniform1i(Vt(s),a)}var Kn=[];function ug(s,a,l){if(a<=144)for(var h=Kn[2*a-1],d=0;d<2*a;d+=2)h[d]=at[l+4*d>>2],h[d+1]=at[l+(4*d+4)>>2];else var h=at.subarray(l>>2,l+a*8>>2);qe.uniform2fv(Vt(s),h)}var Qn=[];function lg(s,a,l){if(a<=144)for(var h=Qn[2*a-1],d=0;d<2*a;d+=2)h[d]=B[l+4*d>>2],h[d+1]=B[l+(4*d+4)>>2];else var h=B.subarray(l>>2,l+a*8>>2);qe.uniform2iv(Vt(s),h)}function cg(s,a,l){if(a<=96)for(var h=Kn[3*a-1],d=0;d<3*a;d+=3)h[d]=at[l+4*d>>2],h[d+1]=at[l+(4*d+4)>>2],h[d+2]=at[l+(4*d+8)>>2];else var h=at.subarray(l>>2,l+a*12>>2);qe.uniform3fv(Vt(s),h)}function fg(s,a,l){if(a<=96)for(var h=Qn[3*a-1],d=0;d<3*a;d+=3)h[d]=B[l+4*d>>2],h[d+1]=B[l+(4*d+4)>>2],h[d+2]=B[l+(4*d+8)>>2];else var h=B.subarray(l>>2,l+a*12>>2);qe.uniform3iv(Vt(s),h)}function hg(s,a,l){if(a<=72){var h=Kn[4*a-1],d=at;l>>=2;for(var w=0;w<4*a;w+=4){var b=l+w;h[w]=d[b],h[w+1]=d[b+1],h[w+2]=d[b+2],h[w+3]=d[b+3]}}else var h=at.subarray(l>>2,l+a*16>>2);qe.uniform4fv(Vt(s),h)}function pg(s,a,l){if(a<=72)for(var h=Qn[4*a-1],d=0;d<4*a;d+=4)h[d]=B[l+4*d>>2],h[d+1]=B[l+(4*d+4)>>2],h[d+2]=B[l+(4*d+8)>>2],h[d+3]=B[l+(4*d+12)>>2];else var h=B.subarray(l>>2,l+a*16>>2);qe.uniform4iv(Vt(s),h)}function dg(s){}function Jn(s){return s%4===0&&(s%100!==0||s%400===0)}function vg(s,a){for(var l=0,h=0;h<=a;l+=s[h++]);return l}var fu=[31,29,31,30,31,30,31,31,30,31,30,31],hu=[31,28,31,30,31,30,31,31,30,31,30,31];function gg(s,a){for(var l=new Date(s.getTime());a>0;){var h=Jn(l.getFullYear()),d=l.getMonth(),w=(h?fu:hu)[d];if(a>w-l.getDate())a-=w-l.getDate()+1,l.setDate(1),d<11?l.setMonth(d+1):(l.setMonth(0),l.setFullYear(l.getFullYear()+1));else return l.setDate(l.getDate()+a),l}return l}function mg(s,a,l,h){var d=B[h+40>>2],w={tm_sec:B[h>>2],tm_min:B[h+4>>2],tm_hour:B[h+8>>2],tm_mday:B[h+12>>2],tm_mon:B[h+16>>2],tm_year:B[h+20>>2],tm_wday:B[h+24>>2],tm_yday:B[h+28>>2],tm_isdst:B[h+32>>2],tm_gmtoff:B[h+36>>2],tm_zone:d?se(d):""},b=se(l),S={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var T in S)b=b.replace(new RegExp(T,"g"),S[T]);var P=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],M=["January","February","March","April","May","June","July","August","September","October","November","December"];function U(R,W,Ae){for(var le=typeof R=="number"?R.toString():R||"";le.length<W;)le=Ae[0]+le;return le}function O(R,W){return U(R,W,"0")}function I(R,W){function Ae(Ze){return Ze<0?-1:Ze>0?1:0}var le;return(le=Ae(R.getFullYear()-W.getFullYear()))===0&&(le=Ae(R.getMonth()-W.getMonth()))===0&&(le=Ae(R.getDate()-W.getDate())),le}function V(R){switch(R.getDay()){case 0:return new Date(R.getFullYear()-1,11,29);case 1:return R;case 2:return new Date(R.getFullYear(),0,3);case 3:return new Date(R.getFullYear(),0,2);case 4:return new Date(R.getFullYear(),0,1);case 5:return new Date(R.getFullYear()-1,11,31);case 6:return new Date(R.getFullYear()-1,11,30)}}function ie(R){var W=gg(new Date(R.tm_year+1900,0,1),R.tm_yday),Ae=new Date(W.getFullYear(),0,4),le=new Date(W.getFullYear()+1,0,4),Ze=V(Ae),xe=V(le);return I(Ze,W)<=0?I(xe,W)<=0?W.getFullYear()+1:W.getFullYear():W.getFullYear()-1}var we={"%a":function(R){return P[R.tm_wday].substring(0,3)},"%A":function(R){return P[R.tm_wday]},"%b":function(R){return M[R.tm_mon].substring(0,3)},"%B":function(R){return M[R.tm_mon]},"%C":function(R){var W=R.tm_year+1900;return O(W/100|0,2)},"%d":function(R){return O(R.tm_mday,2)},"%e":function(R){return U(R.tm_mday,2," ")},"%g":function(R){return ie(R).toString().substring(2)},"%G":function(R){return ie(R)},"%H":function(R){return O(R.tm_hour,2)},"%I":function(R){var W=R.tm_hour;return W==0?W=12:W>12&&(W-=12),O(W,2)},"%j":function(R){return O(R.tm_mday+vg(Jn(R.tm_year+1900)?fu:hu,R.tm_mon-1),3)},"%m":function(R){return O(R.tm_mon+1,2)},"%M":function(R){return O(R.tm_min,2)},"%n":function(){return`
`},"%p":function(R){return R.tm_hour>=0&&R.tm_hour<12?"AM":"PM"},"%S":function(R){return O(R.tm_sec,2)},"%t":function(){return"	"},"%u":function(R){return R.tm_wday||7},"%U":function(R){var W=R.tm_yday+7-R.tm_wday;return O(Math.floor(W/7),2)},"%V":function(R){var W=Math.floor((R.tm_yday+7-(R.tm_wday+6)%7)/7);if((R.tm_wday+371-R.tm_yday-2)%7<=2&&W++,W){if(W==53){var le=(R.tm_wday+371-R.tm_yday)%7;le!=4&&(le!=3||!Jn(R.tm_year))&&(W=1)}}else{W=52;var Ae=(R.tm_wday+7-R.tm_yday-1)%7;(Ae==4||Ae==5&&Jn(R.tm_year%400-1))&&W++}return O(W,2)},"%w":function(R){return R.tm_wday},"%W":function(R){var W=R.tm_yday+7-(R.tm_wday+6)%7;return O(Math.floor(W/7),2)},"%y":function(R){return(R.tm_year+1900).toString().substring(2)},"%Y":function(R){return R.tm_year+1900},"%z":function(R){var W=R.tm_gmtoff,Ae=W>=0;return W=Math.abs(W)/60,W=W/60*100+W%60,(Ae?"+":"-")+String("0000"+W).slice(-4)},"%Z":function(R){return R.tm_zone},"%%":function(){return"%"}};b=b.replace(/%%/g,"\0\0");for(var T in we)b.includes(T)&&(b=b.replace(new RegExp(T,"g"),we[T](w)));b=b.replace(/\0\0/g,"%");var Te=ro(b,!1);return Te.length>a?0:(qr(Te,s),Te.length-1)}function yg(s,a,l,h){return mg(s,a,l,h)}var pu=function(s,a,l,h){s||(s=this),this.parent=s,this.mount=s.mount,this.mounted=null,this.id=v.nextInode++,this.name=a,this.mode=l,this.node_ops={},this.stream_ops={},this.rdev=h},eo=365,to=146;Object.defineProperties(pu.prototype,{read:{get:function(){return(this.mode&eo)===eo},set:function(s){s?this.mode|=eo:this.mode&=~eo}},write:{get:function(){return(this.mode&to)===to},set:function(s){s?this.mode|=to:this.mode&=~to}},isFolder:{get:function(){return v.isDir(this.mode)}},isDevice:{get:function(){return v.isChrdev(this.mode)}}}),v.FSNode=pu,v.staticInit(),yd(),Sr=r.BindingError=ti(Error,"BindingError"),Za=r.InternalError=ti(Error,"InternalError"),Bd(),Pd(),Vd(),ru=r.UnboundTypeError=ti(Error,"UnboundTypeError"),tv();for(var qe,wg=new Float32Array(288),xt=0;xt<288;++xt)Kn[xt]=wg.subarray(0,xt+1);for(var bg=new Int32Array(288),xt=0;xt<288;++xt)Qn[xt]=bg.subarray(0,xt+1);function ro(s,a,l){var h=l>0?l:fe(s)+1,d=new Array(h),w=Ee(s,d,0,d.length);return a&&(d.length=w),d}var Sg={_:Qp,k:Jp,a:ed,c:rd,S:ad,T:ud,p:cd,M:fd,V:hd,J:pd,K:dd,t:vd,L:gd,B:md,X:Sd,d:jd,f:Zd,e:Kd,b:Qd,W:rv,h:ov,g:iv,w:av,j:lv,i:cv,v:fv,q:hv,Y:pv,P:dv,O:gv,m:mv,la:bv,y:ci,ma:Sv,ka:Tv,r:xv,z:Cv,ja:kv,na:Pv,n:Av,l:Rv,x:Ov,Q:Dv,G:Lv,R:di,s:Uv,F:Bv,N:Fv,E:Gv,H:Hv,I:Wv,$:zv,o:Vv,U:Yv,A:$v,u:Zv,Z:Jv,ia:ig,ga:sg,ha:ag,ca:ug,fa:lg,ba:cg,ea:fg,aa:hg,da:pg,C:dg,D:yg};Kp(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var Ct=r._malloc=function(){return(Ct=r._malloc=r.asm.qa).apply(null,arguments)},kt=r._free=function(){return(kt=r._free=r.asm.ra).apply(null,arguments)},du=r.___errno_location=function(){return(du=r.___errno_location=r.asm.sa).apply(null,arguments)},vu=r.___getTypeName=function(){return(vu=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var gu=r._htons=function(){return(gu=r._htons=r.asm.wa).apply(null,arguments)},mu=r._emscripten_builtin_memalign=function(){return(mu=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},yu=r.___cxa_is_pointer_type=function(){return(yu=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Aa).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Ea).apply(null,arguments)},r.FS=v;var no;function gi(s){this.name="ExitStatus",this.message="Program terminated with exit("+s+")",this.status=s}jr=function s(){no||mi(),no||(jr=s)};function mi(s){if(Jt>0||(zp(),Jt>0))return;function a(){no||(no=!0,r.calledRun=!0,!Oe&&(Vp(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),Xp()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),a()},1)):a()}r.run=mi;function _g(s,a){Eg(s)}function Eg(s){Va()||(r.onExit&&r.onExit(s),Oe=!0),c(s,new gi(s))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return mi(),r.ready}})();const oo={library:null},bu=t=>{oo.library=t},F=()=>{if(!oo.library)throw new Error("oppencascade has not been loaded");return oo.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const or=new globalThis.FinalizationRegistry(t=>{try{t.delete()}catch(e){console.error(e)}});class lt{constructor(e){this.oc=F(),e&&or.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(or.unregister(this._wrapped),this._wrapped.delete()),or.register(this,e,e),this._wrapped=e}delete(){var e;or.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const ve=()=>{function t(e){return or.register(t,e),e}return t},yi=t=>{function e(r){return or.register(t,r),r}return e},ce=t=>{const e=new Set;return[r=>(e.add(r),r),()=>{[...e.values()].forEach(r=>r.delete()),e.clear()},t?e:void 0]},wi=2147483647,$e=Math.PI/180,ir=180/Math.PI,io=t=>Math.round(t*1e3)/1e3,_r=(t,e,r)=>{const n=F(),o=Ce(t),i=dt(e);let u;if(r){const c=dt(r);u=new n.gp_Ax3_3(o,i,c),c.delete()}else u=new n.gp_Ax3_4(o,i);return o.delete(),i.delete(),u},sr=(t,e,r)=>{const n=F(),o=Ce(t),i=dt(e);let u;if(r){const c=dt(r);u=new n.gp_Ax2_2(o,i,c),c.delete()}else u=new n.gp_Ax2_3(o,i);return o.delete(),i.delete(),u},bi=(t,e)=>{const r=F(),n=Ce(t),o=dt(e),i=new r.gp_Ax1_2(n,o);return n.delete(),o.delete(),i},Su=(t=[0,0,0])=>{const e=F();if(Array.isArray(t)){if(t.length===3)return new e.gp_Vec_4(...t);if(t.length===2)return new e.gp_Vec_4(...t,0)}else{if(t instanceof X)return new e.gp_Vec_3(t.wrapped.XYZ());if(t.XYZ)return new e.gp_Vec_3(t.XYZ())}return new e.gp_Vec_4(0,0,0)};class X extends lt{constructor(e=[0,0,0]){super(Su(e))}get repr(){return`x: ${io(this.x)}, y: ${io(this.y)}, z: ${io(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new X(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new X(this.wrapped.Subtracted(e.wrapped))}add(e){return new X(this.wrapped.Added(e.wrapped))}multiply(e){return new X(this.wrapped.Multiplied(e))}normalized(){return new X(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*ir}projectToPlane(e){const r=e.origin,n=e.zDir,o=this.sub(r),i=n.multiply(o.dot(n)/n.Length**2),u=this.sub(i);return o.delete(),i.delete(),u}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,r=[0,0,0],n=[0,0,1]){const o=bi(r,n);return this.wrapped.Rotate(o,e*$e),o.delete(),this}}const _u={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function Eu(t){return t==="X"||t==="Y"||t==="Z"?_u[t]:t}function Ce(t){const e=new X(t),r=e.toPnt();return e.delete(),r}function dt(t){const e=new X(t),r=e.toDir();return e.delete(),r}class ar extends lt{constructor(e){const r=F();super(e||new r.gp_Trsf_1)}translate(e,r=0,n=0){const o=new X(typeof e=="number"?[e,r,n]:e);return this.wrapped.SetTranslation_1(o.wrapped),this}rotate(e,r=[0,0,0],n=[0,0,1]){const o=dt(n),i=Ce(r),u=new this.oc.gp_Ax1_2(i,o);return this.wrapped.SetRotation_1(u,e*$e),u.delete(),o.delete(),i.delete(),this}mirror(e="YZ",r){const n=ve();let o,i;if(typeof e=="string"){const c=n(Si(e,r));o=c.origin,i=c.zDir}else e instanceof Xe?(o=r||e.origin,i=e.zDir):(o=r||[0,0,0],i=e);const u=n(sr(o,i));return this.wrapped.SetMirror_3(u),this}scale(e,r){const n=Ce(e);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(e,r){const n=ve(),o=n(e==="reference"?new this.oc.gp_Ax3_1:_r(e.origin,e.zDir,e.xDir)),i=n(r==="reference"?new this.oc.gp_Ax3_1:_r(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(o,i),this}transformPoint(e){const r=Ce(e),n=r.Transformed(this.wrapped);return r.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class Xe{constructor(e,r=null,n=[0,0,1]){this.oc=F();const o=new X(n);if(o.Length===0)throw new Error("normal should be non null");this.zDir=o.normalize();let i;if(r)i=new X(r);else{const u=_r(e,o);i=new X(u.XDirection()),u.delete()}if(i.Length===0)throw new Error("xDir should be non null");this.xDir=i.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new X(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new Xe(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const r=this.clone();return r.origin=new X(e),r}translate(e,r=0,n=0){const o=new X(typeof e=="number"?[e,r,n]:e);return this.translateTo(this.origin.add(o))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,r=[1,0,0]){const n=Eu(r),o=new X(this.zDir).rotate(e,[0,0,0],n),i=new X(this.xDir).rotate(e,[0,0,0],n);return new Xe(this.origin,i,o)}rotate2DAxes(e){const r=new X(this.xDir).rotate(e,[0,0,0],this.zDir);return new Xe(this.origin,r,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,r=_r(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,r),this.globalToLocal=new ar,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new ar,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,r){this.origin=this.toWorldCoords([e,r])}toLocalCoords(e){const r=this.globalToLocal.transformPoint(e),n=new X(r);return r.delete(),n}toWorldCoords(e){const r=this.localToGlobal.transformPoint(e),n=new X(r);return r.delete(),n}}const Tu={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},Si=(t,e=[0,0,0])=>{const r=Tu[t];if(!r)throw new Error(`Could not find plane ${t}`);let n;return typeof e=="number"?n=r.normal.map(o=>o*e):n=e,new Xe(n,r.xDir,r.normal)};let xu=class extends lt{constructor(e){const r=F();let n=e;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[e,r]=this.bounds;return`${new X(e).repr} - ${new X(r).repr}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0},i={current:0},u={current:0};return this.wrapped.Get(e,r,n,o,i,u),[[e.current,r.current,n.current],[o.current,i.current,u.current]]}get center(){const[[e,r,n],[o,i,u]]=this.bounds;return[e+(o-e)/2,r+(i-r)/2,n+(u-n)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}get depth(){const[[,,e],[,,r]]=this.bounds;return Math.abs(r-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};function ct(t="XY",e=[0,0,0]){return t instanceof Xe?t.clone():Si(t,e)}function Cu(t,e,r=[0,0,0],n=[0,0,1]){const o=new ar;o.rotate(e,r,n);const i=o.transform(t);return o.delete(),i}function ku(t,e){const r=new ar;r.translate(e);const n=r.transform(t);return r.delete(),n}function Pu(t,e,r){const n=new ar;n.mirror(e,r);const o=n.transform(t);return n.delete(),o}function Au(t,e,r){const n=new ar;n.scale(e,r);const o=n.transform(t);return n.delete(),o}function rn(t){return Array.isArray(t)&&t.length===2}let nn=null;const _i=t=>{if(nn&&!t)return nn;const r=F().GeomAbs_CurveType;return nn=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),nn},on=t=>{let e=_i().get(t);if(e||(e=_i(!0).get(t)),!e)throw new Error("unknown type");return e};function Ru(t,e){const r=Math.pow(10,e),n=e<0?t:.01/r+t;return Math.round(n*r)/r}function Ou(t){return Array.from(Array(t).keys())}function ur(t){const e=Math.min(...t.map(r=>r.length));return Ou(e).map(r=>t.map(n=>n[r]))}function sn(t){return Math.round(t*100)/100}const Er=([t,e])=>`(${sn(t)},${sn(e)})`,Ei=(t,e=1e-9)=>{let r=t;return Math.abs(t)<e&&(r=0),r.toFixed(-Math.log10(e))},Ti=(t,e=1e-9)=>Array.from(new Map(t.map(([r,n])=>[`[${Ei(r,e)},${Ei(n,e)}]`,[r,n]])).values()),Fe=([t,e])=>{const r=F();return new r.gp_Pnt2d_3(t,e)},Du=([t,e])=>{const r=F();return new r.gp_Dir2d_4(t,e)},xi=([t,e])=>{const r=F();return new r.gp_Vec2d_4(t,e)},lr=(t,e)=>{const r=F(),[n,o]=ce(),i=new r.gp_Ax2d_2(n(Fe(t)),n(Du(e)));return o(),i};class Tr extends lt{constructor(e){const r=F();let n=e;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[e,r]=this.bounds;return`${Er(e)} - ${Er(r)}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.wrapped.Get(e,r,n,o),[[e.current,r.current],[n.current,o.current]]}get center(){const[[e,r],[n,o]]=this.bounds;return[e+(n-e)/2,r+(o-r)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}outsidePoint(e=1){const[r,n]=this.bounds,o=n[0]-r[0],i=n[1]-r[1];return[n[0]+o/100*e,n[1]+i/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=ve()(Fe(e));return!this.wrapped.IsOut_1(n)}}const Ne=([t,e],[r,n],o=1e-6)=>Math.abs(t-r)<=o&&Math.abs(e-n)<=o,cr=([t,e],[r,n])=>[t+r,e+n],so=([t,e],[r,n])=>[t-r,e-n],ao=([t,e],r)=>[t*r,e*r],et=([t,e],[r,n]=[0,0])=>Math.sqrt((t-r)**2+(e-n)**2),Lu=([t,e],[r,n]=[0,0])=>(t-r)**2+(e-n)**2;function Mu([t,e],[r,n]){return t*n-e*r}const Uu=([t,e],[r,n]=[0,0])=>Math.atan2(n*t-e*r,t*r+e*n),Ci=([t,e],[r,n]=[0,0])=>Math.atan2(n-e,r-t),Pt=([t,e])=>{const r=et([t,e]);return[t/r,e/r]},Bu=(t,e,r=[0,0])=>{const[n,o]=t,[i,u]=r,c=n-i,f=o-u,p=Math.sin(e),g=Math.cos(e),y=c*g-f*p,m=c*p+f*g;return[y+i,m+u]},At=(t,e)=>{const r=Math.cos(e)*t,n=Math.sin(e)*t;return[r,n]},Fu=([t,e])=>{const r=et([t,e]),n=Math.atan2(e,t);return[r,n]};class ge extends lt{constructor(e){const r=F(),n=e.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=F(),r=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new Tr(r),this._boundingBox}get repr(){return`${this.geomType} ${Er(this.firstPoint)} - ${Er(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const r=this.innerCurve.Value(e),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=F();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),r=on(e.GetType());return e.delete(),r}clone(){return new ge(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const r=F(),n=ve(),o=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n(Fe(e)),this.wrapped));let i=1/0;try{i=o.LowerDistance()}catch{i=1/0}return Math.min(i,et(e,this.firstPoint),et(e,this.lastPoint))}distanceFromCurve(e){const r=F(),n=ve();let o=1/0;const i=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{o=i.LowerDistance()}catch{o=1/0}return Math.min(o,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return rn(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,r=1e-9){const n=F(),o=ve();let i,u;try{const c=o(new n.Geom2dAPI_ProjectPointOnCurve_2(o(Fe(e)),this.wrapped));i=c.LowerDistance(),u=c.LowerDistanceParameter()}catch{if(Ne(e,this.firstPoint,r))return this.firstParameter;if(Ne(e,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(i>r)throw new Error(`Point ${Er(e)} not on curve ${this.repr}, ${i.toFixed(9)}`);return u}tangentAt(e){const r=F(),[n,o]=ce();let i;Array.isArray(e)?i=this.parameter(e):i=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const u=n(new r.gp_Pnt2d_1),c=n(new r.gp_Vec2d_1);this.innerCurve.D1(i,u,c);const f=[c.X(),c.Y()];return o(),f}splitAt(e,r=1e-9){const n=F(),o=ve();let i=e.map(f=>rn(f)?this.parameter(f,r):f);i=Array.from(new Map(i.map(f=>[Ru(f,-Math.log10(r)),f])).values()).sort((f,p)=>f-p);const u=this.firstParameter,c=this.lastParameter;return u>c&&i.reverse(),Math.abs(i[0]-u)<r*100&&(i=i.slice(1)),i.length?(Math.abs(i[i.length-1]-c)<r*100&&(i=i.slice(0,-1)),i.length?ur([[u,...i],[...i,c]]).map(([f,p])=>{try{if(this.geomType==="BEZIER_CURVE"){const y=new n.Geom2d_BezierCurve_1(o(this.adaptor()).Bezier().get().Poles_2());return y.Segment(f,p),new ge(new n.Handle_Geom2d_Curve_2(y))}if(this.geomType==="BSPLINE_CURVE"){const y=o(this.adaptor()).BSpline().get(),m=new n.Geom2d_BSplineCurve_1(y.Poles_2(),y.Knots_2(),y.Multiplicities_2(),y.Degree(),y.IsPeriodic());return m.Segment(f,p,r),new ge(new n.Handle_Geom2d_Curve_2(m))}const g=new n.Geom2d_TrimmedCurve(this.wrapped,f,p,!0,!0);return new ge(new n.Handle_Geom2d_Curve_2(g))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const ki=(t,e=1e-8)=>{const r=F(),o=ve()(new r.Geom2dConvert_ApproxCurve_2(t.ShallowCopy(),e,r.GeomAbs_Shape.GeomAbs_C0,30,3));return new ge(o.Curve())},Pi=t=>{if(on(t.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=t.BSpline(),r=F(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*o(){const u=n.NbArcs();if(!!u)for(let c=1;c<=u;c++){const f=n.Arc(c);yield new ge(f)}}const i=Array.from(o());return n.delete(),i};function*Ai(t){const e=t.NbPoints();if(!!e)for(let r=1;r<=e;r++){const n=t.Point(r);yield[n.X(),n.Y()]}}function*Iu(t){const e=t.NbSegments();if(!e)return;const r=F();for(let n=1;n<=e;n++){const o=new r.Handle_Geom2d_Curve_1,i=new r.Handle_Geom2d_Curve_1;try{t.Segment(n,o,i)}catch{continue}yield new ge(o),i.delete()}}const xr=(t,e,r=1e-9)=>{if(t.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=F(),o=new n.Geom2dAPI_InterCurveCurve_1;let i,u;try{o.Init_1(t.wrapped,e.wrapped,r),i=Array.from(Ai(o)),u=Array.from(Iu(o))}catch(p){throw console.error(t,e,p),new Error("Intersections failed between curves")}finally{o.delete()}const c=u.filter(p=>Ne(p.firstPoint,p.lastPoint,r)).map(p=>p.firstPoint);c.length&&(i.push(...c),u=u.filter(p=>!Ne(p.firstPoint,p.lastPoint,r)));const f=u.flatMap(p=>[p.firstPoint,p.lastPoint]);return{intersections:i,commonSegments:u,commonSegmentsPoints:f}},Gu=(t,e=1e-9)=>{const r=F(),n=new r.Geom2dAPI_InterCurveCurve_1;let o;try{n.Init_1(t.wrapped,t.wrapped,e),o=Array.from(Ai(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return o},Cr=(t,e)=>{const r=F(),[n,o]=ce(),i=n(new r.GCE2d_MakeSegment_1(n(Fe(t)),n(Fe(e)))).Value(),u=new ge(i);return Ne(u.firstPoint,t)||u.reverse(),o(),u},uo=(t,e,r)=>{const n=F(),[o,i]=ce(),u=o(new n.GCE2d_MakeArcOfCircle_4(o(Fe(t)),o(Fe(e)),o(Fe(r)))).Value();i();const c=new ge(u);return Ne(c.firstPoint,t)||c.wrapped.get().SetTrim(c.lastParameter,c.firstParameter,!0,!0),c},Nu=(t,e,r)=>{const n=F(),[o,i]=ce(),u=o(new n.GCE2d_MakeArcOfCircle_5(o(Fe(t)),o(xi(e)),o(Fe(r)))).Value();i();const c=new ge(u);return Ne(c.firstPoint,t)||c.wrapped.get().SetTrim(c.lastParameter,c.firstParameter,!0,!0),c},Hu=(t,e,r,n,o=[0,0],i,u=!0)=>{const c=F(),[f,p]=ce(),g=f(new c.gp_Elips2d_2(f(lr(o,i)),t,e,!0)),y=f(new c.GCE2d_MakeArcOfEllipse_1(g,r,n,u)).Value();return p(),new ge(y)},Wu=(t,e,r)=>{const n=F(),[o,i]=ce(),u=o(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));u.SetValue(1,o(Fe(t))),e.forEach((f,p)=>{u.SetValue(p+2,o(Fe(f)))}),u.SetValue(e.length+2,o(Fe(r)));const c=new n.Geom2d_BezierCurve_1(u);return i(),new ge(new n.Handle_Geom2d_Curve_2(c))},Ri=(t,e,r)=>{const n=ao(cr(t,e),.5),o=et(r,t),i=Pt(so(n,r));return uo(t,cr(ao(i,o),r),e)},zu=(t,e,r)=>{const n=Pt(so(e,t)),o=[n[1],-n[0]],i=[o[0]*r,o[1]*r];return{firstPoint:cr(t,i),lastPoint:cr(e,i)}},lo=(t,e)=>{const r=ve(),n=t.geomType;if(n==="CIRCLE"){const f=r(r(t.adaptor()).Circle()),p=f.Radius(),g=f.IsDirect()?1:-1,y=e*g,m=p+y;if(m<1e-10){const A=r(f.Location()),L=[A.X(),A.Y()],D=q=>{const[z,ae]=Pt(so(q,L));return cr(q,[y*z,y*ae])};return{collapsed:!0,firstPoint:D(t.firstPoint),lastPoint:D(t.lastPoint)}}const _=F(),E=new _.gp_Circ2d_3(f.Axis(),m),x=new _.Geom2d_Circle_1(E),k=new _.Geom2d_TrimmedCurve(new _.Handle_Geom2d_Curve_2(x),t.firstParameter,t.lastParameter,!0,!0);return new ge(new _.Handle_Geom2d_Curve_2(k))}if(n==="LINE"){const{firstPoint:f,lastPoint:p}=zu(t.firstPoint,t.lastPoint,e);return Cr(f,p)}const o=F(),i=new ge(new o.Handle_Geom2d_Curve_2(new o.Geom2d_OffsetCurve(t.wrapped,e,!0))),u=ki(i.adaptor());return Gu(u).length?{collapsed:!0,firstPoint:u.firstPoint,lastPoint:u.lastPoint}:u};function Oi(t,e,r){const n=Mu(t.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const o=n>0?-1:1,i=Math.abs(r)*o,u=lo(t,i),c=lo(e,i);if(!(u instanceof ge)||!(c instanceof ge))return null;let f;try{const{intersections:_}=xr(u,c,1e-9);f=_.at(-1)}catch{return null}if(!rn(f))return null;const p=f,g=(_,E)=>{const[x,k]=E.tangentAt(p),A=Pt([-k,x]),L=cr(p,ao(A,i)),D=_.parameter(L,1e-6);return _.splitAt([D])},[y]=g(t,u),[,m]=g(e,c);return{first:y,second:m,center:p}}function co(t,e,r){const n=Oi(t,e,r);if(!n)return console.warn("Cannot fillet between curves",t.repr,e.repr),[t,e];const{first:o,second:i,center:u}=n;return[o,Ri(o.lastPoint,i.firstPoint,u),i]}function fo(t,e,r){const n=Oi(t,e,r);if(!n)return console.warn("Cannot chamfer between curves",t.repr,e.repr),[t,e];const{first:o,second:i}=n;return[o,Cr(o.lastPoint,i.firstPoint),i]}class Vu{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,r){let n=this.length++;for(;n>0;){const o=n-1>>1,i=this.values[o];if(r>=i)break;this.ids[n]=this.ids[o],this.values[n]=i,n=o}this.ids[n]=e,this.values[n]=r}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],o=this.length>>1;let i=0;for(;i<o;){let u=(i<<1)+1;const c=u+1;let f=this.ids[u],p=this.values[u];const g=this.values[c];if(c<this.length&&g<p&&(u=c,f=this.ids[c],p=g),p>=n)break;this.ids[i]=f,this.values[i]=p,i=u}this.ids[i]=r,this.values[i]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Di=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],ho=3;class po{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==ho)throw new Error(`Got v${n>>4} data when expected v${ho}.`);const[o]=new Uint16Array(e,2,1),[i]=new Uint32Array(e,4,1);return new po(i,o,Di[n&15],e)}constructor(e,r=16,n=Float64Array,o){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535);let i=e,u=i;this._levelBounds=[i*4];do i=Math.ceil(i/this.nodeSize),u+=i,this._levelBounds.push(u*4);while(i!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const c=Di.indexOf(this.ArrayType),f=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(c<0)throw new Error(`Unexpected typed array class: ${n}.`);o&&o instanceof ArrayBuffer?(this.data=o,this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+f,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+f+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+f,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(ho<<4)+c]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e),this._queue=new Vu}add(e,r,n,o){const i=this._pos>>2;return this._indices[i]=i,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=o,e<this.minX&&(this.minX=e),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),o>this.maxY&&(this.maxY=o),i}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),o=(1<<16)-1;for(let i=0;i<this.numItems;i++){let u=4*i;const c=this._boxes[u++],f=this._boxes[u++],p=this._boxes[u++],g=this._boxes[u++],y=Math.floor(o*((c+p)/2-this.minX)/e),m=Math.floor(o*((f+g)/2-this.minY)/r);n[i]=Yu(y,m)}vo(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let i=0,u=0;i<this._levelBounds.length-1;i++){const c=this._levelBounds[i];for(;u<c;){const f=u;let p=1/0,g=1/0,y=-1/0,m=-1/0;for(let _=0;_<this.nodeSize&&u<c;_++)p=Math.min(p,this._boxes[u++]),g=Math.min(g,this._boxes[u++]),y=Math.max(y,this._boxes[u++]),m=Math.max(m,this._boxes[u++]);this._indices[this._pos>>2]=f,this._boxes[this._pos++]=p,this._boxes[this._pos++]=g,this._boxes[this._pos++]=y,this._boxes[this._pos++]=m}}}search(e,r,n,o,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let u=this._boxes.length-4;const c=[],f=[];for(;u!==void 0;){const p=Math.min(u+this.nodeSize*4,Mi(u,this._levelBounds));for(let g=u;g<p;g+=4){if(n<this._boxes[g]||o<this._boxes[g+1]||e>this._boxes[g+2]||r>this._boxes[g+3])continue;const y=this._indices[g>>2]|0;u<this.numItems*4?(i===void 0||i(y))&&f.push(y):c.push(y)}u=c.pop()}return f}neighbors(e,r,n=1/0,o=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let u=this._boxes.length-4;const c=this._queue,f=[],p=o*o;for(;u!==void 0;){const g=Math.min(u+this.nodeSize*4,Mi(u,this._levelBounds));for(let y=u;y<g;y+=4){const m=this._indices[y>>2]|0,_=Li(e,this._boxes[y],this._boxes[y+2]),E=Li(r,this._boxes[y+1],this._boxes[y+3]),x=_*_+E*E;u<this.numItems*4?(i===void 0||i(m))&&c.push((m<<1)+1,x):c.push(m<<1,x)}for(;c.length&&c.peek()&1;)if(c.peekValue()>p||(f.push(c.pop()>>1),f.length===n))return c.clear(),f;u=c.pop()>>1}return c.clear(),f}}function Li(t,e,r){return t<e?e-t:t<=r?0:t-r}function Mi(t,e){let r=0,n=e.length-1;for(;r<n;){const o=r+n>>1;e[o]>t?n=o:r=o+1}return e[r]}function vo(t,e,r,n,o,i){if(Math.floor(n/i)>=Math.floor(o/i))return;const u=t[n+o>>1];let c=n-1,f=o+1;for(;;){do c++;while(t[c]<u);do f--;while(t[f]>u);if(c>=f)break;Xu(t,e,r,c,f)}vo(t,e,r,n,f,i),vo(t,e,r,f+1,o,i)}function Xu(t,e,r,n,o){const i=t[n];t[n]=t[o],t[o]=i;const u=4*n,c=4*o,f=e[u],p=e[u+1],g=e[u+2],y=e[u+3];e[u]=e[c],e[u+1]=e[c+1],e[u+2]=e[c+2],e[u+3]=e[c+3],e[c]=f,e[c+1]=p,e[c+2]=g,e[c+3]=y;const m=r[n];r[n]=r[o],r[o]=m}function Yu(t,e){let r=t^e,n=65535^r,o=65535^(t|e),i=t&(e^65535),u=r|n>>1,c=r>>1^r,f=o>>1^n&i>>1^o,p=r&o>>1^i>>1^i;r=u,n=c,o=f,i=p,u=r&r>>2^n&n>>2,c=r&n>>2^n&(r^n)>>2,f^=r&o>>2^n&i>>2,p^=n&o>>2^(r^n)&i>>2,r=u,n=c,o=f,i=p,u=r&r>>4^n&n>>4,c=r&n>>4^n&(r^n)>>4,f^=r&o>>4^n&i>>4,p^=n&o>>4^(r^n)&i>>4,r=u,n=c,o=f,i=p,f^=r&o>>8^n&i>>8,p^=n&o>>8^(r^n)&i>>8,r=f^f>>1,n=p^p>>1;let g=t^e,y=n|65535^(g|r);return g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,(y<<1|g)>>>0}const Ui=(t,e=1e-7)=>{const r=new po(t.length);t.forEach(i=>{const[u,c]=i.firstPoint;r.add(u-e,c-e,u+e,c+e)}),r.finish();const n=[],o=new Set;return t.forEach((i,u)=>{if(o.has(u))return;const c=[i];let f=u;o.add(u);let p=t.length;for(;;){if(p--<0)throw new Error("Infinite loop detected");const g=c[c.length-1].lastPoint,[y,m]=g,_=r.search(y-e,m-e,y+e,m+e),E=L=>Math.abs((f-L)%t.length),x=_.filter(L=>!o.has(L)).map(L=>[t[L],L,E(L)]).sort(([,,L],[,,D])=>E(L)-E(D));if(x.length===0){n.push(c);break}const[k,A]=x[0];c.push(k),o.add(A),f=A}}),n};function rt(t){return Math.round(t*1e5)/1e5}const go=t=>`${sn(t.X())} ${sn(t.Y())}`,kr=(t,e)=>{const r=F(),n=on(t.GetType()),[o,i]=e,u=`${rt(o)} ${rt(i)}`;if(n==="LINE")return`L ${u}`;if(n==="BEZIER_CURVE"){const p=t.Bezier().get(),g=p.Degree();if(g===1)return`L ${u}`;if(g===2)return`Q ${go(p.Pole(2))} ${u}`;if(g===3){const y=go(p.Pole(2)),m=go(p.Pole(3));return`C ${y} ${m} ${u}`}}if(n==="CIRCLE"){const p=t.Circle(),g=p.Radius(),y=t.FirstParameter(),_=(t.LastParameter()-y)*ir,E=_!==360?u:`${rt(o)} ${rt(i+1e-4)}`;return`A ${g} ${g} 0 ${Math.abs(_)>180?"1":"0"} ${p.IsDirect()?"1":"0"} ${E}`}if(n==="ELLIPSE"){const p=t.Ellipse(),g=p.MajorRadius(),y=p.MinorRadius(),m=t.FirstParameter(),E=(t.LastParameter()-m)*ir,x=E!==360?u:`${rt(o)} ${rt(i+1e-4)}`,k=new r.gp_Dir2d_1,A=180-p.XAxis().Direction().Angle(k)*ir;return k.delete(),`A ${rt(g)} ${rt(y)} ${rt(A)} ${Math.abs(E)>180?"1":"0"} ${p.IsDirect()?"1":"0"} ${x}`}if(n==="BSPLINE_CURVE"&&t.BSpline().get().Degree()<4)return Pi(t).map(y=>kr(y.adaptor(),y.lastPoint)).join(" ");const c=ki(t);return Pi(c.adaptor()).map(p=>kr(p.adaptor(),p.lastPoint)).join(" ")},qu={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},an={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class Bi{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(r=>r(this)),this}not(e){const r=new this.constructor;e(r);const n=({element:o})=>!r.shouldKeep(o);return this.filters.push(n),this}either(e){const r=e.map(o=>{const i=new this.constructor;return o(i),i}),n=({element:o})=>r.some(i=>i.shouldKeep(o));return this.filters.push(n),this}find(e,{unique:r=!1}={}){const n=this.applyFilter(e);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class Fi extends Bi{inList(e){const r=({element:n})=>!!e.find(o=>o.isSame(n));return this.filters.push(r),this}atAngleWith(e="Z",r=0){let n;typeof e=="string"?n=new X(qu[e]):n=new X(e);const o=({normal:i})=>{if(!i)return!1;const u=Math.acos(Math.abs(i.dot(n)));return Math.abs(u-$e*r)<1e-6};return this.filters.push(o),this}atDistance(e,r=[0,0,0]){const n=Ce(r),o=F(),i=new o.BRepBuilderAPI_MakeVertex(n),u=i.Vertex();i.delete();const c=new o.BRepExtrema_DistShapeShape_1;c.LoadS1(u);const f=({element:p})=>{const g=ve();c.LoadS2(p.wrapped);const y=g(new o.Message_ProgressRange_1);return c.Perform(y),Math.abs(c.Value()-e)<1e-6};return this.filters.push(f),yi(f)(c),this}containsPoint(e){return this.atDistance(0,e)}inBox(e,r){const n=F(),o=new n.BRepPrimAPI_MakeBox_4(Ce(e),Ce(r)),i=o.Solid();o.delete();const u=new n.BRepExtrema_DistShapeShape_1;u.LoadS1(i);const c=({element:p})=>{const g=ve();u.LoadS2(p.wrapped);const y=g(new n.Message_ProgressRange_1);return u.Perform(y),u.Value()<1e-6},f=yi(c);return f(i),f(u),this.filters.push(c),this}}class un extends Fi{clone(){const e=new un;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const r=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(r),this}ofCurveType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}parallelTo(e){if(typeof e=="string"&&an[e])return this.atAngleWith(an[e],90);if(typeof e!="string"&&e instanceof Xe)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(e,r){const n=e instanceof Xe?ct(e):ct(e,r);this.parallelTo(n);const o=({element:i})=>{const u=i.startPoint,c=u.projectToPlane(n);return u.equals(c)};return this.filters.push(o),this}shouldKeep(e){let r=null;try{r=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:e}))}applyFilter(e){return e.edges.filter(r=>this.shouldKeep(r))}}class mo extends Fi{clone(){const e=new mo;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&an[e])return this.atAngleWith(an[e]);if(typeof e!="string"&&e instanceof Xe)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}inPlane(e,r){const n=e instanceof Xe?ct(e):ct(e,r);this.parallelTo(n);const o=({element:i})=>{const u=i.center,c=u.projectToPlane(n);return u.equals(c)};return this.filters.push(o),this}shouldKeep(e){const r=e.normalAt();return this.filters.every(o=>o({normal:r,element:e}))}applyFilter(e){return e.faces.filter(r=>this.shouldKeep(r))}}const $u=function(t){return t.curves.map((e,r)=>({firstCurve:e,secondCurve:t.curves[(r+1)%t.curves.length],point:e.lastPoint}))},yo=2*Math.PI,Ii=t=>{const e=t%yo,r=e<0?e+yo:e;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-yo)};class ln extends Bi{clone(){const e=new ln;return e.filters=[...this.filters],e}inList(e){const r=({element:n})=>!!e.find(o=>Ne(o,n.point));return this.filters.push(r),this}atDistance(e,r=[0,0]){function n({element:o}){return Math.abs(et(r,o.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function r({element:n}){return Ne(e,n.point)}return this.filters.push(r),this}inBox(e,r){const[n,o]=e,[i,u]=r,c=Math.min(n,i),f=Math.max(n,i),p=Math.min(o,u),g=Math.max(o,u);function y({element:m}){const[_,E]=m.point;return _>=c&&_<=f&&E>=p&&E<=g}return this.filters.push(y),this}ofAngle(e){function r({element:n}){const o=n.firstCurve.tangentAt(1),i=n.secondCurve.tangentAt(0);return Math.abs(Ii(Uu(o,i))-Ii($e*e))<1e-9}return this.filters.push(r),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return $u(e).filter(r=>this.shouldKeep(r))}}const Gi=t=>{const e=F();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[t]},ju=function*(e,r){const n=F(),o=new n.TopExp_Explorer_2(e,Gi(r),Gi("shape")),i=new Map;for(;o.More();){const u=o.Current(),c=u.HashCode(wi);i.get(c)||(i.set(c,!0),yield u),o.Next()}o.delete()},Ni=t=>{if(t.IsNull())throw new Error("This shape has not type, it is null");return t.ShapeType()};class cn extends lt{constructor(e){super(e)}clone(){return new this.constructor(Xt(this.wrapped))}get hashCode(){return this.wrapped.HashCode(wi)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=F(),r=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=be(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,r=0,n=0){const o=typeof e=="number"?[e,r,n]:e,i=be(ku(this.wrapped,o));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,r=[0,0,0],n=[0,0,1]){const o=be(Cu(this.wrapped,e,r,n));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}mirror(e,r){const n=be(Pu(this.wrapped,e,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,r=[0,0,0]){const n=be(Au(this.wrapped,r,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return ju(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(r=>Xt(r))}get edges(){return this._listTopo("edge").map(e=>new Ke(e))}get faces(){return this._listTopo("face").map(e=>new fr(e))}get wires(){return this._listTopo("wire").map(e=>new Rt(e))}get boundingBox(){const e=new xu;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,r,!1)}mesh({tolerance:e=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:e,angularTolerance:r});let n=[],o=[],i=[];const u=[];for(const c of this.faces){const f=c.triangulation(o.length/3);if(!f)continue;const{trianglesIndexes:p,vertices:g,verticesNormals:y}=f;u.push({start:n.length,count:p.length,faceId:c.hashCode}),n=n.concat(p),o=o.concat(g),i=i.concat(y)}return{triangles:n,vertices:o,normals:i,faceGroups:u}}meshEdges({tolerance:e=.001,angularTolerance:r=.1}={}){var n;const o=ve(),i=new Set,u=[],c=[],f=()=>{const g=u.length;let y=null;return[m=>{y?(u.push(...y),y=[m.X(),m.Y(),m.Z()],u.push(...y)):y=[m.X(),m.Y(),m.Z()]},m=>{c.push({start:g/3,count:(u.length-g)/3,edgeId:m}),i.add(m)}]},p=o(new this.oc.TopLoc_Location_1);for(const g of this.faces){const y=o(this.oc.BRep_Tool.Triangulation(g.wrapped,p,0));if(y.IsNull())continue;const m=y.get();for(const _ of g.edges){if(o(_),i.has(_.hashCode))continue;const E=o(new this.oc.TopLoc_Location_1),x=o(this.oc.BRep_Tool.PolygonOnTriangulation_1(_.wrapped,y,E)),k=(n=x?.get())==null?void 0:n.Nodes();if(!k)continue;o(k);const[A,L]=f();for(let D=k.Lower();D<=k.Upper();D++){const q=o(o(m.Node(k.Value(D))).Transformed(E.Transformation()));A(q)}L(_.hashCode)}}for(const g of this.edges){o(g);const y=g.hashCode;if(i.has(y))continue;const m=o(new this.oc.BRepAdaptor_Curve_2(g.wrapped)),_=o(new this.oc.GCPnts_TangentialDeflection_2(m,e,r,2,1e-9,1e-7)),[E,x]=f();for(let k=0;k<_.NbPoints();k++){const A=o(_.Value(k+1).Transformed(p.Transformation()));E(A)}x(y)}return{lines:u,edgeGroups:c}}blobSTEP(){const e="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const o=r.Write(e);if(r.delete(),n.delete(),o===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const i=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([i],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:r});const o="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,o,!n)){const u=this.oc.FS.readFile("/"+o);return this.oc.FS.unlink("/"+o),new Blob([u],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class Hi extends cn{}class Wi extends cn{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),r.delete(),n}get curve(){return new Zu(this._geomAdaptor())}get startPoint(){const e=this.curve,r=e.startPoint;return e.delete(),r}get endPoint(){const e=this.curve,r=e.endPoint;return e.delete(),r}tangentAt(e=0){const r=this.curve,n=r.tangentAt(e);return r.delete(),n}get isClosed(){const e=this.curve,r=e.isClosed;return e.delete(),r}get isPeriodic(){const e=this.curve,r=e.isPeriodic;return e.delete(),r}get period(){const e=this.curve,r=e.period;return e.delete(),r}get geomType(){const e=this.curve,r=e.curveType;return e.delete(),r}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const r=e.Mass();return e.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class Zu extends lt{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),r.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return on(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new X(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new X(e)}tangentAt(e){let r=e;e||(r=(this.wrapped.LastParameter()-this.wrapped.FirstParameter())/2);const n=new this.oc.gp_Pnt_1,o=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,o);const i=new X(o);return n.delete(),o.delete(),i}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class Ke extends Wi{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class Rt extends Wi{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},o=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);o.Perform(e,0);const i=be(o.Shape());if(o.delete(),this.delete(),!(i instanceof Rt))throw new Error("Could not offset with a wire");return i}}class Ku extends lt{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class fr extends cn{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new Ku(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,r=e.surfaceType;return e.delete(),r}get UVBounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,r,n,o),{uMin:e.current,uMax:r.current,vMin:n.current,vMax:o.current}}pointOnSurface(e,r){const{uMin:n,uMax:o,vMin:i,vMax:u}=this.UVBounds,c=this._geomAdaptor(),f=new this.oc.gp_Pnt_1,p=e*(o-n)+n,g=r*(u-i)+i;c.D0(p,g,f);const y=new X(f);return c.delete(),f.delete(),y}normalAt(e){let r=0,n=0;const o=ve();if(e){const p=o(this.oc.BRep_Tool.Surface_2(this.wrapped)),g=o(new this.oc.GeomAPI_ProjectPointOnSurf_2(o(Ce(e)),p,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),y={current:0},m={current:0};g.LowerDistanceParameters(y,m),r=y.current,n=m.current}else{const{uMin:p,uMax:g,vMin:y,vMax:m}=this.UVBounds;r=.5*(p+g),n=.5*(y+m)}const i=o(new this.oc.gp_Pnt_1),u=o(new this.oc.gp_Vec_1);return o(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,i,u),new X(u)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const r=new X(e.CentreOfMass());return e.delete(),r}outerWire(){const e=new Rt(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),r=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),r}triangulation(e=0){const r=ve(),n=r(new this.oc.TopLoc_Location_1),o=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(o.IsNull())return null;const i=r(n.Transformation()),u={vertices:[],trianglesIndexes:[],verticesNormals:[]},c=o.get(),f=c.NbNodes();u.vertices=new Array(f*3);for(let E=1;E<=f;E++){const x=r(r(c.Node(E)).Transformed(i));u.vertices[(E-1)*3+0]=x.X(),u.vertices[(E-1)*3+1]=x.Y(),u.vertices[(E-1)*3+2]=x.Z()}const p=r(new this.oc.TColgp_Array1OfDir_2(1,f)),g=r(new this.oc.Poly_Connect_2(o));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,g,p),u.verticesNormals=new Array(p.Length()*3);for(let E=p.Lower();E<=p.Upper();E++){const x=r(r(p.Value(E)).Transformed(i));u.verticesNormals[(E-1)*3+0]=x.X(),u.verticesNormals[(E-1)*3+1]=x.Y(),u.verticesNormals[(E-1)*3+2]=x.Z()}const y=this.orientation,m=c.NbTriangles();u.trianglesIndexes=new Array(m*3);let _=0;for(let E=1;E<=m;E++){const x=r(c.Triangle(E));let k=x.Value(1),A=x.Value(2);const L=x.Value(3);if(y==="backward"){const D=k;k=A,A=D}u.trianglesIndexes[_*3+0]=k-1+e,u.trianglesIndexes[_*3+1]=A-1+e,u.trianglesIndexes[_*3+2]=L-1+e,_++}return u}}class fn extends cn{fuse(e,{optimisation:r="none"}={}){const n=ve(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const u=be(i.Shape());if(!vt(u))throw new Error("Could not fuse as a 3d shape");return u}cut(e,{optimisation:r="none"}={}){const n=ve(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const u=be(i.Shape());if(!vt(u))throw new Error("Could not cut as a 3d shape");return u}intersect(e){const r=ve(),n=r(new this.oc.Message_ProgressRange_1),o=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));o.Build(n),o.SimplifyResult(!0,!0,.001);const i=be(o.Shape());if(!vt(i))throw new Error("Could not intersect as a 3d shape");return i}shell(e,r=null,n=.001){const o=typeof r=="number"?r:n;let i,u;if(typeof e=="number"){u=e;const _=new mo;i=typeof r=="function"?r(_):_}else u=e.thickness,i=e.filter;const c=ve(),f=i.find(this),p=c(new this.oc.TopTools_ListOfShape_1);f.forEach(_=>{p.Append_1(_.wrapped)});const g=c(new this.oc.Message_ProgressRange_1),y=c(new this.oc.BRepOffsetAPI_MakeThickSolid);y.MakeThickSolidByJoin(this.wrapped,p,-u,o,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,g);const m=be(y.Shape());if(!vt(m))throw new Error("Could not shell as a 3d shape");return m}_builderIter(e,r){if(typeof e=="number"){let u=0;for(const c of this._iterTopo("edge"))r(e,Xt(c)),u+=1;return u}let n,o=null;typeof e=="function"?n=e:(n=u=>e.filter.shouldKeep(u)?e.radius||1:0,e.filter&&!e.keep&&(o=()=>e.filter.delete()));let i=0;for(const u of this._iterTopo("edge")){const c=Xt(u),f=new Ke(c),p=n(f);p&&(r(p,c),i+=1),f.delete()}return o&&o(),i}fillet(e,r){const o=ve()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new un)}),!this._builderIter(i,(f,p)=>o.Add_2(f,p)))throw new Error("Could not fillet, no edge was selected");const c=be(o.Shape());if(!vt(c))throw new Error("Could not fillet as a 3d shape");return c}chamfer(e,r){const o=ve()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new un)}),!this._builderIter(i,(f,p)=>o.Add_2(f,p)))throw new Error("Could not chamfer, no edge was selected");const c=be(o.Shape());if(!vt(c))throw new Error("Could not chamfer as a 3d shape");return c}}class zi extends fn{}class Pr extends fn{}class Vi extends fn{}class Xi extends fn{}function vt(t){return t instanceof zi||t instanceof Pr||t instanceof Vi||t instanceof Xi}function Yi(t){return t instanceof Rt}function Xt(t){const e=F(),r=e.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,e.TopoDS.Edge_1],[r.TopAbs_WIRE,e.TopoDS.Wire_1],[r.TopAbs_FACE,e.TopoDS.Face_1],[r.TopAbs_SHELL,e.TopoDS.Shell_1],[r.TopAbs_SOLID,e.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),o=Ni(t),i=n.get(o);if(!i)throw new Error("Could not find a wrapper for this shape type");return i(t)}function be(t){const r=F().TopAbs_ShapeEnum,o=new Map([[r.TopAbs_VERTEX,Hi],[r.TopAbs_EDGE,Ke],[r.TopAbs_WIRE,Rt],[r.TopAbs_FACE,fr],[r.TopAbs_SHELL,zi],[r.TopAbs_SOLID,Pr],[r.TopAbs_COMPSOLID,Vi],[r.TopAbs_COMPOUND,Xi]]).get(Ni(t));if(!o)throw new Error("Could not find a wrapper for this shape type");return new o(Xt(t))}const hn=(t,e)=>{const r=F();return new Ke(new r.BRepBuilderAPI_MakeEdge_3(Ce(t),Ce(e)).Edge())},Qu=(t,e=[0,0,0],r=[0,0,1])=>{const n=F(),[o,i]=ce(),u=o(sr(e,r)),c=o(new n.gp_Circ_2(u,t)),f=o(new n.BRepBuilderAPI_MakeEdge_8(c)),p=new Ke(f.Edge());return i(),p},Ju=(t,e,r,n=[0,0,0],o=[0,0,1],i=!1)=>{const u=F(),[c,f]=ce();let p=2*Math.PI;i&&(p=-2*Math.PI);const g=c(new u.Geom2d_Line_3(c(new u.gp_Pnt2d_3(0,0)),c(new u.gp_Dir2d_4(p,t)))),y=e/t,m=g.Value(0),_=g.Value(y*Math.sqrt((2*Math.PI)**2+t**2)),E=c(new u.GCE2d_MakeSegment_1(m,_)),x=new u.Geom_CylindricalSurface_1(c(_r(n,o)),r),k=c(new u.BRepBuilderAPI_MakeEdge_30(c(new u.Handle_Geom2d_Curve_2(E.Value().get())),c(new u.Handle_Geom_Surface_2(x)))).Edge(),A=c(new u.BRepBuilderAPI_MakeWire_2(k)).Wire();return u.BRepLib.BuildCurves3d_2(A),f(),new Ke(A)},qi=(t,e,r)=>{const n=F(),o=new n.GC_MakeArcOfCircle_4(Ce(t),Ce(e),Ce(r)).Value(),i=new n.Handle_Geom_Curve_2(o.get());return new Ke(new n.BRepBuilderAPI_MakeEdge_24(i).Edge())},el=(t,e,r,n,o=[0,0,0],i=[0,0,1],u)=>{const c=F(),[f,p]=ce(),g=f(sr(o,i,u));if(e>t)throw new Error("The minor radius must be smaller than the major one");const y=f(new c.gp_Elips_2(g,t,e)),m=f(new c.BRepBuilderAPI_MakeEdge_13(y,r,n)),_=new Ke(m.Edge());return p(),_},$i=t=>{const e=F(),r=new e.TColgp_Array1OfPnt_2(1,t.length);t.forEach((i,u)=>{r.SetValue(u+1,Ce(i))});const n=new e.Geom_BezierCurve_1(r),o=new e.Handle_Geom_Curve_2(n);return new Ke(new e.BRepBuilderAPI_MakeEdge_24(o).Edge())},tl=(t,e,r)=>{const n=F(),[o,i]=ce(),u=o(new n.GC_MakeArcOfCircle_5(o(Ce(t)),new X(e).wrapped,o(Ce(r))).Value()),c=o(new n.Handle_Geom_Curve_2(u.get())),f=new Ke(o(new n.BRepBuilderAPI_MakeEdge_24(c)).Edge());return i(),f},Yt=t=>{const e=F(),r=new e.BRepBuilderAPI_MakeWire_1;t.forEach(u=>{u instanceof Ke&&r.Add_1(u.wrapped),u instanceof Rt&&r.Add_2(u.wrapped)});const n=new e.Message_ProgressRange_1;r.Build(n);const o=r.Error();if(o!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const u=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${u.get(o)||"unknown error"}`)}const i=new Rt(r.Wire());return r.delete(),n.delete(),i},pn=(t,e)=>{const r=F(),n=new r.BRepBuilderAPI_MakeFace_15(t.wrapped,!1);if(e?.forEach(i=>{n.Add(i.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const o=n.Face();return n.delete(),new fr(o)},rl=(t,e)=>{const r=F(),[n,o]=ce(),i=n(r.BRep_Tool.Surface_2(t.wrapped)),c=n(new r.BRepBuilderAPI_MakeFace_21(i,e.wrapped,!0)).Face();return o(),new fr(c)},ji=(t,e,r=[0,0,0],n=[0,0,1])=>{const o=F(),i=sr(r,n),u=new o.BRepPrimAPI_MakeCylinder_3(i,t,e),c=new Pr(u.Shape());return i.delete(),u.delete(),c},Zi=t=>{const e=F(),r=Ce(t),n=new e.BRepBuilderAPI_MakeVertex(r),o=n.Vertex();return n.delete(),new Hi(o)},Ar=t=>{const e=F(),r=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return r.MakeCompound(n),t.forEach(i=>{r.Add(n,i.wrapped),i.delete()}),be(n)};function Ki(t){const e=F(),[r,n]=ce(),o=r(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));t.forEach(({wrapped:c})=>{o.Add(c)}),o.Perform(r(new e.Message_ProgressRange_1));const i=r(Xt(o.SewedShape())),u=be(r(new e.ShapeFix_Solid_1).SolidFromShell(i));if(n(),!(u instanceof Pr))throw new Error("Could not make a solid of faces and shells");return u}const Qi=(t,e)=>{const r=F(),[n,o]=ce(),i=n(new r.BRepBuilderAPI_MakeFace_2(t.wrapped));e.forEach(p=>{i.Add(p.wrapped)});const u=n(i.Face()),c=n(new r.ShapeFix_Face_2(u));c.FixOrientation_1();const f=c.Face();return o(),new fr(f)},nl=t=>t==="symmetric"||typeof t=="number"||Array.isArray(t)&&t.length===2,Ji=t=>{let e;t?nl(t)?e={endTangent:t}:e={endTangent:0,...t}:e={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:o=1,startTangent:i}=e;let u;typeof r=="number"?u=At(1,r*$e):u=r;let c;return typeof i=="number"?c=At(1,i*$e):c=i,{endTangent:u,startFactor:n,endFactor:o,startTangent:c}};function es(t,e,r,n){const o=t*r+e*n,i=Math.sqrt((t*t+e*e)*(r*r+n*n));let u=Math.acos(o/i);return t*n-e*r<0&&(u=-u),u}function ts([t,e],[r,n],o,i,u,c,f){const p=Math.PI*2;if(o<0&&(o=-o),i<0&&(i=-i),o==0||i==0)throw Error("rx and ry can not be 0");const g=Math.sin(u),y=Math.cos(u),m=(t-r)/2,_=(e-n)/2,E=(t+r)/2,x=(e+n)/2,k=y*m+g*_,A=y*_-g*m,L=k*k/(o*o)+A*A/(i*i);L>1&&(o=o*Math.sqrt(L),i=i*Math.sqrt(L));const D=o*i,q=o*A,z=i*k,ae=q*q+z*z;if(!ae)throw Error("start point can not be same as end point");let te=Math.sqrt(Math.abs((D*D-ae)/ae));c==f&&(te=-te);const ee=te*q/i,pe=-te*z/o,Oe=y*ee-g*pe+E,Ie=g*ee+y*pe+x,We=(k-ee)/o,Me=(k+ee)/o,se=(A-pe)/i,Ee=(A+pe)/i,ke=es(1,0,We,se);let fe=es(We,se,-Me,-Ee);for(;fe>p;)fe-=p;for(;fe<0;)fe+=p;f||(fe-=p);let me=ke+fe;for(;me>p;)me-=p;for(;me<0;)me+=p;return{cx:Oe,cy:Ie,startAngle:ke,deltaAngle:fe,endAngle:me,clockwise:!!f,rx:o,ry:i}}const rs=(t,e)=>{const r=F(),n=new r.BRepPrimAPI_MakePrism_1(t.wrapped,e.wrapped,!1,!0),o=new Pr(Xt(n.Shape()));return n.delete(),o},ns=(t,e=[0,0,0],r=[0,0,1],n=360)=>{const o=F(),i=bi(e,r),u=new o.BRepPrimAPI_MakeRevol_1(t.wrapped,i,n*$e,!1),c=be(u.Shape());if(i.delete(),u.delete(),!vt(c))throw new Error("Could not revolve to a 3d shape");return c};function Rr(t,e,{frenet:r=!1,auxiliarySpine:n,law:o=null,transitionMode:i="right",withContact:u,support:c,forceProfileSpineOthogonality:f}={},p=!1){const g=F(),y=i==="round"?!0:!!f,m=new g.BRepOffsetAPI_MakePipeShell(e.wrapped);if(i){const x={transformed:g.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:g.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:g.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[i];x&&m.SetTransitionMode(x)}c?m.SetMode_4(c):r&&m.SetMode_1(r),n&&m.SetMode_5(n.wrapped,!1,g.BRepFill_TypeOfContact.BRepFill_NoContact),o?m.SetLaw_1(t.wrapped,o,!!u,y):m.Add_1(t.wrapped,!!u,y);const _=new g.Message_ProgressRange_1;m.Build(_),p||m.MakeSolid();const E=be(m.Shape());if(!vt(E))throw new Error("Could not sweep to a 3d shape");if(p){const x=be(m.FirstShape()),k=be(m.LastShape());if(!Yi(x))throw new Error("Could not sweep with one start wire");if(!Yi(k))throw new Error("Could not sweep with one end wire");return m.delete(),[E,x,k]}return m.delete(),_.delete(),E}const os=(t,{profile:e,endFactor:r=1})=>{let n;const o=F();if(e==="s-curve")n=new o.Law_S,n.Set_1(0,1,t,r);else if(e==="linear")n=new o.Law_Linear,n.Set(0,1,t,r);else throw new Error("Could not generate a law function");return n.Trim(0,t,1e-6)};function is(t,e,r,n,o=!1){const i=new X(e),u=new X(r),c=hn(i,i.add(u)),f=Yt([c]),p=n?os(u.Length,n):null;return o?Rr(t,f,{law:p},o):Rr(t,f,{law:p},o)}function ss(t,e,r,n,o,i=!1){const u=new X(r),c=new X(n),f=hn(u,u.add(c)),p=Yt([f]),g=360/e*c.Length,y=1,m=Ju(g,c.Length,y,r,n),_=o?os(c.Length,o):null;return i?Rr(t,p,{auxiliarySpine:m,law:_},i):Rr(t,p,{auxiliarySpine:m,law:_},i)}const ol=(t,{ruled:e=!0,startPoint:r,endPoint:n}={},o=!1)=>{const i=F(),[u,c]=ce(),f=u(new i.BRepOffsetAPI_ThruSections(!o,e,1e-6));r&&f.AddVertex(u(Zi(r)).wrapped),t.forEach(y=>f.AddWire(y.wrapped)),n&&f.AddVertex(u(Zi(n)).wrapped);const p=u(new i.Message_ProgressRange_1);f.Build(p);const g=be(f.Shape());if(c(),!vt(g))throw new Error("Could not loft to a 3d shape");return g};class qt{constructor(e,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new qt(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new X(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new X(e)}face(){let e;return this.baseFace?e=rl(this.baseFace,this.wire):e=pn(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:r}={}){const n=pn(this.wire),o=ns(n,r||this.defaultOrigin,e);return n.delete(),this.delete(),o}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const[u,c]=ce(),f=u(new X(r||this.defaultDirection).normalized().multiply(e));if(n&&!o){const y=is(this.wire,i||this.defaultOrigin,f,n);return c(),this.delete(),y}if(o){const y=ss(this.wire,o,i||this.defaultOrigin,f,n);return c(),this.delete(),y}const p=pn(this.wire),g=rs(p,f);return c(),this.delete(),g}sweepSketch(e,r={}){const n=this.wire.startPoint,o=this.wire.tangentAt(1e-9).multiply(-1).normalize(),i=o.cross(this.defaultDirection).multiply(-1),u=e(new Xe(n,i,o),n),c={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(c.support=this.baseFace.wrapped);const f=Rr(u.wire,this.wire,c);return this.delete(),f}loftWith(e,r={},n=!1){const o=Array.isArray(e)?[this,...e]:[this,e],i=ol(o.map(u=>u.wire),r,n);return o.forEach(u=>u.delete()),i}}class dn{constructor(e,r){this.plane=e instanceof Xe?ct(e):ct(e,r),this.pointer=new X(this.plane.origin),this.firstPoint=new X(this.plane.origin),this.pendingEdges=[],this._mirrorWire=!1}delete(){this.plane.delete()}_updatePointer(e){this.pointer=e}movePointerTo([e,r]){if(this.pendingEdges.length)throw new Error("You can only move the pointer if there is no edge defined");return this._updatePointer(this.plane.toWorldCoords([e,r])),this.firstPoint=new X(this.pointer),this}lineTo([e,r]){const n=this.plane.toWorldCoords([e,r]);return this.pendingEdges.push(hn(this.pointer,n)),this._updatePointer(n),this}line(e,r){const n=this.plane.toLocalCoords(this.pointer);return this.lineTo([e+n.x,r+n.y])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){const r=this.plane.toLocalCoords(this.pointer);return this.lineTo([r.x,e])}hLineTo(e){const r=this.plane.toLocalCoords(this.pointer);return this.lineTo([e,r.y])}polarLine(e,r){const n=r*$e,[o,i]=At(e,n);return this.line(o,i)}polarLineTo([e,r]){const n=r*$e,o=At(e,n);return this.lineTo(o)}tangentLine(e){const[r,n]=ce(),o=this.pendingEdges.length?this.pendingEdges[this.pendingEdges.length-1]:null;if(!o)throw new Error("you need a previous edge to create a tangent line");const i=r(o.tangentAt(1)),u=r(i.normalized().multiply(e)).add(this.pointer);return this.pendingEdges.push(hn(this.pointer,u)),this._updatePointer(u),n(),this}threePointsArcTo(e,r){const n=this.plane.toWorldCoords(r),o=this.plane.toWorldCoords(e);return this.pendingEdges.push(qi(this.pointer,n,o)),this._updatePointer(o),this}threePointsArc(e,r,n,o){const i=this.plane.toLocalCoords(this.pointer);return this.threePointsArcTo([i.x+e,i.y+r],[i.x+n,i.y+o])}tangentArcTo(e){const r=this.plane.toWorldCoords(e),n=this.pendingEdges[this.pendingEdges.length-1];return this.pendingEdges.push(tl(n.endPoint,n.tangentAt(1),r)),this._updatePointer(r),this}tangentArc(e,r){const n=this.plane.toLocalCoords(this.pointer);return this.tangentArcTo([e+n.x,r+n.y])}sagittaArcTo(e,r){const n=this.pointer,o=this.plane.toWorldCoords(e);let i=o.add(n);const u=i.multiply(.5);i=o.sub(n);const f=i.cross(this.plane.zDir).normalized().multiply(r),p=u.add(f);return this.pendingEdges.push(qi(this.pointer,p,o)),this._updatePointer(o),this}sagittaArc(e,r,n){const o=this.plane.toLocalCoords(this.pointer);return this.sagittaArcTo([e+o.x,r+o.y],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=this.plane.toLocalCoords(this.pointer),o=et([n.x,n.y],e)/2,i=-r*o;return this.sagittaArcTo(e,i)}bulgeArc(e,r,n){const o=this.plane.toLocalCoords(this.pointer);return this.bulgeArcTo([e+o.x,r+this.pointer.y],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}ellipseTo(e,r,n,o=0,i=!1,u=!1){const[c,f]=ce(),p=this.plane.toLocalCoords(this.pointer);let g=o,y=r,m=n;r<n&&(g=o+90,y=n,m=r);const{cx:_,cy:E,rx:x,ry:k,startAngle:A,endAngle:L,clockwise:D}=ts([p.x,p.y],e,y,m,g*$e,i,u),q=c(new X(this.plane.xDir).rotate(g,this.plane.origin,this.plane.zDir)),z=el(x,k,D?A:L,D?L:A,c(this.plane.toWorldCoords([_,E])),this.plane.zDir,q);return D||z.wrapped.Reverse(),this.pendingEdges.push(z),this._updatePointer(this.plane.toWorldCoords(e)),f(),this}ellipse(e,r,n,o,i=0,u=!1,c=!1){const f=this.plane.toLocalCoords(this.pointer);return this.ellipseTo([e+f.x,r+f.y],n,o,i,u,c)}halfEllipseTo(e,r,n=!1){const o=this.plane.toLocalCoords(this.pointer),i=[o.x,o.y],u=Ci(e,i),c=et(e,i);return this.ellipseTo(e,c/2,r,u*ir,!1,n)}halfEllipse(e,r,n,o=!1){const i=this.plane.toLocalCoords(this.pointer);return this.halfEllipseTo([e+i.x,r+i.y],n,o)}bezierCurveTo(e,r){let n;r.length===2&&!Array.isArray(r[0])?n=[r]:n=r;const o=n.map(u=>this.plane.toWorldCoords(u)),i=this.plane.toWorldCoords(e);return this.pendingEdges.push($i([this.pointer,...o,i])),this._updatePointer(i),this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const[n,o]=ce(),{endTangent:i,startTangent:u,startFactor:c,endFactor:f}=Ji(r),p=this.plane.toWorldCoords(e),g=this.pendingEdges.length?this.pendingEdges[this.pendingEdges.length-1]:null,y=n(p.sub(this.pointer)).Length*.25;let m;if(u)m=this.plane.toWorldCoords(u);else if(!g)m=this.plane.toWorldCoords([1,0]);else if(g.geomType==="BEZIER_CURVE"){const L=n(g.curve).wrapped.Bezier().get(),D=n(new X(L.Pole(L.NbPoles()-1)));m=n(this.pointer.sub(D))}else m=n(g.tangentAt(1));const _=n(m.normalized().multiply(c*y)),E=n(this.pointer.add(_));let x;i==="symmetric"?x=n(m.multiply(-1)):x=n(this.plane.toWorldCoords(i));const k=n(x.normalized().multiply(f*y)),A=n(p.sub(k));return this.pendingEdges.push($i([this.pointer,E,A,p])),this._updatePointer(p),o(),this}smoothSpline(e,r,n={}){const o=this.plane.toLocalCoords(this.pointer);return this.smoothSplineTo([e+o.x,r+o.y],n)}_mirrorWireOnStartEnd(e){const n=this.pointer.sub(this.firstPoint).normalize().cross(this.plane.zDir),o=e.clone().mirror(n,this.pointer);return Yt([e,o])}buildWire(){if(!this.pendingEdges.length)throw new Error("No lines to convert into a wire");let e=Yt(this.pendingEdges);return this._mirrorWire&&(e=this._mirrorWireOnStartEnd(e)),e}_closeSketch(){if(!this.pointer.equals(this.firstPoint)&&!this._mirrorWire){const e=this.plane.toLocalCoords(this.firstPoint);this.lineTo([e.x,e.y])}}done(){return new qt(this.buildWire(),{defaultOrigin:this.plane.origin,defaultDirection:this.plane.zDir})}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._mirrorWire=!0,this.close()}}const il=t=>{const e=F(),r=new e.Bnd_Box2d;return t.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new Tr(r)};function sl(t,e){const[r,n]=ce(),o=r(sr(e.origin,e.zDir,e.xDir)),i=F(),u=t.map(c=>{const f=i.GeomLib.To3d(o,c.wrapped);return new Ke(new i.BRepBuilderAPI_MakeEdge_24(f).Edge())});return n(),u}const al=(t,e)=>{const[r,n]=ce(),o=F(),i=t.map(u=>{const c=r(new o.BRepBuilderAPI_MakeEdge_30(u.wrapped,e));return new Ke(c.Edge())});return n(),i},as=(t,e)=>{const r=F();return t.map(o=>e?new ge(r.GeomLib.GTransform(o.wrapped,e)):o.clone())};class Or extends lt{transformCurves(e){return as(e,this.wrapped)}}const us=(t,e,r=[0,0])=>{const n=F(),o=lr(r,e),i=new n.gp_GTrsf2d_1;return i.SetAffinity(o,t),o.delete(),new Or(i)},ul=t=>{const e=F(),[r,n]=ce(),o=new e.gp_Trsf2d_1;o.SetTranslation_1(r(xi(t)));const i=new e.gp_GTrsf2d_2(o);return n(),new Or(i)},ll=(t,e=[0,0],r="center")=>{const n=F(),[o,i]=ce(),u=new n.gp_Trsf2d_1;r==="center"?u.SetMirror_1(o(Fe(t))):u.SetMirror_2(o(lr(e,t)));const c=new n.gp_GTrsf2d_2(u);return i(),new Or(c)},cl=(t,e=[0,0])=>{const r=F(),[n,o]=ce(),i=new r.gp_Trsf2d_1;i.SetRotation(n(Fe(e)),t);const u=new r.gp_GTrsf2d_2(i);return o(),new Or(u)},fl=(t,e=[0,0])=>{const r=F(),[n,o]=ce(),i=new r.gp_Trsf2d_1;i.SetScale(n(Fe(e)),t);const u=new r.gp_GTrsf2d_2(i);return o(),new Or(u)};function hl(t,e,r="original"){const[n,o]=ce(),i=F();let u=n(i.BRep_Tool.Surface_2(e.wrapped));const c=e.UVBounds;let f=null;const p=n(lr([0,0],[0,1])),g=n(lr([0,0],[1,0]));if(r==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const _=n(u.get().Cylinder());_.Direct()||(u=u.get().UReversed());const E=_.Radius();f=us(1/E,[0,1]).wrapped}if(r==="bounds"){if(f=n(new i.gp_GTrsf2d_1),f.SetAffinity(p,c.uMax-c.uMin),c.uMin!==0){const E=n(new i.gp_GTrsf2d_1);E.SetTranslationPart(new i.gp_XY_2(0,-c.uMin)),f.Multiply(E)}const _=n(new i.gp_GTrsf2d_1);if(_.SetAffinity(g,c.vMax-c.vMin),f.Multiply(_),c.vMin!==0){const E=n(new i.gp_GTrsf2d_1);E.SetTranslationPart(n(new i.gp_XY_2(0,-c.vMin))),f.Multiply(E)}}const y=as(t,f),m=al(y,u);return o(),m}function pl(t,e){const r=F(),o=ve()(new r.BRepAdaptor_Curve2d_2(t.wrapped,e.wrapped)),i=new r.Geom2d_TrimmedCurve(o.Curve(),o.FirstParameter(),o.LastParameter(),!0,!0);return t.orientation==="backward"&&i.Reverse(),new ge(new r.Handle_Geom2d_Curve_2(i))}const vn=(t,e=1)=>{const r=t.bounds[0][0]-e,n=-t.bounds[1][1]-e;return`${r} ${n} ${t.width+2*e} ${t.height+2*e}`},wo=(t,e,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${vn(e,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${t}
</svg>`;class Q{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new Q(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=il(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=e.map((n,o)=>{const i=e[(o+1)%e.length];return(i[0]-n[0])*(i[1]+n[1])}).reduce((n,o)=>n+o,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,r,n=[0,0]){const o=us(e,r,n).transformCurves(this.curves);return new Q(o)}scale(e,r){const n=r||this.boundingBox.center,o=fl(e,n).transformCurves(this.curves);return new Q(o)}rotate(e,r){const n=cl(e*$e,r).transformCurves(this.curves);return new Q(n)}translate(e,r=0){const n=rn(e)?e:[e,r],o=ul(n).transformCurves(this.curves);return new Q(o)}mirror(e,r=[0,0],n="center"){const o=ll(e,r,n).transformCurves(this.curves);return new Q(o)}sketchOnPlane(e,r){const n=e instanceof Xe?ct(e):ct(e,r),o=sl(this.curves,n),i=Yt(o);return new qt(i,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,r){const n=F(),o=hl(this.curves,e,r),i=Yt(o);n.BRepLib.BuildCurves3d_2(i.wrapped);const u=new n.ShapeFix_Wire_2(i.wrapped,e.wrapped,1e-9);u.FixEdgeCurves(),u.delete();const c=new qt(i);if(i.isClosed){const f=c.clone().face();c.defaultOrigin=f.pointOnSurface(.5,.5),c.defaultDirection=f.normalAt(),f.orientation!==e.orientation&&(c.defaultDirection=c.defaultDirection.multiply(-1)),c.baseFace=e}else{const f=i.startPoint;c.defaultOrigin=f,c.defaultDirection=e.normalAt(f),c.baseFace=e}return c}toSVGPathD(){const e=ve(),r=this.clone().mirror([1,0],[0,0],"plane"),n=r.curves.flatMap(u=>{if((u.geomType==="ELLIPSE"||u.geomType==="CIRCLE")&&Ne(u.firstPoint,u.lastPoint)){const[c,f]=u.splitAt([.5]);return[kr(e(c.adaptor()),c.lastPoint),kr(e(f.adaptor()),f.lastPoint)]}return kr(e(u.adaptor()),u.lastPoint)}),[o,i]=r.curves[0].firstPoint;return`M ${rt(o)} ${rt(i)} ${n.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return vn(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return wo(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const r=F(),n=new r.Geom2dAPI_InterCurveCurve_1,o=Cr(e,this.boundingBox.outsidePoint());let i=0;return this.curves.find(c=>c.isOnCurve(e))?!1:(this.curves.forEach(c=>{c.boundingBox.isOut(o.boundingBox)||(n.Init_1(o.wrapped,c.wrapped,1e-9),i+=n.NbPoints())}),n.delete(),!!(i%2))}isClosed(){return Ne(this.firstPoint,this.lastPoint)}intersects(e){const r=F(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const o of this.curves)for(const i of e.curves)if(!o.boundingBox.isOut(i.boundingBox)&&(n.Init_1(o.wrapped,i.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class dl{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,r]){return[e,r]}_convertFromUV([e,r]){return[e,r]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?fo:co;this.pendingCurves.push(...n(r,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const r=Cr(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(r),this}line(e,r){return this.lineTo([this.pointer[0]+e,this.pointer[1]+r])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,r]){const n=r*$e,o=At(e,n);return this.lineTo(o)}polarLine(e,r){const n=r*$e,[o,i]=At(e,n);return this.line(o,i)}tangentLine(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=Pt(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,r){return this.saveCurve(uo(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,r,n,o){const[i,u]=this.pointer;return this.threePointsArcTo([i+e,u+r],[i+n,u+o])}sagittaArcTo(e,r){const[n,o]=this.pointer,[i,u]=e,c=[(n+i)/2,(o+u)/2],f=[-(u-o),i-n],p=Math.sqrt(f[0]**2+f[1]**2),g=[c[0]+f[0]/p*r,c[1]+f[1]/p*r];return this.saveCurve(uo(this._convertToUV(this.pointer),this._convertToUV(g),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,r,n){return this.sagittaArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=et(this.pointer,e)/2,o=-r*n;return this.sagittaArcTo(e,o)}bulgeArc(e,r,n){return this.bulgeArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}tangentArcTo(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(Nu(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,r){const[n,o]=this.pointer;return this.tangentArcTo([e+n,r+o])}ellipseTo(e,r,n,o=0,i=!1,u=!1){let c=o,f=r,p=n;r<n&&(c=o+90,f=n,p=r);const g=c*$e,y=ee=>et(this._convertToUV(ee)),m=y(At(f,g)),_=y(At(p,g+Math.PI/2)),E=Pt(this._convertToUV(Bu([1,0],g))),[,x]=Fu(E),{cx:k,cy:A,startAngle:L,endAngle:D,clockwise:q,rx:z,ry:ae}=ts(this._convertToUV(this.pointer),this._convertToUV(e),m,_,x,i,u),te=Hu(z,ae,q?L:D,q?D:L,[k,A],E);return q||te.reverse(),this.saveCurve(te),this.pointer=e,this}ellipse(e,r,n,o,i=0,u=!1,c=!1){const[f,p]=this.pointer;return this.ellipseTo([e+f,r+p],n,o,i,u,c)}halfEllipseTo(e,r,n=!1){const o=Ci(e,this.pointer),i=et(e,this.pointer);return this.ellipseTo(e,i/2,r,o*ir,!0,n)}halfEllipse(e,r,n,o=!1){const[i,u]=this.pointer;return this.halfEllipseTo([i+e,u+r],n,o)}bezierCurveTo(e,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(Wu(this._convertToUV(this.pointer),n.map(o=>this._convertToUV(o)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const{endTangent:n,startTangent:o,startFactor:i,endFactor:u}=Ji(r),c=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,f=et(this.pointer,e)*.25;let p;o?p=o:c?p=this._convertFromUV(c.tangentAt(1)):p=[1,0],p=Pt(p);const g=[this.pointer[0]+p[0]*i*f,this.pointer[1]+p[1]*i*f];let y;n==="symmetric"?y=[-p[0],-p[1]]:y=n,y=Pt(y);const m=[e[0]-y[0]*u*f,e[1]-y[1]*u*f];return this.cubicBezierCurveTo(e,g,m)}smoothSpline(e,r,n){return this.smoothSplineTo([e+this.pointer[0],r+this.pointer[1]],n)}customCorner(e,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:e},this}_customCornerLastWithFirst(e,r="fillet"){if(!e)return;const n=this.pendingCurves.pop(),o=this.pendingCurves.shift();if(!n||!o)throw new Error("Not enough curves to close and fillet");const i=r==="chamfer"?fo:co;this.pendingCurves.push(...i(n,o,e))}_closeSketch(){Ne(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(Ne(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=lr(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(o=>new ge(o.innerCurve.Mirrored_2(r)));n.reverse(),n.map(o=>o.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}class vl extends dl{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Q(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}const bo=(t,e,r)=>new dn().movePointerTo([-t/2,e/2]).hLine(t).vLine(-e).hLine(-t).close().extrude(r),gl=t=>{const e=F(),r=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);t.forEach((i,u)=>{i.edges.forEach(c=>{r.Add_1(c.wrapped,e.GeomAbs_Shape.GeomAbs_C0,u===0)})});const n=new e.Message_ProgressRange_1;r.Build(n),n.delete();const o=be(r.Shape());if(r.delete(),!(o instanceof fr))throw new Error("Failed to create a face");return o},ml=(t,e)=>{const r=F(),n=new r.ShapeFix_Wire_2(t.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),t},ls=t=>{let e,r;try{e=pn(t[0]),r=t.slice(1)}catch{e=gl(t),r=t.slice(1).map(o=>ml(o,e))}return Qi(e,r)},cs=(t,e)=>{const r=[],n=[],o=[];t.forEach(f=>{const[p,g,y]=e(f);r.push(p),n.push(g),o.push(y)});const i=ls(n),u=ls(o);return Ki([i,...r,u])};class fs{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(r=>r.wire);return Ar(e)}face(){const e=this.outerSketch.face();return Qi(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const u=new X(r||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!o?cs(this.sketches,p=>is(p.wire,i||this.outerSketch.defaultOrigin,u,n,!0)):o?cs(this.sketches,p=>ss(p.wire,o,i||this.outerSketch.defaultOrigin,u,n,!0)):rs(this.face(),u)}revolve(e,{origin:r}={}){return ns(this.face(),r||this.outerSketch.defaultOrigin,e)}loftWith(e,r){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((i,u)=>{const c=e.sketches[u];return i.clone().loftWith(c.clone(),{ruled:r.ruled},!0)}),o=this.face().clone();return n.push(o,e.face()),Ki(n)}}class ue{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new ue(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Tr;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,r,n){return new ue(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new ue(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new ue(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new ue(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new ue(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){const n=this.blueprints.map(o=>o.sketchOnPlane(e,r));return new fs(n)}sketchOnFace(e,r){const n=this.blueprints.map(o=>o.sketchOnFace(e,r));return new fs(n)}toSVGViewBox(e=1){return vn(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return wo(this.toSVGGroup(),this.boundingBox,e)}}class hs{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(r=>r instanceof qt?r.wire:r.wires);return Ar(e)}faces(){const e=this.sketches.map(r=>r.face());return Ar(e)}extrude(e,r={}){const n=this.sketches.map(o=>o.extrude(e,r));return Ar(n)}revolve(e,r){return Ar(this.sketches.map(n=>n.revolve(e,r)))}}class j{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new j(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Tr;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,r,n){return new j(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new j(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new j(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new j(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new j(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){return new hs(this.blueprints.map(n=>n.sketchOnPlane(e,r)))}sketchOnFace(e,r){return new hs(this.blueprints.map(n=>n.sketchOnFace(e,r)))}toSVGViewBox(e=1){return vn(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const r=this.blueprints.map(n=>n instanceof Q?n.toSVGPath():n.toSVGGroup());return wo(r.join(`
    `),this.boundingBox,e)}}const yl=t=>{const e=t.map((o,i)=>t.slice(i+1).map((u,c)=>[c+i+1,u]).filter(([,u])=>!o.boundingBox.isOut(u.boundingBox)).map(([u])=>u)),r=[],n=Array(e.length);return e.forEach((o,i)=>{let u=n[i];u||(u=[],r.push(u)),u.push(t[i]),o.length&&o.forEach(c=>{n[c]=u})}),r},ps=t=>t.map((e,r)=>{const n=e.curves[0],o=n.value((n.lastParameter+n.firstParameter)/2),i=t.filter((u,c)=>r===c?!1:u.isInside(o));return{blueprint:e,isIn:i}}),wl=(t,e)=>t.flatMap(({blueprint:r})=>So(e.filter(({blueprint:n,isIn:o})=>n===r||o.indexOf(r)!==-1))),bl=(t,e)=>{const r=e.filter(({isIn:o})=>o.length<=1),n=So(ps(t.map(({blueprint:o})=>o)));return[r,...n]},So=t=>{if(!t.length)return[];const e=t.filter(({isIn:n})=>!n.length),r=t.filter(({isIn:n})=>n.length>1);return e.length===1&&r.length===0?[t]:e.length>1?wl(e,t):bl(r,t)},Dr=t=>{const e=yl(t).map(ps);return new j(e.flatMap(So).map(r=>r.length===1?r[0].blueprint:(r.sort((n,o)=>n.isIn.length-o.isIn.length),new ue(r.map(({blueprint:n})=>n)))))},Sl=(t,e,r=0)=>{const{rx:n=0,ry:o=0}=typeof r=="number"?{ry:r,rx:r}:r;let i=Math.min(n,t/2),u=Math.min(o,e/2);const c=i&&u;c||(i=0,u=0);const f=i===u,p=new vl([Math.min(0,-(t/2-i)),-e/2]),g=(y,m)=>{c&&(f?p.tangentArc(y,m):p.ellipse(y,m,i,u,0,!1,!0))};return i<t/2&&p.hLine(t-2*i),g(i,u),u<e/2&&p.vLine(e-2*u),g(-i,u),i<t/2&&p.hLine(-(t-2*i)),g(-i,-u),u<e/2&&p.vLine(-(e-2*u)),g(i,-u),p.close()},gn=1e-9,He=(t,e)=>Ne(t,e,gn),Lr=t=>{const e=(t.lastParameter+t.firstParameter)/2;return t.value(e)},ds=(t,e)=>{const r=t.findIndex(i=>He(e,i.firstPoint)),n=t.slice(0,r);return t.slice(r).concat(n)},vs=(t,e)=>{const r=u=>He(e.firstPoint,u.firstPoint)&&He(e.lastPoint,u.lastPoint);let n=t.findIndex(r);if(n===-1&&(t=Eo(t),n=t.findIndex(r),n===-1))throw console.error(t.map(u=>u.repr),e.repr),new Error("Failed to rotate to segment start");const o=t.slice(0,n);return t.slice(n).concat(o)};function*gs(t,e,r){const n=u=>!!e.find(c=>He(c,u.lastPoint)),o=u=>!!r.find(c=>He(c.firstPoint,u.firstPoint)&&He(c.lastPoint,u.lastPoint)||He(c.firstPoint,u.lastPoint)&&He(c.lastPoint,u.firstPoint));let i=[];for(const u of t)n(u)?(i.push(u),yield i,i=[]):o(u)?(i.length&&(yield i,i=[]),yield[u]):i.push(u);i.length&&(yield i)}const _l=t=>t[0].firstPoint,_o=t=>t[t.length-1].lastPoint,Eo=t=>(t.reverse(),t.map(e=>{const r=e.clone();return r.reverse(),r})),El=t=>(t.reverse(),t.map(Eo));function Tl(t,e,r){return t.filter(n=>{const o=e.filter(c=>He(c.firstPoint,n)||He(c.lastPoint,n));if(o.length%2)throw console.error(o,n),new Error("Bug in the intersection algo on non crossing point");const i=o.map(c=>r.isInside(Lr(c)));return!(i.every(c=>c)||!i.some(c=>c))})}function xl(t,e){let r=[];const n=[],o=new Array(t.curves.length).fill(0).map(()=>[]),i=new Array(e.curves.length).fill(0).map(()=>[]);if(t.curves.forEach((m,_)=>{e.curves.forEach((E,x)=>{const{intersections:k,commonSegments:A,commonSegmentsPoints:L}=xr(m,E,gn/100);r.push(...k),o[_].push(...k),i[x].push(...k),n.push(...A),r.push(...L),o[_].push(...L),i[x].push(...L)})}),r=Ti(r,gn),!r.length||r.length===1)return null;const u=([m,_])=>_.length?m.splitAt(_,gn/100):[m];let c=ur([t.curves,o]).flatMap(u),f=ur([e.curves,i]).flatMap(u);const p=n.map(m=>[m.firstPoint,m.lastPoint]);if(r=Tl(r,c,e),!r.length&&!n.length)return null;if(n.length){const m=n[0];c=vs(c,m),f=vs(f,m)}else{const m=r[0];c=ds(c,m),f=ds(f,m)}const g=Array.from(gs(c,r,n));let y=Array.from(gs(f,r,n));return(!He(_o(y[0]),_o(g[0]))||n.length>0&&y[0].length!==1)&&(y=El(y)),ur([g,y]).map(([m,_])=>{const E=_l(m),x=_o(m);return p.find(([k,A])=>He(k,E)&&He(A,x)||He(k,x)&&He(k,E))?[m,"same"]:[m,_]})}const Cl=t=>{const e=t.map(u=>u.firstPoint);let r=t.map(u=>u.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=ur([e,r]).map(([u,c],f)=>He(u,c)?null:f).filter(u=>u!==null);if(!n.length)return[t];const o=ur([n.slice(0,-1),n.slice(1)]).map(([u,c])=>t.slice(u,c));let i=t.slice(n[n.length-1]);return n[0]!==0&&(i=i.concat(t.slice(0,n[0]))),o.push(i),o};function To(t,e,{firstInside:r,secondInside:n}){const o=xl(t,e);if(!o){const p=Lr(t.curves[0]),g=e.isInside(p),y=Lr(e.curves[0]),m=t.isInside(y);return{identical:!1,firstCurveInSecond:g,secondCurveInFirst:m}}if(o.every(([,p])=>p==="same"))return{identical:!0};let i=null,u=null;const c=o.flatMap(([p,g])=>{let y=[],m=0;if(g==="same")return u===1?(u=1,[...p]):u===2||u===0?(u=null,[]):u===null?(i?i=[...i,...p]:i=p,[]):(console.error("weird situation"),[]);const _=Lr(p[0]),E=e.isInside(_);(r==="keep"&&E||r==="remove"&&!E)&&(m+=1,y.push(...p));const x=Lr(g[0]),k=t.isInside(x);if(n==="keep"&&k||n==="remove"&&!k){let A=g;m===1&&(A=Eo(g)),m+=1,y.push(...A)}return u===null&&m===1&&i&&(y=[...i,...y]),m===1&&(u=m,i=null),y}),f=Cl(c).filter(p=>p.length).map(p=>new Q(p));return f.length===0?null:f.length===1?f[0]:Dr(f)}const mn=(t,e)=>{const r=To(t,e,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof Q||r instanceof j?r:r.identical?t.clone():r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():new j([t,e])},Mr=(t,e)=>{const r=To(t,e,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof Q||r instanceof j?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new j([new ue([t,e])]):t.clone()},xo=(t,e)=>{const r=To(t,e,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof Q||r instanceof j?r:r.identical||r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():null},Co=(t,e)=>{if(t instanceof Q&&e instanceof Q){let r=[];return t.curves.forEach(n=>{e.curves.forEach(o=>{const{intersections:i,commonSegmentsPoints:u}=xr(n,o);r.push(...i),r.push(...u)})}),r=Ti(r),r.length>1}if(t instanceof ue||t instanceof j)return t.blueprints.some(r=>Co(r,e));if(e instanceof ue||e instanceof j)return e.blueprints.some(r=>Co(t,r));throw new Error("Bug in the generic intersects algorithm")},kl=(t,e)=>{if(t instanceof ue){if(e instanceof Q)return yn(e,t);if(e instanceof ue)return wn(t,e)}if(e instanceof ue){if(t instanceof Q)return yn(t,e);if(t instanceof ue)return wn(t,e)}if(t instanceof Q&&e instanceof Q)return mn(t,e);throw new Error("Bug in the generic fuse algorithm")},ms=t=>{const e=new Map,r=[];return t.forEach((n,o)=>{let i;e.has(o)?i=e.get(o):(i={current:n,fusedWith:new Set([o])},r.push(i)),t.slice(o+1).forEach((u,c)=>{const f=i.current,p=o+c+1;if(i.fusedWith.has(p))return;let g=u,y=!1;if(e.has(p)&&(g=e.get(p).current,y=!0),f.boundingBox.isOut(g.boundingBox)||!Co(f,g))return;let m;if(f instanceof j||g instanceof j?m=mt(f,g):m=kl(f,g),!(m instanceof Q||m instanceof ue)){if(m instanceof j&&m.blueprints.length===2)return;if(m instanceof j&&m.blueprints.length===1)m=m.blueprints[0];else if(!(m instanceof j))throw console.error(m),new Error("Bug in blueprint fusing algorigthm")}i.fusedWith.add(p),i.current=m,y||e.set(p,i)})}),Dr(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>gt(n)))},gt=t=>t instanceof Q?[t]:t instanceof ue?t.blueprints:t instanceof j?t.blueprints.flatMap(e=>gt(e)):[],yn=(t,e)=>{const r=mn(t,e.blueprints[0]),n=e.blueprints.slice(1).map(o=>Mr(o,t));return Dr([...gt(r),...n.flatMap(o=>gt(o))])};function Pl(t,e){const r=[];for(const n of t)for(const o of e)r.push([n,o]);return r}const wn=(t,e)=>{const r=mn(t.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(u=>Mr(u,t.blueprints[0])),o=t.blueprints.slice(1).map(u=>Mr(u,e.blueprints[0])),i=Pl(t.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([u,c])=>gt(xo(u,c)));return Dr([...gt(r),...n.flatMap(u=>gt(u)),...o.flatMap(u=>gt(u)),...i])},mt=(t,e)=>{if(t===null)return e&&e.clone();if(e===null)return t&&t.clone();if(!(t instanceof j)&&e instanceof j)return ms([t,...e.blueprints]);if(!(e instanceof j)&&t instanceof j)return ms([e,...t.blueprints]);if(t instanceof j&&e instanceof j){let r=mt(t.blueprints[0],e);return t.blueprints.slice(1).forEach(n=>{r=mt(n,r)}),r}if(t instanceof ue){if(e instanceof j)return mt(e,t);if(e instanceof Q)return yn(e,t);if(e instanceof ue)return wn(t,e)}if(e instanceof ue){if(t instanceof j)return mt(t,e);if(t instanceof Q)return yn(t,e);if(t instanceof ue)return wn(t,e)}return t instanceof Q&&e instanceof Q?mn(t,e):null},bn=t=>{const e=t.flatMap(r=>r===null?[]:r instanceof j?r.blueprints:r);return e.length===1?e[0]:new j(e)},Ot=(t,e)=>{if(t===null)return null;if(e===null)return t.clone();if(t instanceof j)return bn(t.blueprints.map(n=>Ot(n,e)));if(t instanceof ue){const n=t.blueprints[0];if(e instanceof Q&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const o=mt(e,new j(t.blueprints.slice(1)));return Dr([n,...gt(o)])}else{let o=Ot(t.blueprints[0],e);return t.blueprints.slice(1).forEach(i=>{o=Ot(o,i)}),o}}if(e instanceof j)return bn(e.blueprints.map(n=>Ot(t,n)));if(e instanceof ue){let n=Mr(t,e.blueprints[0]);return e.blueprints.slice(1).forEach(o=>{n=mt(n,xo(o,t))}),n}return Mr(t,e)};function Ur(t,e){if(t===null||e===null)return null;if(t instanceof Q&&e instanceof Q)return xo(t,e);if(t instanceof j)return bn(t.blueprints.map(r=>Ur(r,e)));if(t instanceof ue){const r=t.blueprints[0],n=t.blueprints[1];return Ot(Ur(r,e),n)}if(e instanceof j)return bn(e.blueprints.map(r=>Ur(t,r)));if(e instanceof ue){const r=e.blueprints[0],n=e.blueprints[1];return Ot(Ur(r,t),n)}throw new Error("intersct 2D algorithm error")}const Al=(t,e={})=>{const r=e.plane instanceof Xe?ct(e.plane):ct(e.plane,e.origin),n=Yt([Qu(t,r.origin,r.zDir)]),o=new qt(n,{defaultOrigin:r.origin,defaultDirection:r.zDir});return r.delete(),o};/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var r={},n=Object.defineProperty,o=n(r,r,r)&&n}catch{}return o}(),e=function(r){if(this==null)throw TypeError();var n=String(this),o=n.length,i=r?Number(r):0;if(i!=i&&(i=0),!(i<0||i>=o)){var u=n.charCodeAt(i),c;return u>=55296&&u<=56319&&o>i+1&&(c=n.charCodeAt(i+1),c>=56320&&c<=57343)?(u-55296)*1024+c-56320+65536:u}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function ko(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var Rl=new ko,Ol=new ko,ys=new Uint8Array(30),ws=new Uint16Array(30),Dl=new Uint8Array(30),Ll=new Uint16Array(30);new ko;function bs(t,e,r,n){var o,i;for(o=0;o<r;++o)t[o]=0;for(o=0;o<30-r;++o)t[o+r]=o/r|0;for(i=n,o=0;o<30;++o)e[o]=i,i+=1<<t[o]}function Ml(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[24+144+r]=280+r;for(r=0;r<112;++r)t.trans[24+144+8+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}Ml(Rl,Ol),bs(ys,ws,4,3),bs(Dl,Ll,2,1),ys[28]=0,ws[28]=258;function hr(t,e,r,n,o){return Math.pow(1-o,3)*t+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*r+Math.pow(o,3)*n}function Dt(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}Dt.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},Dt.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},Dt.prototype.addX=function(t){this.addPoint(t,null)},Dt.prototype.addY=function(t){this.addPoint(null,t)},Dt.prototype.addBezier=function(t,e,r,n,o,i,u,c){var f=[t,e],p=[r,n],g=[o,i],y=[u,c];this.addPoint(t,e),this.addPoint(u,c);for(var m=0;m<=1;m++){var _=6*f[m]-12*p[m]+6*g[m],E=-3*f[m]+9*p[m]-9*g[m]+3*y[m],x=3*p[m]-3*f[m];if(E===0){if(_===0)continue;var k=-x/_;0<k&&k<1&&(m===0&&this.addX(hr(f[m],p[m],g[m],y[m],k)),m===1&&this.addY(hr(f[m],p[m],g[m],y[m],k)));continue}var A=Math.pow(_,2)-4*x*E;if(!(A<0)){var L=(-_+Math.sqrt(A))/(2*E);0<L&&L<1&&(m===0&&this.addX(hr(f[m],p[m],g[m],y[m],L)),m===1&&this.addY(hr(f[m],p[m],g[m],y[m],L)));var D=(-_-Math.sqrt(A))/(2*E);0<D&&D<1&&(m===0&&this.addX(hr(f[m],p[m],g[m],y[m],D)),m===1&&this.addY(hr(f[m],p[m],g[m],y[m],D)))}}},Dt.prototype.addQuad=function(t,e,r,n,o,i){var u=t+.6666666666666666*(r-t),c=e+2/3*(n-e),f=u+1/3*(o-t),p=c+1/3*(i-e);this.addBezier(t,e,u,c,f,p,o,i)};function Re(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Re.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})},Re.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})},Re.prototype.curveTo=Re.prototype.bezierCurveTo=function(t,e,r,n,o,i){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:o,y:i})},Re.prototype.quadTo=Re.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})},Re.prototype.close=Re.prototype.closePath=function(){this.commands.push({type:"Z"})},Re.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof Dt){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)},Re.prototype.getBoundingBox=function(){for(var t=new Dt,e=0,r=0,n=0,o=0,i=0;i<this.commands.length;i++){var u=this.commands[i];switch(u.type){case"M":t.addPoint(u.x,u.y),e=n=u.x,r=o=u.y;break;case"L":t.addPoint(u.x,u.y),n=u.x,o=u.y;break;case"Q":t.addQuad(n,o,u.x1,u.y1,u.x,u.y),n=u.x,o=u.y;break;case"C":t.addBezier(n,o,u.x1,u.y1,u.x2,u.y2,u.x,u.y),n=u.x,o=u.y;break;case"Z":n=e,o=r;break;default:throw new Error("Unexpected path command "+u.type)}}return t.isEmpty()&&t.addPoint(0,0),t},Re.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())},Re.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(u){return Math.round(u)===u?""+Math.round(u):u.toFixed(t)}function r(){for(var u=arguments,c="",f=0;f<arguments.length;f+=1){var p=u[f];p>=0&&f>0&&(c+=" "),c+=e(p)}return c}for(var n="",o=0;o<this.commands.length;o+=1){var i=this.commands[o];i.type==="M"?n+="M"+r(i.x,i.y):i.type==="L"?n+="L"+r(i.x,i.y):i.type==="C"?n+="C"+r(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?n+="Q"+r(i.x1,i.y1,i.x,i.y):i.type==="Z"&&(n+="Z")}return n},Re.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e},Re.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function Ss(t){throw new Error(t)}function _s(t,e){t||Ss(e)}var $={fail:Ss,argument:_s,assert:_s},Es=32768,Ts=2147483648,pr={},G={},Y={};function nt(t){return function(){return t}}G.BYTE=function(t){return $.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]},Y.BYTE=nt(1),G.CHAR=function(t){return[t.charCodeAt(0)]},Y.CHAR=nt(1),G.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e},Y.CHARARRAY=function(t){return typeof t>"u"?0:t.length},G.USHORT=function(t){return[t>>8&255,t&255]},Y.USHORT=nt(2),G.SHORT=function(t){return t>=Es&&(t=-(2*Es-t)),[t>>8&255,t&255]},Y.SHORT=nt(2),G.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]},Y.UINT24=nt(3),G.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]},Y.ULONG=nt(4),G.LONG=function(t){return t>=Ts&&(t=-(2*Ts-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]},Y.LONG=nt(4),G.FIXED=G.ULONG,Y.FIXED=Y.ULONG,G.FWORD=G.SHORT,Y.FWORD=Y.SHORT,G.UFWORD=G.USHORT,Y.UFWORD=Y.USHORT,G.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]},Y.LONGDATETIME=nt(8),G.TAG=function(t){return $.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]},Y.TAG=nt(4),G.Card8=G.BYTE,Y.Card8=Y.BYTE,G.Card16=G.USHORT,Y.Card16=Y.USHORT,G.OffSize=G.BYTE,Y.OffSize=Y.BYTE,G.SID=G.USHORT,Y.SID=Y.USHORT,G.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?G.NUMBER16(t):G.NUMBER32(t)},Y.NUMBER=function(t){return G.NUMBER(t).length},G.NUMBER16=function(t){return[28,t>>8&255,t&255]},Y.NUMBER16=nt(3),G.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]},Y.NUMBER32=nt(5),G.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var o="",i=0,u=e.length;i<u;i+=1){var c=e[i];c==="e"?o+=e[++i]==="-"?"c":"b":c==="."?o+="a":c==="-"?o+="e":o+=c}o+=o.length&1?"f":"ff";for(var f=[30],p=0,g=o.length;p<g;p+=2)f.push(parseInt(o.substr(p,2),16));return f},Y.REAL=function(t){return G.REAL(t).length},G.NAME=G.CHARARRAY,Y.NAME=Y.CHARARRAY,G.STRING=G.CHARARRAY,Y.STRING=Y.CHARARRAY,pr.UTF8=function(t,e,r){for(var n=[],o=r,i=0;i<o;i++,e+=1)n[i]=t.getUint8(e);return String.fromCharCode.apply(null,n)},pr.UTF16=function(t,e,r){for(var n=[],o=r/2,i=0;i<o;i++,e+=2)n[i]=t.getUint16(e);return String.fromCharCode.apply(null,n)},G.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e},Y.UTF16=function(t){return t.length*2};var Po={"x-mac-croatian":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\u0160\u2122\xB4\xA8\u2260\u017D\xD8\u221E\xB1\u2264\u2265\u2206\xB5\u2202\u2211\u220F\u0161\u222B\xAA\xBA\u03A9\u017E\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u0106\xAB\u010C\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u0110\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\uF8FF\xA9\u2044\u20AC\u2039\u203A\xC6\xBB\u2013\xB7\u201A\u201E\u2030\xC2\u0107\xC1\u010D\xC8\xCD\xCE\xCF\xCC\xD3\xD4\u0111\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u03C0\xCB\u02DA\xB8\xCA\xE6\u02C7","x-mac-cyrillic":"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u2020\xB0\u0490\xA3\xA7\u2022\xB6\u0406\xAE\xA9\u2122\u0402\u0452\u2260\u0403\u0453\u221E\xB1\u2264\u2265\u0456\xB5\u0491\u0408\u0404\u0454\u0407\u0457\u0409\u0459\u040A\u045A\u0458\u0405\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\u040B\u045B\u040C\u045C\u0455\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u201E\u040E\u045E\u040F\u045F\u2116\u0401\u0451\u044F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E","x-mac-gaelic":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u1E02\xB1\u2264\u2265\u1E03\u010A\u010B\u1E0A\u1E0B\u1E1E\u1E1F\u0120\u0121\u1E40\xE6\xF8\u1E41\u1E56\u1E57\u027C\u0192\u017F\u1E60\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\u1E61\u1E9B\xFF\u0178\u1E6A\u20AC\u2039\u203A\u0176\u0177\u1E6B\xB7\u1EF2\u1EF3\u204A\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\u2663\xD2\xDA\xDB\xD9\u0131\xDD\xFD\u0174\u0175\u1E84\u1E85\u1E80\u1E81\u1E82\u1E83","x-mac-greek":"\xC4\xB9\xB2\xC9\xB3\xD6\xDC\u0385\xE0\xE2\xE4\u0384\xA8\xE7\xE9\xE8\xEA\xEB\xA3\u2122\xEE\xEF\u2022\xBD\u2030\xF4\xF6\xA6\u20AC\xF9\xFB\xFC\u2020\u0393\u0394\u0398\u039B\u039E\u03A0\xDF\xAE\xA9\u03A3\u03AA\xA7\u2260\xB0\xB7\u0391\xB1\u2264\u2265\xA5\u0392\u0395\u0396\u0397\u0399\u039A\u039C\u03A6\u03AB\u03A8\u03A9\u03AC\u039D\xAC\u039F\u03A1\u2248\u03A4\xAB\xBB\u2026\xA0\u03A5\u03A7\u0386\u0388\u0153\u2013\u2015\u201C\u201D\u2018\u2019\xF7\u0389\u038A\u038C\u038E\u03AD\u03AE\u03AF\u03CC\u038F\u03CD\u03B1\u03B2\u03C8\u03B4\u03B5\u03C6\u03B3\u03B7\u03B9\u03BE\u03BA\u03BB\u03BC\u03BD\u03BF\u03C0\u03CE\u03C1\u03C3\u03C4\u03B8\u03C9\u03C2\u03C7\u03C5\u03B6\u03CA\u03CB\u0390\u03B0\xAD","x-mac-icelandic":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\xDD\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\xD0\xF0\xDE\xFE\xFD\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-inuit":"\u1403\u1404\u1405\u1406\u140A\u140B\u1431\u1432\u1433\u1434\u1438\u1439\u1449\u144E\u144F\u1450\u1451\u1455\u1456\u1466\u146D\u146E\u146F\u1470\u1472\u1473\u1483\u148B\u148C\u148D\u148E\u1490\u1491\xB0\u14A1\u14A5\u14A6\u2022\xB6\u14A7\xAE\xA9\u2122\u14A8\u14AA\u14AB\u14BB\u14C2\u14C3\u14C4\u14C5\u14C7\u14C8\u14D0\u14EF\u14F0\u14F1\u14F2\u14F4\u14F5\u1505\u14D5\u14D6\u14D7\u14D8\u14DA\u14DB\u14EA\u1528\u1529\u152A\u152B\u152D\u2026\xA0\u152E\u153E\u1555\u1556\u1557\u2013\u2014\u201C\u201D\u2018\u2019\u1558\u1559\u155A\u155D\u1546\u1547\u1548\u1549\u154B\u154C\u1550\u157F\u1580\u1581\u1582\u1583\u1584\u1585\u158F\u1590\u1591\u1592\u1593\u1594\u1595\u1671\u1672\u1673\u1674\u1675\u1676\u1596\u15A0\u15A1\u15A2\u15A3\u15A4\u15A5\u15A6\u157C\u0141\u0142","x-mac-ce":"\xC4\u0100\u0101\xC9\u0104\xD6\xDC\xE1\u0105\u010C\xE4\u010D\u0106\u0107\xE9\u0179\u017A\u010E\xED\u010F\u0112\u0113\u0116\xF3\u0117\xF4\xF6\xF5\xFA\u011A\u011B\xFC\u2020\xB0\u0118\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\u0119\xA8\u2260\u0123\u012E\u012F\u012A\u2264\u2265\u012B\u0136\u2202\u2211\u0142\u013B\u013C\u013D\u013E\u0139\u013A\u0145\u0146\u0143\xAC\u221A\u0144\u0147\u2206\xAB\xBB\u2026\xA0\u0148\u0150\xD5\u0151\u014C\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\u014D\u0154\u0155\u0158\u2039\u203A\u0159\u0156\u0157\u0160\u201A\u201E\u0161\u015A\u015B\xC1\u0164\u0165\xCD\u017D\u017E\u016A\xD3\xD4\u016B\u016E\xDA\u016F\u0170\u0171\u0172\u0173\xDD\xFD\u0137\u017B\u0141\u017C\u0122\u02C7",macintosh:"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\u2039\u203A\uFB01\uFB02\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-romanian":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\u0102\u0218\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\u0103\u0219\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\u2039\u203A\u021A\u021B\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-turkish":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u011E\u011F\u0130\u0131\u015E\u015F\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\uF8A0\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7"};pr.MACSTRING=function(t,e,r,n){var o=Po[n];if(o!==void 0){for(var i="",u=0;u<r;u++){var c=t.getUint8(e+u);c<=127?i+=String.fromCharCode(c):i+=o[c&127]}return i}};var Sn=typeof WeakMap=="function"&&new WeakMap,_n,Ul=function(t){if(!_n){_n={};for(var e in Po)_n[e]=new String(e)}var r=_n[t];if(r!==void 0){if(Sn){var n=Sn.get(r);if(n!==void 0)return n}var o=Po[t];if(o!==void 0){for(var i={},u=0;u<o.length;u++)i[o.charCodeAt(u)]=u+128;return Sn&&Sn.set(r,i),i}}};G.MACSTRING=function(t,e){var r=Ul(e);if(r!==void 0){for(var n=[],o=0;o<t.length;o++){var i=t.charCodeAt(o);if(i>=128&&(i=r[i],i===void 0))return;n[o]=i}return n}},Y.MACSTRING=function(t,e){var r=G.MACSTRING(t,e);return r!==void 0?r.length:0};function Ao(t){return t>=-128&&t<=127}function Bl(t,e,r){for(var n=0,o=t.length;e<o&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function Fl(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var u=t[i];if(!Ao(u)||u===0&&i+1<o&&t[i+1]===0)break;++i,++n}r.push(n-1);for(var c=e;c<i;++c)r.push(t[c]+256&255);return i}function Il(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var u=t[i];if(u===0||Ao(u)&&i+1<o&&Ao(t[i+1]))break;++i,++n}r.push(64|n-1);for(var c=e;c<i;++c){var f=t[c];r.push(f+65536>>8&255,f+256&255)}return i}G.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=Bl(t,e,r):n>=-128&&n<=127?e=Fl(t,e,r):e=Il(t,e,r)}return r},G.INDEX=function(t){for(var e=1,r=[e],n=[],o=0;o<t.length;o+=1){var i=G.OBJECT(t[o]);Array.prototype.push.apply(n,i),e+=i.length,r.push(e)}if(n.length===0)return[0,0];for(var u=[],c=1+Math.floor(Math.log(e)/Math.log(2))/8|0,f=[void 0,G.BYTE,G.USHORT,G.UINT24,G.ULONG][c],p=0;p<r.length;p+=1){var g=f(r[p]);Array.prototype.push.apply(u,g)}return Array.prototype.concat(G.Card16(t.length),G.OffSize(c),u,n)},Y.INDEX=function(t){return G.INDEX(t).length},G.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,o=0;o<n;o+=1){var i=parseInt(r[o],0),u=t[i];e=e.concat(G.OPERAND(u.value,u.type)),e=e.concat(G.OPERATOR(i))}return e},Y.DICT=function(t){return G.DICT(t).length},G.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]},G.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)$.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(G.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(G.NUMBER(t));else if(e==="offset")r=r.concat(G.NUMBER32(t));else if(e==="number")r=r.concat(G.NUMBER(t));else if(e==="real")r=r.concat(G.REAL(t));else throw new Error("Unknown operand type "+e);return r},G.OP=G.BYTE,Y.OP=Y.BYTE;var En=typeof WeakMap=="function"&&new WeakMap;G.CHARSTRING=function(t){if(En){var e=En.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,o=0;o<n;o+=1){var i=t[o];r=r.concat(G[i.type](i.value))}return En&&En.set(t,r),r},Y.CHARSTRING=function(t){return G.CHARSTRING(t).length},G.OBJECT=function(t){var e=G[t.type];return $.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)},Y.OBJECT=function(t){var e=Y[t.type];return $.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)},G.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],o=[],i=0;i<r;i+=1){var u=t.fields[i],c=G[u.type];$.argument(c!==void 0,"No encoding function for field type "+u.type+" ("+u.name+")");var f=t[u.name];f===void 0&&(f=u.value);var p=c(f);u.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),n.push(p)):e=e.concat(p)}for(var g=0;g<n.length;g+=1){var y=o[g],m=e.length;$.argument(m<65536,"Table "+t.tableName+" too big."),e[y]=m>>8,e[y+1]=m&255,e=e.concat(n[g])}return e},Y.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var o=t.fields[n],i=Y[o.type];$.argument(i!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var u=t[o.name];u===void 0&&(u=o.value),e+=i(u),o.type==="TABLE"&&(e+=2)}return e},G.RECORD=G.TABLE,Y.RECORD=Y.TABLE,G.LITERAL=function(t){return t},Y.LITERAL=function(t){return t.length};function Le(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var o=e[n];this[o.name]=o.value}if(this.tableName=t,this.fields=e,r)for(var i=Object.keys(r),u=0;u<i.length;u+=1){var c=i[u],f=r[c];this[c]!==void 0&&(this[c]=f)}}Le.prototype.encode=function(){return G.TABLE(this)},Le.prototype.sizeOf=function(){return Y.TABLE(this)};function Br(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var o=0;o<e.length;o++)n[o+1]={name:t+o,type:"USHORT",value:e[o]};return n}function Ro(t,e,r){var n=e.length,o=new Array(n+1);o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o[i+1]={name:t+i,type:"TABLE",value:r(e[i],i)};return o}function Fr(t,e,r){var n=e.length,o=[];o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o=o.concat(r(e[i],i));return o}function Tn(t){t.format===1?Le.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Br("glyph",t.glyphs))):t.format===2?Le.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(Fr("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):$.assert(!1,"Coverage format must be 1 or 2.")}Tn.prototype=Object.create(Le.prototype),Tn.prototype.constructor=Tn;function xn(t){Le.call(this,"scriptListTable",Fr("scriptRecord",t,function(e,r){var n=e.script,o=n.defaultLangSys;return $.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new Le("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Le("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(Br("featureIndex",o.featureIndexes)))}].concat(Fr("langSys",n.langSysRecords,function(i,u){var c=i.langSys;return[{name:"langSysTag"+u,type:"TAG",value:i.tag},{name:"langSys"+u,type:"TABLE",value:new Le("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:c.reqFeatureIndex}].concat(Br("featureIndex",c.featureIndexes)))}]})))}]}))}xn.prototype=Object.create(Le.prototype),xn.prototype.constructor=xn;function Cn(t){Le.call(this,"featureListTable",Fr("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new Le("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(Br("lookupListIndex",n.lookupListIndexes)))}]}))}Cn.prototype=Object.create(Le.prototype),Cn.prototype.constructor=Cn;function kn(t,e){Le.call(this,"lookupListTable",Ro("lookup",t,function(r){var n=e[r.lookupType];return $.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new Le("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(Ro("subtable",r.subtables,n)))}))}kn.prototype=Object.create(Le.prototype),kn.prototype.constructor=kn;var H={Table:Le,Record:Le,Coverage:Tn,ScriptList:xn,FeatureList:Cn,LookupList:kn,ushortList:Br,tableList:Ro,recordList:Fr};function xs(t,e){return t.getUint8(e)}function Pn(t,e){return t.getUint16(e,!1)}function Gl(t,e){return t.getInt16(e,!1)}function Oo(t,e){return t.getUint32(e,!1)}function Cs(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function Nl(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function Hl(t,e,r){for(var n=0,o=0;o<r;o+=1)n<<=8,n+=t.getUint8(e+o);return n}function Wl(t,e,r){for(var n=[],o=e;o<r;o+=1)n.push(t.getUint8(o));return n}function zl(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var Vl={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function C(t,e){this.data=t,this.offset=e,this.relativeOffset=0}C.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},C.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},C.prototype.parseCard8=C.prototype.parseByte,C.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},C.prototype.parseCard16=C.prototype.parseUShort,C.prototype.parseSID=C.prototype.parseUShort,C.prototype.parseOffset16=C.prototype.parseUShort,C.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},C.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t},C.prototype.parseULong=function(){var t=Oo(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},C.prototype.parseOffset32=C.prototype.parseULong,C.prototype.parseFixed=function(){var t=Cs(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},C.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var o=0;o<t;o++)n+=String.fromCharCode(e.getUint8(r+o));return n},C.prototype.parseTag=function(){return this.parseString(4)},C.prototype.parseLongDateTime=function(){var t=Oo(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t},C.prototype.parseVersion=function(t){var e=Pn(this.data,this.offset+this.relativeOffset),r=Pn(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10},C.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=Vl[t]*e},C.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e},C.prototype.parseOffset16List=C.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e},C.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e},C.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint8(n++);return this.relativeOffset+=t,e},C.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},C.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},C.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},u=0;u<n.length;u++){var c=n[u],f=e[c];i[c]=f.call(this)}r[o]=i}return r},C.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},u=0;u<n.length;u++){var c=n[u],f=e[c];i[c]=f.call(this)}r[o]=i}return r},C.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var o=e[n],i=t[o];r[o]=i.call(this)}return r},C.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}},C.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r},C.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new C(this.data,this.offset+e).parseStruct(t)},C.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new C(this.data,this.offset+e).parseStruct(t)},C.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,o=new Array(r),i=0;i<r;i++){var u=e[i];if(u===0){o[i]=void 0;continue}if(this.relativeOffset=u,t){for(var c=this.parseOffset16List(),f=new Array(c.length),p=0;p<c.length;p++)this.relativeOffset=u+c[p],f[p]=t.call(this);o[i]=f}else o[i]=this.parseUShortList()}return this.relativeOffset=n,o},C.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),o=0;o<r;o++)n[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")},C.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:C.uShort,end:C.uShort,classId:C.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")},C.list=function(t,e){return function(){return this.parseList(t,e)}},C.list32=function(t,e){return function(){return this.parseList32(t,e)}},C.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}},C.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}},C.pointer=function(t){return function(){return this.parsePointer(t)}},C.pointer32=function(t){return function(){return this.parsePointer32(t)}},C.tag=C.prototype.parseTag,C.byte=C.prototype.parseByte,C.uShort=C.offset16=C.prototype.parseUShort,C.uShortList=C.prototype.parseUShortList,C.uLong=C.offset32=C.prototype.parseULong,C.uLongList=C.prototype.parseULongList,C.struct=C.prototype.parseStruct,C.coverage=C.prototype.parseCoverage,C.classDef=C.prototype.parseClassDef;var ks={reserved:C.uShort,reqFeatureIndex:C.uShort,featureIndexes:C.uShortList};C.prototype.parseScriptList=function(){return this.parsePointer(C.recordList({tag:C.tag,script:C.pointer({defaultLangSys:C.pointer(ks),langSysRecords:C.recordList({tag:C.tag,langSys:C.pointer(ks)})})}))||[]},C.prototype.parseFeatureList=function(){return this.parsePointer(C.recordList({tag:C.tag,feature:C.pointer({featureParams:C.offset16,lookupListIndexes:C.uShortList})}))||[]},C.prototype.parseLookupList=function(t){return this.parsePointer(C.list(C.pointer(function(){var e=this.parseUShort();$.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(C.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]},C.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();$.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:C.offset32,featureTableSubstitutionOffset:C.offset32});return r})||[]};var Z={getByte:xs,getCard8:xs,getUShort:Pn,getCard16:Pn,getShort:Gl,getULong:Oo,getFixed:Cs,getTag:Nl,getOffset:Hl,getBytes:Wl,bytesToString:zl,Parser:C};function Xl(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var o=e.parseULong(),i=e.parseULong(),u=e.parseULong(),c=o;c<=i;c+=1)t.glyphIndexMap[c]=u,u++}function Yl(t,e,r,n,o){t.length=e.parseUShort(),t.language=e.parseUShort();var i;t.segCount=i=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var u=new Z.Parser(r,n+o+14),c=new Z.Parser(r,n+o+16+i*2),f=new Z.Parser(r,n+o+16+i*4),p=new Z.Parser(r,n+o+16+i*6),g=n+o+16+i*8,y=0;y<i-1;y+=1)for(var m=void 0,_=u.parseUShort(),E=c.parseUShort(),x=f.parseShort(),k=p.parseUShort(),A=E;A<=_;A+=1)k!==0?(g=p.offset+p.relativeOffset-2,g+=k,g+=(A-E)*2,m=Z.getUShort(r,g),m!==0&&(m=m+x&65535)):m=A+x&65535,t.glyphIndexMap[A]=m}function ql(t,e){var r={};r.version=Z.getUShort(t,e),$.argument(r.version===0,"cmap table version should be 0."),r.numTables=Z.getUShort(t,e+2);for(var n=-1,o=r.numTables-1;o>=0;o-=1){var i=Z.getUShort(t,e+4+o*8),u=Z.getUShort(t,e+4+o*8+2);if(i===3&&(u===0||u===1||u===10)||i===0&&(u===0||u===1||u===2||u===3||u===4)){n=Z.getULong(t,e+4+o*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var c=new Z.Parser(t,e+n);if(r.format=c.parseUShort(),r.format===12)Xl(r,c);else if(r.format===4)Yl(r,c,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function $l(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function jl(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function Zl(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:12+8}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new H.Table("cmap",o);for(i.segments=[],r=0;r<t.length;r+=1){for(var u=t.get(r),c=0;c<u.unicodes.length;c+=1)$l(i,u.unicodes[c],r);i.segments=i.segments.sort(function(L,D){return L.start-D.start})}jl(i);var f=i.segments.length,p=0,g=[],y=[],m=[],_=[],E=[],x=[];for(r=0;r<f;r+=1){var k=i.segments[r];k.end<=65535&&k.start<=65535?(g=g.concat({name:"end_"+r,type:"USHORT",value:k.end}),y=y.concat({name:"start_"+r,type:"USHORT",value:k.start}),m=m.concat({name:"idDelta_"+r,type:"SHORT",value:k.delta}),_=_.concat({name:"idRangeOffset_"+r,type:"USHORT",value:k.offset}),k.glyphId!==void 0&&(E=E.concat({name:"glyph_"+r,type:"USHORT",value:k.glyphId}))):p+=1,!e&&k.glyphIndex!==void 0&&(x=x.concat({name:"cmap12Start_"+r,type:"ULONG",value:k.start}),x=x.concat({name:"cmap12End_"+r,type:"ULONG",value:k.end}),x=x.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:k.glyphIndex}))}if(i.segCountX2=(f-p)*2,i.searchRange=Math.pow(2,Math.floor(Math.log(f-p)/Math.log(2)))*2,i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(g),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(y),i.fields=i.fields.concat(m),i.fields=i.fields.concat(_),i.fields=i.fields.concat(E),i.cmap4Length=14+g.length*2+2+y.length*2+m.length*2+_.length*2+E.length*2,!e){var A=16+x.length*4;i.cmap12Offset=12+2*2+4+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:A},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:x.length/3}]),i.fields=i.fields.concat(x)}return i}var Kl={parse:ql,make:Zl},An=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Ql=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Jl=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Ps=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function As(t){this.font=t}As.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var o=r.get(n),i=0;i<o.unicodes.length;i+=1)if(o.unicodes[i]===e)return n}return null};function Rn(t,e){this.encoding=t,this.charset=e}Rn.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function ec(t,e,r,n,o){t.beginPath(),t.moveTo(e,r),t.lineTo(n,o),t.stroke()}var $t={line:ec};function tc(t,e){var r=e||new Re;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function tt(t){this.bindConstructorValues(t)}tt.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",tc(this,t.path))},tt.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)},tt.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},tt.prototype.getPath=function(t,e,r,n,o){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var i,u;n||(n={});var c=n.xScale,f=n.yScale;if(n.hinting&&o&&o.hinting&&(u=this.path&&o.hinting.exec(this,r)),u)i=o.hinting.getCommands(u),t=Math.round(t),e=Math.round(e),c=f=1;else{i=this.path.commands;var p=1/(this.path.unitsPerEm||1e3)*r;c===void 0&&(c=p),f===void 0&&(f=p)}for(var g=new Re,y=0;y<i.length;y+=1){var m=i[y];m.type==="M"?g.moveTo(t+m.x*c,e+-m.y*f):m.type==="L"?g.lineTo(t+m.x*c,e+-m.y*f):m.type==="Q"?g.quadraticCurveTo(t+m.x1*c,e+-m.y1*f,t+m.x*c,e+-m.y*f):m.type==="C"?g.curveTo(t+m.x1*c,e+-m.y1*f,t+m.x2*c,e+-m.y2*f,t+m.x*c,e+-m.y*f):m.type==="Z"&&g.closePath()}return g},tt.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return $.argument(e.length===0,"There are still points left in the current contour."),t},tt.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];o.type!=="Z"&&(e.push(o.x),r.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),r.push(o.y1)),o.type==="C"&&(e.push(o.x2),r.push(o.y2))}var i={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i},tt.prototype.draw=function(t,e,r,n,o){this.getPath(e,r,n,o).draw(t)},tt.prototype.drawPoints=function(t,e,r,n){function o(y,m,_,E){t.beginPath();for(var x=0;x<y.length;x+=1)t.moveTo(m+y[x].x*E,_+y[x].y*E),t.arc(m+y[x].x*E,_+y[x].y*E,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var i=1/this.path.unitsPerEm*n,u=[],c=[],f=this.path,p=0;p<f.commands.length;p+=1){var g=f.commands[p];g.x!==void 0&&u.push({x:g.x,y:-g.y}),g.x1!==void 0&&c.push({x:g.x1,y:-g.y1}),g.x2!==void 0&&c.push({x:g.x2,y:-g.y2})}t.fillStyle="blue",o(u,e,r,i),t.fillStyle="red",o(c,e,r,i)},tt.prototype.drawMetrics=function(t,e,r,n){var o;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,o=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",$t.line(t,e,-1e4,e,1e4),$t.line(t,-1e4,r,1e4,r);var i=this.xMin||0,u=this.yMin||0,c=this.xMax||0,f=this.yMax||0,p=this.advanceWidth||0;t.strokeStyle="blue",$t.line(t,e+i*o,-1e4,e+i*o,1e4),$t.line(t,e+c*o,-1e4,e+c*o,1e4),$t.line(t,-1e4,r+-u*o,1e4,r+-u*o),$t.line(t,-1e4,r+-f*o,1e4,r+-f*o),t.strokeStyle="green",$t.line(t,e+p*o,-1e4,e+p*o,1e4)};function On(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function Do(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}Do.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]},Do.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function rc(t,e){return new tt({index:e,font:t})}function nc(t,e,r,n,o,i){return function(){var u=new tt({index:e,font:t});return u.path=function(){r(u,n,o);var c=i(t.glyphs,u);return c.unitsPerEm=t.unitsPerEm,c},On(u,"xMin","_xMin"),On(u,"xMax","_xMax"),On(u,"yMin","_yMin"),On(u,"yMax","_yMax"),u}}function oc(t,e,r,n){return function(){var o=new tt({index:e,font:t});return o.path=function(){var i=r(t,o,n);return i.unitsPerEm=t.unitsPerEm,i},o}}var ft={GlyphSet:Do,glyphLoader:rc,ttfGlyphLoader:nc,cffGlyphLoader:oc};function Rs(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!Rs(t[r],e[r]))return!1;return!0}else return!1}function Lo(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function Lt(t,e,r){var n=[],o=[],i=Z.getCard16(t,e),u,c;if(i!==0){var f=Z.getByte(t,e+2);u=e+(i+1)*f+2;for(var p=e+3,g=0;g<i+1;g+=1)n.push(Z.getOffset(t,p,f)),p+=f;c=u+n[i]}else c=e+2;for(var y=0;y<n.length-1;y+=1){var m=Z.getBytes(t,u+n[y],u+n[y+1]);r&&(m=r(m)),o.push(m)}return{objects:o,startOffset:e,endOffset:c}}function ic(t,e){var r=[],n=Z.getCard16(t,e),o,i;if(n!==0){var u=Z.getByte(t,e+2);o=e+(n+1)*u+2;for(var c=e+3,f=0;f<n+1;f+=1)r.push(Z.getOffset(t,c,u)),c+=u;i=o+r[n]}else i=e+2;return{offsets:r,startOffset:e,endOffset:i}}function sc(t,e,r,n,o){var i=Z.getCard16(r,n),u=0;if(i!==0){var c=Z.getByte(r,n+2);u=n+(i+1)*c+2}var f=Z.getBytes(r,u+e[t],u+e[t+1]);return o&&(f=o(f)),f}function ac(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=t.parseByte(),i=o>>4,u=o&15;if(i===r||(e+=n[i],u===r))break;e+=n[u]}return parseFloat(e)}function uc(t,e){var r,n,o,i;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),o=t.parseByte(),i=t.parseByte(),r<<24|n<<16|o<<8|i;if(e===30)return ac(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function lc(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],o=t[r][1],i=void 0;if(o.length===1?i=o[0]:i=o,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=i}return e}function Os(t,e,r){e=e!==void 0?e:0;var n=new Z.Parser(t,e),o=[],i=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var u=n.parseByte();u<=21?(u===12&&(u=1200+n.parseByte()),o.push([u,i]),i=[]):i.push(uc(n,u))}return lc(o)}function Ir(t,e){return e<=390?e=An[e]:e=t[e-391],e}function Ds(t,e,r){for(var n={},o,i=0;i<e.length;i+=1){var u=e[i];if(Array.isArray(u.type)){var c=[];c.length=u.type.length;for(var f=0;f<u.type.length;f++)o=t[u.op]!==void 0?t[u.op][f]:void 0,o===void 0&&(o=u.value!==void 0&&u.value[f]!==void 0?u.value[f]:null),u.type[f]==="SID"&&(o=Ir(r,o)),c[f]=o;n[u.name]=c}else o=t[u.op],o===void 0&&(o=u.value!==void 0?u.value:null),u.type==="SID"&&(o=Ir(r,o)),n[u.name]=o}return n}function cc(t,e){var r={};return r.formatMajor=Z.getCard8(t,e),r.formatMinor=Z.getCard8(t,e+1),r.size=Z.getCard8(t,e+2),r.offsetSize=Z.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var Ls=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Ms=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function fc(t,e){var r=Os(t,0,t.byteLength);return Ds(r,Ls,e)}function Us(t,e,r,n){var o=Os(t,e,r);return Ds(o,Ms,n)}function Bs(t,e,r,n){for(var o=[],i=0;i<r.length;i+=1){var u=new DataView(new Uint8Array(r[i]).buffer),c=fc(u,n);c._subrs=[],c._subrsBias=0,c._defaultWidthX=0,c._nominalWidthX=0;var f=c.private[0],p=c.private[1];if(f!==0&&p!==0){var g=Us(t,p+e,f,n);if(c._defaultWidthX=g.defaultWidthX,c._nominalWidthX=g.nominalWidthX,g.subrs!==0){var y=p+g.subrs,m=Lt(t,y+e);c._subrs=m.objects,c._subrsBias=Lo(c._subrs)}c._privateDict=g}o.push(c)}return o}function hc(t,e,r,n){var o,i,u=new Z.Parser(t,e);r-=1;var c=[".notdef"],f=u.parseCard8();if(f===0)for(var p=0;p<r;p+=1)o=u.parseSID(),c.push(Ir(n,o));else if(f===1)for(;c.length<=r;){o=u.parseSID(),i=u.parseCard8();for(var g=0;g<=i;g+=1)c.push(Ir(n,o)),o+=1}else if(f===2)for(;c.length<=r;){o=u.parseSID(),i=u.parseCard16();for(var y=0;y<=i;y+=1)c.push(Ir(n,o)),o+=1}else throw new Error("Unknown charset format "+f);return c}function pc(t,e,r){var n,o={},i=new Z.Parser(t,e),u=i.parseCard8();if(u===0)for(var c=i.parseCard8(),f=0;f<c;f+=1)n=i.parseCard8(),o[n]=f;else if(u===1){var p=i.parseCard8();n=1;for(var g=0;g<p;g+=1)for(var y=i.parseCard8(),m=i.parseCard8(),_=y;_<=y+m;_+=1)o[_]=n,n+=1}else throw new Error("Unknown encoding format "+u);return new Rn(o,r)}function Fs(t,e,r){var n,o,i,u,c=new Re,f=[],p=0,g=!1,y=!1,m=0,_=0,E,x,k,A;if(t.isCIDFont){var L=t.tables.cff.topDict._fdSelect[e.index],D=t.tables.cff.topDict._fdArray[L];E=D._subrs,x=D._subrsBias,k=D._defaultWidthX,A=D._nominalWidthX}else E=t.tables.cff.topDict._subrs,x=t.tables.cff.topDict._subrsBias,k=t.tables.cff.topDict._defaultWidthX,A=t.tables.cff.topDict._nominalWidthX;var q=k;function z(ee,pe){y&&c.closePath(),c.moveTo(ee,pe),y=!0}function ae(){var ee;ee=f.length%2!==0,ee&&!g&&(q=f.shift()+A),p+=f.length>>1,f.length=0,g=!0}function te(ee){for(var pe,Oe,Ie,We,Me,se,Ee,ke,fe,me,Ue,Ye,ye=0;ye<ee.length;){var De=ee[ye];switch(ye+=1,De){case 1:ae();break;case 3:ae();break;case 4:f.length>1&&!g&&(q=f.shift()+A,g=!0),_+=f.pop(),z(m,_);break;case 5:for(;f.length>0;)m+=f.shift(),_+=f.shift(),c.lineTo(m,_);break;case 6:for(;f.length>0&&(m+=f.shift(),c.lineTo(m,_),f.length!==0);)_+=f.shift(),c.lineTo(m,_);break;case 7:for(;f.length>0&&(_+=f.shift(),c.lineTo(m,_),f.length!==0);)m+=f.shift(),c.lineTo(m,_);break;case 8:for(;f.length>0;)n=m+f.shift(),o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),_=u+f.shift(),c.curveTo(n,o,i,u,m,_);break;case 10:Me=f.pop()+x,se=E[Me],se&&te(se);break;case 11:return;case 12:switch(De=ee[ye],ye+=1,De){case 35:n=m+f.shift(),o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),Ee=i+f.shift(),ke=u+f.shift(),fe=Ee+f.shift(),me=ke+f.shift(),Ue=fe+f.shift(),Ye=me+f.shift(),m=Ue+f.shift(),_=Ye+f.shift(),f.shift(),c.curveTo(n,o,i,u,Ee,ke),c.curveTo(fe,me,Ue,Ye,m,_);break;case 34:n=m+f.shift(),o=_,i=n+f.shift(),u=o+f.shift(),Ee=i+f.shift(),ke=u,fe=Ee+f.shift(),me=u,Ue=fe+f.shift(),Ye=_,m=Ue+f.shift(),c.curveTo(n,o,i,u,Ee,ke),c.curveTo(fe,me,Ue,Ye,m,_);break;case 36:n=m+f.shift(),o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),Ee=i+f.shift(),ke=u,fe=Ee+f.shift(),me=u,Ue=fe+f.shift(),Ye=me+f.shift(),m=Ue+f.shift(),c.curveTo(n,o,i,u,Ee,ke),c.curveTo(fe,me,Ue,Ye,m,_);break;case 37:n=m+f.shift(),o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),Ee=i+f.shift(),ke=u+f.shift(),fe=Ee+f.shift(),me=ke+f.shift(),Ue=fe+f.shift(),Ye=me+f.shift(),Math.abs(Ue-m)>Math.abs(Ye-_)?m=Ue+f.shift():_=Ye+f.shift(),c.curveTo(n,o,i,u,Ee,ke),c.curveTo(fe,me,Ue,Ye,m,_);break;default:console.log("Glyph "+e.index+": unknown operator "+1200+De),f.length=0}break;case 14:f.length>0&&!g&&(q=f.shift()+A,g=!0),y&&(c.closePath(),y=!1);break;case 18:ae();break;case 19:case 20:ae(),ye+=p+7>>3;break;case 21:f.length>2&&!g&&(q=f.shift()+A,g=!0),_+=f.pop(),m+=f.pop(),z(m,_);break;case 22:f.length>1&&!g&&(q=f.shift()+A,g=!0),m+=f.pop(),z(m,_);break;case 23:ae();break;case 24:for(;f.length>2;)n=m+f.shift(),o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),_=u+f.shift(),c.curveTo(n,o,i,u,m,_);m+=f.shift(),_+=f.shift(),c.lineTo(m,_);break;case 25:for(;f.length>6;)m+=f.shift(),_+=f.shift(),c.lineTo(m,_);n=m+f.shift(),o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),_=u+f.shift(),c.curveTo(n,o,i,u,m,_);break;case 26:for(f.length%2&&(m+=f.shift());f.length>0;)n=m,o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i,_=u+f.shift(),c.curveTo(n,o,i,u,m,_);break;case 27:for(f.length%2&&(_+=f.shift());f.length>0;)n=m+f.shift(),o=_,i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),_=u,c.curveTo(n,o,i,u,m,_);break;case 28:pe=ee[ye],Oe=ee[ye+1],f.push((pe<<24|Oe<<16)>>16),ye+=2;break;case 29:Me=f.pop()+t.gsubrsBias,se=t.gsubrs[Me],se&&te(se);break;case 30:for(;f.length>0&&(n=m,o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),_=u+(f.length===1?f.shift():0),c.curveTo(n,o,i,u,m,_),f.length!==0);)n=m+f.shift(),o=_,i=n+f.shift(),u=o+f.shift(),_=u+f.shift(),m=i+(f.length===1?f.shift():0),c.curveTo(n,o,i,u,m,_);break;case 31:for(;f.length>0&&(n=m+f.shift(),o=_,i=n+f.shift(),u=o+f.shift(),_=u+f.shift(),m=i+(f.length===1?f.shift():0),c.curveTo(n,o,i,u,m,_),f.length!==0);)n=m,o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),_=u+(f.length===1?f.shift():0),c.curveTo(n,o,i,u,m,_);break;default:De<32?console.log("Glyph "+e.index+": unknown operator "+De):De<247?f.push(De-139):De<251?(pe=ee[ye],ye+=1,f.push((De-247)*256+pe+108)):De<255?(pe=ee[ye],ye+=1,f.push(-(De-251)*256-pe-108)):(pe=ee[ye],Oe=ee[ye+1],Ie=ee[ye+2],We=ee[ye+3],ye+=4,f.push((pe<<24|Oe<<16|Ie<<8|We)/65536))}}}return te(r),e.advanceWidth=q,c}function dc(t,e,r,n){var o=[],i,u=new Z.Parser(t,e),c=u.parseCard8();if(c===0)for(var f=0;f<r;f++){if(i=u.parseCard8(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");o.push(i)}else if(c===3){var p=u.parseCard16(),g=u.parseCard16();if(g!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+g);for(var y,m=0;m<p;m++){if(i=u.parseCard8(),y=u.parseCard16(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");if(y>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+y);for(;g<y;g++)o.push(i);g=y}if(y!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+y)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+c);return o}function vc(t,e,r,n){r.tables.cff={};var o=cc(t,e),i=Lt(t,o.endOffset,Z.bytesToString),u=Lt(t,i.endOffset),c=Lt(t,u.endOffset,Z.bytesToString),f=Lt(t,c.endOffset);r.gsubrs=f.objects,r.gsubrsBias=Lo(r.gsubrs);var p=Bs(t,e,u.objects,c.objects);if(p.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+p.length);var g=p[0];if(r.tables.cff.topDict=g,g._privateDict&&(r.defaultWidthX=g._privateDict.defaultWidthX,r.nominalWidthX=g._privateDict.nominalWidthX),g.ros[0]!==void 0&&g.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var y=g.fdArray,m=g.fdSelect;if(y===0||m===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");y+=e;var _=Lt(t,y),E=Bs(t,e,_.objects,c.objects);g._fdArray=E,m+=e,g._fdSelect=dc(t,m,r.numGlyphs,E.length)}var x=e+g.private[1],k=Us(t,x,g.private[0],c.objects);if(r.defaultWidthX=k.defaultWidthX,r.nominalWidthX=k.nominalWidthX,k.subrs!==0){var A=x+k.subrs,L=Lt(t,A);r.subrs=L.objects,r.subrsBias=Lo(r.subrs)}else r.subrs=[],r.subrsBias=0;var D;n.lowMemory?(D=ic(t,e+g.charStrings),r.nGlyphs=D.offsets.length):(D=Lt(t,e+g.charStrings),r.nGlyphs=D.objects.length);var q=hc(t,e+g.charset,r.nGlyphs,c.objects);if(g.encoding===0?r.cffEncoding=new Rn(Ql,q):g.encoding===1?r.cffEncoding=new Rn(Jl,q):r.cffEncoding=pc(t,e+g.encoding,q),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new ft.GlyphSet(r),n.lowMemory)r._push=function(te){var ee=sc(te,D.offsets,t,e+g.charStrings);r.glyphs.push(te,ft.cffGlyphLoader(r,te,Fs,ee))};else for(var z=0;z<r.nGlyphs;z+=1){var ae=D.objects[z];r.glyphs.push(z,ft.cffGlyphLoader(r,z,Fs,ae))}}function Is(t,e){var r,n=An.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+An.length:(r=An.length+e.length,e.push(t)),r}function gc(){return new H.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function mc(t){var e=new H.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function Gs(t,e,r){for(var n={},o=0;o<t.length;o+=1){var i=t[o],u=e[i.name];u!==void 0&&!Rs(u,i.value)&&(i.type==="SID"&&(u=Is(u,r)),n[i.op]={name:i.name,type:i.type,value:u})}return n}function Ns(t,e){var r=new H.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Gs(Ls,t,e),r}function Hs(t){var e=new H.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function yc(t){var e=new H.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function wc(){return new H.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function bc(t,e){for(var r=new H.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var o=t[n],i=Is(o,e);r.fields.push({name:"glyph_"+n,type:"SID",value:i})}return r}function Sc(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,o=0,i=0;i<r.commands.length;i+=1){var u=void 0,c=void 0,f=r.commands[i];if(f.type==="Q"){var p=.3333333333333333,g=2/3;f={type:"C",x:f.x,y:f.y,x1:Math.round(p*n+g*f.x1),y1:Math.round(p*o+g*f.y1),x2:Math.round(p*f.x+g*f.x1),y2:Math.round(p*f.y+g*f.y1)}}if(f.type==="M")u=Math.round(f.x-n),c=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:c}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(f.x),o=Math.round(f.y);else if(f.type==="L")u=Math.round(f.x-n),c=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:c}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(f.x),o=Math.round(f.y);else if(f.type==="C"){var y=Math.round(f.x1-n),m=Math.round(f.y1-o),_=Math.round(f.x2-f.x1),E=Math.round(f.y2-f.y1);u=Math.round(f.x-f.x2),c=Math.round(f.y-f.y2),e.push({name:"dx1",type:"NUMBER",value:y}),e.push({name:"dy1",type:"NUMBER",value:m}),e.push({name:"dx2",type:"NUMBER",value:_}),e.push({name:"dy2",type:"NUMBER",value:E}),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:c}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(f.x),o=Math.round(f.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function _c(t){for(var e=new H.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),o=Sc(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:o})}return e}function Ec(t,e){var r=new H.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Gs(Ms,t,e),r}function Tc(t,e){for(var r=new H.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i={},u=[],c,f=1;f<t.length;f+=1)c=t.get(f),u.push(c.name);var p=[];r.header=gc(),r.nameIndex=mc([e.postScriptName]);var g=Ns(o,p);r.topDictIndex=Hs(g),r.globalSubrIndex=wc(),r.charsets=bc(u,p),r.charStringsIndex=_c(t),r.privateDict=Ec(i,p),r.stringIndex=yc(p);var y=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return o.charset=y,o.encoding=0,o.charStrings=o.charset+r.charsets.sizeOf(),o.private[1]=o.charStrings+r.charStringsIndex.sizeOf(),g=Ns(o,p),r.topDictIndex=Hs(g),r}var xc={parse:vc,make:Tc};function Cc(t,e){var r={},n=new Z.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),$.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function kc(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new H.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var Pc={parse:Cc,make:kc};function Ac(t,e){var r={},n=new Z.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function Rc(t){return new H.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var Oc={parse:Ac,make:Rc};function Dc(t,e,r,n,o){for(var i,u,c=new Z.Parser(t,e),f=0;f<n;f+=1){f<r&&(i=c.parseUShort(),u=c.parseShort());var p=o.get(f);p.advanceWidth=i,p.leftSideBearing=u}}function Lc(t,e,r,n,o){t._hmtxTableData={};for(var i,u,c=new Z.Parser(e,r),f=0;f<o;f+=1)f<n&&(i=c.parseUShort(),u=c.parseShort()),t._hmtxTableData[f]={advanceWidth:i,leftSideBearing:u}}function Mc(t,e,r,n,o,i,u){u.lowMemory?Lc(t,e,r,n,o):Dc(e,r,n,o,i)}function Uc(t){for(var e=new H.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),o=n.advanceWidth||0,i=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:i})}return e}var Bc={parse:Mc,make:Uc};function Fc(t){for(var e=new H.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,o=0;o<t.length;++o){var i=r.indexOf(t[o]);i<0&&(i=r.length,r+=t[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:n+i}),e.fields.push({name:"length "+o,type:"USHORT",value:t[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function Ic(t,e){var r=new Z.Parser(t,e),n=r.parseULong();$.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var o=r.parseULong(),i=[],u=0;u<o;u++){for(var c="",f=e+r.parseUShort(),p=r.parseUShort(),g=f;g<f+p;++g)c+=String.fromCharCode(t.getInt8(g));i.push(c)}return i}var Gc={make:Fc,parse:Ic};function Nc(t,e){var r={},n=new Z.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function Hc(t){return new H.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var Wc={parse:Nc,make:Hc},Ws=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],zs={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},zc={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Vs={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Vc(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return zs[e];case 3:return Vs[e]}}var Mo="utf-16",Xc={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Yc={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Xs(t,e,r){switch(t){case 0:return Mo;case 1:return Yc[r]||Xc[e];case 3:if(e===1||e===10)return Mo;break}}function qc(t,e,r){for(var n={},o=new Z.Parser(t,e),i=o.parseUShort(),u=o.parseUShort(),c=o.offset+o.parseUShort(),f=0;f<u;f++){var p=o.parseUShort(),g=o.parseUShort(),y=o.parseUShort(),m=o.parseUShort(),_=Ws[m]||m,E=o.parseUShort(),x=o.parseUShort(),k=Vc(p,y,r),A=Xs(p,g,y);if(A!==void 0&&k!==void 0){var L=void 0;if(A===Mo?L=pr.UTF16(t,c+x,E):L=pr.MACSTRING(t,c+x,E,A),L){var D=n[_];D===void 0&&(D=n[_]={}),D[k]=L}}}return i===1&&o.parseUShort(),n}function Uo(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function Ys(t,e,r,n,o,i){return new H.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:i}])}function $c(t,e){var r=t.length,n=e.length-r+1;e:for(var o=0;o<n;o++)for(;o<n;o++){for(var i=0;i<r;i++)if(e[o+i]!==t[i])continue e;return o}return-1}function qs(t,e){var r=$c(t,e);if(r<0){r=e.length;for(var n=0,o=t.length;n<o;++n)e.push(t[n])}return r}function jc(t,e){var r,n=[],o={},i=Uo(Ws);for(var u in t){var c=i[u];if(c===void 0&&(c=u),r=parseInt(c),isNaN(r))throw new Error('Name table entry "'+u+'" does not exist, see nameTableNames for complete list.');o[r]=t[u],n.push(r)}for(var f=Uo(zs),p=Uo(Vs),g=[],y=[],m=0;m<n.length;m++){r=n[m];var _=o[r];for(var E in _){var x=_[E],k=1,A=f[E],L=zc[A],D=Xs(k,L,A),q=G.MACSTRING(x,D);q===void 0&&(k=0,A=e.indexOf(E),A<0&&(A=e.length,e.push(E)),L=4,q=G.UTF16(x));var z=qs(q,y);g.push(Ys(k,L,A,r,q.length,z));var ae=p[E];if(ae!==void 0){var te=G.UTF16(x),ee=qs(te,y);g.push(Ys(3,1,ae,r,te.length,ee))}}}g.sort(function(Ie,We){return Ie.platformID-We.platformID||Ie.encodingID-We.encodingID||Ie.languageID-We.languageID||Ie.nameID-We.nameID});for(var pe=new H.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:g.length},{name:"stringOffset",type:"USHORT",value:6+g.length*12}]),Oe=0;Oe<g.length;Oe++)pe.fields.push({name:"record_"+Oe,type:"RECORD",value:g[Oe]});return pe.fields.push({name:"strings",type:"LITERAL",value:y}),pe}var Zc={parse:qc,make:jc},Bo=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function Kc(t){for(var e=0;e<Bo.length;e+=1){var r=Bo[e];if(t>=r.begin&&t<r.end)return e}return-1}function Qc(t,e){var r={},n=new Z.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var o=0;o<10;o++)r.panose[o]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function Jc(t){return new H.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var $s={parse:Qc,make:Jc,unicodeRanges:Bo,getUnicodeRange:Kc};function ef(t,e){var r={},n=new Z.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=Ps.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.glyphNameIndex[o]=n.parseUShort();r.names=[];for(var i=0;i<r.numberOfGlyphs;i++)if(r.glyphNameIndex[i]>=Ps.length){var u=n.parseChar();r.names.push(n.parseString(u))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var c=0;c<r.numberOfGlyphs;c++)r.offset[c]=n.parseChar();break}return r}function tf(){return new H.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var rf={parse:ef,make:tf},ot=new Array(9);ot[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(C.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(C.coverage),substitute:this.parseOffset16List()};$.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},ot[2]=function(){var e=this.parseUShort();return $.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(C.coverage),sequences:this.parseListOfLists()}},ot[3]=function(){var e=this.parseUShort();return $.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(C.coverage),alternateSets:this.parseListOfLists()}},ot[4]=function(){var e=this.parseUShort();return $.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(C.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var dr={sequenceIndex:C.uShort,lookupListIndex:C.uShort};ot[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(C.coverage),ruleSets:this.parseListOfLists(function(){var i=this.parseUShort(),u=this.parseUShort();return{input:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(u,dr)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(C.coverage),classDef:this.parsePointer(C.classDef),classSets:this.parseListOfLists(function(){var i=this.parseUShort(),u=this.parseUShort();return{classes:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(u,dr)}})};if(r===3){var n=this.parseUShort(),o=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,C.pointer(C.coverage)),lookupRecords:this.parseRecordList(o,dr)}}$.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},ot[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(C.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(dr)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(C.coverage),backtrackClassDef:this.parsePointer(C.classDef),inputClassDef:this.parsePointer(C.classDef),lookaheadClassDef:this.parsePointer(C.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(dr)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(C.pointer(C.coverage)),inputCoverage:this.parseList(C.pointer(C.coverage)),lookaheadCoverage:this.parseList(C.pointer(C.coverage)),lookupRecords:this.parseRecordList(dr)};$.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},ot[7]=function(){var e=this.parseUShort();$.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new C(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:ot[r].call(n)}},ot[8]=function(){var e=this.parseUShort();return $.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(C.coverage),backtrackCoverage:this.parseList(C.pointer(C.coverage)),lookaheadCoverage:this.parseList(C.pointer(C.coverage)),substitutes:this.parseUShortList()}};function nf(t,e){e=e||0;var r=new C(t,e),n=r.parseVersion(1);return $.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(ot)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(ot),variations:r.parseFeatureVariationsList()}}var vr=new Array(9);vr[1]=function(e){return e.substFormat===1?new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.ushortList("substitute",e.substitute)))},vr[2]=function(e){return $.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("seqSet",e.sequences,function(r){return new H.Table("sequenceSetTable",H.ushortList("sequence",r))})))},vr[3]=function(e){return $.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("altSet",e.alternateSets,function(r){return new H.Table("alternateSetTable",H.ushortList("alternate",r))})))},vr[4]=function(e){return $.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("ligSet",e.ligatureSets,function(r){return new H.Table("ligatureSetTable",H.tableList("ligature",r,function(n){return new H.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(H.ushortList("component",n.components,n.components.length+1)))}))})))},vr[6]=function(e){if(e.substFormat===1){var r=new H.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("chainRuleSet",e.chainRuleSets,function(i){return new H.Table("chainRuleSetTable",H.tableList("chainRule",i,function(u){var c=H.ushortList("backtrackGlyph",u.backtrack,u.backtrack.length).concat(H.ushortList("inputGlyph",u.input,u.input.length+1)).concat(H.ushortList("lookaheadGlyph",u.lookahead,u.lookahead.length)).concat(H.ushortList("substitution",[],u.lookupRecords.length));return u.lookupRecords.forEach(function(f,p){c=c.concat({name:"sequenceIndex"+p,type:"USHORT",value:f.sequenceIndex}).concat({name:"lookupListIndex"+p,type:"USHORT",value:f.lookupListIndex})}),new H.Table("chainRuleTable",c)}))})));return r}else if(e.substFormat===2)$.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(i,u){n.push({name:"backtrackCoverage"+u,type:"TABLE",value:new H.Coverage(i)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(i,u){n.push({name:"inputCoverage"+u,type:"TABLE",value:new H.Coverage(i)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(i,u){n.push({name:"lookaheadCoverage"+u,type:"TABLE",value:new H.Coverage(i)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(i,u){n=n.concat({name:"sequenceIndex"+u,type:"USHORT",value:i.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:i.lookupListIndex})});var o=new H.Table("chainContextTable",n);return o}$.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function of(t){return new H.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new H.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new H.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new H.LookupList(t.lookups,vr)}])}var sf={parse:nf,make:of};function af(t,e){var r=new Z.Parser(t,e),n=r.parseULong();$.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var o=r.parseULong(),i={},u=0;u<o;u++){var c=r.parseTag(),f=r.parseULong(),p=r.parseULong(),g=pr.UTF8(t,e+f,p);i[c]=g}return i}function uf(t){var e=Object.keys(t).length,r="",n=16+e*12,o=new H.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var i in t){var u=r.length;r+=t[i],o.fields.push({name:"tag "+i,type:"TAG",value:i}),o.fields.push({name:"offset "+i,type:"ULONG",value:n+u}),o.fields.push({name:"length "+i,type:"ULONG",value:t[i].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),o}var lf={parse:af,make:uf};function js(t){return Math.log(t)/Math.log(2)|0}function Fo(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function Zs(t,e,r,n){return new H.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function Ks(t){var e=new H.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,js(e.numTables));e.searchRange=16*r,e.entrySelector=js(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],o=[],i=e.sizeOf()+Zs().sizeOf()*e.numTables;i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0});for(var u=0;u<t.length;u+=1){var c=t[u];$.argument(c.tableName.length===4,"Table name"+c.tableName+" is invalid.");var f=c.sizeOf(),p=Zs(c.tableName,Fo(c.encode()),i,f);for(n.push({name:p.tag+" Table Record",type:"RECORD",value:p}),o.push({name:c.tableName+" table",type:"RECORD",value:c}),i+=f,$.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(g,y){return g.value.tag>y.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(o),e}function Qs(t,e,r){for(var n=0;n<e.length;n+=1){var o=t.charToGlyphIndex(e[n]);if(o>0){var i=t.glyphs.get(o);return i.getMetrics()}}return r}function cf(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function ff(t){for(var e=[],r=[],n=[],o=[],i=[],u=[],c=[],f,p=0,g=0,y=0,m=0,_=0,E=0;E<t.glyphs.length;E+=1){var x=t.glyphs.get(E),k=x.unicode|0;if(isNaN(x.advanceWidth))throw new Error("Glyph "+x.name+" ("+E+"): advanceWidth is not a number.");(f>k||f===void 0)&&k>0&&(f=k),p<k&&(p=k);var A=$s.getUnicodeRange(k);if(A<32)g|=1<<A;else if(A<64)y|=1<<A-32;else if(A<96)m|=1<<A-64;else if(A<123)_|=1<<A-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(x.name!==".notdef"){var L=x.getMetrics();e.push(L.xMin),r.push(L.yMin),n.push(L.xMax),o.push(L.yMax),u.push(L.leftSideBearing),c.push(L.rightSideBearing),i.push(x.advanceWidth)}}var D={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:cf(i),minLeftSideBearing:Math.min.apply(null,u),maxLeftSideBearing:Math.max.apply(null,u),minRightSideBearing:Math.min.apply(null,c)};D.ascender=t.ascender,D.descender=t.descender;var q=Pc.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:D.xMin,yMin:D.yMin,xMax:D.xMax,yMax:D.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),z=Oc.make({ascender:D.ascender,descender:D.descender,advanceWidthMax:D.advanceWidthMax,minLeftSideBearing:D.minLeftSideBearing,minRightSideBearing:D.minRightSideBearing,xMaxExtent:D.maxLeftSideBearing+(D.xMax-D.xMin),numberOfHMetrics:t.glyphs.length}),ae=Wc.make(t.glyphs.length),te=$s.make(Object.assign({xAvgCharWidth:Math.round(D.advanceWidthAvg),usFirstCharIndex:f,usLastCharIndex:p,ulUnicodeRange1:g,ulUnicodeRange2:y,ulUnicodeRange3:m,ulUnicodeRange4:_,sTypoAscender:D.ascender,sTypoDescender:D.descender,sTypoLineGap:0,usWinAscent:D.yMax,usWinDescent:Math.abs(D.yMin),ulCodePageRange1:1,sxHeight:Qs(t,"xyvw",{yMax:Math.round(D.ascender/2)}).yMax,sCapHeight:Qs(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",D).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),ee=Bc.make(t.glyphs),pe=Kl.make(t.glyphs),Oe=t.getEnglishName("fontFamily"),Ie=t.getEnglishName("fontSubfamily"),We=Oe+" "+Ie,Me=t.getEnglishName("postScriptName");Me||(Me=Oe.replace(/\s/g,"")+"-"+Ie);var se={};for(var Ee in t.names)se[Ee]=t.names[Ee];se.uniqueID||(se.uniqueID={en:t.getEnglishName("manufacturer")+":"+We}),se.postScriptName||(se.postScriptName={en:Me}),se.preferredFamily||(se.preferredFamily=t.names.fontFamily),se.preferredSubfamily||(se.preferredSubfamily=t.names.fontSubfamily);var ke=[],fe=Zc.make(se,ke),me=ke.length>0?Gc.make(ke):void 0,Ue=rf.make(),Ye=xc.make(t.glyphs,{version:t.getEnglishName("version"),fullName:We,familyName:Oe,weightName:Ie,postScriptName:Me,unitsPerEm:t.unitsPerEm,fontBBox:[0,D.yMin,D.ascender,D.advanceWidthMax]}),ye=t.metas&&Object.keys(t.metas).length>0?lf.make(t.metas):void 0,De=[q,z,ae,te,fe,pe,Ue,Ye,ee];me&&De.push(me),t.tables.gsub&&De.push(sf.make(t.tables.gsub)),ye&&De.push(ye);for(var Yr=Ks(De),Qo=Yr.encode(),Fn=Fo(Qo),qr=Yr.fields,In=!1,St=0;St<qr.length;St+=1)if(qr[St].name==="head table"){qr[St].value.checkSumAdjustment=2981146554-Fn,In=!0;break}if(!In)throw new Error("Could not find head table with checkSum to adjust.");return Yr}var hf={make:Ks,fontToTable:ff,computeCheckSum:Fo};function Io(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o].tag;if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function Js(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o];if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function ea(t,e){for(var r,n=0,o=t.length-1;n<=o;){var i=n+o>>>1;r=t[i];var u=r.start;if(u===e)return r;u<e?n=i+1:o=i-1}if(n>0)return r=t[n-1],e>r.end?0:r}function Gr(t,e){this.font=t,this.tableName=e}Gr.prototype={searchTag:Io,binSearch:Js,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(!!t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,o=Io(r.scripts,t);if(o>=0)return n[o].script;if(e){var i={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-o,0,i),i.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var o=Io(n.langSysRecords,e);if(o>=0)return n.langSysRecords[o].langSys;if(r){var i={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-o,0,i),i.langSys}}},getFeatureTable:function(t,e,r,n){var o=this.getLangSysTable(t,e,n);if(o){for(var i,u=o.featureIndexes,c=this.font.tables[this.tableName].features,f=0;f<u.length;f++)if(i=c[u[f]],i.tag===r)return i.feature;if(n){var p=c.length;return $.assert(p===0||r>=c[p-1].tag,"Features must be added in alphabetical order."),i={tag:r,feature:{params:0,lookupListIndexes:[]}},c.push(i),u.push(p),i.feature}}},getLookupTables:function(t,e,r,n,o){var i=this.getFeatureTable(t,e,r,o),u=[];if(i){for(var c,f=i.lookupListIndexes,p=this.font.tables[this.tableName].lookups,g=0;g<f.length;g++)c=p[f[g]],c.lookupType===n&&u.push(c);if(u.length===0&&o){c={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var y=p.length;return p.push(c),f.push(y),[c]}}return u},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=ea(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=Js(t.glyphs,e);return r>=0?r:-1;case 2:var n=ea(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var o=r[n],i=o.start,u=o.end,c=i;c<=u;c++)e.push(c);return e}};function Nr(t){Gr.call(this,t,"gpos")}Nr.prototype=Gr.prototype,Nr.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)},Nr.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var o=t[n].subtables,i=0;i<o.length;i++){var u=o[i],c=this.getCoverageIndex(u.coverage,e);if(!(c<0))switch(u.posFormat){case 1:for(var f=u.pairSets[c],p=0;p<f.length;p++){var g=f[p];if(g.secondGlyph===r)return g.value1&&g.value1.xAdvance||0}break;case 2:var y=this.getGlyphClass(u.classDef1,e),m=this.getGlyphClass(u.classDef2,r),_=u.classRecords[y][m];return _.value1&&_.value1.xAdvance||0}}return 0},Nr.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function Qe(t){Gr.call(this,t,"gsub")}function pf(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Go(t,e,r){for(var n=t.subtables,o=0;o<n.length;o++){var i=n[o];if(i.substFormat===e)return i}if(r)return n.push(r),r}Qe.prototype=Gr.prototype,Qe.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Qe.prototype.getSingle=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,1),i=0;i<o.length;i++)for(var u=o[i].subtables,c=0;c<u.length;c++){var f=u[c],p=this.expandCoverage(f.coverage),g=void 0;if(f.substFormat===1){var y=f.deltaGlyphId;for(g=0;g<p.length;g++){var m=p[g];n.push({sub:m,by:m+y})}}else{var _=f.substitute;for(g=0;g<p.length;g++)n.push({sub:p[g],by:_[g]})}}return n},Qe.prototype.getMultiple=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,2),i=0;i<o.length;i++)for(var u=o[i].subtables,c=0;c<u.length;c++){var f=u[c],p=this.expandCoverage(f.coverage),g=void 0;for(g=0;g<p.length;g++){var y=p[g],m=f.sequences[g];n.push({sub:y,by:m})}}return n},Qe.prototype.getAlternates=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,3),i=0;i<o.length;i++)for(var u=o[i].subtables,c=0;c<u.length;c++)for(var f=u[c],p=this.expandCoverage(f.coverage),g=f.alternateSets,y=0;y<p.length;y++)n.push({sub:p[y],by:g[y]});return n},Qe.prototype.getLigatures=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,4),i=0;i<o.length;i++)for(var u=o[i].subtables,c=0;c<u.length;c++)for(var f=u[c],p=this.expandCoverage(f.coverage),g=f.ligatureSets,y=0;y<p.length;y++)for(var m=p[y],_=g[y],E=0;E<_.length;E++){var x=_[E];n.push({sub:[m].concat(x.components),by:x.ligGlyph})}return n},Qe.prototype.addSingle=function(t,e,r,n){var o=this.getLookupTables(r,n,t,1,!0)[0],i=Go(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});$.assert(i.coverage.format===1,"Single: unable to modify coverage table format "+i.coverage.format);var u=e.sub,c=this.binSearch(i.coverage.glyphs,u);c<0&&(c=-1-c,i.coverage.glyphs.splice(c,0,u),i.substitute.splice(c,0,0)),i.substitute[c]=e.by},Qe.prototype.addMultiple=function(t,e,r,n){$.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(r,n,t,2,!0)[0],i=Go(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});$.assert(i.coverage.format===1,"Multiple: unable to modify coverage table format "+i.coverage.format);var u=e.sub,c=this.binSearch(i.coverage.glyphs,u);c<0&&(c=-1-c,i.coverage.glyphs.splice(c,0,u),i.sequences.splice(c,0,0)),i.sequences[c]=e.by},Qe.prototype.addAlternate=function(t,e,r,n){var o=this.getLookupTables(r,n,t,3,!0)[0],i=Go(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});$.assert(i.coverage.format===1,"Alternate: unable to modify coverage table format "+i.coverage.format);var u=e.sub,c=this.binSearch(i.coverage.glyphs,u);c<0&&(c=-1-c,i.coverage.glyphs.splice(c,0,u),i.alternateSets.splice(c,0,0)),i.alternateSets[c]=e.by},Qe.prototype.addLigature=function(t,e,r,n){var o=this.getLookupTables(r,n,t,4,!0)[0],i=o.subtables[0];i||(i={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=i),$.assert(i.coverage.format===1,"Ligature: unable to modify coverage table format "+i.coverage.format);var u=e.sub[0],c=e.sub.slice(1),f={ligGlyph:e.by,components:c},p=this.binSearch(i.coverage.glyphs,u);if(p>=0){for(var g=i.ligatureSets[p],y=0;y<g.length;y++)if(pf(g[y].components,c))return;g.push(f)}else p=-1-p,i.coverage.glyphs.splice(p,0,u),i.ligatureSets.splice(p,0,[f])},Qe.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}},Qe.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function df(){return typeof window<"u"}function vf(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function Hr(t,e){if(!t)throw e}function ta(t,e,r,n,o){var i;return(e&n)>0?(i=t.parseByte(),(e&o)===0&&(i=-i),i=r+i):(e&o)>0?i=r:i=r+t.parseShort(),i}function ra(t,e,r){var n=new Z.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var o,i;if(t.numberOfContours>0){for(var u=t.endPointIndices=[],c=0;c<t.numberOfContours;c+=1)u.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var f=0;f<t.instructionLength;f+=1)t.instructions.push(n.parseByte());var p=u[u.length-1]+1;o=[];for(var g=0;g<p;g+=1)if(i=n.parseByte(),o.push(i),(i&8)>0)for(var y=n.parseByte(),m=0;m<y;m+=1)o.push(i),g+=1;if($.argument(o.length===p,"Bad flags."),u.length>0){var _=[],E;if(p>0){for(var x=0;x<p;x+=1)i=o[x],E={},E.onCurve=!!(i&1),E.lastPointOfContour=u.indexOf(x)>=0,_.push(E);for(var k=0,A=0;A<p;A+=1)i=o[A],E=_[A],E.x=ta(n,i,k,2,16),k=E.x;for(var L=0,D=0;D<p;D+=1)i=o[D],E=_[D],E.y=ta(n,i,L,4,32),L=E.y}t.points=_}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var q=!0;q;){o=n.parseUShort();var z={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?(z.dx=n.parseShort(),z.dy=n.parseShort()):z.matchedPoints=[n.parseUShort(),n.parseUShort()]:(o&2)>0?(z.dx=n.parseChar(),z.dy=n.parseChar()):z.matchedPoints=[n.parseByte(),n.parseByte()],(o&8)>0?z.xScale=z.yScale=n.parseF2Dot14():(o&64)>0?(z.xScale=n.parseF2Dot14(),z.yScale=n.parseF2Dot14()):(o&128)>0&&(z.xScale=n.parseF2Dot14(),z.scale01=n.parseF2Dot14(),z.scale10=n.parseF2Dot14(),z.yScale=n.parseF2Dot14()),t.components.push(z),q=!!(o&32)}if(o&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var ae=0;ae<t.instructionLength;ae+=1)t.instructions.push(n.parseByte())}}}function No(t,e){for(var r=[],n=0;n<t.length;n+=1){var o=t[n],i={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};r.push(i)}return r}function gf(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];r.push(o),o.lastPointOfContour&&(e.push(r),r=[])}return $.argument(r.length===0,"There are still points left in the current contour."),e}function na(t){var e=new Re;if(!t)return e;for(var r=gf(t),n=0;n<r.length;++n){var o=r[n],i=null,u=o[o.length-1],c=o[0];if(u.onCurve)e.moveTo(u.x,u.y);else if(c.onCurve)e.moveTo(c.x,c.y);else{var f={x:(u.x+c.x)*.5,y:(u.y+c.y)*.5};e.moveTo(f.x,f.y)}for(var p=0;p<o.length;++p)if(i=u,u=c,c=o[(p+1)%o.length],u.onCurve)e.lineTo(u.x,u.y);else{var g=c;i.onCurve||((u.x+i.x)*.5,(u.y+i.y)*.5),c.onCurve||(g={x:(u.x+c.x)*.5,y:(u.y+c.y)*.5}),e.quadraticCurveTo(u.x,u.y,g.x,g.y)}e.closePath()}return e}function oa(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],o=t.get(n.glyphIndex);if(o.getPath(),o.points){var i=void 0;if(n.matchedPoints===void 0)i=No(o.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var u=e.points[n.matchedPoints[0]],c=o.points[n.matchedPoints[1]],f={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};c=No([c],f)[0],f.dx=u.x-c.x,f.dy=u.y-c.y,i=No(o.points,f)}e.points=e.points.concat(i)}}return na(e.points)}function mf(t,e,r,n){for(var o=new ft.GlyphSet(n),i=0;i<r.length-1;i+=1){var u=r[i],c=r[i+1];u!==c?o.push(i,ft.ttfGlyphLoader(n,i,ra,t,e+u,oa)):o.push(i,ft.glyphLoader(n,i))}return o}function yf(t,e,r,n){var o=new ft.GlyphSet(n);return n._push=function(i){var u=r[i],c=r[i+1];u!==c?o.push(i,ft.ttfGlyphLoader(n,i,ra,t,e+u,oa)):o.push(i,ft.glyphLoader(n,i))},o}function wf(t,e,r,n,o){return o.lowMemory?yf(t,e,r,n):mf(t,e,r,n)}var bf={getPath:na,parse:wf},ia,jt,sa,Ho;function aa(t){this.font=t,this.getCommands=function(e){return bf.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Sf(t){return t}function ua(t){return Math.sign(t)*Math.round(Math.abs(t))}function _f(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function Ef(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function Tf(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function xf(t){return Math.sign(t)*Math.floor(Math.abs(t))}var la=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,o=1;return t<0&&(t=-t,o=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*o:t*o},ht={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var o,i,u,c,f,p,g;if(!n||n===this){if(o=t.xo-e.xo,i=t.xo-r.xo,f=e.x-e.xo,p=r.x-r.xo,u=Math.abs(o),c=Math.abs(i),g=u+c,g===0){t.x=t.xo+(f+p)/2;return}t.x=t.xo+(f*c+p*u)/g;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),u=Math.abs(o),c=Math.abs(i),g=u+c,g===0){ht.setRelative(t,t,(f+p)/2,n,!0);return}ht.setRelative(t,t,(f*c+p*u)/g,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,o){if(!n||n===this){t.x=(o?e.xo:e.x)+r;return}var i=o?e.xo:e.x,u=o?e.yo:e.y,c=i+r*n.x,f=u+r*n.y;t.x=c+(t.y-f)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},yt={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var o,i,u,c,f,p,g;if(!n||n===this){if(o=t.yo-e.yo,i=t.yo-r.yo,f=e.y-e.yo,p=r.y-r.yo,u=Math.abs(o),c=Math.abs(i),g=u+c,g===0){t.y=t.yo+(f+p)/2;return}t.y=t.yo+(f*c+p*u)/g;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),u=Math.abs(o),c=Math.abs(i),g=u+c,g===0){yt.setRelative(t,t,(f+p)/2,n,!0);return}yt.setRelative(t,t,(f*c+p*u)/g,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,o){if(!n||n===this){t.y=(o?e.yo:e.y)+r;return}var i=o?e.xo:e.x,u=o?e.yo:e.y,c=i+r*n.x,f=u+r*n.y;t.y=f+n.normalSlope*(t.x-c)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(ht),Object.freeze(yt);function Wr(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}Wr.prototype.distance=function(t,e,r,n){return this.x*ht.distance(t,e,r,n)+this.y*yt.distance(t,e,r,n)},Wr.prototype.interpolate=function(t,e,r,n){var o,i,u,c,f,p,g;if(u=n.distance(t,e,!0,!0),c=n.distance(t,r,!0,!0),o=n.distance(e,e,!1,!0),i=n.distance(r,r,!1,!0),f=Math.abs(u),p=Math.abs(c),g=f+p,g===0){this.setRelative(t,t,(o+i)/2,n,!0);return}this.setRelative(t,t,(o*p+i*f)/g,n,!0)},Wr.prototype.setRelative=function(t,e,r,n,o){n=n||this;var i=o?e.xo:e.x,u=o?e.yo:e.y,c=i+r*n.x,f=u+r*n.y,p=n.normalSlope,g=this.slope,y=t.x,m=t.y;t.x=(g*y-p*c+f-m)/(g-p),t.y=g*(t.x-y)+m},Wr.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function zr(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?ht:t===0&&e===1?yt:new Wr(t,e)}function wt(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}wt.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e},wt.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var Vr=Object.freeze(new wt(0,0)),Cf={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Mt(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=ht,this.round=ua}}aa.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var o=this._fpgmState;if(!o){Mt.prototype=Cf,o=this._fpgmState=new Mt("fpgm",r.tables.fpgm),o.funcs=[],o.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{jt(o)}catch(p){console.log("Hinting error in FPGM:"+p),this._errorState=3;return}}Mt.prototype=o,n=this._prepState=new Mt("prep",r.tables.prep),n.ppem=e;var i=r.tables.cvt;if(i)for(var u=n.cvt=new Array(i.length),c=e/r.unitsPerEm,f=0;f<i.length;f++)u[f]=i[f]*c;else n.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{jt(n)}catch(p){this._errorState<2&&console.log("Hinting error in PREP:"+p),this._errorState=2}}if(!(this._errorState>1))try{return sa(t,n)}catch(p){this._errorState<1&&(console.log("Hinting error:"+p),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}},sa=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,o=t.components,i,u,c;if(Mt.prototype=e,!o)c=new Mt("glyf",t.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),c.step=-1),Ho(t,c,r,n),u=c.gZone;else{var f=e.font;u=[],i=[];for(var p=0;p<o.length;p++){var g=o[p],y=f.glyphs.get(g.glyphIndex);c=new Mt("glyf",y.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+p+"---"),c.step=-1),Ho(y,c,r,n);for(var m=Math.round(g.dx*r),_=Math.round(g.dy*n),E=c.gZone,x=c.contours,k=0;k<E.length;k++){var A=E[k];A.xTouched=A.yTouched=!1,A.xo=A.x=A.x+m,A.yo=A.y=A.y+_}var L=u.length;u.push.apply(u,E);for(var D=0;D<x.length;D++)i.push(x[D]+L)}t.instructions&&!c.inhibitGridFit&&(c=new Mt("glyf",t.instructions),c.gZone=c.z0=c.z1=c.z2=u,c.contours=i,u.push(new wt(0,0),new wt(Math.round(t.advanceWidth*r),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),c.step=-1),jt(c),u.length-=2)}return u},Ho=function(t,e,r,n){for(var o=t.points||[],i=o.length,u=e.gZone=e.z0=e.z1=e.z2=[],c=e.contours=[],f,p=0;p<i;p++)f=o[p],u[p]=new wt(f.x*r,f.y*n,f.lastPointOfContour,f.onCurve);for(var g,y,m=0;m<i;m++)f=u[m],g||(g=f,c.push(m)),f.lastPointOfContour?(f.nextPointOnContour=g,g.prevPointOnContour=f,g=void 0):(y=u[m+1],f.nextPointOnContour=y,y.prevPointOnContour=f);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var _=0;_<i;_++)console.log(_,u[_].x,u[_].y)}if(u.push(new wt(0,0),new wt(Math.round(t.advanceWidth*r),0)),jt(e),u.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var E=0;E<i;E++)console.log(E,u[E].x,u[E].y)}}},jt=function(t){var e=t.prog;if(!!e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(exports.DEBUG&&t.step++,n=ia[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function Dn(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new wt(0,0)}function ca(t,e){var r=t.prog,n=t.ip,o=1,i;do if(i=r[++n],i===88)o++;else if(i===89)o--;else if(i===64)n+=r[n+1]+1;else if(i===65)n+=2*r[n+1]+1;else if(i>=176&&i<=183)n+=i-176+1;else if(i>=184&&i<=191)n+=(i-184+1)*2;else if(e&&o===1&&i===27)break;while(o>0);t.ip=n}function fa(t,e){exports.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function ha(t,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function pa(t,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function da(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log("SPVTL["+t+"]",n,o);var c,f;t?(c=i.y-u.y,f=u.x-i.x):(c=u.x-i.x,f=u.y-i.y),e.pv=e.dpv=zr(c,f)}function va(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log("SFVTL["+t+"]",n,o);var c,f;t?(c=i.y-u.y,f=u.x-i.x):(c=u.x-i.x,f=u.y-i.y),e.fv=zr(c,f)}function kf(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=zr(n,r)}function Pf(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=zr(n,r)}function Af(t){var e=t.stack,r=t.pv;exports.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Rf(t){var e=t.stack,r=t.fv;exports.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Of(t){t.fv=t.pv,exports.DEBUG&&console.log(t.step,"SFVTPV[]")}function Df(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop(),i=e.pop(),u=e.pop(),c=t.z0,f=t.z1,p=c[r],g=c[n],y=f[o],m=f[i],_=t.z2[u];exports.DEBUG&&console.log("ISECT[], ",r,n,o,i,u);var E=p.x,x=p.y,k=g.x,A=g.y,L=y.x,D=y.y,q=m.x,z=m.y,ae=(E-k)*(D-z)-(x-A)*(L-q),te=E*A-x*k,ee=L*z-D*q;_.x=(te*(L-q)-ee*(E-k))/ae,_.y=(te*(D-z)-ee*(x-A))/ae}function Lf(t){t.rp0=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function Mf(t){t.rp1=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function Uf(t){t.rp2=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function Bf(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||Dn(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Ff(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||Dn(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function If(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||Dn(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Gf(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||Dn(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Nf(t){t.loop=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function Hf(t){exports.DEBUG&&console.log(t.step,"RTG[]"),t.round=ua}function Wf(t){exports.DEBUG&&console.log(t.step,"RTHG[]"),t.round=Ef}function zf(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function Vf(t){exports.DEBUG&&console.log(t.step,"ELSE[]"),ca(t,!1)}function Xf(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function Yf(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function qf(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function Wo(t){exports.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function $f(t){exports.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function jf(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function Zf(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function Kf(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var o=t.ip,i=t.prog;t.prog=t.funcs[r];for(var u=0;u<n;u++)jt(t),exports.DEBUG&&console.log(++t.step,u+1<n?"next loopcall":"done loopcall",u);t.ip=o,t.prog=i}function Qf(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],jt(t),t.ip=r,t.prog=n,exports.DEBUG&&console.log(++t.step,"returning from",e)}function Jf(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function eh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function th(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,o=e.pop(),i=n;for(exports.DEBUG&&console.log(t.step,"FDEF[]",o);r[++n]!==45;);t.ip=n,t.funcs[o]=r.slice(i+1,n)}function ga(t,e){var r=e.stack.pop(),n=e.z0[r],o=e.fv,i=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var u=i.distance(n,Vr);t&&(u=e.round(u)),o.setRelative(n,Vr,u,i),o.touch(n),e.rp0=e.rp1=r}function ma(t,e){var r=e.z2,n=r.length-2,o,i,u;exports.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var c=0;c<n;c++)o=r[c],!t.touched(o)&&(i=o.prevTouched(t),i!==o&&(u=o.nextTouched(t),i===u&&t.setRelative(o,o,t.distance(i,i,!1,!0),t,!0),t.interpolate(o,i,u,t)))}function ya(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,u=e.pv,c=e.loop,f=e.z2;c--;){var p=r.pop(),g=f[p],y=u.distance(o,o,!1,!0);i.setRelative(g,g,y,u),i.touch(g),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-c)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",p)}e.loop=1}function wa(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,u=e.pv,c=r.pop(),f=e.z2[e.contours[c]],p=f;exports.DEBUG&&console.log(e.step,"SHC["+t+"]",c);var g=u.distance(o,o,!1,!0);do p!==o&&i.setRelative(p,p,g,u),p=p.nextPointOnContour;while(p!==f)}function ba(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,u=e.pv,c=r.pop();exports.DEBUG&&console.log(e.step,"SHZ["+t+"]",c);var f;switch(c){case 0:f=e.tZone;break;case 1:f=e.gZone;break;default:throw new Error("Invalid zone")}for(var p,g=u.distance(o,o,!1,!0),y=f.length-2,m=0;m<y;m++)p=f[m],i.setRelative(p,p,g,u)}function rh(t){for(var e=t.stack,r=t.loop,n=t.fv,o=e.pop()/64,i=t.z2;r--;){var u=e.pop(),c=i[u];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",u,o),n.setRelative(c,c,o),n.touch(c)}t.loop=1}function nh(t){for(var e=t.stack,r=t.rp1,n=t.rp2,o=t.loop,i=t.z0[r],u=t.z1[n],c=t.fv,f=t.dpv,p=t.z2;o--;){var g=e.pop(),y=p[g];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"IP[]",g,r,"<->",n),c.interpolate(y,i,u,f),c.touch(y)}t.loop=1}function Sa(t,e){var r=e.stack,n=r.pop()/64,o=r.pop(),i=e.z1[o],u=e.z0[e.rp0],c=e.fv,f=e.pv;c.setRelative(i,u,n,f),c.touch(i),exports.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,o),e.rp1=e.rp0,e.rp2=o,t&&(e.rp0=o)}function oh(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],o=t.loop,i=t.fv,u=t.pv,c=t.z1;o--;){var f=e.pop(),p=c[f];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"ALIGNRP[]",f),i.setRelative(p,n,0,u),i.touch(p)}t.loop=1}function ih(t){exports.DEBUG&&console.log(t.step,"RTDG[]"),t.round=_f}function _a(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z0[o],u=e.fv,c=e.pv,f=e.cvt[n];exports.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",f,")",o);var p=c.distance(i,Vr);t&&(Math.abs(p-f)<e.cvCutIn&&(p=f),p=e.round(p)),u.setRelative(i,Vr,p,c),e.zp0===0&&(i.xo=i.x,i.yo=i.y),u.touch(i),e.rp0=e.rp1=o}function sh(t){var e=t.prog,r=t.ip,n=t.stack,o=e[++r];exports.DEBUG&&console.log(t.step,"NPUSHB[]",o);for(var i=0;i<o;i++)n.push(e[++r]);t.ip=r}function ah(t){var e=t.ip,r=t.prog,n=t.stack,o=r[++e];exports.DEBUG&&console.log(t.step,"NPUSHW[]",o);for(var i=0;i<o;i++){var u=r[++e]<<8|r[++e];u&32768&&(u=-((u^65535)+1)),n.push(u)}t.ip=e}function uh(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),o=e.pop();exports.DEBUG&&console.log(t.step,"WS",n,o),r[o]=n}function lh(t){var e=t.stack,r=t.store,n=e.pop();exports.DEBUG&&console.log(t.step,"RS",n);var o=r&&r[n]||0;e.push(o)}function ch(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function fh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function Ea(t,e){var r=e.stack,n=r.pop(),o=e.z2[n];exports.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(o,Vr,t,!1)*64)}function Ta(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z1[n],u=e.z0[o],c=e.dpv.distance(u,i,t,t);exports.DEBUG&&console.log(e.step,"MD["+t+"]",n,o,"->",c),e.stack.push(Math.round(c*64))}function hh(t){exports.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function ph(t){exports.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function dh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function vh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function gh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function mh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function yh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function wh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function bh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function Sh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function _h(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"IF[]",e),e||(ca(t,!0),exports.DEBUG&&console.log(t.step,"EIF[]"))}function Eh(t){exports.DEBUG&&console.log(t.step,"EIF[]")}function Th(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function xh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function Ch(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function zo(t,e){var r=e.stack,n=r.pop(),o=e.fv,i=e.pv,u=e.ppem,c=e.deltaBase+(t-1)*16,f=e.deltaShift,p=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var g=0;g<n;g++){var y=r.pop(),m=r.pop(),_=c+((m&240)>>4);if(_===u){var E=(m&15)-8;E>=0&&E++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",y,"by",E*f);var x=p[y];o.setRelative(x,x,E*f,i)}}}function kh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function Ph(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function Ah(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function Rh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function Oh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function Dh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function Lh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function Mh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function Uh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function Bh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function Ln(t,e){var r=e.stack,n=r.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function Fh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function Vo(t,e){var r=e.stack,n=r.pop(),o=e.ppem,i=e.deltaBase+(t-1)*16,u=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var c=0;c<n;c++){var f=r.pop(),p=r.pop(),g=i+((p&240)>>4);if(g===o){var y=(p&15)-8;y>=0&&y++;var m=y*u;exports.DEBUG&&console.log(e.step,"DELTACFIX",f,"by",m),e.cvt[f]+=m}}}function Ih(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=la;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function Gh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=la;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function Nh(t){exports.DEBUG&&console.log(t.step,"ROFF[]"),t.round=Sf}function Hh(t){exports.DEBUG&&console.log(t.step,"RUTG[]"),t.round=Tf}function Wh(t){exports.DEBUG&&console.log(t.step,"RDTG[]"),t.round=xf}function zh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function xa(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,o);var c,f;t?(c=i.y-u.y,f=u.x-i.x):(c=u.x-i.x,f=u.y-i.y),e.dpv=zr(c,f)}function Vh(t){var e=t.stack,r=e.pop(),n=0;exports.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function Xh(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop();exports.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(o)}function Yh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function qh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function $h(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function jh(t){var e=t.stack.pop(),r=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Ut(t,e){var r=e.stack,n=e.prog,o=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var i=0;i<t;i++)r.push(n[++o]);e.ip=o}function Bt(t,e){var r=e.ip,n=e.prog,o=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var i=0;i<t;i++){var u=n[++r]<<8|n[++r];u&32768&&(u=-((u^65535)+1)),o.push(u)}e.ip=r}function N(t,e,r,n,o,i){var u=i.stack,c=t&&u.pop(),f=u.pop(),p=i.rp0,g=i.z0[p],y=i.z1[f],m=i.minDis,_=i.fv,E=i.dpv,x,k,A,L;k=x=E.distance(y,g,!0,!0),A=k>=0?1:-1,k=Math.abs(k),t&&(L=i.cvt[c],n&&Math.abs(k-L)<i.cvCutIn&&(k=L)),r&&k<m&&(k=m),n&&(k=i.round(k)),_.setRelative(y,g,A*k,E),_.touch(y),exports.DEBUG&&console.log(i.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",t?c+"("+i.cvt[c]+","+L+")":"",f,"(d =",x,"->",A*k,")"),i.rp1=i.rp0,i.rp2=f,e&&(i.rp0=f)}ia=[fa.bind(void 0,yt),fa.bind(void 0,ht),ha.bind(void 0,yt),ha.bind(void 0,ht),pa.bind(void 0,yt),pa.bind(void 0,ht),da.bind(void 0,0),da.bind(void 0,1),va.bind(void 0,0),va.bind(void 0,1),kf,Pf,Af,Rf,Of,Df,Lf,Mf,Uf,Bf,Ff,If,Gf,Nf,Hf,Wf,zf,Vf,Xf,Yf,void 0,void 0,qf,Wo,$f,jf,Zf,Jf,eh,void 0,void 0,void 0,Kf,Qf,th,void 0,ga.bind(void 0,0),ga.bind(void 0,1),ma.bind(void 0,yt),ma.bind(void 0,ht),ya.bind(void 0,0),ya.bind(void 0,1),wa.bind(void 0,0),wa.bind(void 0,1),ba.bind(void 0,0),ba.bind(void 0,1),rh,nh,Sa.bind(void 0,0),Sa.bind(void 0,1),oh,ih,_a.bind(void 0,0),_a.bind(void 0,1),sh,ah,uh,lh,ch,fh,Ea.bind(void 0,0),Ea.bind(void 0,1),void 0,Ta.bind(void 0,0),Ta.bind(void 0,1),hh,void 0,ph,void 0,void 0,dh,vh,gh,mh,yh,wh,bh,Sh,_h,Eh,Th,xh,Ch,zo.bind(void 0,1),kh,Ph,Ah,Rh,Oh,Dh,Lh,Mh,Uh,Bh,Ln.bind(void 0,0),Ln.bind(void 0,1),Ln.bind(void 0,2),Ln.bind(void 0,3),void 0,void 0,void 0,void 0,Fh,zo.bind(void 0,2),zo.bind(void 0,3),Vo.bind(void 0,1),Vo.bind(void 0,2),Vo.bind(void 0,3),Ih,Gh,void 0,void 0,Nh,void 0,Hh,Wh,Wo,Wo,void 0,void 0,void 0,void 0,void 0,zh,xa.bind(void 0,0),xa.bind(void 0,1),Vh,void 0,Xh,Yh,qh,$h,jh,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ut.bind(void 0,1),Ut.bind(void 0,2),Ut.bind(void 0,3),Ut.bind(void 0,4),Ut.bind(void 0,5),Ut.bind(void 0,6),Ut.bind(void 0,7),Ut.bind(void 0,8),Bt.bind(void 0,1),Bt.bind(void 0,2),Bt.bind(void 0,3),Bt.bind(void 0,4),Bt.bind(void 0,5),Bt.bind(void 0,6),Bt.bind(void 0,7),Bt.bind(void 0,8),N.bind(void 0,0,0,0,0,0),N.bind(void 0,0,0,0,0,1),N.bind(void 0,0,0,0,0,2),N.bind(void 0,0,0,0,0,3),N.bind(void 0,0,0,0,1,0),N.bind(void 0,0,0,0,1,1),N.bind(void 0,0,0,0,1,2),N.bind(void 0,0,0,0,1,3),N.bind(void 0,0,0,1,0,0),N.bind(void 0,0,0,1,0,1),N.bind(void 0,0,0,1,0,2),N.bind(void 0,0,0,1,0,3),N.bind(void 0,0,0,1,1,0),N.bind(void 0,0,0,1,1,1),N.bind(void 0,0,0,1,1,2),N.bind(void 0,0,0,1,1,3),N.bind(void 0,0,1,0,0,0),N.bind(void 0,0,1,0,0,1),N.bind(void 0,0,1,0,0,2),N.bind(void 0,0,1,0,0,3),N.bind(void 0,0,1,0,1,0),N.bind(void 0,0,1,0,1,1),N.bind(void 0,0,1,0,1,2),N.bind(void 0,0,1,0,1,3),N.bind(void 0,0,1,1,0,0),N.bind(void 0,0,1,1,0,1),N.bind(void 0,0,1,1,0,2),N.bind(void 0,0,1,1,0,3),N.bind(void 0,0,1,1,1,0),N.bind(void 0,0,1,1,1,1),N.bind(void 0,0,1,1,1,2),N.bind(void 0,0,1,1,1,3),N.bind(void 0,1,0,0,0,0),N.bind(void 0,1,0,0,0,1),N.bind(void 0,1,0,0,0,2),N.bind(void 0,1,0,0,0,3),N.bind(void 0,1,0,0,1,0),N.bind(void 0,1,0,0,1,1),N.bind(void 0,1,0,0,1,2),N.bind(void 0,1,0,0,1,3),N.bind(void 0,1,0,1,0,0),N.bind(void 0,1,0,1,0,1),N.bind(void 0,1,0,1,0,2),N.bind(void 0,1,0,1,0,3),N.bind(void 0,1,0,1,1,0),N.bind(void 0,1,0,1,1,1),N.bind(void 0,1,0,1,1,2),N.bind(void 0,1,0,1,1,3),N.bind(void 0,1,1,0,0,0),N.bind(void 0,1,1,0,0,1),N.bind(void 0,1,1,0,0,2),N.bind(void 0,1,1,0,0,3),N.bind(void 0,1,1,0,1,0),N.bind(void 0,1,1,0,1,1),N.bind(void 0,1,1,0,1,2),N.bind(void 0,1,1,0,1,3),N.bind(void 0,1,1,1,0,0),N.bind(void 0,1,1,1,0,1),N.bind(void 0,1,1,1,0,2),N.bind(void 0,1,1,1,0,3),N.bind(void 0,1,1,1,1,0),N.bind(void 0,1,1,1,1,1),N.bind(void 0,1,1,1,1,2),N.bind(void 0,1,1,1,1,3)];function gr(t){this.char=t,this.state={},this.activeState=null}function Xo(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function Zh(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function it(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Mn(t){this.eventId=t,this.subscribers=[]}function Kh(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(o){Object.defineProperty(e.events,o,{value:new Mn(o)})}),t&&r.forEach(function(o){var i=t[o];typeof i=="function"&&e.events[o].subscribe(i)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function Se(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],Kh.call(this,t)}gr.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState},gr.prototype.getState=function(t){return this.state[t]||null},Se.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length},Se.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(i){return e[i[0]].apply(e,i.slice(1).concat(r))}),o=function(i){return typeof i=="object"&&i.hasOwnProperty("FAIL")};if(n.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(o)};this.dispatch("composeRUD",[n.filter(function(i){return!o(i)})])},Se.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var o=r.every(function(u){return u instanceof gr});if(!isNaN(t)&&this.inboundIndex(t)&&o){var i=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[i,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}},Se.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof gr){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}},Se.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n},Se.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}},Se.prototype.insertToken=function(t,e,r){var n=t.every(function(o){return o instanceof gr});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}},Se.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,o){var i=[n,o],u=e===null||e.apply(this,i)===!0,c=[n,o];if(u){var f=r.apply(this,c);n.setState(t,f)}}),this.registeredModifiers.push(t)},Mn.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},Mn.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)},it.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)},it.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}},Se.prototype.rangeToText=function(t){if(t instanceof Xo)return this.getRangeTokens(t).map(function(e){return e.char}).join("")},Se.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")},Se.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null},Se.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null},Se.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof Mn&&n.subscribers.forEach(function(o){o.apply(r,e||[])})},Se.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new Zh(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n},Se.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))},Se.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}},Se.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}},Se.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new it(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},Se.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new Xo(r,t,e),o=this.getContext(e).ranges;return n.rangeId=e+"."+o.length,o.push(n),this.getContext(e).openRange=null,n},Se.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var o=n.contextName,i=e.getContext(o).openRange;if(!i&&n.checkStart(t)&&(i=new Xo(r,null,o),e.getContext(o).openRange=i,e.dispatch("contextStart",[o,r])),!!i&&n.checkEnd(t)){var u=r-i.startIndex+1,c=e.setEndOffset(u,o);e.dispatch("contextEnd",[o,c])}})},Se.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],o=new it(e,r);this.dispatch("next",[o]),this.runContextCheck(o);var i=new gr(n);this.tokens.push(i),this.dispatch("newToken",[i,o])}return this.dispatch("end",[this.tokens]),this.tokens};function Ft(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function Ca(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function It(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function Un(t){return/[A-z]/.test(t)}function Qh(t){return/\s/.test(t)}function Je(t){this.font=t,this.features={}}function Zt(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function Xr(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var o=r[n];if(t>=o.start&&t<=o.end){var i=t-o.start;return o.index+i}}break;default:return-1}return-1}function Jh(t,e){var r=Xr(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function ep(t,e){var r=Xr(t,e.coverage);return r===-1?null:e.substitute[r]}function Yo(t,e){for(var r=[],n=0;n<t.length;n++){var o=t[n],i=e.current;i=Array.isArray(i)?i[0]:i;var u=Xr(i,o);u!==-1&&r.push(u)}return r.length!==t.length?-1:r}function tp(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=Yo(e.inputCoverage,t);if(n===-1)return[];var o=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var i=t.lookahead.slice(o);i.length&&It(i[0].char);)i.shift();var u=new it(i,0),c=Yo(e.lookaheadCoverage,u),f=[].concat(t.backtrack);for(f.reverse();f.length&&It(f[0].char);)f.shift();if(f.length<e.backtrackCoverage.length)return[];var p=new it(f,0),g=Yo(e.backtrackCoverage,p),y=n.length===e.inputCoverage.length&&c.length===e.lookaheadCoverage.length&&g.length===e.backtrackCoverage.length,m=[];if(y)for(var _=0;_<e.lookupRecords.length;_++)for(var E=e.lookupRecords[_],x=E.lookupListIndex,k=this.getLookupByIndex(x),A=0;A<k.subtables.length;A++){var L=k.subtables[A],D=this.getLookupMethod(k,L),q=this.getSubstitutionType(k,L);if(q==="12")for(var z=0;z<n.length;z++){var ae=t.get(z),te=D(ae);te&&m.push(te)}}return m}function rp(t,e){var r=t.current,n=Xr(r,e.coverage);if(n===-1)return null;for(var o,i=e.ligatureSets[n],u=0;u<i.length;u++){o=i[u];for(var c=0;c<o.components.length;c++){var f=t.lookahead[c],p=o.components[c];if(f!==p)break;if(c===o.components.length-1)return o}}return null}function np(t,e){var r=Xr(t,e.coverage);return r===-1?null:e.sequences[r]}Je.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]},Je.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var o=r[n];if(o.tag===t&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var i=o.langSysRecords;if(i)for(var u=0;u<i.length;u++){var c=i[u];if(c.tag===t){var f=c.langSys;return f.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()},Je.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var o=t[n].tag,i=t[n].feature;r[o]=i}this.features[e].tags=r},Je.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(o){return n.features[o]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e},Je.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n},Je.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(o){return Jh.apply(r,[o,e])};case"12":return function(o){return ep.apply(r,[o,e])};case"63":return function(o){return tp.apply(r,[o,e])};case"41":return function(o){return rp.apply(r,[o,e])};case"21":return function(o){return np.apply(r,[o,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}},Je.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var o=this.getFeatureLookups(n),i=[].concat(e.context),u=0;u<o.length;u++)for(var c=o[u],f=this.getLookupSubtables(c),p=0;p<f.length;p++){var g=f[p],y=this.getSubstitutionType(c,g),m=this.getLookupMethod(c,g),_=void 0;switch(y){case"11":_=m(e.current),_&&i.splice(r,1,new Zt({id:11,tag:t.tag,substitution:_}));break;case"12":_=m(e.current),_&&i.splice(r,1,new Zt({id:12,tag:t.tag,substitution:_}));break;case"63":_=m(e),Array.isArray(_)&&_.length&&i.splice(r,1,new Zt({id:63,tag:t.tag,substitution:_}));break;case"41":_=m(e),_&&i.splice(r,1,new Zt({id:41,tag:t.tag,substitution:_}));break;case"21":_=m(e.current),_&&i.splice(r,1,new Zt({id:21,tag:t.tag,substitution:_}));break}e=new it(i,r),!(Array.isArray(_)&&!_.length)&&(_=null)}return i.length?i:null},Je.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r},Je.prototype.getLookupSubtables=function(t){return t.subtables||null},Je.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null},Je.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))},Je.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function op(t){var e=t.current,r=t.get(-1);return r===null&&Ft(e)||!Ft(r)&&Ft(e)}function ip(t){var e=t.get(1);return e===null||!Ft(e)}var sp={startCheck:op,endCheck:ip};function ap(t){var e=t.current,r=t.get(-1);return(Ft(e)||It(e))&&!Ft(r)}function up(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!Ft(e)&&!It(e)):var r=Qh(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(o){return Ft(o)||It(o)}),!n)return!0}break;default:return!1}}var lp={startCheck:ap,endCheck:up};function cp(t,e,r){e[r].setState(t.tag,t.substitution)}function fp(t,e,r){e[r].setState(t.tag,t.substitution)}function hp(t,e,r){t.substitution.forEach(function(n,o){var i=e[r+o];i.setState(t.tag,n)})}function pp(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var o=t.substitution.components.length,i=0;i<o;i++)n=e[r+i+1],n.setState("deleted",!0)}var ka={11:cp,12:fp,63:hp,41:pp};function qo(t,e,r){t instanceof Zt&&ka[t.id]&&ka[t.id](t,e,r)}function dp(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],o=Ca(n),i=It(n);if(!o&&!i)return!0;if(o)return!1}return!1}function vp(t){if(Ca(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=It(r);if(!n)return!0}return!1}function gp(t){var e=this,r="arab",n=this.featuresTags[r],o=this.tokenizer.getRangeTokens(t);if(o.length!==1){var i=new it(o.map(function(c){return c.getState("glyphIndex")}),0),u=new it(o.map(function(c){return c.char}),0);o.forEach(function(c,f){if(!It(c.char)){i.setCurrentIndex(f),u.setCurrentIndex(f);var p=0;dp(u)&&(p|=1),vp(u)&&(p|=2);var g;switch(p){case 1:g="fina";break;case 2:g="init";break;case 3:g="medi";break}if(n.indexOf(g)!==-1){var y=e.query.lookupFeature({tag:g,script:r,contextParams:i});if(y instanceof Error)return console.info(y.message);y.forEach(function(m,_){m instanceof Zt&&(qo(m,o,_),i.context[_]=m.substitution)})}}})}}function Pa(t,e){var r=t.map(function(n){return n.activeState.value});return new it(r,e||0)}function mp(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),o=Pa(n);o.context.forEach(function(i,u){o.setCurrentIndex(u);var c=e.query.lookupFeature({tag:"rlig",script:r,contextParams:o});c.length&&(c.forEach(function(f){return qo(f,n,u)}),o=Pa(n))})}function yp(t){var e=t.current,r=t.get(-1);return r===null&&Un(e)||!Un(r)&&Un(e)}function wp(t){var e=t.get(1);return e===null||!Un(e)}var bp={startCheck:yp,endCheck:wp};function Aa(t,e){var r=t.map(function(n){return n.activeState.value});return new it(r,e||0)}function Sp(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),o=Aa(n);o.context.forEach(function(i,u){o.setCurrentIndex(u);var c=e.query.lookupFeature({tag:"liga",script:r,contextParams:o});c.length&&(c.forEach(function(f){return qo(f,n,u)}),o=Aa(n))})}function st(t){this.baseDir=t||"ltr",this.tokenizer=new Se,this.featuresTags={}}st.prototype.setText=function(t){this.text=t},st.prototype.contextChecks={latinWordCheck:bp,arabicWordCheck:sp,arabicSentenceCheck:lp};function $o(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function _p(){return $o.call(this,"latinWord"),$o.call(this,"arabicWord"),$o.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function Ep(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}st.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(o){return r.query.supports({script:t,tag:o})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n},st.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new Je(t));for(var r=0;r<e.length;r++){var n=e[r];!this.query.supports({script:n.script})||this.registerFeatures(n.script,n.tags)}},st.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function jo(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function Tp(){var t=this,e="arab";if(!!this.featuresTags.hasOwnProperty(e)){jo.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){gp.call(t,n)})}}function xp(){var t=this,e="arab";if(!!this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){jo.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(o){mp.call(t,o)})}}}function Cp(){var t=this,e="latn";if(!!this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){jo.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(o){Sp.call(t,o)})}}}st.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)},st.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(Tp.call(this),xp.call(this)),this.checkContextReady("latinWord")&&Cp.call(this),this.checkContextReady("arabicSentence")&&Ep.call(this)},st.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),_p.call(this),this.applyFeaturesToContexts())},st.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()},st.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var o=n.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function he(t){t=t||{},t.tables=t.tables||{},t.empty||(Hr(t.familyName,"When creating a new Font object, familyName is required."),Hr(t.styleName,"When creating a new Font object, styleName is required."),Hr(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Hr(t.ascender,"When creating a new Font object, ascender is required."),Hr(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new ft.GlyphSet(this,t.glyphs||[]),this.encoding=new As(this),this.position=new Nr(this),this.substitution=new Qe(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new aa(this)}})}he.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null},he.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)},he.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},he.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})},he.prototype.stringToGlyphs=function(t,e){var r=this,n=new st,o=function(y){return r.charToGlyphIndex(y.char)};n.registerModifier("glyphIndex",null,o);var i=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,i);for(var u=n.getTextGlyphs(t),c=u.length,f=new Array(c),p=this.glyphs.get(0),g=0;g<c;g+=1)f[g]=this.glyphs.get(u[g])||p;return f},he.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)},he.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},he.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""},he.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0},he.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},he.prototype.forEachGlyph=function(t,e,r,n,o,i){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,o=Object.assign({},this.defaultRenderOptions,o);var u=1/this.unitsPerEm*n,c=this.stringToGlyphs(t,o),f;if(o.kerning){var p=o.script||this.position.getDefaultScriptName();f=this.position.getKerningTables(p,o.language)}for(var g=0;g<c.length;g+=1){var y=c[g];if(i.call(this,y,e,r,n,o),y.advanceWidth&&(e+=y.advanceWidth*u),o.kerning&&g<c.length-1){var m=f?this.position.getKerningValue(f,y.index,c[g+1].index):this.getKerningValue(y,c[g+1]);e+=m*u}o.letterSpacing?e+=o.letterSpacing*n:o.tracking&&(e+=o.tracking/1e3*n)}return e},he.prototype.getPath=function(t,e,r,n,o){var i=new Re;return this.forEachGlyph(t,e,r,n,o,function(u,c,f,p){var g=u.getPath(c,f,p,o,this);i.extend(g)}),i},he.prototype.getPaths=function(t,e,r,n,o){var i=[];return this.forEachGlyph(t,e,r,n,o,function(u,c,f,p){var g=u.getPath(c,f,p,o,this);i.push(g)}),i},he.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})},he.prototype.draw=function(t,e,r,n,o,i){this.getPath(e,r,n,o,i).draw(t)},he.prototype.drawPoints=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(u,c,f,p){u.drawPoints(t,c,f,p)})},he.prototype.drawMetrics=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(u,c,f,p){u.drawMetrics(t,c,f,p)})},he.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en},he.prototype.validate=function(){var t=this;function e(n,o){}function r(n){var o=t.getEnglishName(n);o&&o.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0},he.prototype.toTables=function(){return hf.fontToTable(this)},he.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},he.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),o=0;o<e.length;o++)n[o]=e[o];return r},he.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(df())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(n),i=new Blob([o],{type:"font/opentype"}),u=document.createElement("a");u.href=window.URL.createObjectURL(i),u.download=t;var c=document.createEvent("MouseEvents");c.initEvent("click",!0,!1),u.dispatchEvent(c)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var f=require("fs"),p=vf(n);f.writeFileSync(t,p)}},he.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},he.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},he.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var bt=new Array(10);bt[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(C.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(C.coverage),values:this.parseValueRecordList()};$.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},bt[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();$.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(C.coverage),o=this.parseUShort(),i=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,pairSets:this.parseList(C.pointer(C.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}})))};if(r===2){var u=this.parsePointer(C.classDef),c=this.parsePointer(C.classDef),f=this.parseUShort(),p=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,classDef1:u,classDef2:c,class1Count:f,class2Count:p,classRecords:this.parseList(f,C.list(p,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}}))}}},bt[3]=function(){return{error:"GPOS Lookup 3 not supported"}},bt[4]=function(){return{error:"GPOS Lookup 4 not supported"}},bt[5]=function(){return{error:"GPOS Lookup 5 not supported"}},bt[6]=function(){return{error:"GPOS Lookup 6 not supported"}},bt[7]=function(){return{error:"GPOS Lookup 7 not supported"}},bt[8]=function(){return{error:"GPOS Lookup 8 not supported"}},bt[9]=function(){return{error:"GPOS Lookup 9 not supported"}},new Array(10);const kp=()=>Date.now().toString(36)+Math.random().toString(36).substring(2);async function Pp(t){const e=F(),[r,n]=ce(),o=kp(),i=new Uint8Array(await t.arrayBuffer());e.FS.writeFile(`/${o}`,i);const u=r(new e.STEPControl_Reader_1);if(u.ReadFile(o)){e.FS.unlink("/"+o),u.TransferRoots(r(new e.Message_ProgressRange_1));const c=r(u.OneShape()),f=be(c);return n(),f}else throw e.FS.unlink("/"+o),n(),new Error("Failed to load STEP file")}const Ap={XY:{dir:[0,0,1],xAxis:[1,0,0]},XZ:{dir:[0,-1,0],xAxis:[1,0,0]},YZ:{dir:[1,0,0],xAxis:[0,1,0]},YX:{dir:[0,0,-1],xAxis:[0,1,0]},ZX:{dir:[0,1,0],xAxis:[0,0,1]},ZY:{dir:[-1,0,0],xAxis:[0,0,1]},front:{dir:[0,-1,0],xAxis:[1,0,0]},back:{dir:[0,1,0],xAxis:[-1,0,0]},right:{dir:[-1,0,0],xAxis:[0,-1,0]},left:{dir:[1,0,0],xAxis:[0,1,0]},bottom:{dir:[0,0,1],xAxis:[1,0,0]},top:{dir:[0,0,-1],xAxis:[1,0,0]}};function Rp(t){const{dir:e,xAxis:r}=Ap[t];return new Zo([0,0,0],e,r)}function Ra(t){const e=new X(t);let r=new X([0,0,1]),n=r.cross(e);return n.Length===0&&(r=new X([0,1,0]),n=r.cross(e)),n.normalize()}class Zo extends lt{constructor(e=[0,0,0],r=[0,0,1],n){const o=n?new X(n):Ra(r),i=sr(e,r,o);super(i)}get position(){return new X(this.wrapped.Location())}get direction(){return new X(this.wrapped.Direction())}get xAxis(){return new X(this.wrapped.XDirection())}get yAxis(){return new X(this.wrapped.YDirection())}autoAxes(){const e=Ra(this.direction);this.wrapped.SetXDirection(dt(e))}setPosition(e){return this.wrapped.SetLocation(Ce(e)),this}setXAxis(e){return this.wrapped.SetYDirection(dt(e)),this}setYAxis(e){return this.wrapped.SetYDirection(dt(e)),this}lookAt(e){const r=new X("boundingBox"in e?e.boundingBox.center:e),n=this.position.sub(r).normalized();return this.wrapped.SetDirection(n.toDir()),this.autoAxes(),this}}const mr=t=>t.IsNull()?[]:be(t).edges;function Op(t,e,r=!0){const n=F(),o=ve(),i=o(new n.HLRBRep_Algo_1);i.Add_2(t.wrapped,0);const u=o(new n.HLRAlgo_Projector_2(e.wrapped));i.Projector_1(u),i.Update(),i.Hide_1();const c=new n.HLRBRep_HLRToShape(new n.Handle_HLRBRep_Algo_2(i)),f=[...mr(c.VCompound_1()),...mr(c.Rg1LineVCompound_1()),...mr(c.OutLineVCompound_1())];f.forEach(g=>n.BRepLib.BuildCurves3d_2(g.wrapped));const p=r?[...mr(c.HCompound_1()),...mr(c.Rg1LineHCompound_1()),...mr(c.OutLineHCompound_1())]:[];return p.forEach(g=>n.BRepLib.BuildCurves3d_2(g.wrapped)),{visible:f,hidden:p}}const Kt=1e-8,yr=(t,e)=>Ne(t,e,Kt*10);function Dp(t,e){const r=t.orientation==="clockwise"?-e:e,n=t.curves.map(p=>({offset:lo(p,r),original:p})),o=[];let i=null,u=n.at(-1);if(!u)return[];if(o.length===1)return o;const c=p=>{i?p.offset instanceof ge?o.push(p.offset):yr(p.offset.firstPoint,p.offset.lastPoint)||o.push(Cr(p.offset.firstPoint,p.offset.lastPoint)):i=p},f=function*(){for(const p of n.slice(0,-1))yield p;if(!i)throw new Error("Bug in the offset algorithm");yield i};for(const p of f()){const g=u.offset.lastPoint,y=p.offset.firstPoint;if(yr(g,y)){c(u),u=p;continue}let m=[];if(u.offset instanceof ge&&p.offset instanceof ge){const{intersections:E,commonSegmentsPoints:x}=xr(u.offset,p.offset,Kt/100);m=[...E,...x]}if(m.length>0){let E=m[0];if(m.length>1){const A=u?.original.lastPoint,L=m.map(D=>Lu(D,A));E=m[L.indexOf(Math.min(...L))]}const x=u.offset.splitAt([E],Kt)[0],k=p.offset.splitAt([E],Kt).at(-1);if(!k)throw new Error("Bug in the splitting algo in offset");c({offset:x,original:u.original}),u={offset:k,original:p.original};continue}const _=Ri(g,y,u.original.lastPoint);c(u),o.push(_),u=p}return c(u),o}function Lp(t,e){const r=Dp(t,e);if(r.length<2)return null;const n=new Map,o=(p,g)=>{const y=n.get(p)||[];n.set(p,[...y,...g])};if(r.forEach((p,g)=>{r.slice(g+1).forEach((y,m)=>{const{intersections:_,commonSegmentsPoints:E}=xr(p,y,Kt),x=[..._,...E].filter(k=>{const A=yr(k,p.firstPoint)||yr(k,p.lastPoint),L=yr(k,y.firstPoint)||yr(k,y.lastPoint);return!(A&&L)});!x.length||(o(g,x),o(m+g+1,x))})}),!n.size){const p=new Q(r);return t.intersects(p)?null:p}const u=r.flatMap((p,g)=>{if(!n.has(g))return p;const y=n.get(g)||[];return p.splitAt(y,Kt*100)}).filter(p=>!t.curves.find(y=>y.distanceFrom(p)<Math.abs(e)-Kt));if(!u.length)return null;const f=Ui(u).filter(p=>p.length>1).map(p=>new Q(p)).filter(p=>p.isClosed());return f.length?f.length===1?f[0]:new j(f):null}const Oa=t=>{let e=t[0];for(let r=1;r<t.length;r++)e=mt(e,t[r]);return e};function Bn(t,e){if(t instanceof Q)return Lp(t,e);if(t instanceof j)return Oa(t.blueprints.map(r=>Bn(r,e)));if(t instanceof ue){const r=Oa(t.blueprints.slice(1).map(n=>Bn(n,e)));return Ot(Bn(t.blueprints[0],e),r)}return null}function Da(t,e,r,n){let o=()=>!0;n&&(o=n.shouldKeep.bind(n));const i=[e.curves[0]],u=(f,p)=>{o({firstCurve:f,secondCurve:p,point:f.lastPoint})?i.push(...t(f,p,r)):i.push(f,p)};e.curves.slice(1).forEach(f=>{const p=i.pop();if(!p)throw new Error("Bug in the blueprint filletting algo");u(p,f)});const c=i.at(-1);if(!c)throw new Error("Bug in the blueprint corner algo");if(Ne(i[0].firstPoint,c.lastPoint)&&i.length>1){const f=i.pop(),p=i.shift();if(!f||!p)throw new Error("Bug in the blueprint filletting algo");u(f,p)}return new Q(i)}function Ko(t,e,r,n){if(e instanceof Q)return Da(t,e,r,n);if(e instanceof ue)return new ue(e.blueprints.map(o=>Da(t,o,r,n)));if(e instanceof j){const o=e.blueprints.map(i=>Ko(t,i,r,n)).filter(i=>i!==null);return new j(o)}return null}function Mp(t,e,r){return Ko(co,t,e,r)}function Up(t,e,r){return Ko(fo,t,e,r)}class _e{constructor(e=null){this.innerShape=e}clone(){var e;return new _e(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new Tr}stretch(e,r,n){return this.innerShape?new _e(this.innerShape.stretch(e,r,n)):new _e}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,r){return this.innerShape?new _e(this.innerShape.rotate(e,r)):new _e}translate(e,r=0){return this.innerShape?new _e(this.innerShape.translate(e,r)):new _e}scale(e,r){return this.innerShape?new _e(this.innerShape.scale(e,r)):new _e}mirror(e,r,n){return this.innerShape?new _e(this.innerShape.mirror(e,r,n)):new _e}cut(e){return new _e(Ot(this.innerShape,e.innerShape))}fuse(e){return new _e(mt(this.innerShape,e.innerShape))}intersect(e){return new _e(Ur(this.innerShape,e.innerShape))}fillet(e,r){const n=r&&r(new ln);return new _e(Mp(this.innerShape,e,n))}chamfer(e,r){const n=r&&r(new ln);return new _e(Up(this.innerShape,e,n))}sketchOnPlane(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,r)}sketchOnFace(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,r)}toSVG(e){var r;return((r=this.innerShape)==null?void 0:r.toSVG(e))||""}toSVGViewBox(e=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new _e(Bn(this.innerShape,e))}get blueprint(){if(!(this.innerShape instanceof Q)){if(this.innerShape instanceof j&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof Q)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}function Bp(t,e,r=0){return new _e(Sl(t,e,r))}const Fp=Bp,La=t=>{const e=Fp(1e3,1e3).sketchOnPlane().face(),r=t.map(o=>pl(o,e)),n=Ui(r).map(o=>new Q(o));return n.length===0?new _e:n.length===1?new _e(n[0]):new _e(new j(n))};function Ip(t,e="front"){let r;e instanceof Zo?r=e:r=Rp(e);const{visible:n,hidden:o}=Op(t,r);return{visible:La(n),hidden:La(o)}}function Qt(t){return{type:"Ok",value:t}}function wr(t){return{type:"Err",message:t}}let Ma,Ua,Ba=!1;const Gp=async()=>{if(Ba)return Promise.resolve(!0);const t=await wu({locateFile:()=>Ma});return Ba=!0,bu(t),!0};let Fa=0,Gt=new Map;self.addEventListener("message",async t=>{let e=JSON.parse(JSON.stringify(t.data));switch(e.type){case"setupOpenCascade":{Ma=e.params.opencascadeWasm,Ua=e.params.resourcesUrl,await Gp(),self.postMessage({requestId:e.requestId,result:Qt({})});break}case"makeTubedFaceShape":{let r=await Np(e.params);if(r==null)self.postMessage({requestId:e.requestId,result:wr("Failed to create shape")});else{let n=Fa++;Gt.set(n,r),self.postMessage({requestId:e.requestId,result:Qt(n)})}break}case"shapeToMesh":{let r=Gt.get(e.params.id);if(r==null)self.postMessage({requestId:e.requestId,result:wr("Shape not found")});else{let n=.001,o=r.mesh({tolerance:.5,angularTolerance:2});for(let i=0;i<o.vertices.length;++i)o.vertices[i]*=n;self.postMessage({requestId:e.requestId,result:Qt(o)})}break}case"shapeToEdges":{let r=Gt.get(e.params.id);if(r==null)self.postMessage({requestId:e.requestId,result:wr("Shape not found")});else{let n=.001,o=r.meshEdges({tolerance:.5,angularTolerance:2});for(let i=0;i<o.lines.length;++i)o.lines[i]*=n;self.postMessage({requestId:e.requestId,result:Qt(o)})}break}case"fuseShapesWithTransforms":{let r=[];for(let{shapeId:u,transform:c}of e.params.shapeIdTransformList){let f=Gt.get(u);if(f==null){self.postMessage({requestId:e.requestId,result:wr("Shape not found")});for(f of r)f.delete();return}let p=f.clone(),g=2*Math.acos(c.q[0])*180/Math.PI,y=[c.q[1],c.q[2],c.q[3]],m=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]);y[0]/=m,y[1]/=m,y[2]/=m,Number.isFinite(y[0])&&(p=p.rotate(g,[0,0,0],y)),p=p.translate(c.o[0],c.o[1],c.o[2]),r.push(p)}if(r.length==null){self.postMessage({requestId:e.requestId,result:wr("No shapes to fuse")});return}let n,o=u=>{n==null?n=u:n=n.fuse(u)};for(let u of r)o(u);let i=Fa++;Gt.set(i,n??r[0]),self.postMessage({requestId:e.requestId,result:Qt(i)});break}case"projectShape":{let r=Gt.get(e.params.shapeId);if(r==null)self.postMessage({requestId:e.requestId,result:wr("Shape not found")});else{let n=new Zo(e.params.camera.position,e.params.camera.direction,e.params.camera.xAxis),o=Ip(r.clone(),n).visible;self.postMessage({requestId:e.requestId,result:Qt(o.toSVGPaths())})}break}case"deleteShape":{let r=Gt.get(e.params.id);r!=null&&(r.delete(),Gt.delete(e.params.id)),self.postMessage({requestId:e.requestId,result:Qt({})});break}}});async function Np(t){let e,r=t.style,n=f=>{e=e==null?f:e.fuse(f)},o,i,u;{let f=t.endGap,g=t.width-t.endGap-f,y=Math.ceil(g/t.maxGapSize);t.style=="Loop Top"&&(y|=1),i=f,u=g/y,o=y+1}let c;if(r=="Spear Top"){let f=await fetch(Ua+"spear.stp").then(p=>p.blob());c=await Pp(f),c=c.scale(1.1*t.tubeDiameter/20).translateZ(10*t.tubeDiameter/20)}{let f=bo(t.width,t.flatWidth,t.flatHeight).translate([.5*t.width,0,0]);n(f)}if(r=="Arched Spear"||r=="Continuous Scroll"||r=="Cross Top"||r=="Double Flat"||r=="Hi-Low Spear"||r=="Intermitten Ring"||r=="Loop & Spear"||r=="Loop Top"||r=="Lorraine"||r=="Macintyre"||r=="Oakwood"||r=="Open Rail"||r=="Open Rail Scroll"||r=="Oxley Ring"||r=="Ring & Scroll"||r=="Rod Top"||r=="Sapphire"||r=="Spear Top"||r=="Windsor Ring"){let f=bo(t.width,t.flatWidth,t.flatHeight).translate([.5*t.width,0,t.secondaryHeight-.5*t.flatHeight]);n(f)}if(r=="Flat Top"||r=="Continuous Scroll"||r=="Cross Top"||r=="Double Flat"||r=="Intermitten Ring"||r=="Lorraine"||r=="Macintyre"||r=="Oakwood"||r=="Open Rail"||r=="Open Rail Scroll"||r=="Oxley Ring"||r=="Ring & Scroll"||r=="Sapphire"||r=="Windsor Ring"){let f=bo(t.width,t.flatWidth,t.flatHeight).translate([.5*t.width,0,t.height-.5*t.flatHeight]);n(f)}if(r=="Flat Top"||r=="Double Flat"||r=="Spear Top"){let f=i;for(let p=0;p<o;++p){let g=ji(.5*t.tubeDiameter,t.height).translateX(f);n(g),f+=u}}if(r=="Continuous Scroll"){let f=i;for(let p=0;p<o;++p){let y=p==0||p==o-1?t.height:t.secondaryHeight,m=ji(.5*t.tubeDiameter,y).translateX(f);n(m),f+=u}}if(r=="Spear Top"&&c!=null){let f=i,p=u,g=o;for(let y=0;y<g;++y){let m=c.clone().translateX(f).translateZ(t.height);n(m),f+=p}}if(r=="Continuous Scroll"){let f=3*u,p=t.height-t.secondaryHeight-t.flatHeight,g=t.width-2*t.endGap,y=Math.floor(g/f),_=.5*t.width-.5*(y*f),E=Wp({width:f,height:p,steelWidth:t.tubeDiameter,steelHeight:2}).translateZ(t.secondaryHeight+.5*t.flatHeight);for(let x=0;x<y;++x)n(E.clone().translateX(_)),_+=f;E.delete()}if(r=="Loop Top"){let f=Math.floor(o/2),p=i,g=2*u;for(let y=0;y<f;++y){let m=p+g*y,_=Hp({height:t.height,tubeDiameter:t.tubeDiameter,loopDiameter:u});_=_.translateX(m),n(_)}}return c?.delete(),e}function Hp(t){return new dn().movePointerTo([0,0]).lineTo([0,t.height-.5*t.loopDiameter]).ellipseTo([t.loopDiameter,t.height-.5*t.loopDiameter],.5*t.loopDiameter,.5*t.loopDiameter).lineTo([t.loopDiameter,0]).done().sweepSketch((n,o)=>Al(.5*t.tubeDiameter,{plane:n,origin:o})).rotate(90,void 0,[1,0,0])}function Wp(t){let e=t.width-t.steelHeight,r=t.height-t.steelHeight,n=.5*r,o=.5*r/(.5*e-.5*r),i=Math.sqrt(1-o*o);return new dn().movePointerTo([n+n*o,n-n*i]).threePointsArcTo([n+n*o,n+n*i],[0,n]).lineTo([e-n-n*o,n-n*i]).threePointsArcTo([e-n-n*o,n+n*i],[e,n]).done().sweepSketch((f,p)=>new dn(f).movePointerTo([-.5*t.steelHeight,-.5*t.steelWidth]).lineTo([-.5*t.steelHeight,.5*t.steelWidth]).lineTo([.5*t.steelHeight,.5*t.steelWidth]).lineTo([.5*t.steelHeight,-.5*t.steelWidth]).close()).rotate(90,void 0,[1,0,0]).translateZ(.5*t.steelHeight)}})();
