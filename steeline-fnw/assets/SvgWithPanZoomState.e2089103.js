import{f as V,c as D,o as I,g,z as N,a as q,L as W,i as Z,b as G,e as O,s as o,S as A,N as B,C as j,t as R,u as F}from"./index.5aba22ff.js";import{V as U}from"./Vec3.ce1f4f7a.js";const J=R('<svg><rect fill="url(#grid)"></rect></svg>',4,!0),K=R('<svg><defs><pattern id="smallGrid" patternUnits="userSpaceOnUse"><path fill="none" stroke="gray"></path></pattern><pattern id="grid" patternUnits="userSpaceOnUse"><rect fill="url(#smallGrid)"></rect><path fill="none" stroke="gray"></path></pattern><marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7"></polygon></marker></defs><g></g></svg>'),et=s=>{let t;const[n,P]=D({svgWidth:400,svgHeight:300}),r=a=>{t!=null&&(P("svgWidth",t.clientWidth),P("svgHeight",t.clientHeight))};let Y=a=>{s.onTouchStart&&s.onTouchStart(a)},X=a=>{s.onTouchMove&&s.onTouchMove(a)},c=a=>{s.onTouchEnd&&s.onTouchEnd(a)},d=a=>{s.onWheel?.call(void 0,a)};I(()=>{g(()=>{t!=null&&(P("svgWidth",t.clientWidth),P("svgHeight",t.clientHeight))}),window.addEventListener("resize",r),t!=null&&(s.onRefSvg!=null&&s.onRefSvg(t),t.addEventListener("touchstart",Y,{passive:!1}),t.addEventListener("touchmove",X,{passive:!1}),t.addEventListener("touchend",c,{passive:!1}),t.addEventListener("wheel",d)),s.onInit&&s.onInit({svgWidth:()=>n.svgWidth,svgHeight:()=>n.svgHeight})}),N(()=>{window.removeEventListener("resize",r),t!=null&&(t.removeEventListener("touchstart",Y),t.removeEventListener("touchmove",X),t.removeEventListener("touchend",c),t.removeEventListener("wheel",d))});let i=q(()=>s.gridScale??8);return(()=>{const a=K.cloneNode(!0),u=a.firstChild,l=u.firstChild,v=l.firstChild,f=l.nextSibling,M=f.firstChild,_=M.nextSibling,S=u.nextSibling;W(a,"mousemove",s.onMouseMove,!0),W(a,"mouseup",s.onMouseUp,!0),W(a,"mousedown",s.onMouseDown,!0);const $=t;return typeof $=="function"?F($,a):t=a,Z(S,G(A,{get when(){return s.showGrid},get children(){const e=J.cloneNode(!0);return O(h=>{const m=s.state.panX,w=s.state.panY,E=n.svgWidth/s.state.scale+"px",T=n.svgHeight/s.state.scale+"px";return m!==h._v$&&o(e,"x",h._v$=m),w!==h._v$2&&o(e,"y",h._v$2=w),E!==h._v$3&&o(e,"width",h._v$3=E),T!==h._v$4&&o(e,"height",h._v$4=T),h},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),e}}),null),Z(S,()=>s.children,null),Z(a,G(B,{get when(){return s.uiSvgOverlay},children:e=>e()({})}),null),O(e=>{const h=s.svgWidth,m=s.svgHeight,w={border:"solid","border-width":"1px","font-size":s.fontSize+"pt",...s.style??{}},E=i().toString(),T=i().toString(),p="M "+i()+" 0 L 0 0 0 "+i(),L=.5/s.state.scale,y=(10*i()).toString(),b=(10*i()).toString(),x=(10*i()).toString(),H=(10*i()).toString(),z="M "+10*i()+" 0 L 0 0 0 "+10*i(),k=1/s.state.scale,C="scale("+s.state.scale+") translate("+-s.state.panX+"px, "+-s.state.panY+"px)";return h!==e._v$5&&o(a,"width",e._v$5=h),m!==e._v$6&&o(a,"height",e._v$6=m),e._v$7=j(a,w,e._v$7),E!==e._v$8&&o(l,"width",e._v$8=E),T!==e._v$9&&o(l,"height",e._v$9=T),p!==e._v$10&&o(v,"d",e._v$10=p),L!==e._v$11&&o(v,"stroke-width",e._v$11=L),y!==e._v$12&&o(f,"width",e._v$12=y),b!==e._v$13&&o(f,"height",e._v$13=b),x!==e._v$14&&o(M,"width",e._v$14=x),H!==e._v$15&&o(M,"height",e._v$15=H),z!==e._v$16&&o(_,"d",e._v$16=z),k!==e._v$17&&o(_,"stroke-width",e._v$17=k),C!==e._v$18&&S.style.setProperty("transform",e._v$18=C),e},{_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0,_v$16:void 0,_v$17:void 0,_v$18:void 0}),a})()};V(["mousedown","mouseup","mousemove"]);function st(){return{scale:1,panX:0,panY:0,isPanning:!1,touchPanZoom:void 0}}class nt{constructor(t){this.state=t.state,this.setState=t.setState,this.disablePan=t.disablePan}startPan(t,n){g(()=>{this.setState("isPanning",!0),this.setState("panStartScreenX",t),this.setState("panStartScreenY",n),this.setState("panStartWorldX",this.state.panX),this.setState("panStartWorldY",this.state.panY)})}endPan(){g(()=>{this.setState("isPanning",!1),this.setState("panStartScreenX",void 0),this.setState("panStartScreenY",void 0),this.setState("panStartWorldX",void 0),this.setState("panStartWorldY",void 0)})}movePan(t,n){g(()=>{this.state.panStartScreenX!=null&&this.state.panStartScreenY!=null&&this.state.panStartWorldX!=null&&this.state.panStartWorldY!=null&&(this.setState("panX",this.state.panStartWorldX-(t-this.state.panStartScreenX)/this.state.scale),this.setState("panY",this.state.panStartWorldY-(n-this.state.panStartScreenY)/this.state.scale))})}zoomIn(t,n){g(()=>{this.setState("panX",this.state.panX+t*.1/(this.state.scale*1.1)),this.setState("panY",this.state.panY+n*.1/(this.state.scale*1.1)),this.setState("scale",this.state.scale*1.1)})}zoomOut(t,n){g(()=>{this.setState("panX",this.state.panX-t*.1/this.state.scale),this.setState("panY",this.state.panY-n*.1/this.state.scale),this.setState("scale",this.state.scale/1.1)})}resetPanZoom(){g(()=>{this.setState("scale",1),this.setState("panX",0),this.setState("panY",0)})}screenPtToWorldPt(t,n){return U.create(this.state.panX+t/this.state.scale,-this.state.panY-n/this.state.scale)}worldPtToScreenPt(t){return U.create((t.x-this.state.panX)*this.state.scale,-(t.y+this.state.panY)*this.state.scale)}mouseAndTouchEventHandlers(){return{onMouseDown:t=>this.onMouseDown(t),onMouseUp:t=>this.onMouseUp(t),onMouseMove:t=>this.onMouseMove(t),onWheel:t=>this.onWheel(t),onTouchStart:t=>this.onTouchStart(t),onTouchMove:t=>this.onTouchMove(t),onTouchEnd:t=>this.onTouchEnd(t)}}onMouseDown(t){!this.state.isPanning&&!this.disablePan()&&this.startPan(t.clientX,t.clientY)}onMouseUp(t){this.state.isPanning&&this.endPan()}onMouseMove(t){this.state.isPanning&&this.movePan(t.clientX,t.clientY)}onWheel(t){t.deltaY>0?this.zoomOut(t.offsetX,t.offsetY):t.deltaY<0&&this.zoomIn(t.offsetX,t.offsetY)}onTouchStart(t){if(!this.disablePan()){let n=t.target;for(;n!=null&&n!=null&&!(n instanceof SVGSVGElement);)n=n.parentElement;if(n==null||n==null)return;let r=n.getBoundingClientRect(),Y=window.pageXOffset||document.documentElement.scrollLeft,X=window.pageYOffset||document.documentElement.scrollTop,c=Y+r.left,d=X+r.top,i=t.touches[0].pageX-c,a=t.touches[0].pageY-d,u;if(t.touches.length==2){let l=t.touches[1].pageX-t.touches[0].pageX,v=t.touches[1].pageY-t.touches[0].pageY,f=Math.sqrt(l*l+v*v);u={startScreenX:t.touches[1].pageX-c,startScreenY:t.touches[1].pageY-d,startScale:this.state.scale,startGap:f}}this.setState("touchPanZoom",{startScreenX:i,startScreenY:a,startPanX:this.state.panX,startPanY:this.state.panY,secondTouch:u})}}onTouchMove(t){if(this.disablePan()){this.setState("touchPanZoom",void 0);return}g(()=>{if(this.state.touchPanZoom!=null){let n=t.target;for(;n!=null&&n!=null&&!(n instanceof SVGSVGElement);)n=n.parentElement;if(n==null||n==null)return;let r=n.getBoundingClientRect(),Y=window.pageXOffset||document.documentElement.scrollLeft,X=window.pageYOffset||document.documentElement.scrollTop,c=Y+r.left,d=X+r.top,i=t.touches[0].pageX-c,a=t.touches[0].pageY-d;if(this.state.touchPanZoom.secondTouch!=null){let u=.5*(i+(t.touches[1].pageX-c)),l=.5*(a+(t.touches[1].pageY-d)),v=t.touches[1].pageX-t.touches[0].pageX,f=t.touches[1].pageY-t.touches[0].pageY,_=Math.sqrt(v*v+f*f)/this.state.touchPanZoom.secondTouch.startGap,S=this.state.touchPanZoom.secondTouch.startScale,$=S*_,e=this.state.touchPanZoom.startPanX-(u-.5*(this.state.touchPanZoom.startScreenX+this.state.touchPanZoom.secondTouch.startScreenX))/S,h=this.state.touchPanZoom.startPanY-(l-.5*(this.state.touchPanZoom.startScreenY+this.state.touchPanZoom.secondTouch.startScreenY))/S,m=e+u/$*(_-1),w=h+l/$*(_-1);this.setState("panX",m),this.setState("panY",w),this.setState("scale",$)}else this.setState("panX",this.state.touchPanZoom.startPanX-(i-this.state.touchPanZoom.startScreenX)/this.state.scale),this.setState("panY",this.state.touchPanZoom.startPanY-(a-this.state.touchPanZoom.startScreenY)/this.state.scale)}})}onTouchEnd(t){this.state.touchPanZoom!=null&&this.setState("touchPanZoom",void 0)}}export{et as S,nt as a,st as m};
