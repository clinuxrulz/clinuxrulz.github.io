import{f as ve,c as ye,o as Y,a as x,W as I,X as me,b,e as S,s as c,$ as q,S as j,m as xe,z as G,i as H,C as z,d as W,M as J,I as O,u as X,t as M}from"./index.5aba22ff.js";import{V as w}from"./Vec3.ce1f4f7a.js";const $e=M('<svg><line stroke-width="1.2" stroke="blue"></line></svg>',4,!0),_e=M('<svg><path style="stroke: rgb(0,0,0); stroke-width: 2; vector-effect: non-scaling-stroke;" fill="none"></path></svg>',4,!0),K=M('<svg><text text-anchor="middle" dominant-baseline="central"></text></svg>',4,!0),Q=M('<svg><foreignObject width="100" height="150"><input></foreignObject></svg>',5,!0),Se=M('<svg><path fill="none" stroke="blue" style="stroke-width: 2; vector-effect: non-scaling-stroke;"></path></svg>',4,!0),Z=M('<svg><line stroke="black" marker-end="url(#arrowhead)" style="stroke-width: 1.5; vector-effect: non-scaling-stroke;"></line></svg>',4,!0),be=M("<svg><text>Colour</text></svg>",4,!0),De=M("<svg><text>Tapered</text></svg>",4,!0),we=g=>{let E,[$,_]=ye({labelUnderMouse:void 0});Y(()=>{g.onInit!=null&&g.onInit({editing:()=>$.editingDim!=null,cancelEditing:()=>_("editingDim",void 0),labelUnderMouse:()=>$.labelUnderMouse})});let U=(e,t)=>{setTimeout(()=>{E?.focus(),E?.select()}),_("labelUnderMouse",void 0),_("editingDim",{type:"length",index:e,initValue:t})},F=(e,t)=>{setTimeout(()=>{E?.focus(),E?.select()}),_("labelUnderMouse",void 0),_("editingDim",{type:"angle",index:e,initValue:t})};const P=()=>g.flashingPoints,B=x(()=>{let e=[],t=P(),n=I(t);for(let r of n)e.push({x1:r.from.x,y1:-r.from.y,x2:r.to.x,y2:-r.to.y});return e}),p=x(()=>{let e=[],t=P(),n=I(t);const r=8;for(let s of n){let d=s.from,i=s.to,a=i.x-d.x,o=i.y-d.y,l=Math.sqrt(a*a+o*o),f=l,u=Math.round(f)+"mm",h=.5*(d.x+i.x),v=.5*(d.y+i.y),y=a/l,m=o/l,D=-m,L=y,N=h-D*r,T=v-L*r,A=-Math.atan2(m,y)*180/Math.PI;e.push({x:N,y:-T,angle:A,text:u,length:f})}return e}),ee=x(()=>{let e=[],t=P(),n=I(t);for(let r=0;r<n.length-1;++r){let s=n[r].from,d=n[r].to,i=n[r+1].to,a=d.x-s.x,o=d.y-s.y,l=i.x-d.x,f=i.y-d.y,u=Math.sqrt(a*a+o*o),h=Math.sqrt(l*l+f*f),v=a/u,y=o/u,m=l/h,D=f/h,L=180-Math.abs(t.segments[r+1].turnAngle),N=L==0?"Squash":Math.round(L)+"\xB0",T=.5*(-v+m),A=.5*(-y+D),V=Math.sqrt(T*T+A*A),ie=T/V,de=A/V,ue=d.x+ie*20,se=-(d.y+de*20),ae=d.x,oe=-d.y,fe=5,ge=-Math.atan2(-y,-v)*180/Math.PI,ce=-Math.atan2(D,m)*180/Math.PI,he=y*m-v*D<=0;e.push({textX:ue,textY:se,text:N,arcX:ae,arcY:oe,arcRadius:fe,arcStartAngle:ge,arcEndAngle:ce,arcOtherSide:he,angle:L})}return e}),te=x(()=>{let e=g.colourSide;if(e==null)return;let t=B(),n,r;for(let s=0;s<t.length;++s){let d=t[s],i=d.x2-d.x1,a=-d.y2- -d.y1,o=e.x-d.x1,l=e.y- -d.y1,f=Math.max(0,Math.min(1,(o*i+l*a)/(i*i+a*a))),u=d.x1+f*i,h=-d.y1+f*a,v=u-e.x,y=h-e.y,m=v*v+y*y;(r==null||m<r)&&(n={x:u,y:h},r=m)}if(n!=null)return{x1:e.x,y1:-e.y,x2:n.x,y2:-n.y}});let R;{let e=x(()=>{let t=B().map(({x1:r,y1:s,x2:d,y2:i})=>({x1:r,y1:-s,x2:d,y2:-i}));if(t.length==0)return[];let n=[];n.push({index:0,pt:w.create(t[0].x1,t[0].y1)});for(let r=0;r<t.length-1;++r){let s=t[r],d=t[r+1],i=d.x1-s.x2,a=d.y1-s.y2,o=i*i+a*a,l=r+1;o>1e-6?(n.push({index:l,pt:w.create(s.x2,s.y2)}),n.push({index:l,pt:w.create(d.x1,d.y1)})):n.push({index:l,pt:w.create(s.x2,s.y2)})}return n.push({index:t.length,pt:w.create(t[t.length-1].x2,t[t.length-1].y2)}),n});R=x(()=>g.taperedPointMarkers.flatMap(t=>{let n=w.create(t.x,t.y),s=e().filter(({index:i})=>i==t.targetPointIndex),d;if(s.length==0)return[];if(s.length==2){let i=n.distanceSquared(s[0].pt),a=n.distanceSquared(s[1].pt);i<a?d=s[0].pt:d=s[1].pt}else d=s[0].pt;return[{x1:n.x,y1:-n.y,x2:d.x,y2:-d.y}]}))}const k=e=>{let t,n;return{onTouchStart:r=>{t=r,n!=null&&(clearTimeout(n),n=void 0),n=setTimeout(()=>{n=void 0,t!=null&&e.onTouchDragStart(t)},200),r.preventDefault()},onTouchEnd:r=>{n!=null&&(clearTimeout(n),n=void 0,t!=null&&e.onTouchPress(t)),t=void 0,r.preventDefault()}}};let C=x(()=>{let e=P();if(e.start==null)return;let t=me(e),n="M"+e.start.x+" "+-e.start.y;for(let r of t)switch(r.type){case"line":n+=" L"+r.to.x+" "+-r.to.y,Math.atan2(r.to.x-r.from.x,r.to.y-r.from.y)*180/Math.PI;break;case"squash":n+=" A"+r.arcRadius+" "+r.arcRadius+" 0 0 "+r.sideFlag+" "+r.to.x+" "+-r.to.y;break}return n}),ne=x(()=>{let e=g.highlightLinesByIndices;if(e==null||e.length==0)return;let t=I(P());return b(q,{each:e,children:n=>{if(n<0||n>=t.length)return;let r=t[n];return(()=>{const s=$e.cloneNode(!0);return S(d=>{const i=r.from.x,a=-r.from.y,o=r.to.x,l=-r.to.y;return i!==d._v$&&c(s,"x1",d._v$=i),a!==d._v$2&&c(s,"y1",d._v$2=a),o!==d._v$3&&c(s,"x2",d._v$3=o),l!==d._v$4&&c(s,"y2",d._v$4=l),d},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),s})()}})}),le=x(()=>{let e=new Set;if(g.highlightLengthLabelsByIndices==null)return e;for(let t of g.highlightLengthLabelsByIndices)e.add(t);return e}),re=x(()=>{let e=new Set;if(g.highlightAngleLabelsByIndices==null)return e;for(let t of g.highlightAngleLabelsByIndices)e.add(t);return e});return[b(j,{get when(){return C()!=null},get children(){const e=_e.cloneNode(!0);return S(()=>c(e,"d",C())),e}}),xe(ne),b(O,{get each(){return p()},children:(e,t)=>{let n=x(()=>le().has(t)),r=x(()=>{let i=g.flashingPoints.segments[t];return i.lengthLabelOffset!=null?{x:i.lengthLabelOffset.x,y:i.lengthLabelOffset.y}:{x:0,y:0}}),s=x(()=>{let i=Math.cos(e().angle*Math.PI/180),a=Math.sin(e().angle*Math.PI/180);return Math.asin(Math.abs(a))*180/Math.PI<70?i<=0?{angle:e().angle-180,isFlip:!0}:{angle:e().angle,isFlip:!1}:a<=0?{angle:e().angle-180,isFlip:!0}:{angle:e().angle,isFlip:!1}}),d=x(()=>{let{onTouchStart:i,onTouchEnd:a}=k({onTouchPress:l=>{g.onSetLength!=null&&U(t,Math.round(e().length))},onTouchDragStart:l=>{let u=l.target.ownerSVGElement;if(g.onStartDraggingLengthLabel==null||l.targetTouches.length==0)return;let h=u.getBoundingClientRect(),v=window.pageXOffset||document.documentElement.scrollLeft,y=window.pageYOffset||document.documentElement.scrollTop,m=l.touches[0].clientX-(h.left+v),D=l.touches[0].clientY-(h.top+y);g.onStartDraggingLengthLabel(t,m,D),l.stopPropagation()}}),o;return Y(()=>{o!=null&&(o.addEventListener("touchstart",i,{passive:!1}),o.addEventListener("touchend",a,{passive:!1}))}),G(()=>{o!=null&&(o.removeEventListener("touchstart",i),o.removeEventListener("touchend",a))}),(()=>{const l=K.cloneNode(!0);l.addEventListener("mouseleave",u=>{$.labelUnderMouse?.type=="Length"&&$.labelUnderMouse.index==t&&_("labelUnderMouse",void 0)}),l.addEventListener("mouseenter",u=>{_("labelUnderMouse",{type:"Length",index:t})}),l.$$mousedown=u=>{g.onStartDraggingLengthLabel!=null&&(g.onStartDraggingLengthLabel(t,u.offsetX,u.offsetY),u.stopPropagation())},l.$$dblclick=()=>{g.onSetLength!=null&&U(t,Math.round(e().length))};const f=o;return typeof f=="function"?X(f,l):o=l,H(l,()=>e().text),S(u=>{const h="translate("+(e().x+r().x)+", "+(e().y+r().y)+") rotate("+s().angle+")",v=n()?"blue":"black",y=g.onStartDraggingLengthLabel!=null?"cursor:move;":void 0;return h!==u._v$5&&c(l,"transform",u._v$5=h),v!==u._v$6&&c(l,"fill",u._v$6=v),u._v$7=z(l,y,u._v$7),u},{_v$5:void 0,_v$6:void 0,_v$7:void 0}),l})()});return b(W,{get fallback(){return d()},get children(){return b(J,{get when(){return $.editingDim?.type=="length"&&$.editingDim.index==t},get children(){const i=Q.cloneNode(!0),a=i.firstChild;a.$$focusout=()=>_("editingDim",void 0),a.$$keydown=l=>{if(l.key=="Enter"){let f=l.target,u=Number.parseFloat(f.value);if(u==Number.NaN)return;_("editingDim",void 0),g.onSetLength&&g.onSetLength(t,u)}else l.key=="Escape"&&_("editingDim",void 0)};const o=E;return typeof o=="function"?X(o,a):E=a,S(l=>{const f=e().x-10,u=e().y-10;return f!==l._v$8&&c(i,"x",l._v$8=f),u!==l._v$9&&c(i,"y",l._v$9=u),l},{_v$8:void 0,_v$9:void 0}),S(()=>a.value=$.editingDim?.type=="length"?$.editingDim.initValue:void 0),i}})}})}}),b(O,{get each(){return ee()},children:(e,t)=>{let n=x(()=>re().has(t)),r=x(()=>{let i=e().arcX,a=e().arcY,o=e().arcStartAngle,l=e().arcEndAngle,f=e().arcRadius,u=i+Math.cos(o*Math.PI/180)*f,h=a+Math.sin(o*Math.PI/180)*f,v=i+Math.cos(l*Math.PI/180)*f,y=a+Math.sin(l*Math.PI/180)*f,m=e().arcOtherSide?1:0;return{arcRadius:f,arcStartX:u,arcStartY:h,arcEndX:v,arcEndY:y,arcSide:m}}),s=x(()=>{let i=g.flashingPoints.segments[t+1];return i.angleLabelOffset!=null?{x:i.angleLabelOffset.x,y:i.angleLabelOffset.y}:{x:0,y:0}}),d=x(()=>{let{onTouchStart:i,onTouchEnd:a}=k({onTouchPress:l=>{g.onSetAngle!=null&&F(t+1,Math.round(e().angle))},onTouchDragStart:l=>{let u=l.target.ownerSVGElement;if(g.onStartDraggingAngleLabel==null||l.targetTouches.length==0)return;let h=u.getBoundingClientRect(),v=window.pageXOffset||document.documentElement.scrollLeft,y=window.pageYOffset||document.documentElement.scrollTop,m=l.touches[0].clientX-(h.left+v),D=l.touches[0].clientY-(h.top+y);g.onStartDraggingAngleLabel(t+1,m,D)}}),o;return Y(()=>{o!=null&&(o.addEventListener("touchstart",i,{passive:!1}),o.addEventListener("touchend",a,{passive:!1}))}),G(()=>{o!=null&&(o.removeEventListener("touchstart",i),o.removeEventListener("touchend",a))}),(()=>{const l=K.cloneNode(!0);l.addEventListener("mouseleave",u=>{$.labelUnderMouse?.type=="Angle"&&$.labelUnderMouse.index==t&&_("labelUnderMouse",void 0)}),l.addEventListener("mouseenter",u=>{_("labelUnderMouse",{type:"Angle",index:t})}),l.$$mousedown=u=>{g.onStartDraggingAngleLabel!=null&&(g.onStartDraggingAngleLabel(t+1,u.offsetX,u.offsetY),u.stopPropagation())},l.$$dblclick=()=>{g.onSetAngle!=null&&F(t+1,Math.round(e().angle))};const f=o;return typeof f=="function"?X(f,l):o=l,H(l,()=>e().text),S(u=>{const h=e().textX+s().x,v=e().textY+s().y,y=g.onStartDraggingAngleLabel!=null?"cursor:move;":void 0,m=n()?"blue":"black";return h!==u._v$10&&c(l,"x",u._v$10=h),v!==u._v$11&&c(l,"y",u._v$11=v),u._v$12=z(l,y,u._v$12),m!==u._v$13&&c(l,"fill",u._v$13=m),u},{_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0}),l})()});return[b(j,{get when(){return e().angle!=0},get children(){const i=Se.cloneNode(!0);return S(()=>c(i,"d","M"+r().arcStartX+" "+r().arcStartY+" A"+r().arcRadius+" "+r().arcRadius+" 0 0 "+r().arcSide+" "+r().arcEndX+" "+r().arcEndY)),i}}),b(W,{get fallback(){return d()},get children(){return b(J,{get when(){return $.editingDim?.type=="angle"&&$.editingDim.index==t+1},get children(){const i=Q.cloneNode(!0),a=i.firstChild;a.$$focusout=()=>_("editingDim",void 0),a.$$keydown=l=>{if(l.key=="Enter"){let f=l.target,u=Number.parseFloat(f.value);if(u==Number.NaN)return;_("editingDim",void 0),g.onSetAngle&&g.onSetAngle(t,u)}};const o=E;return typeof o=="function"?X(o,a):E=a,S(l=>{const f=e().textX-10,u=e().textY-10;return f!==l._v$14&&c(i,"x",l._v$14=f),u!==l._v$15&&c(i,"y",l._v$15=u),l},{_v$14:void 0,_v$15:void 0}),S(()=>a.value=$.editingDim?.type=="angle"?$.editingDim?.initValue:void 0),i}})}})]}}),b(O,{get each(){return(()=>{let e=te();return e==null?[]:[e]})()},children:e=>[(()=>{const t=Z.cloneNode(!0);return S(n=>{const r=e().x1,s=e().y1,d=e().x2,i=e().y2;return r!==n._v$16&&c(t,"x1",n._v$16=r),s!==n._v$17&&c(t,"y1",n._v$17=s),d!==n._v$18&&c(t,"x2",n._v$18=d),i!==n._v$19&&c(t,"y2",n._v$19=i),n},{_v$16:void 0,_v$17:void 0,_v$18:void 0,_v$19:void 0}),t})(),(()=>{const t=be.cloneNode(!0);return S(n=>{const r=e().x1,s=e().y1,d=e().x1>e().x2?"start":"end";return r!==n._v$20&&c(t,"x",n._v$20=r),s!==n._v$21&&c(t,"y",n._v$21=s),d!==n._v$22&&c(t,"text-anchor",n._v$22=d),n},{_v$20:void 0,_v$21:void 0,_v$22:void 0}),t})()]}),b(q,{get each(){return R()},children:e=>[(()=>{const t=Z.cloneNode(!0);return S(n=>{const r=e.x1,s=e.y1,d=e.x2,i=e.y2;return r!==n._v$23&&c(t,"x1",n._v$23=r),s!==n._v$24&&c(t,"y1",n._v$24=s),d!==n._v$25&&c(t,"x2",n._v$25=d),i!==n._v$26&&c(t,"y2",n._v$26=i),n},{_v$23:void 0,_v$24:void 0,_v$25:void 0,_v$26:void 0}),t})(),(()=>{const t=De.cloneNode(!0);return S(n=>{const r=e.x1,s=e.y1,d=e.x1>e.x2?"start":"end";return r!==n._v$27&&c(t,"x",n._v$27=r),s!==n._v$28&&c(t,"y",n._v$28=s),d!==n._v$29&&c(t,"text-anchor",n._v$29=d),n},{_v$27:void 0,_v$28:void 0,_v$29:void 0}),t})()]})]};ve(["dblclick","mousedown","keydown","focusout"]);export{we as F};
