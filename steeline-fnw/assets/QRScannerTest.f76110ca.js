import{c as R,a2 as D,i as F,b as _,N as L,e as T,S as I,f as Q,t as x,ar as j}from"./index.5aba22ff.js";import{e as v,o as N}from"./Component.fa73bdbc.js";import M from"./Flashing.6f39137f.js";import"./Vec3.ce1f4f7a.js";import"./PropertiesForm.c69fa44e.js";import"./Component.6024a649.js";import"./SvgWithPanZoomState.e2089103.js";import"./FlashingRenderer.e92cafa9.js";import"./Line2D.139781b3.js";import"./Ray2D.01cdc921.js";import"./PanelUtils.894b6d74.js";function i(t){return{type:"Keyword",keyword:t,atIdx:0,nextState:{type:"EOF"}}}function l(){return{type:"Whitespace",nextState:{type:"EOF"}}}function S(t){return{type:"Parse String Start",visit:t,nextState:{type:"EOF"}}}function p(t){return{type:"Parse Number",visit:t,value:"",nextState:{type:"EOF"}}}function C(t,e){return{type:"ZeroOrMore",onRowDone:e,mkInner:t,inner:t(),nextState:{type:"EOF"}}}function k(...t){let e={type:"EOF"};for(let n of t)e=B(e,n);return e}function B(t,e){let n=t;for(;;)switch(n.type){case"EOF":return e;default:{if(n.nextState.type=="EOF")return n.nextState=e,t;n=n.nextState}}}function O(t,e,n){let c=!1;switch(t.type){case"Keyword":{if(e!=t.keyword[t.atIdx])return v("Error at "+n);t.atIdx++,t.atIdx==t.keyword.length&&(t=t.nextState);break}case"Whitespace":{e==" "||e=="\r"||e==`
`||e=="	"||(t=t.nextState,c=!0);break}case"Parse String Start":{if(e!='"')return v("Error at "+n+', expected `"`');t={type:"Parse String",visit:t.visit,value:"",nextState:t.nextState};break}case"Parse String":{e=='"'?(t.visit(t.value),t=t.nextState):t.value+=e;break}case"Parse Number":{if(e.match(/[0-9]|\.|\+|\-/))t.value+=e;else{let u=Number.parseFloat(t.value);if(!Number.isFinite(u))return v("Error at "+n+", `"+t.value+"` is not a valid number.");t.visit(u),t=t.nextState,c=!0}break}case"ZeroOrMore":{let u=O(t.inner,e,n);if(u.type=="Err")return N({tryAgain:!0,nextState:t.nextState});let o=u.value;t.inner=o.nextState,c=o.tryAgain,t.inner.type=="EOF"&&(t.inner=t.mkInner(),t.onRowDone());break}case"EOF":return v("Error at "+n+", expected end of input.")}return N({tryAgain:c,nextState:t})}function z(t){let e={reverseColours:!1},n,c,u=k(i("Name"),l(),S(r=>e.name=r),l(),i("Sheetlength"),l(),p(r=>e.sheetLength=r),i(","),l(),i("Ends"),l(),p(r=>e.end1Type=r),i("/"),p(r=>e.end1Dim=r),i(","),l(),p(r=>e.end2Type=r),i("/"),p(r=>e.end2Dim=r),i(":"),l(),C(()=>k(i("Offset"),l(),p(r=>n=r),i(","),l(),i("Angle"),l(),p(r=>c=r),i(","),l(),i("Type 0, Radius 0.0000, ClampHt 0;"),l()),()=>{n!=null&&c!=null&&(e.lines==null&&(e.lines=[]),e.lines.push({offset:n,angle:c}),n=void 0,c=void 0)}),C(()=>k(i("ReverseColours,"),l()),()=>{e.reverseColours=!0}),i("Customer"),l(),S(r=>e.customer=r),i(","),l(),i("Materialname"),l(),S(r=>e.materialName=r),i(","),l(),i("Colour"),l(),S(r=>e.colour=r),i(","),l(),i("JobLength"),l(),p(r=>e.jobLength=r),i(","),l(),i("JobQuantity"),l(),p(r=>e.jobQuantity=r),i(","),l(),i("DateEntered"),l(),S(r=>e.dateEntered=r),i(","),l(),i("DeliveryDate"),l(),S(r=>e.deliveryDate=r),i(","),l(),i("Rotation"),l(),p(r=>e.rotation=r)),o=0;for(let r of t){for(;;){let f=O(u,r,o);if(f.type=="Err")return v(f.message);let{tryAgain:s,nextState:a}=f.value;if(u=a,!s)break}++o}{let r=O(u,"",o);if(r.type=="Err")return v(r.message);let{nextState:f}=r.value;if(u=f,u.type!="EOF")return v("Error at "+o+", expected end of file.")}let m=[],g=e.rotation??0,w=0;if(e.end1Type==2&&e.end1Dim!=null){let r=g+180;for(;r<-180;)r+=360;for(;r>180;)r-=360;m.push({turnAngle:r,length:e.end1Dim}),g=-180}for(let r of e.lines??[])m.push({turnAngle:g,length:r.offset-w}),g=r.angle,w=r.offset;m.push({turnAngle:g,length:(e.sheetLength??0)-w}),e.end2Type==2&&e.end2Dim!=null&&m.push({turnAngle:-180,length:e.end2Dim});let $={start:{x:0,y:0},segments:m};return N({id:"",flashingName:e.name??"",materialName:e.materialName??"",colour:e.colour??"",lengthQtyList:[{length:e.jobLength??0,qty:e.jobQuantity??0}],flashingPoints:$,fontSize:12,taperedPointMarkers:[]})}const J=x('<div>Select File to Scan:<input type="file"><br>Or click div and paste:<br><div tabindex="0"></div></div>'),q=x('<div style="flex-grow: 1; display: flex; flex-direction: column;"><h2>QR Scanner Test</h2></div>'),K=x("<br>"),U=x("<pre></pre>"),W=x('<input class="btn btn-primary" type="button" value="Copy">'),Z=x('<input class="btn btn-primary" type="button" value="Parse Flashing">'),ae=t=>{let[e,n]=R({data:void 0,divBackgroundImage:void 0,divFocused:!1,flashingData:new D(void 0)}),c=u=>{j.scanImage(u,{}).then(o=>{typeof o=="string"?n("data",o):n("data",void 0)}).catch(o=>{n("data","Failed to scan: "+o+".")})};return(()=>{const u=q.cloneNode(!0);return u.firstChild,F(u,_(I,{get when(){return e.flashingData.value==null},get children(){const o=J.cloneNode(!0),m=o.firstChild,g=m.nextSibling,w=g.nextSibling,$=w.nextSibling,r=$.nextSibling,f=r.nextSibling;return g.addEventListener("change",s=>{n("data",void 0);let a=s.currentTarget.files;if(a==null||a.length==0)return;let d=a[0],y=new FileReader;y.onload=function(b){let E=b.target;if(E==null)return;let h=E.result;typeof h=="string"&&n("divBackgroundImage","url('"+h+"')")},y.readAsDataURL(d),c(d)}),f.addEventListener("blur",s=>{n("divFocused",!1)}),f.addEventListener("focus",s=>{n("divFocused",!0)}),f.addEventListener("paste",s=>{n("data",void 0);let a=s.clipboardData;if(a==null)return;let d=0;for(let y of a.types){let b;if(y.match(/Files.*/))b=a.files[d];else if(y.match(/image.*/)){let h=a.items[d].getAsFile();if(h==null){d=d+1;continue}b=h}else{d=d+1;continue}let E=new FileReader;E.onload=function(h){let P=h.target;if(P==null)return;let A=P.result;typeof A=="string"&&n("divBackgroundImage","url('"+A+"')")},E.readAsDataURL(b),c(b);break}}),f.style.setProperty("width","400px"),f.style.setProperty("height","400px"),f.style.setProperty("background-repeat","no-repeat"),f.style.setProperty("background-size","contain"),F(o,_(L,{get when(){return e.data},children:s=>["Data:",K.cloneNode(!0),(()=>{const a=U.cloneNode(!0);return F(a,s),a})(),(()=>{const a=W.cloneNode(!0);return a.$$click=()=>{navigator.clipboard.writeText(s())},a})(),(()=>{const a=Z.cloneNode(!0);return a.$$click=()=>{let d=z(s());if(d.type=="Err"){console.log(d.message);return}let y=d.value;n("flashingData",new D(y))},a})()]}),null),T(s=>{const a=e.divFocused?"2px solid black":"1px solid black",d=e.divBackgroundImage;return a!==s._v$&&f.style.setProperty("border",s._v$=a),d!==s._v$2&&f.style.setProperty("background-image",s._v$2=d),s},{_v$:void 0,_v$2:void 0}),o}}),null),F(u,_(L,{get when(){return e.flashingData.value},children:o=>_(M,{get id(){return o().id},forJob:{jobNumber:"",customerName:""},get init(){return o()},onClose:()=>{n("flashingData",new D(void 0))}})}),null),u})()};Q(["click"]);export{ae as default};
