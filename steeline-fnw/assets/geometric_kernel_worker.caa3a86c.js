(function(){"use strict";var hu=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(t=t||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,o;r.ready=new Promise(function(i,a){n=i,o=a});var s=Object.assign({},r),u="./this.program",c=(i,a)=>{throw a},f=typeof window=="object",p=typeof importScripts=="function",g=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="";function m(i){return r.locateFile?r.locateFile(i,y):y+i}var _,E,x;function k(i){if(i instanceof gs)return;z("exiting due to exception: "+i)}var C,R,O;g?(p?y=require("path").dirname(y)+"/":y=__dirname+"/",O=()=>{R||(C=require("fs"),R=require("path"))},_=function(a,l){return O(),a=R.normalize(a),C.readFileSync(a,l?void 0:"utf8")},x=i=>{var a=_(i,!0);return a.buffer||(a=new Uint8Array(a)),a},E=(i,a,l)=>{O(),i=R.normalize(i),C.readFile(i,function(h,d){h?l(h):a(d.buffer)})},process.argv.length>1&&(u=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(i){if(!(i instanceof gs))throw i}),process.on("unhandledRejection",function(i){throw i}),c=(i,a)=>{if(Ua())throw process.exitCode=i,a;k(a),process.exit(i)},r.inspect=function(){return"[Emscripten Module object]"}):(f||p)&&(p?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),t&&(y=t),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",_=i=>{var a=new XMLHttpRequest;return a.open("GET",i,!1),a.send(null),a.responseText},p&&(x=i=>{var a=new XMLHttpRequest;return a.open("GET",i,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),E=(i,a,l)=>{var h=new XMLHttpRequest;h.open("GET",i,!0),h.responseType="arraybuffer",h.onload=()=>{if(h.status==200||h.status==0&&h.response){a(h.response);return}l()},h.onerror=l,h.send(null)});var $=r.print||console.log.bind(console),z=r.printErr||console.warn.bind(console);Object.assign(r,s),s=null,r.arguments&&r.arguments,r.thisProgram&&(u=r.thisProgram),r.quit&&(c=r.quit);var ae=4,te;r.wasmBinary&&(te=r.wasmBinary);var ee=r.noExitRuntime||!0;typeof WebAssembly!="object"&&Vt("no native wasm support detected");var pe,Me=!1;function Ge(i,a){i||Vt(a)}var ze=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Be(i,a,l){for(var h=a+l,d=a;i[d]&&!(d>=h);)++d;if(d-a>16&&i.buffer&&ze)return ze.decode(i.subarray(a,d));for(var w="";a<d;){var b=i[a++];if(!(b&128)){w+=String.fromCharCode(b);continue}var S=i[a++]&63;if((b&224)==192){w+=String.fromCharCode((b&31)<<6|S);continue}var T=i[a++]&63;if((b&240)==224?b=(b&15)<<12|S<<6|T:b=(b&7)<<18|S<<12|T<<6|i[a++]&63,b<65536)w+=String.fromCharCode(b);else{var A=b-65536;w+=String.fromCharCode(55296|A>>10,56320|A&1023)}}return w}function ie(i,a){return i?Be(qe,i,a):""}function Te(i,a,l,h){if(!(h>0))return 0;for(var d=l,w=l+h-1,b=0;b<i.length;++b){var S=i.charCodeAt(b);if(S>=55296&&S<=57343){var T=i.charCodeAt(++b);S=65536+((S&1023)<<10)|T&1023}if(S<=127){if(l>=w)break;a[l++]=S}else if(S<=2047){if(l+1>=w)break;a[l++]=192|S>>6,a[l++]=128|S&63}else if(S<=65535){if(l+2>=w)break;a[l++]=224|S>>12,a[l++]=128|S>>6&63,a[l++]=128|S&63}else{if(l+3>=w)break;a[l++]=240|S>>18,a[l++]=128|S>>12&63,a[l++]=128|S>>6&63,a[l++]=128|S&63}}return a[l]=0,l-d}function Pe(i,a,l){return Te(i,qe,a,l)}function fe(i){for(var a=0,l=0;l<i.length;++l){var h=i.charCodeAt(l);h>=55296&&h<=57343&&(h=65536+((h&1023)<<10)|i.charCodeAt(++l)&1023),h<=127?++a:h<=2047?a+=2:h<=65535?a+=3:a+=4}return a}var me=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Ie(i,a){for(var l=i,h=l>>1,d=h+a/2;!(h>=d)&&$r[h];)++h;if(l=h<<1,l-i>32&&me)return me.decode(qe.subarray(i,l));for(var w="",b=0;!(b>=a/2);++b){var S=Wt[i+b*2>>1];if(S==0)break;w+=String.fromCharCode(S)}return w}function Xe(i,a,l){if(l===void 0&&(l=2147483647),l<2)return 0;l-=2;for(var h=a,d=l<i.length*2?l/2:i.length,w=0;w<d;++w){var b=i.charCodeAt(w);Wt[a>>1]=b,a+=2}return Wt[a>>1]=0,a-h}function ye(i){return i.length*2}function Oe(i,a){for(var l=0,h="";!(l>=a/4);){var d=F[i+l*4>>2];if(d==0)break;if(++l,d>=65536){var w=d-65536;h+=String.fromCharCode(55296|w>>10,56320|w&1023)}else h+=String.fromCharCode(d)}return h}function Yr(i,a,l){if(l===void 0&&(l=2147483647),l<4)return 0;for(var h=a,d=h+l-4,w=0;w<i.length;++w){var b=i.charCodeAt(w);if(b>=55296&&b<=57343){var S=i.charCodeAt(++w);b=65536+((b&1023)<<10)|S&1023}if(F[a>>2]=b,a+=4,a+4>d)break}return F[a>>2]=0,a-h}function Qo(i){for(var a=0,l=0;l<i.length;++l){var h=i.charCodeAt(l);h>=55296&&h<=57343&&++l,a+=4}return a}function Un(i){var a=fe(i)+1,l=At(a);return l&&Te(i,Ne,l,a),l}function Xr(i,a){Ne.set(i,a)}function Ln(i,a,l){for(var h=0;h<i.length;++h)Ne[a++>>0]=i.charCodeAt(h);l||(Ne[a>>0]=0)}var Tt,Ne,qe,Wt,$r,F,J,lt,Ma;function Oa(i){Tt=i,r.HEAP8=Ne=new Int8Array(i),r.HEAP16=Wt=new Int16Array(i),r.HEAP32=F=new Int32Array(i),r.HEAPU8=qe=new Uint8Array(i),r.HEAPU16=$r=new Uint16Array(i),r.HEAPU32=J=new Uint32Array(i),r.HEAPF32=lt=new Float32Array(i),r.HEAPF64=Ma=new Float64Array(i)}r.INITIAL_MEMORY;var Da,Ba=[],Ia=[],Fa=[];function Ua(){return ee}function Up(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Np(r.preRun.shift());es(Ba)}function Lp(){!r.noFSInit&&!v.init.initialized&&v.init(),v.ignorePermissions=!1,es(Ia)}function Gp(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Wp(r.postRun.shift());es(Fa)}function Np(i){Ba.unshift(i)}function Hp(i){Ia.unshift(i)}function Wp(i){Fa.unshift(i)}var Qt=0,jr=null;function yg(i){return i}function Jo(i){Qt++,r.monitorRunDependencies&&r.monitorRunDependencies(Qt)}function Gn(i){if(Qt--,r.monitorRunDependencies&&r.monitorRunDependencies(Qt),Qt==0&&jr){var a=jr;jr=null,a()}}function Vt(i){r.onAbort&&r.onAbort(i),i="Aborted("+i+")",z(i),Me=!0,i+=". Build with -sASSERTIONS for more info.";var a=new WebAssembly.RuntimeError(i);throw o(a),a}var Vp="data:application/octet-stream;base64,";function La(i){return i.startsWith(Vp)}function Ga(i){return i.startsWith("file://")}var Ke;Ke="replicad_single.wasm",La(Ke)||(Ke=m(Ke));function Na(i){try{if(i==Ke&&te)return new Uint8Array(te);if(x)return x(i);throw"both async and sync fetching of the wasm failed"}catch(a){Vt(a)}}function zp(){if(!te&&(f||p)){if(typeof fetch=="function"&&!Ga(Ke))return fetch(Ke,{credentials:"same-origin"}).then(function(i){if(!i.ok)throw"failed to load wasm binary file at '"+Ke+"'";return i.arrayBuffer()}).catch(function(){return Na(Ke)});if(E)return new Promise(function(i,a){E(Ke,function(l){i(new Uint8Array(l))},a)})}return Promise.resolve().then(function(){return Na(Ke)})}function qp(){var i={a:vg};function a(b,S){var T=b.exports;r.asm=T,pe=r.asm.oa,Oa(pe.buffer),Da=r.asm.va,Hp(r.asm.pa),Gn()}Jo();function l(b){a(b.instance)}function h(b){return zp().then(function(S){return WebAssembly.instantiate(S,i)}).then(function(S){return S}).then(b,function(S){z("failed to asynchronously prepare wasm: "+S),Vt(S)})}function d(){return!te&&typeof WebAssembly.instantiateStreaming=="function"&&!La(Ke)&&!Ga(Ke)&&!g&&typeof fetch=="function"?fetch(Ke,{credentials:"same-origin"}).then(function(b){var S=WebAssembly.instantiateStreaming(b,i);return S.then(l,function(T){return z("wasm streaming compile failed: "+T),z("falling back to ArrayBuffer instantiation"),h(l)})}):h(l)}if(r.instantiateWasm)try{var w=r.instantiateWasm(i,a);return w}catch(b){return z("Module.instantiateWasm callback failed with error: "+b),!1}return d().catch(o),{}}var Fe,xt;function Yp(){return r.HEAP8.length}function es(i){for(;i.length>0;){var a=i.shift();if(typeof a=="function"){a(r);continue}var l=a.func;typeof l=="number"?a.arg===void 0?Hn(l)():Hn(l)(a.arg):l(a.arg===void 0?null:a.arg)}}var Nn=[];function Hn(i){var a=Nn[i];return a||(i>=Nn.length&&(Nn.length=i+1),Nn[i]=a=Da.get(i)),a}function Xp(i,a,l,h){Vt("Assertion failed: "+ie(i)+", at: "+[a?ie(a):"unknown filename",l,h?ie(h):"unknown function"])}function $p(i){return At(i+24)+24}function jp(i){this.excPtr=i,this.ptr=i-24,this.set_type=function(a){J[this.ptr+4>>2]=a},this.get_type=function(){return J[this.ptr+4>>2]},this.set_destructor=function(a){J[this.ptr+8>>2]=a},this.get_destructor=function(){return J[this.ptr+8>>2]},this.set_refcount=function(a){F[this.ptr>>2]=a},this.set_caught=function(a){a=a?1:0,Ne[this.ptr+12>>0]=a},this.get_caught=function(){return Ne[this.ptr+12>>0]!=0},this.set_rethrown=function(a){a=a?1:0,Ne[this.ptr+13>>0]=a},this.get_rethrown=function(){return Ne[this.ptr+13>>0]!=0},this.init=function(a,l){this.set_adjusted_ptr(0),this.set_type(a),this.set_destructor(l),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var a=F[this.ptr>>2];F[this.ptr>>2]=a+1},this.release_ref=function(){var a=F[this.ptr>>2];return F[this.ptr>>2]=a-1,a===1},this.set_adjusted_ptr=function(a){J[this.ptr+16>>2]=a},this.get_adjusted_ptr=function(){return J[this.ptr+16>>2]},this.get_exception_ptr=function(){var a=fu(this.get_type());if(a)return J[this.excPtr>>2];var l=this.get_adjusted_ptr();return l!==0?l:this.excPtr}}function Zp(i,a,l){var h=new jp(i);throw h.init(a,l),i}var re={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return a.exec(i).slice(1)},normalizeArray:(i,a)=>{for(var l=0,h=i.length-1;h>=0;h--){var d=i[h];d==="."?i.splice(h,1):d===".."?(i.splice(h,1),l++):l&&(i.splice(h,1),l--)}if(a)for(;l;l--)i.unshift("..");return i},normalize:i=>{var a=re.isAbs(i),l=i.substr(-1)==="/";return i=re.normalizeArray(i.split("/").filter(h=>!!h),!a).join("/"),!i&&!a&&(i="."),i&&l&&(i+="/"),(a?"/":"")+i},dirname:i=>{var a=re.splitPath(i),l=a[0],h=a[1];return!l&&!h?".":(h&&(h=h.substr(0,h.length-1)),l+h)},basename:i=>{if(i==="/")return"/";i=re.normalize(i),i=i.replace(/\/$/,"");var a=i.lastIndexOf("/");return a===-1?i:i.substr(a+1)},join:function(){var i=Array.prototype.slice.call(arguments,0);return re.normalize(i.join("/"))},join2:(i,a)=>re.normalize(i+"/"+a)};function Kp(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var i=new Uint8Array(1);return function(){return crypto.getRandomValues(i),i[0]}}else if(g)try{var a=require("crypto");return function(){return a.randomBytes(1)[0]}}catch{}return function(){Vt("randomDevice")}}var kt={resolve:function(){for(var i="",a=!1,l=arguments.length-1;l>=-1&&!a;l--){var h=l>=0?arguments[l]:v.cwd();if(typeof h!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!h)return"";i=h+"/"+i,a=re.isAbs(h)}return i=re.normalizeArray(i.split("/").filter(d=>!!d),!a).join("/"),(a?"/":"")+i||"."},relative:(i,a)=>{i=kt.resolve(i).substr(1),a=kt.resolve(a).substr(1);function l(A){for(var B=0;B<A.length&&A[B]==="";B++);for(var I=A.length-1;I>=0&&A[I]==="";I--);return B>I?[]:A.slice(B,I-B+1)}for(var h=l(i.split("/")),d=l(a.split("/")),w=Math.min(h.length,d.length),b=w,S=0;S<w;S++)if(h[S]!==d[S]){b=S;break}for(var T=[],S=b;S<h.length;S++)T.push("..");return T=T.concat(d.slice(b)),T.join("/")}},Jt={ttys:[],init:function(){},shutdown:function(){},register:function(i,a){Jt.ttys[i]={input:[],output:[],ops:a},v.registerDevice(i,Jt.stream_ops)},stream_ops:{open:function(i){var a=Jt.ttys[i.node.rdev];if(!a)throw new v.ErrnoError(43);i.tty=a,i.seekable=!1},close:function(i){i.tty.ops.flush(i.tty)},flush:function(i){i.tty.ops.flush(i.tty)},read:function(i,a,l,h,d){if(!i.tty||!i.tty.ops.get_char)throw new v.ErrnoError(60);for(var w=0,b=0;b<h;b++){var S;try{S=i.tty.ops.get_char(i.tty)}catch{throw new v.ErrnoError(29)}if(S===void 0&&w===0)throw new v.ErrnoError(6);if(S==null)break;w++,a[l+b]=S}return w&&(i.node.timestamp=Date.now()),w},write:function(i,a,l,h,d){if(!i.tty||!i.tty.ops.put_char)throw new v.ErrnoError(60);try{for(var w=0;w<h;w++)i.tty.ops.put_char(i.tty,a[l+w])}catch{throw new v.ErrnoError(29)}return h&&(i.node.timestamp=Date.now()),w}},default_tty_ops:{get_char:function(i){if(!i.input.length){var a=null;if(g){var l=256,h=Buffer.alloc(l),d=0;try{d=C.readSync(process.stdin.fd,h,0,l,-1)}catch(w){if(w.toString().includes("EOF"))d=0;else throw w}d>0?a=h.slice(0,d).toString("utf-8"):a=null}else typeof window<"u"&&typeof window.prompt=="function"?(a=window.prompt("Input: "),a!==null&&(a+=`
`)):typeof readline=="function"&&(a=readline(),a!==null&&(a+=`
`));if(!a)return null;i.input=ro(a,!0)}return i.input.shift()},put_char:function(i,a){a===null||a===10?($(Be(i.output,0)),i.output=[]):a!=0&&i.output.push(a)},flush:function(i){i.output&&i.output.length>0&&($(Be(i.output,0)),i.output=[])}},default_tty1_ops:{put_char:function(i,a){a===null||a===10?(z(Be(i.output,0)),i.output=[]):a!=0&&i.output.push(a)},flush:function(i){i.output&&i.output.length>0&&(z(Be(i.output,0)),i.output=[])}}};function Qp(i,a){qe.fill(0,i,i+a)}function Jp(i,a){return Math.ceil(i/a)*a}function Ha(i){i=Jp(i,65536);var a=cu(65536,i);return a?(Qp(a,i),a):0}var K={ops_table:null,mount:function(i){return K.createNode(null,"/",16895,0)},createNode:function(i,a,l,h){if(v.isBlkdev(l)||v.isFIFO(l))throw new v.ErrnoError(63);K.ops_table||(K.ops_table={dir:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr,lookup:K.node_ops.lookup,mknod:K.node_ops.mknod,rename:K.node_ops.rename,unlink:K.node_ops.unlink,rmdir:K.node_ops.rmdir,readdir:K.node_ops.readdir,symlink:K.node_ops.symlink},stream:{llseek:K.stream_ops.llseek}},file:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr},stream:{llseek:K.stream_ops.llseek,read:K.stream_ops.read,write:K.stream_ops.write,allocate:K.stream_ops.allocate,mmap:K.stream_ops.mmap,msync:K.stream_ops.msync}},link:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr,readlink:K.node_ops.readlink},stream:{}},chrdev:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr},stream:v.chrdev_stream_ops}});var d=v.createNode(i,a,l,h);return v.isDir(d.mode)?(d.node_ops=K.ops_table.dir.node,d.stream_ops=K.ops_table.dir.stream,d.contents={}):v.isFile(d.mode)?(d.node_ops=K.ops_table.file.node,d.stream_ops=K.ops_table.file.stream,d.usedBytes=0,d.contents=null):v.isLink(d.mode)?(d.node_ops=K.ops_table.link.node,d.stream_ops=K.ops_table.link.stream):v.isChrdev(d.mode)&&(d.node_ops=K.ops_table.chrdev.node,d.stream_ops=K.ops_table.chrdev.stream),d.timestamp=Date.now(),i&&(i.contents[a]=d,i.timestamp=d.timestamp),d},getFileDataAsTypedArray:function(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage:function(i,a){var l=i.contents?i.contents.length:0;if(!(l>=a)){var h=1024*1024;a=Math.max(a,l*(l<h?2:1.125)>>>0),l!=0&&(a=Math.max(a,256));var d=i.contents;i.contents=new Uint8Array(a),i.usedBytes>0&&i.contents.set(d.subarray(0,i.usedBytes),0)}},resizeFileStorage:function(i,a){if(i.usedBytes!=a)if(a==0)i.contents=null,i.usedBytes=0;else{var l=i.contents;i.contents=new Uint8Array(a),l&&i.contents.set(l.subarray(0,Math.min(a,i.usedBytes))),i.usedBytes=a}},node_ops:{getattr:function(i){var a={};return a.dev=v.isChrdev(i.mode)?i.id:1,a.ino=i.id,a.mode=i.mode,a.nlink=1,a.uid=0,a.gid=0,a.rdev=i.rdev,v.isDir(i.mode)?a.size=4096:v.isFile(i.mode)?a.size=i.usedBytes:v.isLink(i.mode)?a.size=i.link.length:a.size=0,a.atime=new Date(i.timestamp),a.mtime=new Date(i.timestamp),a.ctime=new Date(i.timestamp),a.blksize=4096,a.blocks=Math.ceil(a.size/a.blksize),a},setattr:function(i,a){a.mode!==void 0&&(i.mode=a.mode),a.timestamp!==void 0&&(i.timestamp=a.timestamp),a.size!==void 0&&K.resizeFileStorage(i,a.size)},lookup:function(i,a){throw v.genericErrors[44]},mknod:function(i,a,l,h){return K.createNode(i,a,l,h)},rename:function(i,a,l){if(v.isDir(i.mode)){var h;try{h=v.lookupNode(a,l)}catch{}if(h)for(var d in h.contents)throw new v.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=l,a.contents[l]=i,a.timestamp=i.parent.timestamp,i.parent=a},unlink:function(i,a){delete i.contents[a],i.timestamp=Date.now()},rmdir:function(i,a){var l=v.lookupNode(i,a);for(var h in l.contents)throw new v.ErrnoError(55);delete i.contents[a],i.timestamp=Date.now()},readdir:function(i){var a=[".",".."];for(var l in i.contents)!i.contents.hasOwnProperty(l)||a.push(l);return a},symlink:function(i,a,l){var h=K.createNode(i,a,41471,0);return h.link=l,h},readlink:function(i){if(!v.isLink(i.mode))throw new v.ErrnoError(28);return i.link}},stream_ops:{read:function(i,a,l,h,d){var w=i.node.contents;if(d>=i.node.usedBytes)return 0;var b=Math.min(i.node.usedBytes-d,h);if(b>8&&w.subarray)a.set(w.subarray(d,d+b),l);else for(var S=0;S<b;S++)a[l+S]=w[d+S];return b},write:function(i,a,l,h,d,w){if(a.buffer===Ne.buffer&&(w=!1),!h)return 0;var b=i.node;if(b.timestamp=Date.now(),a.subarray&&(!b.contents||b.contents.subarray)){if(w)return b.contents=a.subarray(l,l+h),b.usedBytes=h,h;if(b.usedBytes===0&&d===0)return b.contents=a.slice(l,l+h),b.usedBytes=h,h;if(d+h<=b.usedBytes)return b.contents.set(a.subarray(l,l+h),d),h}if(K.expandFileStorage(b,d+h),b.contents.subarray&&a.subarray)b.contents.set(a.subarray(l,l+h),d);else for(var S=0;S<h;S++)b.contents[d+S]=a[l+S];return b.usedBytes=Math.max(b.usedBytes,d+h),h},llseek:function(i,a,l){var h=a;if(l===1?h+=i.position:l===2&&v.isFile(i.node.mode)&&(h+=i.node.usedBytes),h<0)throw new v.ErrnoError(28);return h},allocate:function(i,a,l){K.expandFileStorage(i.node,a+l),i.node.usedBytes=Math.max(i.node.usedBytes,a+l)},mmap:function(i,a,l,h,d){if(!v.isFile(i.node.mode))throw new v.ErrnoError(43);var w,b,S=i.node.contents;if(!(d&2)&&S.buffer===Tt)b=!1,w=S.byteOffset;else{if((l>0||l+a<S.length)&&(S.subarray?S=S.subarray(l,l+a):S=Array.prototype.slice.call(S,l,l+a)),b=!0,w=Ha(a),!w)throw new v.ErrnoError(48);Ne.set(S,w)}return{ptr:w,allocated:b}},msync:function(i,a,l,h,d){if(!v.isFile(i.node.mode))throw new v.ErrnoError(43);return d&2||K.stream_ops.write(i,a,0,h,l,!1),0}}};function ed(i,a,l,h){var d=h?"":"al "+i;E(i,function(w){Ge(w,'Loading data file "'+i+'" failed (no arrayBuffer).'),a(new Uint8Array(w)),d&&Gn()},function(w){if(l)l();else throw'Loading data file "'+i+'" failed.'}),d&&Jo()}var v={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(i,a={})=>{if(i=kt.resolve(v.cwd(),i),!i)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(a=Object.assign(l,a),a.recurse_count>8)throw new v.ErrnoError(32);for(var h=re.normalizeArray(i.split("/").filter(I=>!!I),!1),d=v.root,w="/",b=0;b<h.length;b++){var S=b===h.length-1;if(S&&a.parent)break;if(d=v.lookupNode(d,h[b]),w=re.join2(w,h[b]),v.isMountpoint(d)&&(!S||S&&a.follow_mount)&&(d=d.mounted.root),!S||a.follow)for(var T=0;v.isLink(d.mode);){var A=v.readlink(w);w=kt.resolve(re.dirname(w),A);var B=v.lookupPath(w,{recurse_count:a.recurse_count+1});if(d=B.node,T++>40)throw new v.ErrnoError(32)}}return{path:w,node:d}},getPath:i=>{for(var a;;){if(v.isRoot(i)){var l=i.mount.mountpoint;return a?l[l.length-1]!=="/"?l+"/"+a:l+a:l}a=a?i.name+"/"+a:i.name,i=i.parent}},hashName:(i,a)=>{for(var l=0,h=0;h<a.length;h++)l=(l<<5)-l+a.charCodeAt(h)|0;return(i+l>>>0)%v.nameTable.length},hashAddNode:i=>{var a=v.hashName(i.parent.id,i.name);i.name_next=v.nameTable[a],v.nameTable[a]=i},hashRemoveNode:i=>{var a=v.hashName(i.parent.id,i.name);if(v.nameTable[a]===i)v.nameTable[a]=i.name_next;else for(var l=v.nameTable[a];l;){if(l.name_next===i){l.name_next=i.name_next;break}l=l.name_next}},lookupNode:(i,a)=>{var l=v.mayLookup(i);if(l)throw new v.ErrnoError(l,i);for(var h=v.hashName(i.id,a),d=v.nameTable[h];d;d=d.name_next){var w=d.name;if(d.parent.id===i.id&&w===a)return d}return v.lookup(i,a)},createNode:(i,a,l,h)=>{var d=new v.FSNode(i,a,l,h);return v.hashAddNode(d),d},destroyNode:i=>{v.hashRemoveNode(i)},isRoot:i=>i===i.parent,isMountpoint:i=>!!i.mounted,isFile:i=>(i&61440)===32768,isDir:i=>(i&61440)===16384,isLink:i=>(i&61440)===40960,isChrdev:i=>(i&61440)===8192,isBlkdev:i=>(i&61440)===24576,isFIFO:i=>(i&61440)===4096,isSocket:i=>(i&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:i=>{var a=v.flagModes[i];if(typeof a>"u")throw new Error("Unknown file open mode: "+i);return a},flagsToPermissionString:i=>{var a=["r","w","rw"][i&3];return i&512&&(a+="w"),a},nodePermissions:(i,a)=>v.ignorePermissions?0:a.includes("r")&&!(i.mode&292)||a.includes("w")&&!(i.mode&146)||a.includes("x")&&!(i.mode&73)?2:0,mayLookup:i=>{var a=v.nodePermissions(i,"x");return a||(i.node_ops.lookup?0:2)},mayCreate:(i,a)=>{try{var l=v.lookupNode(i,a);return 20}catch{}return v.nodePermissions(i,"wx")},mayDelete:(i,a,l)=>{var h;try{h=v.lookupNode(i,a)}catch(w){return w.errno}var d=v.nodePermissions(i,"wx");if(d)return d;if(l){if(!v.isDir(h.mode))return 54;if(v.isRoot(h)||v.getPath(h)===v.cwd())return 10}else if(v.isDir(h.mode))return 31;return 0},mayOpen:(i,a)=>i?v.isLink(i.mode)?32:v.isDir(i.mode)&&(v.flagsToPermissionString(a)!=="r"||a&512)?31:v.nodePermissions(i,v.flagsToPermissionString(a)):44,MAX_OPEN_FDS:4096,nextfd:(i=0,a=v.MAX_OPEN_FDS)=>{for(var l=i;l<=a;l++)if(!v.streams[l])return l;throw new v.ErrnoError(33)},getStream:i=>v.streams[i],createStream:(i,a,l)=>{v.FSStream||(v.FSStream=function(){this.shared={}},v.FSStream.prototype={},Object.defineProperties(v.FSStream.prototype,{object:{get:function(){return this.node},set:function(d){this.node=d}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(d){this.shared.flags=d}},position:{get:function(){return this.shared.position},set:function(d){this.shared.position=d}}})),i=Object.assign(new v.FSStream,i);var h=v.nextfd(a,l);return i.fd=h,v.streams[h]=i,i},closeStream:i=>{v.streams[i]=null},chrdev_stream_ops:{open:i=>{var a=v.getDevice(i.node.rdev);i.stream_ops=a.stream_ops,i.stream_ops.open&&i.stream_ops.open(i)},llseek:()=>{throw new v.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,a)=>i<<8|a,registerDevice:(i,a)=>{v.devices[i]={stream_ops:a}},getDevice:i=>v.devices[i],getMounts:i=>{for(var a=[],l=[i];l.length;){var h=l.pop();a.push(h),l.push.apply(l,h.mounts)}return a},syncfs:(i,a)=>{typeof i=="function"&&(a=i,i=!1),v.syncFSRequests++,v.syncFSRequests>1&&z("warning: "+v.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var l=v.getMounts(v.root.mount),h=0;function d(b){return v.syncFSRequests--,a(b)}function w(b){if(b)return w.errored?void 0:(w.errored=!0,d(b));++h>=l.length&&d(null)}l.forEach(b=>{if(!b.type.syncfs)return w(null);b.type.syncfs(b,i,w)})},mount:(i,a,l)=>{var h=l==="/",d=!l,w;if(h&&v.root)throw new v.ErrnoError(10);if(!h&&!d){var b=v.lookupPath(l,{follow_mount:!1});if(l=b.path,w=b.node,v.isMountpoint(w))throw new v.ErrnoError(10);if(!v.isDir(w.mode))throw new v.ErrnoError(54)}var S={type:i,opts:a,mountpoint:l,mounts:[]},T=i.mount(S);return T.mount=S,S.root=T,h?v.root=T:w&&(w.mounted=S,w.mount&&w.mount.mounts.push(S)),T},unmount:i=>{var a=v.lookupPath(i,{follow_mount:!1});if(!v.isMountpoint(a.node))throw new v.ErrnoError(28);var l=a.node,h=l.mounted,d=v.getMounts(h);Object.keys(v.nameTable).forEach(b=>{for(var S=v.nameTable[b];S;){var T=S.name_next;d.includes(S.mount)&&v.destroyNode(S),S=T}}),l.mounted=null;var w=l.mount.mounts.indexOf(h);l.mount.mounts.splice(w,1)},lookup:(i,a)=>i.node_ops.lookup(i,a),mknod:(i,a,l)=>{var h=v.lookupPath(i,{parent:!0}),d=h.node,w=re.basename(i);if(!w||w==="."||w==="..")throw new v.ErrnoError(28);var b=v.mayCreate(d,w);if(b)throw new v.ErrnoError(b);if(!d.node_ops.mknod)throw new v.ErrnoError(63);return d.node_ops.mknod(d,w,a,l)},create:(i,a)=>(a=a!==void 0?a:438,a&=4095,a|=32768,v.mknod(i,a,0)),mkdir:(i,a)=>(a=a!==void 0?a:511,a&=1023,a|=16384,v.mknod(i,a,0)),mkdirTree:(i,a)=>{for(var l=i.split("/"),h="",d=0;d<l.length;++d)if(!!l[d]){h+="/"+l[d];try{v.mkdir(h,a)}catch(w){if(w.errno!=20)throw w}}},mkdev:(i,a,l)=>(typeof l>"u"&&(l=a,a=438),a|=8192,v.mknod(i,a,l)),symlink:(i,a)=>{if(!kt.resolve(i))throw new v.ErrnoError(44);var l=v.lookupPath(a,{parent:!0}),h=l.node;if(!h)throw new v.ErrnoError(44);var d=re.basename(a),w=v.mayCreate(h,d);if(w)throw new v.ErrnoError(w);if(!h.node_ops.symlink)throw new v.ErrnoError(63);return h.node_ops.symlink(h,d,i)},rename:(i,a)=>{var l=re.dirname(i),h=re.dirname(a),d=re.basename(i),w=re.basename(a),b,S,T;if(b=v.lookupPath(i,{parent:!0}),S=b.node,b=v.lookupPath(a,{parent:!0}),T=b.node,!S||!T)throw new v.ErrnoError(44);if(S.mount!==T.mount)throw new v.ErrnoError(75);var A=v.lookupNode(S,d),B=kt.relative(i,h);if(B.charAt(0)!==".")throw new v.ErrnoError(28);if(B=kt.relative(a,l),B.charAt(0)!==".")throw new v.ErrnoError(55);var I;try{I=v.lookupNode(T,w)}catch{}if(A!==I){var D=v.isDir(A.mode),L=v.mayDelete(S,d,D);if(L)throw new v.ErrnoError(L);if(L=I?v.mayDelete(T,w,D):v.mayCreate(T,w),L)throw new v.ErrnoError(L);if(!S.node_ops.rename)throw new v.ErrnoError(63);if(v.isMountpoint(A)||I&&v.isMountpoint(I))throw new v.ErrnoError(10);if(T!==S&&(L=v.nodePermissions(S,"w"),L))throw new v.ErrnoError(L);v.hashRemoveNode(A);try{S.node_ops.rename(A,T,w)}catch(V){throw V}finally{v.hashAddNode(A)}}},rmdir:i=>{var a=v.lookupPath(i,{parent:!0}),l=a.node,h=re.basename(i),d=v.lookupNode(l,h),w=v.mayDelete(l,h,!0);if(w)throw new v.ErrnoError(w);if(!l.node_ops.rmdir)throw new v.ErrnoError(63);if(v.isMountpoint(d))throw new v.ErrnoError(10);l.node_ops.rmdir(l,h),v.destroyNode(d)},readdir:i=>{var a=v.lookupPath(i,{follow:!0}),l=a.node;if(!l.node_ops.readdir)throw new v.ErrnoError(54);return l.node_ops.readdir(l)},unlink:i=>{var a=v.lookupPath(i,{parent:!0}),l=a.node;if(!l)throw new v.ErrnoError(44);var h=re.basename(i),d=v.lookupNode(l,h),w=v.mayDelete(l,h,!1);if(w)throw new v.ErrnoError(w);if(!l.node_ops.unlink)throw new v.ErrnoError(63);if(v.isMountpoint(d))throw new v.ErrnoError(10);l.node_ops.unlink(l,h),v.destroyNode(d)},readlink:i=>{var a=v.lookupPath(i),l=a.node;if(!l)throw new v.ErrnoError(44);if(!l.node_ops.readlink)throw new v.ErrnoError(28);return kt.resolve(v.getPath(l.parent),l.node_ops.readlink(l))},stat:(i,a)=>{var l=v.lookupPath(i,{follow:!a}),h=l.node;if(!h)throw new v.ErrnoError(44);if(!h.node_ops.getattr)throw new v.ErrnoError(63);return h.node_ops.getattr(h)},lstat:i=>v.stat(i,!0),chmod:(i,a,l)=>{var h;if(typeof i=="string"){var d=v.lookupPath(i,{follow:!l});h=d.node}else h=i;if(!h.node_ops.setattr)throw new v.ErrnoError(63);h.node_ops.setattr(h,{mode:a&4095|h.mode&-4096,timestamp:Date.now()})},lchmod:(i,a)=>{v.chmod(i,a,!0)},fchmod:(i,a)=>{var l=v.getStream(i);if(!l)throw new v.ErrnoError(8);v.chmod(l.node,a)},chown:(i,a,l,h)=>{var d;if(typeof i=="string"){var w=v.lookupPath(i,{follow:!h});d=w.node}else d=i;if(!d.node_ops.setattr)throw new v.ErrnoError(63);d.node_ops.setattr(d,{timestamp:Date.now()})},lchown:(i,a,l)=>{v.chown(i,a,l,!0)},fchown:(i,a,l)=>{var h=v.getStream(i);if(!h)throw new v.ErrnoError(8);v.chown(h.node,a,l)},truncate:(i,a)=>{if(a<0)throw new v.ErrnoError(28);var l;if(typeof i=="string"){var h=v.lookupPath(i,{follow:!0});l=h.node}else l=i;if(!l.node_ops.setattr)throw new v.ErrnoError(63);if(v.isDir(l.mode))throw new v.ErrnoError(31);if(!v.isFile(l.mode))throw new v.ErrnoError(28);var d=v.nodePermissions(l,"w");if(d)throw new v.ErrnoError(d);l.node_ops.setattr(l,{size:a,timestamp:Date.now()})},ftruncate:(i,a)=>{var l=v.getStream(i);if(!l)throw new v.ErrnoError(8);if((l.flags&2097155)===0)throw new v.ErrnoError(28);v.truncate(l.node,a)},utime:(i,a,l)=>{var h=v.lookupPath(i,{follow:!0}),d=h.node;d.node_ops.setattr(d,{timestamp:Math.max(a,l)})},open:(i,a,l)=>{if(i==="")throw new v.ErrnoError(44);a=typeof a=="string"?v.modeStringToFlags(a):a,l=typeof l>"u"?438:l,a&64?l=l&4095|32768:l=0;var h;if(typeof i=="object")h=i;else{i=re.normalize(i);try{var d=v.lookupPath(i,{follow:!(a&131072)});h=d.node}catch{}}var w=!1;if(a&64)if(h){if(a&128)throw new v.ErrnoError(20)}else h=v.mknod(i,l,0),w=!0;if(!h)throw new v.ErrnoError(44);if(v.isChrdev(h.mode)&&(a&=-513),a&65536&&!v.isDir(h.mode))throw new v.ErrnoError(54);if(!w){var b=v.mayOpen(h,a);if(b)throw new v.ErrnoError(b)}a&512&&!w&&v.truncate(h,0),a&=-131713;var S=v.createStream({node:h,path:v.getPath(h),flags:a,seekable:!0,position:0,stream_ops:h.stream_ops,ungotten:[],error:!1});return S.stream_ops.open&&S.stream_ops.open(S),r.logReadFiles&&!(a&1)&&(v.readFiles||(v.readFiles={}),i in v.readFiles||(v.readFiles[i]=1)),S},close:i=>{if(v.isClosed(i))throw new v.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(a){throw a}finally{v.closeStream(i.fd)}i.fd=null},isClosed:i=>i.fd===null,llseek:(i,a,l)=>{if(v.isClosed(i))throw new v.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new v.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new v.ErrnoError(28);return i.position=i.stream_ops.llseek(i,a,l),i.ungotten=[],i.position},read:(i,a,l,h,d)=>{if(h<0||d<0)throw new v.ErrnoError(28);if(v.isClosed(i))throw new v.ErrnoError(8);if((i.flags&2097155)===1)throw new v.ErrnoError(8);if(v.isDir(i.node.mode))throw new v.ErrnoError(31);if(!i.stream_ops.read)throw new v.ErrnoError(28);var w=typeof d<"u";if(!w)d=i.position;else if(!i.seekable)throw new v.ErrnoError(70);var b=i.stream_ops.read(i,a,l,h,d);return w||(i.position+=b),b},write:(i,a,l,h,d,w)=>{if(h<0||d<0)throw new v.ErrnoError(28);if(v.isClosed(i))throw new v.ErrnoError(8);if((i.flags&2097155)===0)throw new v.ErrnoError(8);if(v.isDir(i.node.mode))throw new v.ErrnoError(31);if(!i.stream_ops.write)throw new v.ErrnoError(28);i.seekable&&i.flags&1024&&v.llseek(i,0,2);var b=typeof d<"u";if(!b)d=i.position;else if(!i.seekable)throw new v.ErrnoError(70);var S=i.stream_ops.write(i,a,l,h,d,w);return b||(i.position+=S),S},allocate:(i,a,l)=>{if(v.isClosed(i))throw new v.ErrnoError(8);if(a<0||l<=0)throw new v.ErrnoError(28);if((i.flags&2097155)===0)throw new v.ErrnoError(8);if(!v.isFile(i.node.mode)&&!v.isDir(i.node.mode))throw new v.ErrnoError(43);if(!i.stream_ops.allocate)throw new v.ErrnoError(138);i.stream_ops.allocate(i,a,l)},mmap:(i,a,l,h,d)=>{if((h&2)!==0&&(d&2)===0&&(i.flags&2097155)!==2)throw new v.ErrnoError(2);if((i.flags&2097155)===1)throw new v.ErrnoError(2);if(!i.stream_ops.mmap)throw new v.ErrnoError(43);return i.stream_ops.mmap(i,a,l,h,d)},msync:(i,a,l,h,d)=>!i||!i.stream_ops.msync?0:i.stream_ops.msync(i,a,l,h,d),munmap:i=>0,ioctl:(i,a,l)=>{if(!i.stream_ops.ioctl)throw new v.ErrnoError(59);return i.stream_ops.ioctl(i,a,l)},readFile:(i,a={})=>{if(a.flags=a.flags||0,a.encoding=a.encoding||"binary",a.encoding!=="utf8"&&a.encoding!=="binary")throw new Error('Invalid encoding type "'+a.encoding+'"');var l,h=v.open(i,a.flags),d=v.stat(i),w=d.size,b=new Uint8Array(w);return v.read(h,b,0,w,0),a.encoding==="utf8"?l=Be(b,0):a.encoding==="binary"&&(l=b),v.close(h),l},writeFile:(i,a,l={})=>{l.flags=l.flags||577;var h=v.open(i,l.flags,l.mode);if(typeof a=="string"){var d=new Uint8Array(fe(a)+1),w=Te(a,d,0,d.length);v.write(h,d,0,w,void 0,l.canOwn)}else if(ArrayBuffer.isView(a))v.write(h,a,0,a.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");v.close(h)},cwd:()=>v.currentPath,chdir:i=>{var a=v.lookupPath(i,{follow:!0});if(a.node===null)throw new v.ErrnoError(44);if(!v.isDir(a.node.mode))throw new v.ErrnoError(54);var l=v.nodePermissions(a.node,"x");if(l)throw new v.ErrnoError(l);v.currentPath=a.path},createDefaultDirectories:()=>{v.mkdir("/tmp"),v.mkdir("/home"),v.mkdir("/home/web_user")},createDefaultDevices:()=>{v.mkdir("/dev"),v.registerDevice(v.makedev(1,3),{read:()=>0,write:(a,l,h,d,w)=>d}),v.mkdev("/dev/null",v.makedev(1,3)),Jt.register(v.makedev(5,0),Jt.default_tty_ops),Jt.register(v.makedev(6,0),Jt.default_tty1_ops),v.mkdev("/dev/tty",v.makedev(5,0)),v.mkdev("/dev/tty1",v.makedev(6,0));var i=Kp();v.createDevice("/dev","random",i),v.createDevice("/dev","urandom",i),v.mkdir("/dev/shm"),v.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{v.mkdir("/proc");var i=v.mkdir("/proc/self");v.mkdir("/proc/self/fd"),v.mount({mount:()=>{var a=v.createNode(i,"fd",16895,73);return a.node_ops={lookup:(l,h)=>{var d=+h,w=v.getStream(d);if(!w)throw new v.ErrnoError(8);var b={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>w.path}};return b.parent=b,b}},a}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?v.createDevice("/dev","stdin",r.stdin):v.symlink("/dev/tty","/dev/stdin"),r.stdout?v.createDevice("/dev","stdout",null,r.stdout):v.symlink("/dev/tty","/dev/stdout"),r.stderr?v.createDevice("/dev","stderr",null,r.stderr):v.symlink("/dev/tty1","/dev/stderr"),v.open("/dev/stdin",0),v.open("/dev/stdout",1),v.open("/dev/stderr",1)},ensureErrnoError:()=>{v.ErrnoError||(v.ErrnoError=function(a,l){this.node=l,this.setErrno=function(h){this.errno=h},this.setErrno(a),this.message="FS error"},v.ErrnoError.prototype=new Error,v.ErrnoError.prototype.constructor=v.ErrnoError,[44].forEach(i=>{v.genericErrors[i]=new v.ErrnoError(i),v.genericErrors[i].stack="<generic error, no stack>"}))},staticInit:()=>{v.ensureErrnoError(),v.nameTable=new Array(4096),v.mount(K,{},"/"),v.createDefaultDirectories(),v.createDefaultDevices(),v.createSpecialDirectories(),v.filesystems={MEMFS:K}},init:(i,a,l)=>{v.init.initialized=!0,v.ensureErrnoError(),r.stdin=i||r.stdin,r.stdout=a||r.stdout,r.stderr=l||r.stderr,v.createStandardStreams()},quit:()=>{v.init.initialized=!1;for(var i=0;i<v.streams.length;i++){var a=v.streams[i];!a||v.close(a)}},getMode:(i,a)=>{var l=0;return i&&(l|=365),a&&(l|=146),l},findObject:(i,a)=>{var l=v.analyzePath(i,a);return l.exists?l.object:null},analyzePath:(i,a)=>{try{var l=v.lookupPath(i,{follow:!a});i=l.path}catch{}var h={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=v.lookupPath(i,{parent:!0});h.parentExists=!0,h.parentPath=l.path,h.parentObject=l.node,h.name=re.basename(i),l=v.lookupPath(i,{follow:!a}),h.exists=!0,h.path=l.path,h.object=l.node,h.name=l.node.name,h.isRoot=l.path==="/"}catch(d){h.error=d.errno}return h},createPath:(i,a,l,h)=>{i=typeof i=="string"?i:v.getPath(i);for(var d=a.split("/").reverse();d.length;){var w=d.pop();if(!!w){var b=re.join2(i,w);try{v.mkdir(b)}catch{}i=b}}return b},createFile:(i,a,l,h,d)=>{var w=re.join2(typeof i=="string"?i:v.getPath(i),a),b=v.getMode(h,d);return v.create(w,b)},createDataFile:(i,a,l,h,d,w)=>{var b=a;i&&(i=typeof i=="string"?i:v.getPath(i),b=a?re.join2(i,a):i);var S=v.getMode(h,d),T=v.create(b,S);if(l){if(typeof l=="string"){for(var A=new Array(l.length),B=0,I=l.length;B<I;++B)A[B]=l.charCodeAt(B);l=A}v.chmod(T,S|146);var D=v.open(T,577);v.write(D,l,0,l.length,0,w),v.close(D),v.chmod(T,S)}return T},createDevice:(i,a,l,h)=>{var d=re.join2(typeof i=="string"?i:v.getPath(i),a),w=v.getMode(!!l,!!h);v.createDevice.major||(v.createDevice.major=64);var b=v.makedev(v.createDevice.major++,0);return v.registerDevice(b,{open:S=>{S.seekable=!1},close:S=>{h&&h.buffer&&h.buffer.length&&h(10)},read:(S,T,A,B,I)=>{for(var D=0,L=0;L<B;L++){var V;try{V=l()}catch{throw new v.ErrnoError(29)}if(V===void 0&&D===0)throw new v.ErrnoError(6);if(V==null)break;D++,T[A+L]=V}return D&&(S.node.timestamp=Date.now()),D},write:(S,T,A,B,I)=>{for(var D=0;D<B;D++)try{h(T[A+D])}catch{throw new v.ErrnoError(29)}return B&&(S.node.timestamp=Date.now()),D}}),v.mkdev(d,w,b)},forceLoadFile:i=>{if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(_)try{i.contents=ro(_(i.url),!0),i.usedBytes=i.contents.length}catch{throw new v.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(i,a,l,h,d)=>{function w(){this.lengthKnown=!1,this.chunks=[]}if(w.prototype.get=function(L){if(!(L>this.length-1||L<0)){var V=L%this.chunkSize,se=L/this.chunkSize|0;return this.getter(se)[V]}},w.prototype.setDataGetter=function(L){this.getter=L},w.prototype.cacheLength=function(){var L=new XMLHttpRequest;if(L.open("HEAD",l,!1),L.send(null),!(L.status>=200&&L.status<300||L.status===304))throw new Error("Couldn't load "+l+". Status: "+L.status);var V=Number(L.getResponseHeader("Content-length")),se,we=(se=L.getResponseHeader("Accept-Ranges"))&&se==="bytes",xe=(se=L.getResponseHeader("Content-Encoding"))&&se==="gzip",M=1024*1024;we||(M=V);var W=(ce,Qe)=>{if(ce>Qe)throw new Error("invalid range ("+ce+", "+Qe+") or no bytes requested!");if(Qe>V-1)throw new Error("only "+V+" bytes available! programmer error!");var ke=new XMLHttpRequest;if(ke.open("GET",l,!1),V!==M&&ke.setRequestHeader("Range","bytes="+ce+"-"+Qe),ke.responseType="arraybuffer",ke.overrideMimeType&&ke.overrideMimeType("text/plain; charset=x-user-defined"),ke.send(null),!(ke.status>=200&&ke.status<300||ke.status===304))throw new Error("Couldn't load "+l+". Status: "+ke.status);return ke.response!==void 0?new Uint8Array(ke.response||[]):ro(ke.responseText||"",!0)},Ae=this;Ae.setDataGetter(ce=>{var Qe=ce*M,ke=(ce+1)*M-1;if(ke=Math.min(ke,V-1),typeof Ae.chunks[ce]>"u"&&(Ae.chunks[ce]=W(Qe,ke)),typeof Ae.chunks[ce]>"u")throw new Error("doXHR failed!");return Ae.chunks[ce]}),(xe||!V)&&(M=V=1,V=this.getter(0).length,M=V,$("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=V,this._chunkSize=M,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!p)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var b=new w;Object.defineProperties(b,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var S={isDevice:!1,contents:b}}else var S={isDevice:!1,url:l};var T=v.createFile(i,a,S,h,d);S.contents?T.contents=S.contents:S.url&&(T.contents=null,T.url=S.url),Object.defineProperties(T,{usedBytes:{get:function(){return this.contents.length}}});var A={},B=Object.keys(T.stream_ops);B.forEach(D=>{var L=T.stream_ops[D];A[D]=function(){return v.forceLoadFile(T),L.apply(null,arguments)}});function I(D,L,V,se,we){var xe=D.node.contents;if(we>=xe.length)return 0;var M=Math.min(xe.length-we,se);if(xe.slice)for(var W=0;W<M;W++)L[V+W]=xe[we+W];else for(var W=0;W<M;W++)L[V+W]=xe.get(we+W);return M}return A.read=(D,L,V,se,we)=>(v.forceLoadFile(T),I(D,L,V,se,we)),A.mmap=(D,L,V,se,we)=>{v.forceLoadFile(T);var xe=Ha(L);if(!xe)throw new v.ErrnoError(48);return I(D,Ne,xe,L,V),{ptr:xe,allocated:!0}},T.stream_ops=A,T},createPreloadedFile:(i,a,l,h,d,w,b,S,T,A)=>{var B=a?kt.resolve(re.join2(i,a)):i;function I(D){function L(V){A&&A(),S||v.createDataFile(i,a,V,h,d,T),w&&w(),Gn()}Browser.handledByPreloadPlugin(D,B,L,()=>{b&&b(),Gn()})||L(D)}Jo(),typeof l=="string"?ed(l,D=>I(D),b):I(l)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(i,a,l)=>{a=a||(()=>{}),l=l||(()=>{});var h=v.indexedDB();try{var d=h.open(v.DB_NAME(),v.DB_VERSION)}catch(w){return l(w)}d.onupgradeneeded=()=>{$("creating db");var w=d.result;w.createObjectStore(v.DB_STORE_NAME)},d.onsuccess=()=>{var w=d.result,b=w.transaction([v.DB_STORE_NAME],"readwrite"),S=b.objectStore(v.DB_STORE_NAME),T=0,A=0,B=i.length;function I(){A==0?a():l()}i.forEach(D=>{var L=S.put(v.analyzePath(D).object.contents,D);L.onsuccess=()=>{T++,T+A==B&&I()},L.onerror=()=>{A++,T+A==B&&I()}}),b.onerror=l},d.onerror=l},loadFilesFromDB:(i,a,l)=>{a=a||(()=>{}),l=l||(()=>{});var h=v.indexedDB();try{var d=h.open(v.DB_NAME(),v.DB_VERSION)}catch(w){return l(w)}d.onupgradeneeded=l,d.onsuccess=()=>{var w=d.result;try{var b=w.transaction([v.DB_STORE_NAME],"readonly")}catch(D){l(D);return}var S=b.objectStore(v.DB_STORE_NAME),T=0,A=0,B=i.length;function I(){A==0?a():l()}i.forEach(D=>{var L=S.get(D);L.onsuccess=()=>{v.analyzePath(D).exists&&v.unlink(D),v.createDataFile(re.dirname(D),re.basename(D),L.result,!0,!0,!0),T++,T+A==B&&I()},L.onerror=()=>{A++,T+A==B&&I()}}),b.onerror=l},d.onerror=l}},ne={DEFAULT_POLLMASK:5,calculateAt:function(i,a,l){if(re.isAbs(a))return a;var h;if(i===-100)h=v.cwd();else{var d=v.getStream(i);if(!d)throw new v.ErrnoError(8);h=d.path}if(a.length==0){if(!l)throw new v.ErrnoError(44);return h}return re.join2(h,a)},doStat:function(i,a,l){try{var h=i(a)}catch(d){if(d&&d.node&&re.normalize(a)!==re.normalize(v.getPath(d.node)))return-54;throw d}return F[l>>2]=h.dev,F[l+4>>2]=0,F[l+8>>2]=h.ino,F[l+12>>2]=h.mode,F[l+16>>2]=h.nlink,F[l+20>>2]=h.uid,F[l+24>>2]=h.gid,F[l+28>>2]=h.rdev,F[l+32>>2]=0,xt=[h.size>>>0,(Fe=h.size,+Math.abs(Fe)>=1?Fe>0?(Math.min(+Math.floor(Fe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Fe-+(~~Fe>>>0))/4294967296)>>>0:0)],F[l+40>>2]=xt[0],F[l+44>>2]=xt[1],F[l+48>>2]=4096,F[l+52>>2]=h.blocks,F[l+56>>2]=h.atime.getTime()/1e3|0,F[l+60>>2]=0,F[l+64>>2]=h.mtime.getTime()/1e3|0,F[l+68>>2]=0,F[l+72>>2]=h.ctime.getTime()/1e3|0,F[l+76>>2]=0,xt=[h.ino>>>0,(Fe=h.ino,+Math.abs(Fe)>=1?Fe>0?(Math.min(+Math.floor(Fe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Fe-+(~~Fe>>>0))/4294967296)>>>0:0)],F[l+80>>2]=xt[0],F[l+84>>2]=xt[1],0},doMsync:function(i,a,l,h,d){var w=qe.slice(i,i+l);v.msync(a,w,d,l,h)},varargs:void 0,get:function(){ne.varargs+=4;var i=F[ne.varargs-4>>2];return i},getStr:function(i){var a=ie(i);return a},getStreamFromFD:function(i){var a=v.getStream(i);if(!a)throw new v.ErrnoError(8);return a}};function td(i,a){try{return i=ne.getStr(i),v.chmod(i,a),0}catch(l){if(typeof v>"u"||!(l instanceof v.ErrnoError))throw l;return-l.errno}}function rd(i,a,l,h){try{if(a=ne.getStr(a),a=ne.calculateAt(i,a),l&-8)return-28;var d=v.lookupPath(a,{follow:!0}),w=d.node;if(!w)return-44;var b="";return l&4&&(b+="r"),l&2&&(b+="w"),l&1&&(b+="x"),b&&v.nodePermissions(w,b)?-2:0}catch(S){if(typeof v>"u"||!(S instanceof v.ErrnoError))throw S;return-S.errno}}function nd(i){return F[au()>>2]=i,i}function od(i,a,l){ne.varargs=l;try{var h=ne.getStreamFromFD(i);switch(a){case 0:{var d=ne.get();if(d<0)return-28;var w;return w=v.createStream(h,d),w.fd}case 1:case 2:return 0;case 3:return h.flags;case 4:{var d=ne.get();return h.flags|=d,0}case 5:{var d=ne.get(),b=0;return Wt[d+b>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return nd(28),-1;default:return-28}}catch(S){if(typeof v>"u"||!(S instanceof v.ErrnoError))throw S;return-S.errno}}function sd(i,a){try{var l=ne.getStreamFromFD(i);return ne.doStat(v.stat,l.path,a)}catch(h){if(typeof v>"u"||!(h instanceof v.ErrnoError))throw h;return-h.errno}}function id(i,a,l){ne.varargs=l;try{var h=ne.getStreamFromFD(i);switch(a){case 21509:case 21505:return h.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return h.tty?0:-59;case 21519:{if(!h.tty)return-59;var d=ne.get();return F[d>>2]=0,0}case 21520:return h.tty?-28:-59;case 21531:{var d=ne.get();return v.ioctl(h,a,d)}case 21523:return h.tty?0:-59;case 21524:return h.tty?0:-59;default:Vt("bad ioctl syscall "+a)}}catch(w){if(typeof v>"u"||!(w instanceof v.ErrnoError))throw w;return-w.errno}}function ad(i,a){try{return i=ne.getStr(i),ne.doStat(v.lstat,i,a)}catch(l){if(typeof v>"u"||!(l instanceof v.ErrnoError))throw l;return-l.errno}}function ud(i,a,l,h){try{a=ne.getStr(a);var d=h&256,w=h&4096;return h=h&-4353,a=ne.calculateAt(i,a,w),ne.doStat(d?v.lstat:v.stat,a,l)}catch(b){if(typeof v>"u"||!(b instanceof v.ErrnoError))throw b;return-b.errno}}function ld(i,a,l,h){ne.varargs=h;try{a=ne.getStr(a),a=ne.calculateAt(i,a);var d=h?ne.get():0;return v.open(a,l,d).fd}catch(w){if(typeof v>"u"||!(w instanceof v.ErrnoError))throw w;return-w.errno}}function cd(i,a){try{return i=ne.getStr(i),ne.doStat(v.stat,i,a)}catch(l){if(typeof v>"u"||!(l instanceof v.ErrnoError))throw l;return-l.errno}}function fd(i,a,l,h,d){}function Wn(i){switch(i){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+i)}}function hd(){for(var i=new Array(256),a=0;a<256;++a)i[a]=String.fromCharCode(a);Wa=i}var Wa=void 0;function Ye(i){for(var a="",l=i;qe[l];)a+=Wa[qe[l++]];return a}var yr={},er={},Vn={},pd=48,dd=57;function zn(i){if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var a=i.charCodeAt(0);return a>=pd&&a<=dd?"_"+i:i}function qn(i,a){return i=zn(i),new Function("body","return function "+i+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(a)}function ts(i,a){var l=qn(a,function(h){this.name=a,this.message=h;var d=new Error(h).stack;d!==void 0&&(this.stack=this.toString()+`
`+d.replace(/^Error(:[^\n]*)?\n/,""))});return l.prototype=Object.create(i.prototype),l.prototype.constructor=l,l.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},l}var wr=void 0;function oe(i){throw new wr(i)}var Va=void 0;function Yn(i){throw new Va(i)}function tr(i,a,l){i.forEach(function(S){Vn[S]=a});function h(S){var T=l(S);T.length!==i.length&&Yn("Mismatched type converter count");for(var A=0;A<i.length;++A)gt(i[A],T[A])}var d=new Array(a.length),w=[],b=0;a.forEach((S,T)=>{er.hasOwnProperty(S)?d[T]=er[S]:(w.push(S),yr.hasOwnProperty(S)||(yr[S]=[]),yr[S].push(()=>{d[T]=er[S],++b,b===w.length&&h(d)}))}),w.length===0&&h(d)}function gt(i,a,l={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");var h=a.name;if(i||oe('type "'+h+'" must have a positive integer typeid pointer'),er.hasOwnProperty(i)){if(l.ignoreDuplicateRegistrations)return;oe("Cannot register type '"+h+"' twice")}if(er[i]=a,delete Vn[i],yr.hasOwnProperty(i)){var d=yr[i];delete yr[i],d.forEach(w=>w())}}function vd(i,a,l,h,d){var w=Wn(l);a=Ye(a),gt(i,{name:a,fromWireType:function(b){return!!b},toWireType:function(b,S){return S?h:d},argPackAdvance:8,readValueFromPointer:function(b){var S;if(l===1)S=Ne;else if(l===2)S=Wt;else if(l===4)S=F;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(S[b>>w])},destructorFunction:null})}function gd(i){if(!(this instanceof zt)||!(i instanceof zt))return!1;for(var a=this.$$.ptrType.registeredClass,l=this.$$.ptr,h=i.$$.ptrType.registeredClass,d=i.$$.ptr;a.baseClass;)l=a.upcast(l),a=a.baseClass;for(;h.baseClass;)d=h.upcast(d),h=h.baseClass;return a===h&&l===d}function md(i){return{count:i.count,deleteScheduled:i.deleteScheduled,preservePointerOnDelete:i.preservePointerOnDelete,ptr:i.ptr,ptrType:i.ptrType,smartPtr:i.smartPtr,smartPtrType:i.smartPtrType}}function rs(i){function a(l){return l.$$.ptrType.registeredClass.name}oe(a(i)+" instance already deleted")}var ns=!1;function za(i){}function yd(i){i.smartPtr?i.smartPtrType.rawDestructor(i.smartPtr):i.ptrType.registeredClass.rawDestructor(i.ptr)}function qa(i){i.count.value-=1;var a=i.count.value===0;a&&yd(i)}function Ya(i,a,l){if(a===l)return i;if(l.baseClass===void 0)return null;var h=Ya(i,a,l.baseClass);return h===null?null:l.downcast(h)}var Xa={};function wd(){return Object.keys(Qr).length}function bd(){var i=[];for(var a in Qr)Qr.hasOwnProperty(a)&&i.push(Qr[a]);return i}var Zr=[];function os(){for(;Zr.length;){var i=Zr.pop();i.$$.deleteScheduled=!1,i.delete()}}var Kr=void 0;function _d(i){Kr=i,Zr.length&&Kr&&Kr(os)}function Sd(){r.getInheritedInstanceCount=wd,r.getLiveInheritedInstances=bd,r.flushPendingDeletes=os,r.setDelayFunction=_d}var Qr={};function Ed(i,a){for(a===void 0&&oe("ptr should not be undefined");i.baseClass;)a=i.upcast(a),i=i.baseClass;return a}function Td(i,a){return a=Ed(i,a),Qr[a]}function Xn(i,a){(!a.ptrType||!a.ptr)&&Yn("makeClassHandle requires ptr and ptrType");var l=!!a.smartPtrType,h=!!a.smartPtr;return l!==h&&Yn("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Jr(Object.create(i,{$$:{value:a}}))}function xd(i){var a=this.getPointee(i);if(!a)return this.destructor(i),null;var l=Td(this.registeredClass,a);if(l!==void 0){if(l.$$.count.value===0)return l.$$.ptr=a,l.$$.smartPtr=i,l.clone();var h=l.clone();return this.destructor(i),h}function d(){return this.isSmartPointer?Xn(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:a,smartPtrType:this,smartPtr:i}):Xn(this.registeredClass.instancePrototype,{ptrType:this,ptr:i})}var w=this.registeredClass.getActualType(a),b=Xa[w];if(!b)return d.call(this);var S;this.isConst?S=b.constPointerType:S=b.pointerType;var T=Ya(a,this.registeredClass,S.registeredClass);return T===null?d.call(this):this.isSmartPointer?Xn(S.registeredClass.instancePrototype,{ptrType:S,ptr:T,smartPtrType:this,smartPtr:i}):Xn(S.registeredClass.instancePrototype,{ptrType:S,ptr:T})}function Jr(i){return typeof FinalizationRegistry>"u"?(Jr=a=>a,i):(ns=new FinalizationRegistry(a=>{qa(a.$$)}),Jr=a=>{var l=a.$$,h=!!l.smartPtr;if(h){var d={$$:l};ns.register(a,d,a)}return a},za=a=>ns.unregister(a),Jr(i))}function kd(){if(this.$$.ptr||rs(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var i=Jr(Object.create(Object.getPrototypeOf(this),{$$:{value:md(this.$$)}}));return i.$$.count.value+=1,i.$$.deleteScheduled=!1,i}function Pd(){this.$$.ptr||rs(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&oe("Object already scheduled for deletion"),za(this),qa(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Cd(){return!this.$$.ptr}function Ad(){return this.$$.ptr||rs(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&oe("Object already scheduled for deletion"),Zr.push(this),Zr.length===1&&Kr&&Kr(os),this.$$.deleteScheduled=!0,this}function Rd(){zt.prototype.isAliasOf=gd,zt.prototype.clone=kd,zt.prototype.delete=Pd,zt.prototype.isDeleted=Cd,zt.prototype.deleteLater=Ad}function zt(){}function ss(i,a,l){if(i[a].overloadTable===void 0){var h=i[a];i[a]=function(){return i[a].overloadTable.hasOwnProperty(arguments.length)||oe("Function '"+l+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+i[a].overloadTable+")!"),i[a].overloadTable[arguments.length].apply(this,arguments)},i[a].overloadTable=[],i[a].overloadTable[h.argCount]=h}}function $a(i,a,l){r.hasOwnProperty(i)?((l===void 0||r[i].overloadTable!==void 0&&r[i].overloadTable[l]!==void 0)&&oe("Cannot register public name '"+i+"' twice"),ss(r,i,i),r.hasOwnProperty(l)&&oe("Cannot register multiple overloads of a function with the same number of arguments ("+l+")!"),r[i].overloadTable[l]=a):(r[i]=a,l!==void 0&&(r[i].numArguments=l))}function Md(i,a,l,h,d,w,b,S){this.name=i,this.constructor=a,this.instancePrototype=l,this.rawDestructor=h,this.baseClass=d,this.getActualType=w,this.upcast=b,this.downcast=S,this.pureVirtualFunctions=[]}function is(i,a,l){for(;a!==l;)a.upcast||oe("Expected null or instance of "+l.name+", got an instance of "+a.name),i=a.upcast(i),a=a.baseClass;return i}function Od(i,a){if(a===null)return this.isReference&&oe("null is not a valid "+this.name),0;a.$$||oe('Cannot pass "'+fs(a)+'" as a '+this.name),a.$$.ptr||oe("Cannot pass deleted object as a pointer of type "+this.name);var l=a.$$.ptrType.registeredClass,h=is(a.$$.ptr,l,this.registeredClass);return h}function Dd(i,a){var l;if(a===null)return this.isReference&&oe("null is not a valid "+this.name),this.isSmartPointer?(l=this.rawConstructor(),i!==null&&i.push(this.rawDestructor,l),l):0;a.$$||oe('Cannot pass "'+fs(a)+'" as a '+this.name),a.$$.ptr||oe("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&a.$$.ptrType.isConst&&oe("Cannot convert argument of type "+(a.$$.smartPtrType?a.$$.smartPtrType.name:a.$$.ptrType.name)+" to parameter type "+this.name);var h=a.$$.ptrType.registeredClass;if(l=is(a.$$.ptr,h,this.registeredClass),this.isSmartPointer)switch(a.$$.smartPtr===void 0&&oe("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:a.$$.smartPtrType===this?l=a.$$.smartPtr:oe("Cannot convert argument of type "+(a.$$.smartPtrType?a.$$.smartPtrType.name:a.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:l=a.$$.smartPtr;break;case 2:if(a.$$.smartPtrType===this)l=a.$$.smartPtr;else{var d=a.clone();l=this.rawShare(l,Ce.toHandle(function(){d.delete()})),i!==null&&i.push(this.rawDestructor,l)}break;default:oe("Unsupporting sharing policy")}return l}function Bd(i,a){if(a===null)return this.isReference&&oe("null is not a valid "+this.name),0;a.$$||oe('Cannot pass "'+fs(a)+'" as a '+this.name),a.$$.ptr||oe("Cannot pass deleted object as a pointer of type "+this.name),a.$$.ptrType.isConst&&oe("Cannot convert argument of type "+a.$$.ptrType.name+" to parameter type "+this.name);var l=a.$$.ptrType.registeredClass,h=is(a.$$.ptr,l,this.registeredClass);return h}function $n(i){return this.fromWireType(J[i>>2])}function Id(i){return this.rawGetPointee&&(i=this.rawGetPointee(i)),i}function Fd(i){this.rawDestructor&&this.rawDestructor(i)}function Ud(i){i!==null&&i.delete()}function Ld(){Pt.prototype.getPointee=Id,Pt.prototype.destructor=Fd,Pt.prototype.argPackAdvance=8,Pt.prototype.readValueFromPointer=$n,Pt.prototype.deleteObject=Ud,Pt.prototype.fromWireType=xd}function Pt(i,a,l,h,d,w,b,S,T,A,B){this.name=i,this.registeredClass=a,this.isReference=l,this.isConst=h,this.isSmartPointer=d,this.pointeeType=w,this.sharingPolicy=b,this.rawGetPointee=S,this.rawConstructor=T,this.rawShare=A,this.rawDestructor=B,!d&&a.baseClass===void 0?h?(this.toWireType=Od,this.destructorFunction=null):(this.toWireType=Bd,this.destructorFunction=null):this.toWireType=Dd}function Gd(i,a,l){r.hasOwnProperty(i)||Yn("Replacing nonexistant public symbol"),r[i].overloadTable!==void 0&&l!==void 0?r[i].overloadTable[l]=a:(r[i]=a,r[i].argCount=l)}function Nd(i,a,l){var h=r["dynCall_"+i];return l&&l.length?h.apply(null,[a].concat(l)):h.call(null,a)}function Hd(i,a,l){return i.includes("j")?Nd(i,a,l):Hn(a).apply(null,l)}function Wd(i,a){var l=[];return function(){return l.length=0,Object.assign(l,arguments),Hd(i,a,l)}}function rr(i,a){i=Ye(i);function l(){return i.includes("j")?Wd(i,a):Hn(a)}var h=l();return typeof h!="function"&&oe("unknown function pointer with signature "+i+": "+a),h}var ja=void 0;function Za(i){var a=uu(i),l=Ye(a);return Rt(a),l}function jn(i,a){var l=[],h={};function d(w){if(!h[w]&&!er[w]){if(Vn[w]){Vn[w].forEach(d);return}l.push(w),h[w]=!0}}throw a.forEach(d),new ja(i+": "+l.map(Za).join([", "]))}function Vd(i,a,l,h,d,w,b,S,T,A,B,I,D){B=Ye(B),w=rr(d,w),S&&(S=rr(b,S)),A&&(A=rr(T,A)),D=rr(I,D);var L=zn(B);$a(L,function(){jn("Cannot construct "+B+" due to unbound types",[h])}),tr([i,a,l],h?[h]:[],function(V){V=V[0];var se,we;h?(se=V.registeredClass,we=se.instancePrototype):we=zt.prototype;var xe=qn(L,function(){if(Object.getPrototypeOf(this)!==M)throw new wr("Use 'new' to construct "+B);if(W.constructor_body===void 0)throw new wr(B+" has no accessible constructor");var ke=W.constructor_body[arguments.length];if(ke===void 0)throw new wr("Tried to invoke ctor of "+B+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(W.constructor_body).toString()+") parameters instead!");return ke.apply(this,arguments)}),M=Object.create(we,{constructor:{value:xe}});xe.prototype=M;var W=new Md(B,xe,M,D,se,w,S,A),Ae=new Pt(B,W,!0,!1,!1),ce=new Pt(B+"*",W,!1,!1,!1),Qe=new Pt(B+" const*",W,!1,!0,!1);return Xa[i]={pointerType:ce,constPointerType:Qe},Gd(L,xe),[Ae,ce,Qe]})}function Ka(i,a){if(!(i instanceof Function))throw new TypeError("new_ called with constructor type "+typeof i+" which is not a function");var l=qn(i.name||"unknownFunctionName",function(){});l.prototype=i.prototype;var h=new l,d=i.apply(h,a);return d instanceof Object?d:h}function Qa(i){for(;i.length;){var a=i.pop(),l=i.pop();l(a)}}function as(i,a,l,h,d){var w=a.length;w<2&&oe("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var b=a[1]!==null&&l!==null,S=!1,T=1;T<a.length;++T)if(a[T]!==null&&a[T].destructorFunction===void 0){S=!0;break}for(var A=a[0].name!=="void",B="",I="",T=0;T<w-2;++T)B+=(T!==0?", ":"")+"arg"+T,I+=(T!==0?", ":"")+"arg"+T+"Wired";var D="return function "+zn(i)+"("+B+`) {
if (arguments.length !== `+(w-2)+`) {
throwBindingError('function `+i+" called with ' + arguments.length + ' arguments, expected "+(w-2)+` args!');
}
`;S&&(D+=`var destructors = [];
`);var L=S?"destructors":"null",V=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],se=[oe,h,d,Qa,a[0],a[1]];b&&(D+="var thisWired = classParam.toWireType("+L+`, this);
`);for(var T=0;T<w-2;++T)D+="var arg"+T+"Wired = argType"+T+".toWireType("+L+", arg"+T+"); // "+a[T+2].name+`
`,V.push("argType"+T),se.push(a[T+2]);if(b&&(I="thisWired"+(I.length>0?", ":"")+I),D+=(A?"var rv = ":"")+"invoker(fn"+(I.length>0?", ":"")+I+`);
`,S)D+=`runDestructors(destructors);
`;else for(var T=b?1:2;T<a.length;++T){var we=T===1?"thisWired":"arg"+(T-2)+"Wired";a[T].destructorFunction!==null&&(D+=we+"_dtor("+we+"); // "+a[T].name+`
`,V.push(we+"_dtor"),se.push(a[T].destructorFunction))}A&&(D+=`var ret = retType.fromWireType(rv);
return ret;
`),D+=`}
`,V.push(D);var xe=Ka(Function,V).apply(null,se);return xe}function us(i,a){for(var l=[],h=0;h<i;h++)l.push(F[(a>>2)+h]);return l}function zd(i,a,l,h,d,w,b){var S=us(l,h);a=Ye(a),w=rr(d,w),tr([],[i],function(T){T=T[0];var A=T.name+"."+a;function B(){jn("Cannot call "+A+" due to unbound types",S)}a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var I=T.registeredClass.constructor;return I[a]===void 0?(B.argCount=l-1,I[a]=B):(ss(I,a,A),I[a].overloadTable[l-1]=B),tr([],S,function(D){var L=[D[0],null].concat(D.slice(1)),V=as(A,L,null,w,b);return I[a].overloadTable===void 0?(V.argCount=l-1,I[a]=V):I[a].overloadTable[l-1]=V,[]}),[]})}function qd(i,a,l,h,d,w){Ge(a>0);var b=us(a,l);d=rr(h,d),tr([],[i],function(S){S=S[0];var T="constructor "+S.name;if(S.registeredClass.constructor_body===void 0&&(S.registeredClass.constructor_body=[]),S.registeredClass.constructor_body[a-1]!==void 0)throw new wr("Cannot register multiple constructors with identical number of parameters ("+(a-1)+") for class '"+S.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return S.registeredClass.constructor_body[a-1]=()=>{jn("Cannot construct "+S.name+" due to unbound types",b)},tr([],b,function(A){return A.splice(1,0,null),S.registeredClass.constructor_body[a-1]=as(T,A,null,d,w),[]}),[]})}function Yd(i,a,l,h,d,w,b,S){var T=us(l,h);a=Ye(a),w=rr(d,w),tr([],[i],function(A){A=A[0];var B=A.name+"."+a;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),S&&A.registeredClass.pureVirtualFunctions.push(a);function I(){jn("Cannot call "+B+" due to unbound types",T)}var D=A.registeredClass.instancePrototype,L=D[a];return L===void 0||L.overloadTable===void 0&&L.className!==A.name&&L.argCount===l-2?(I.argCount=l-2,I.className=A.name,D[a]=I):(ss(D,a,B),D[a].overloadTable[l-2]=I),tr([],T,function(V){var se=as(B,V,A,w,b);return D[a].overloadTable===void 0?(se.argCount=l-2,D[a]=se):D[a].overloadTable[l-2]=se,[]}),[]})}var ls=[],ct=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function cs(i){i>4&&--ct[i].refcount===0&&(ct[i]=void 0,ls.push(i))}function Xd(){for(var i=0,a=5;a<ct.length;++a)ct[a]!==void 0&&++i;return i}function $d(){for(var i=5;i<ct.length;++i)if(ct[i]!==void 0)return ct[i];return null}function jd(){r.count_emval_handles=Xd,r.get_first_emval=$d}var Ce={toValue:i=>(i||oe("Cannot use deleted val. handle = "+i),ct[i].value),toHandle:i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var a=ls.length?ls.pop():ct.length;return ct[a]={refcount:1,value:i},a}}}};function Zd(i,a){a=Ye(a),gt(i,{name:a,fromWireType:function(l){var h=Ce.toValue(l);return cs(l),h},toWireType:function(l,h){return Ce.toHandle(h)},argPackAdvance:8,readValueFromPointer:$n,destructorFunction:null})}function Kd(i,a,l){switch(a){case 0:return function(h){var d=l?Ne:qe;return this.fromWireType(d[h])};case 1:return function(h){var d=l?Wt:$r;return this.fromWireType(d[h>>1])};case 2:return function(h){var d=l?F:J;return this.fromWireType(d[h>>2])};default:throw new TypeError("Unknown integer type: "+i)}}function Qd(i,a,l,h){var d=Wn(l);a=Ye(a);function w(){}w.values={},gt(i,{name:a,constructor:w,fromWireType:function(b){return this.constructor.values[b]},toWireType:function(b,S){return S.value},argPackAdvance:8,readValueFromPointer:Kd(a,d,h),destructorFunction:null}),$a(a,w)}function Zn(i,a){var l=er[i];return l===void 0&&oe(a+" has unknown type "+Za(i)),l}function Jd(i,a,l){var h=Zn(i,"enum");a=Ye(a);var d=h.constructor,w=Object.create(h.constructor.prototype,{value:{value:l},constructor:{value:qn(h.name+"_"+a,function(){})}});d.values[l]=w,d[a]=w}function fs(i){if(i===null)return"null";var a=typeof i;return a==="object"||a==="array"||a==="function"?i.toString():""+i}function ev(i,a){switch(a){case 2:return function(l){return this.fromWireType(lt[l>>2])};case 3:return function(l){return this.fromWireType(Ma[l>>3])};default:throw new TypeError("Unknown float type: "+i)}}function tv(i,a,l){var h=Wn(l);a=Ye(a),gt(i,{name:a,fromWireType:function(d){return d},toWireType:function(d,w){return w},argPackAdvance:8,readValueFromPointer:ev(a,h),destructorFunction:null})}function rv(i,a,l){switch(a){case 0:return l?function(d){return Ne[d]}:function(d){return qe[d]};case 1:return l?function(d){return Wt[d>>1]}:function(d){return $r[d>>1]};case 2:return l?function(d){return F[d>>2]}:function(d){return J[d>>2]};default:throw new TypeError("Unknown integer type: "+i)}}function nv(i,a,l,h,d){a=Ye(a);var w=Wn(l),b=I=>I;if(h===0){var S=32-8*l;b=I=>I<<S>>>S}var T=a.includes("unsigned"),A=(I,D)=>{},B;T?B=function(I,D){return A(D,this.name),D>>>0}:B=function(I,D){return A(D,this.name),D},gt(i,{name:a,fromWireType:b,toWireType:B,argPackAdvance:8,readValueFromPointer:rv(a,w,h!==0),destructorFunction:null})}function ov(i,a,l){var h=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],d=h[a];function w(b){b=b>>2;var S=J,T=S[b],A=S[b+1];return new d(Tt,A,T)}l=Ye(l),gt(i,{name:l,fromWireType:w,argPackAdvance:8,readValueFromPointer:w},{ignoreDuplicateRegistrations:!0})}function sv(i,a){a=Ye(a);var l=a==="std::string";gt(i,{name:a,fromWireType:function(h){var d=J[h>>2],w;if(l)for(var b=h+4,S=0;S<=d;++S){var T=h+4+S;if(S==d||qe[T]==0){var A=T-b,B=ie(b,A);w===void 0?w=B:(w+=String.fromCharCode(0),w+=B),b=T+1}}else{for(var I=new Array(d),S=0;S<d;++S)I[S]=String.fromCharCode(qe[h+4+S]);w=I.join("")}return Rt(h),w},toWireType:function(h,d){d instanceof ArrayBuffer&&(d=new Uint8Array(d));var w,b=typeof d=="string";b||d instanceof Uint8Array||d instanceof Uint8ClampedArray||d instanceof Int8Array||oe("Cannot pass non-string to std::string"),l&&b?w=()=>fe(d):w=()=>d.length;var S=w(),T=At(4+S+1);if(J[T>>2]=S,l&&b)Pe(d,T+4,S+1);else if(b)for(var A=0;A<S;++A){var B=d.charCodeAt(A);B>255&&(Rt(T),oe("String has UTF-16 code units that do not fit in 8 bits")),qe[T+4+A]=B}else for(var A=0;A<S;++A)qe[T+4+A]=d[A];return h!==null&&h.push(Rt,T),T},argPackAdvance:8,readValueFromPointer:$n,destructorFunction:function(h){Rt(h)}})}function iv(i,a,l){l=Ye(l);var h,d,w,b,S;a===2?(h=Ie,d=Xe,b=ye,w=()=>$r,S=1):a===4&&(h=Oe,d=Yr,b=Qo,w=()=>J,S=2),gt(i,{name:l,fromWireType:function(T){for(var A=J[T>>2],B=w(),I,D=T+4,L=0;L<=A;++L){var V=T+4+L*a;if(L==A||B[V>>S]==0){var se=V-D,we=h(D,se);I===void 0?I=we:(I+=String.fromCharCode(0),I+=we),D=V+a}}return Rt(T),I},toWireType:function(T,A){typeof A!="string"&&oe("Cannot pass non-string to C++ string type "+l);var B=b(A),I=At(4+B+a);return J[I>>2]=B>>S,d(A,I+4,B+a),T!==null&&T.push(Rt,I),I},argPackAdvance:8,readValueFromPointer:$n,destructorFunction:function(T){Rt(T)}})}function av(i,a){a=Ye(a),gt(i,{isVoid:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(l,h){}})}function uv(){return Date.now()}var lv=!0;function cv(){return lv}function fv(i,a,l){i=Ce.toValue(i),a=Zn(a,"emval::as");var h=[],d=Ce.toHandle(h);return F[l>>2]=d,a.toWireType(h,i)}function hv(i){var a=[];return F[i>>2]=Ce.toHandle(a),a}var pv={};function hs(i){var a=pv[i];return a===void 0?Ye(i):a}var ps=[];function dv(i,a,l,h,d){return i=ps[i],a=Ce.toValue(a),l=hs(l),i(a,l,hv(h),d)}function Ja(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function vv(i){return i===0?Ce.toHandle(Ja()):(i=hs(i),Ce.toHandle(Ja()[i]))}function gv(i){var a=ps.length;return ps.push(i),a}function mv(i,a){for(var l=new Array(i),h=0;h<i;++h)l[h]=Zn(J[a+h*ae>>2],"parameter "+h);return l}var eu=[];function yv(i,a){var l=mv(i,a),h=l[0],d=h.name+"_$"+l.slice(1).map(function(V){return V.name}).join("_")+"$",w=eu[d];if(w!==void 0)return w;for(var b=["retType"],S=[h],T="",A=0;A<i-1;++A)T+=(A!==0?", ":"")+"arg"+A,b.push("argType"+A),S.push(l[1+A]);for(var B=zn("methodCaller_"+d),I="return function "+B+`(handle, name, destructors, args) {
`,D=0,A=0;A<i-1;++A)I+="    var arg"+A+" = argType"+A+".readValueFromPointer(args"+(D?"+"+D:"")+`);
`,D+=l[A+1].argPackAdvance;I+="    var rv = handle[name]("+T+`);
`;for(var A=0;A<i-1;++A)l[A+1].deleteObject&&(I+="    argType"+A+".deleteObject(arg"+A+`);
`);h.isVoid||(I+=`    return retType.toWireType(destructors, rv);
`),I+=`};
`,b.push(I);var L=Ka(Function,b).apply(null,S);return w=gv(L),eu[d]=w,w}function wv(i,a){return i=Ce.toValue(i),a=Ce.toValue(a),Ce.toHandle(i[a])}function bv(i){i>4&&(ct[i].refcount+=1)}function _v(i){return Ce.toHandle(hs(i))}function Sv(i){var a=Ce.toValue(i);Qa(a),cs(i)}function Ev(i,a,l){i=Ce.toValue(i),a=Ce.toValue(a),l=Ce.toValue(l),i[a]=l}function Tv(i,a){i=Zn(i,"_emval_take_value");var l=i.readValueFromPointer(a);return Ce.toHandle(l)}function xv(i){return i=Ce.toValue(i),Ce.toHandle(typeof i)}function kv(i,a){var l=new Date(F[i>>2]*1e3);F[a>>2]=l.getSeconds(),F[a+4>>2]=l.getMinutes(),F[a+8>>2]=l.getHours(),F[a+12>>2]=l.getDate(),F[a+16>>2]=l.getMonth(),F[a+20>>2]=l.getFullYear()-1900,F[a+24>>2]=l.getDay();var h=new Date(l.getFullYear(),0,1),d=(l.getTime()-h.getTime())/(1e3*60*60*24)|0;F[a+28>>2]=d,F[a+36>>2]=-(l.getTimezoneOffset()*60);var w=new Date(l.getFullYear(),6,1).getTimezoneOffset(),b=h.getTimezoneOffset(),S=(w!=b&&l.getTimezoneOffset()==Math.min(b,w))|0;F[a+32>>2]=S}function Pv(i,a,l,h,d,w){try{var b=v.getStream(d);b&&(l&2&&ne.doMsync(i,b,a,h,w),v.munmap(b))}catch(S){if(typeof v>"u"||!(S instanceof v.ErrnoError))throw S;return-S.errno}}function Cv(i,a,l){var h=new Date().getFullYear(),d=new Date(h,0,1),w=new Date(h,6,1),b=d.getTimezoneOffset(),S=w.getTimezoneOffset(),T=Math.max(b,S);F[i>>2]=T*60,F[a>>2]=Number(b!=S);function A(V){var se=V.toTimeString().match(/\(([A-Za-z ]+)\)$/);return se?se[1]:"GMT"}var B=A(d),I=A(w),D=Un(B),L=Un(I);S<b?(J[l>>2]=D,J[l+4>>2]=L):(J[l>>2]=L,J[l+4>>2]=D)}function ds(i,a,l){ds.called||(ds.called=!0,Cv(i,a,l))}function Av(){Vt("")}function tu(){return 2147483648}function Rv(){return tu()}function Mv(i,a,l){qe.copyWithin(i,a,a+l)}function Ov(i){try{return pe.grow(i-Tt.byteLength+65535>>>16),Oa(pe.buffer),1}catch{}}function Dv(i){var a=qe.length;i=i>>>0;var l=tu();if(i>l)return!1;let h=(T,A)=>T+(A-T%A)%A;for(var d=1;d<=4;d*=2){var w=a*(1+.2/d);w=Math.min(w,i+100663296);var b=Math.min(l,h(Math.max(i,w),65536)),S=Ov(b);if(S)return!0}return!1}var vs={};function Bv(){return u||"./this.program"}function en(){if(!en.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",a={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:Bv()};for(var l in vs)vs[l]===void 0?delete a[l]:a[l]=vs[l];var h=[];for(var l in a)h.push(l+"="+a[l]);en.strings=h}return en.strings}function Iv(i,a){var l=0;return en().forEach(function(h,d){var w=a+l;J[i+d*4>>2]=w,Ln(h,w),l+=h.length+1}),0}function Fv(i,a){var l=en();J[i>>2]=l.length;var h=0;return l.forEach(function(d){h+=d.length+1}),J[a>>2]=h,0}function Uv(i){gg(i)}function Lv(i){try{var a=ne.getStreamFromFD(i);return v.close(a),0}catch(l){if(typeof v>"u"||!(l instanceof v.ErrnoError))throw l;return l.errno}}function Gv(i,a,l,h){for(var d=0,w=0;w<l;w++){var b=J[a>>2],S=J[a+4>>2];a+=8;var T=v.read(i,Ne,b,S,h);if(T<0)return-1;if(d+=T,T<S)break}return d}function Nv(i,a,l,h){try{var d=ne.getStreamFromFD(i),w=Gv(d,a,l);return F[h>>2]=w,0}catch(b){if(typeof v>"u"||!(b instanceof v.ErrnoError))throw b;return b.errno}}function Hv(i,a){return a+2097152>>>0<4194305-!!i?(i>>>0)+a*4294967296:NaN}function Wv(i,a,l,h,d){try{var w=Hv(a,l);if(isNaN(w))return 61;var b=ne.getStreamFromFD(i);return v.llseek(b,w,h),xt=[b.position>>>0,(Fe=b.position,+Math.abs(Fe)>=1?Fe>0?(Math.min(+Math.floor(Fe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Fe-+(~~Fe>>>0))/4294967296)>>>0:0)],F[d>>2]=xt[0],F[d+4>>2]=xt[1],b.getdents&&w===0&&h===0&&(b.getdents=null),0}catch(S){if(typeof v>"u"||!(S instanceof v.ErrnoError))throw S;return S.errno}}function Vv(i,a,l,h){for(var d=0,w=0;w<l;w++){var b=J[a>>2],S=J[a+4>>2];a+=8;var T=v.write(i,Ne,b,S,h);if(T<0)return-1;d+=T}return d}function zv(i,a,l,h){try{var d=ne.getStreamFromFD(i),w=Vv(d,a,l);return J[h>>2]=w,0}catch(b){if(typeof v>"u"||!(b instanceof v.ErrnoError))throw b;return b.errno}}function ru(i){for(var a=i.split("."),l=0;l<4;l++){var h=Number(a[l]);if(isNaN(h))return null;a[l]=h}return(a[0]|a[1]<<8|a[2]<<16|a[3]<<24)>>>0}function tn(i){return parseInt(i)}function qv(i){var a,l,h,d,w=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,b=[];if(!w.test(i))return null;if(i==="::")return[0,0,0,0,0,0,0,0];for(i.startsWith("::")?i=i.replace("::","Z:"):i=i.replace("::",":Z:"),i.indexOf(".")>0?(i=i.replace(new RegExp("[.]","g"),":"),a=i.split(":"),a[a.length-4]=tn(a[a.length-4])+tn(a[a.length-3])*256,a[a.length-3]=tn(a[a.length-2])+tn(a[a.length-1])*256,a=a.slice(0,a.length-2)):a=i.split(":"),h=0,d=0,l=0;l<a.length;l++)if(typeof a[l]=="string")if(a[l]==="Z"){for(d=0;d<8-a.length+1;d++)b[l+d]=0;h=d-1}else b[l+h]=lu(parseInt(a[l],16));else b[l+h]=a[l];return[b[1]<<16|b[0],b[3]<<16|b[2],b[5]<<16|b[4],b[7]<<16|b[6]]}var qt={address_map:{id:1,addrs:{},names:{}},lookup_name:function(i){var a=ru(i);if(a!==null||(a=qv(i),a!==null))return i;var l;if(qt.address_map.addrs[i])l=qt.address_map.addrs[i];else{var h=qt.address_map.id++;Ge(h<65535,"exceeded max address mappings of 65535"),l="172.29."+(h&255)+"."+(h&65280),qt.address_map.names[l]=i,qt.address_map.addrs[i]=l}return l},lookup_addr:function(i){return qt.address_map.names[i]?qt.address_map.names[i]:null}};function Yv(i){var a=At(20),l=At(i.length+1);Pe(i,l,i.length+1),J[a>>2]=l;var h=At(4);J[h>>2]=0,J[a+4>>2]=h;var d=2;F[a+8>>2]=d,F[a+12>>2]=4;var w=At(12);return J[w>>2]=w+8,J[w+4>>2]=0,F[w+8>>2]=ru(qt.lookup_name(i)),J[a+16>>2]=w,a}function Xv(i){return Yv(ie(i))}function $v(i){var a=i.getExtension("ANGLE_instanced_arrays");if(a)return i.vertexAttribDivisor=function(l,h){a.vertexAttribDivisorANGLE(l,h)},i.drawArraysInstanced=function(l,h,d,w){a.drawArraysInstancedANGLE(l,h,d,w)},i.drawElementsInstanced=function(l,h,d,w,b){a.drawElementsInstancedANGLE(l,h,d,w,b)},1}function jv(i){var a=i.getExtension("OES_vertex_array_object");if(a)return i.createVertexArray=function(){return a.createVertexArrayOES()},i.deleteVertexArray=function(l){a.deleteVertexArrayOES(l)},i.bindVertexArray=function(l){a.bindVertexArrayOES(l)},i.isVertexArray=function(l){return a.isVertexArrayOES(l)},1}function Zv(i){var a=i.getExtension("WEBGL_draw_buffers");if(a)return i.drawBuffers=function(l,h){a.drawBuffersWEBGL(l,h)},1}function Kv(i){return!!(i.multiDrawWebgl=i.getExtension("WEBGL_multi_draw"))}var de={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(a){de.lastError||(de.lastError=a)},getNewId:function(i){for(var a=de.counter++,l=i.length;l<a;l++)i[l]=null;return a},getSource:function(i,a,l,h){for(var d="",w=0;w<a;++w){var b=h?F[h+w*4>>2]:-1;d+=ie(F[l+w*4>>2],b<0?void 0:b)}return d},createContext:function(i,a){if(!i.getContextSafariWebGL2Fixed){let d=function(w,b){var S=i.getContextSafariWebGL2Fixed(w,b);return w=="webgl"==S instanceof WebGLRenderingContext?S:null};i.getContextSafariWebGL2Fixed=i.getContext,i.getContext=d}var l=i.getContext("webgl",a);if(!l)return 0;var h=de.registerContext(l,a);return h},registerContext:function(i,a){var l=de.getNewId(de.contexts),h={handle:l,attributes:a,version:a.majorVersion,GLctx:i};return i.canvas&&(i.canvas.GLctxObject=h),de.contexts[l]=h,(typeof a.enableExtensionsByDefault>"u"||a.enableExtensionsByDefault)&&de.initExtensions(h),l},makeContextCurrent:function(i){return de.currentContext=de.contexts[i],r.ctx=$e=de.currentContext&&de.currentContext.GLctx,!(i&&!$e)},getContext:function(i){return de.contexts[i]},deleteContext:function(i){de.currentContext===de.contexts[i]&&(de.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(de.contexts[i].GLctx.canvas),de.contexts[i]&&de.contexts[i].GLctx.canvas&&(de.contexts[i].GLctx.canvas.GLctxObject=void 0),de.contexts[i]=null},initExtensions:function(i){if(i||(i=de.currentContext),!i.initExtensionsDone){i.initExtensionsDone=!0;var a=i.GLctx;$v(a),jv(a),Zv(a),a.disjointTimerQueryExt=a.getExtension("EXT_disjoint_timer_query"),Kv(a);var l=a.getSupportedExtensions()||[];l.forEach(function(h){!h.includes("lose_context")&&!h.includes("debug")&&a.getExtension(h)})}}};function nu(i){return i.slice(-1)=="]"&&i.lastIndexOf("[")}function Qv(i){var a=i.uniformLocsById,l=i.uniformSizeAndIdsByName,h,d;if(!a)for(i.uniformLocsById=a={},i.uniformArrayNamesById={},h=0;h<$e.getProgramParameter(i,35718);++h){var w=$e.getActiveUniform(i,h),b=w.name,S=w.size,T=nu(b),A=T>0?b.slice(0,T):b,B=i.uniformIdCounter;for(i.uniformIdCounter+=S,l[A]=[S,B],d=0;d<S;++d)a[B]=d,i.uniformArrayNamesById[B++]=A}}function Jv(i,a){if(a=ie(a),i=de.programs[i]){Qv(i);var l=i.uniformLocsById,h=0,d=a,w=nu(a);w>0&&(h=tn(a.slice(w+1))>>>0,d=a.slice(0,w));var b=i.uniformSizeAndIdsByName[d];if(b&&h<b[0]&&(h+=b[1],l[h]=l[h]||$e.getUniformLocation(i,a)))return h}else de.recordError(1281);return-1}function Yt(i){var a=$e.currentProgram;if(a){var l=a.uniformLocsById[i];return typeof l=="number"&&(a.uniformLocsById[i]=l=$e.getUniformLocation(a,a.uniformArrayNamesById[i]+(l>0?"["+l+"]":""))),l}else de.recordError(1282)}function eg(i,a){$e.uniform1f(Yt(i),a)}function tg(i,a){$e.uniform1i(Yt(i),a)}var Kn=[];function rg(i,a,l){if(a<=144)for(var h=Kn[2*a-1],d=0;d<2*a;d+=2)h[d]=lt[l+4*d>>2],h[d+1]=lt[l+(4*d+4)>>2];else var h=lt.subarray(l>>2,l+a*8>>2);$e.uniform2fv(Yt(i),h)}var Qn=[];function ng(i,a,l){if(a<=144)for(var h=Qn[2*a-1],d=0;d<2*a;d+=2)h[d]=F[l+4*d>>2],h[d+1]=F[l+(4*d+4)>>2];else var h=F.subarray(l>>2,l+a*8>>2);$e.uniform2iv(Yt(i),h)}function og(i,a,l){if(a<=96)for(var h=Kn[3*a-1],d=0;d<3*a;d+=3)h[d]=lt[l+4*d>>2],h[d+1]=lt[l+(4*d+4)>>2],h[d+2]=lt[l+(4*d+8)>>2];else var h=lt.subarray(l>>2,l+a*12>>2);$e.uniform3fv(Yt(i),h)}function sg(i,a,l){if(a<=96)for(var h=Qn[3*a-1],d=0;d<3*a;d+=3)h[d]=F[l+4*d>>2],h[d+1]=F[l+(4*d+4)>>2],h[d+2]=F[l+(4*d+8)>>2];else var h=F.subarray(l>>2,l+a*12>>2);$e.uniform3iv(Yt(i),h)}function ig(i,a,l){if(a<=72){var h=Kn[4*a-1],d=lt;l>>=2;for(var w=0;w<4*a;w+=4){var b=l+w;h[w]=d[b],h[w+1]=d[b+1],h[w+2]=d[b+2],h[w+3]=d[b+3]}}else var h=lt.subarray(l>>2,l+a*16>>2);$e.uniform4fv(Yt(i),h)}function ag(i,a,l){if(a<=72)for(var h=Qn[4*a-1],d=0;d<4*a;d+=4)h[d]=F[l+4*d>>2],h[d+1]=F[l+(4*d+4)>>2],h[d+2]=F[l+(4*d+8)>>2],h[d+3]=F[l+(4*d+12)>>2];else var h=F.subarray(l>>2,l+a*16>>2);$e.uniform4iv(Yt(i),h)}function ug(i){}function Jn(i){return i%4===0&&(i%100!==0||i%400===0)}function lg(i,a){for(var l=0,h=0;h<=a;l+=i[h++]);return l}var ou=[31,29,31,30,31,30,31,31,30,31,30,31],su=[31,28,31,30,31,30,31,31,30,31,30,31];function cg(i,a){for(var l=new Date(i.getTime());a>0;){var h=Jn(l.getFullYear()),d=l.getMonth(),w=(h?ou:su)[d];if(a>w-l.getDate())a-=w-l.getDate()+1,l.setDate(1),d<11?l.setMonth(d+1):(l.setMonth(0),l.setFullYear(l.getFullYear()+1));else return l.setDate(l.getDate()+a),l}return l}function fg(i,a,l,h){var d=F[h+40>>2],w={tm_sec:F[h>>2],tm_min:F[h+4>>2],tm_hour:F[h+8>>2],tm_mday:F[h+12>>2],tm_mon:F[h+16>>2],tm_year:F[h+20>>2],tm_wday:F[h+24>>2],tm_yday:F[h+28>>2],tm_isdst:F[h+32>>2],tm_gmtoff:F[h+36>>2],tm_zone:d?ie(d):""},b=ie(l),S={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var T in S)b=b.replace(new RegExp(T,"g"),S[T]);var A=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],B=["January","February","March","April","May","June","July","August","September","October","November","December"];function I(M,W,Ae){for(var ce=typeof M=="number"?M.toString():M||"";ce.length<W;)ce=Ae[0]+ce;return ce}function D(M,W){return I(M,W,"0")}function L(M,W){function Ae(Qe){return Qe<0?-1:Qe>0?1:0}var ce;return(ce=Ae(M.getFullYear()-W.getFullYear()))===0&&(ce=Ae(M.getMonth()-W.getMonth()))===0&&(ce=Ae(M.getDate()-W.getDate())),ce}function V(M){switch(M.getDay()){case 0:return new Date(M.getFullYear()-1,11,29);case 1:return M;case 2:return new Date(M.getFullYear(),0,3);case 3:return new Date(M.getFullYear(),0,2);case 4:return new Date(M.getFullYear(),0,1);case 5:return new Date(M.getFullYear()-1,11,31);case 6:return new Date(M.getFullYear()-1,11,30)}}function se(M){var W=cg(new Date(M.tm_year+1900,0,1),M.tm_yday),Ae=new Date(W.getFullYear(),0,4),ce=new Date(W.getFullYear()+1,0,4),Qe=V(Ae),ke=V(ce);return L(Qe,W)<=0?L(ke,W)<=0?W.getFullYear()+1:W.getFullYear():W.getFullYear()-1}var we={"%a":function(M){return A[M.tm_wday].substring(0,3)},"%A":function(M){return A[M.tm_wday]},"%b":function(M){return B[M.tm_mon].substring(0,3)},"%B":function(M){return B[M.tm_mon]},"%C":function(M){var W=M.tm_year+1900;return D(W/100|0,2)},"%d":function(M){return D(M.tm_mday,2)},"%e":function(M){return I(M.tm_mday,2," ")},"%g":function(M){return se(M).toString().substring(2)},"%G":function(M){return se(M)},"%H":function(M){return D(M.tm_hour,2)},"%I":function(M){var W=M.tm_hour;return W==0?W=12:W>12&&(W-=12),D(W,2)},"%j":function(M){return D(M.tm_mday+lg(Jn(M.tm_year+1900)?ou:su,M.tm_mon-1),3)},"%m":function(M){return D(M.tm_mon+1,2)},"%M":function(M){return D(M.tm_min,2)},"%n":function(){return`
`},"%p":function(M){return M.tm_hour>=0&&M.tm_hour<12?"AM":"PM"},"%S":function(M){return D(M.tm_sec,2)},"%t":function(){return"	"},"%u":function(M){return M.tm_wday||7},"%U":function(M){var W=M.tm_yday+7-M.tm_wday;return D(Math.floor(W/7),2)},"%V":function(M){var W=Math.floor((M.tm_yday+7-(M.tm_wday+6)%7)/7);if((M.tm_wday+371-M.tm_yday-2)%7<=2&&W++,W){if(W==53){var ce=(M.tm_wday+371-M.tm_yday)%7;ce!=4&&(ce!=3||!Jn(M.tm_year))&&(W=1)}}else{W=52;var Ae=(M.tm_wday+7-M.tm_yday-1)%7;(Ae==4||Ae==5&&Jn(M.tm_year%400-1))&&W++}return D(W,2)},"%w":function(M){return M.tm_wday},"%W":function(M){var W=M.tm_yday+7-(M.tm_wday+6)%7;return D(Math.floor(W/7),2)},"%y":function(M){return(M.tm_year+1900).toString().substring(2)},"%Y":function(M){return M.tm_year+1900},"%z":function(M){var W=M.tm_gmtoff,Ae=W>=0;return W=Math.abs(W)/60,W=W/60*100+W%60,(Ae?"+":"-")+String("0000"+W).slice(-4)},"%Z":function(M){return M.tm_zone},"%%":function(){return"%"}};b=b.replace(/%%/g,"\0\0");for(var T in we)b.includes(T)&&(b=b.replace(new RegExp(T,"g"),we[T](w)));b=b.replace(/\0\0/g,"%");var xe=ro(b,!1);return xe.length>a?0:(Xr(xe,i),xe.length-1)}function hg(i,a,l,h){return fg(i,a,l,h)}var iu=function(i,a,l,h){i||(i=this),this.parent=i,this.mount=i.mount,this.mounted=null,this.id=v.nextInode++,this.name=a,this.mode=l,this.node_ops={},this.stream_ops={},this.rdev=h},eo=365,to=146;Object.defineProperties(iu.prototype,{read:{get:function(){return(this.mode&eo)===eo},set:function(i){i?this.mode|=eo:this.mode&=~eo}},write:{get:function(){return(this.mode&to)===to},set:function(i){i?this.mode|=to:this.mode&=~to}},isFolder:{get:function(){return v.isDir(this.mode)}},isDevice:{get:function(){return v.isChrdev(this.mode)}}}),v.FSNode=iu,v.staticInit(),hd(),wr=r.BindingError=ts(Error,"BindingError"),Va=r.InternalError=ts(Error,"InternalError"),Rd(),Sd(),Ld(),ja=r.UnboundTypeError=ts(Error,"UnboundTypeError"),jd();for(var $e,pg=new Float32Array(288),Ct=0;Ct<288;++Ct)Kn[Ct]=pg.subarray(0,Ct+1);for(var dg=new Int32Array(288),Ct=0;Ct<288;++Ct)Qn[Ct]=dg.subarray(0,Ct+1);function ro(i,a,l){var h=l>0?l:fe(i)+1,d=new Array(h),w=Te(i,d,0,d.length);return a&&(d.length=w),d}var vg={_:Yp,k:Xp,a:$p,c:Zp,S:td,T:rd,p:od,M:sd,V:id,J:ad,K:ud,t:ld,L:cd,B:fd,X:vd,d:Vd,f:zd,e:qd,b:Yd,W:Zd,h:Qd,g:Jd,w:tv,j:nv,i:ov,v:sv,q:iv,Y:av,P:uv,O:cv,m:fv,la:dv,y:cs,ma:vv,ka:yv,r:wv,z:bv,ja:_v,na:Sv,n:Ev,l:Tv,x:xv,Q:kv,G:Pv,R:ds,s:Av,F:Rv,N:Mv,E:Dv,H:Iv,I:Fv,$:Uv,o:Lv,U:Nv,A:Wv,u:zv,Z:Xv,ia:Jv,ga:eg,ha:tg,ca:rg,fa:ng,ba:og,ea:sg,aa:ig,da:ag,C:ug,D:hg};qp(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var At=r._malloc=function(){return(At=r._malloc=r.asm.qa).apply(null,arguments)},Rt=r._free=function(){return(Rt=r._free=r.asm.ra).apply(null,arguments)},au=r.___errno_location=function(){return(au=r.___errno_location=r.asm.sa).apply(null,arguments)},uu=r.___getTypeName=function(){return(uu=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var lu=r._htons=function(){return(lu=r._htons=r.asm.wa).apply(null,arguments)},cu=r._emscripten_builtin_memalign=function(){return(cu=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},fu=r.___cxa_is_pointer_type=function(){return(fu=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Aa).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Ea).apply(null,arguments)},r.FS=v;var no;function gs(i){this.name="ExitStatus",this.message="Program terminated with exit("+i+")",this.status=i}jr=function i(){no||ms(),no||(jr=i)};function ms(i){if(Qt>0||(Up(),Qt>0))return;function a(){no||(no=!0,r.calledRun=!0,!Me&&(Lp(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),Gp()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),a()},1)):a()}r.run=ms;function gg(i,a){mg(i)}function mg(i){Ua()||(r.onExit&&r.onExit(i),Me=!0),c(i,new gs(i))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return ms(),r.ready}})();const oo={library:null},pu=t=>{oo.library=t},U=()=>{if(!oo.library)throw new Error("oppencascade has not been loaded");return oo.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const nr=new globalThis.FinalizationRegistry(t=>{try{t.delete()}catch(e){console.error(e)}});class ft{constructor(e){this.oc=U(),e&&nr.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(nr.unregister(this._wrapped),this._wrapped.delete()),nr.register(this,e,e),this._wrapped=e}delete(){var e;nr.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const ve=()=>{function t(e){return nr.register(t,e),e}return t},ys=t=>{function e(r){return nr.register(t,r),r}return e},be=t=>{const e=new Set;return[r=>(e.add(r),r),()=>{[...e.values()].forEach(r=>r.delete()),e.clear()},t?e:void 0]},ws=2147483647,nt=Math.PI/180,br=180/Math.PI,so=t=>Math.round(t*1e3)/1e3,_r=(t,e,r)=>{const n=U(),o=je(t),s=mt(e);let u;if(r){const c=mt(r);u=new n.gp_Ax3_3(o,s,c),c.delete()}else u=new n.gp_Ax3_4(o,s);return o.delete(),s.delete(),u},rn=(t,e,r)=>{const n=U(),o=je(t),s=mt(e);let u;if(r){const c=mt(r);u=new n.gp_Ax2_2(o,s,c),c.delete()}else u=new n.gp_Ax2_3(o,s);return o.delete(),s.delete(),u},bs=(t,e)=>{const r=U(),n=je(t),o=mt(e),s=new r.gp_Ax1_2(n,o);return n.delete(),o.delete(),s},du=(t=[0,0,0])=>{const e=U();if(Array.isArray(t)){if(t.length===3)return new e.gp_Vec_4(...t);if(t.length===2)return new e.gp_Vec_4(...t,0)}else{if(t instanceof q)return new e.gp_Vec_3(t.wrapped.XYZ());if(t.XYZ)return new e.gp_Vec_3(t.XYZ())}return new e.gp_Vec_4(0,0,0)};class q extends ft{constructor(e=[0,0,0]){super(du(e))}get repr(){return`x: ${so(this.x)}, y: ${so(this.y)}, z: ${so(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new q(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new q(this.wrapped.Subtracted(e.wrapped))}add(e){return new q(this.wrapped.Added(e.wrapped))}multiply(e){return new q(this.wrapped.Multiplied(e))}normalized(){return new q(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*br}projectToPlane(e){const r=e.origin,n=e.zDir,o=this.sub(r),s=n.multiply(o.dot(n)/n.Length**2),u=this.sub(s);return o.delete(),s.delete(),u}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,r=[0,0,0],n=[0,0,1]){const o=bs(r,n);return this.wrapped.Rotate(o,e*nt),o.delete(),this}}const vu={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function gu(t){return t==="X"||t==="Y"||t==="Z"?vu[t]:t}function je(t){const e=new q(t),r=e.toPnt();return e.delete(),r}function mt(t){const e=new q(t),r=e.toDir();return e.delete(),r}class or extends ft{constructor(e){const r=U();super(e||new r.gp_Trsf_1)}translate(e,r=0,n=0){const o=new q(typeof e=="number"?[e,r,n]:e);return this.wrapped.SetTranslation_1(o.wrapped),this}rotate(e,r=[0,0,0],n=[0,0,1]){const o=mt(n),s=je(r),u=new this.oc.gp_Ax1_2(s,o);return this.wrapped.SetRotation_1(u,e*nt),u.delete(),o.delete(),s.delete(),this}mirror(e="YZ",r){const n=ve();let o,s;if(typeof e=="string"){const c=n(_s(e,r));o=c.origin,s=c.zDir}else e instanceof Je?(o=r||e.origin,s=e.zDir):(o=r||[0,0,0],s=e);const u=n(rn(o,s));return this.wrapped.SetMirror_3(u),this}scale(e,r){const n=je(e);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(e,r){const n=ve(),o=n(e==="reference"?new this.oc.gp_Ax3_1:_r(e.origin,e.zDir,e.xDir)),s=n(r==="reference"?new this.oc.gp_Ax3_1:_r(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(o,s),this}transformPoint(e){const r=je(e),n=r.Transformed(this.wrapped);return r.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class Je{constructor(e,r=null,n=[0,0,1]){this.oc=U();const o=new q(n);if(o.Length===0)throw new Error("normal should be non null");this.zDir=o.normalize();let s;if(r)s=new q(r);else{const u=_r(e,o);s=new q(u.XDirection()),u.delete()}if(s.Length===0)throw new Error("xDir should be non null");this.xDir=s.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new q(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new Je(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const r=this.clone();return r.origin=new q(e),r}translate(e,r=0,n=0){const o=new q(typeof e=="number"?[e,r,n]:e);return this.translateTo(this.origin.add(o))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,r=[1,0,0]){const n=gu(r),o=new q(this.zDir).rotate(e,[0,0,0],n),s=new q(this.xDir).rotate(e,[0,0,0],n);return new Je(this.origin,s,o)}rotate2DAxes(e){const r=new q(this.xDir).rotate(e,[0,0,0],this.zDir);return new Je(this.origin,r,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,r=_r(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,r),this.globalToLocal=new or,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new or,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,r){this.origin=this.toWorldCoords([e,r])}toLocalCoords(e){const r=this.globalToLocal.transformPoint(e),n=new q(r);return r.delete(),n}toWorldCoords(e){const r=this.localToGlobal.transformPoint(e),n=new q(r);return r.delete(),n}}const mu={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},_s=(t,e=[0,0,0])=>{const r=mu[t];if(!r)throw new Error(`Could not find plane ${t}`);let n;return typeof e=="number"?n=r.normal.map(o=>o*e):n=e,new Je(n,r.xDir,r.normal)};let yu=class extends ft{constructor(e){const r=U();let n=e;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[e,r]=this.bounds;return`${new q(e).repr} - ${new q(r).repr}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0},s={current:0},u={current:0};return this.wrapped.Get(e,r,n,o,s,u),[[e.current,r.current,n.current],[o.current,s.current,u.current]]}get center(){const[[e,r,n],[o,s,u]]=this.bounds;return[e+(o-e)/2,r+(s-r)/2,n+(u-n)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}get depth(){const[[,,e],[,,r]]=this.bounds;return Math.abs(r-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};function sr(t="XY",e=[0,0,0]){return t instanceof Je?t.clone():_s(t,e)}function wu(t,e,r=[0,0,0],n=[0,0,1]){const o=new or;o.rotate(e,r,n);const s=o.transform(t);return o.delete(),s}function bu(t,e){const r=new or;r.translate(e);const n=r.transform(t);return r.delete(),n}function _u(t,e,r){const n=new or;n.mirror(e,r);const o=n.transform(t);return n.delete(),o}function Su(t,e,r){const n=new or;n.scale(e,r);const o=n.transform(t);return n.delete(),o}function nn(t){return Array.isArray(t)&&t.length===2}let on=null;const Ss=t=>{if(on&&!t)return on;const r=U().GeomAbs_CurveType;return on=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),on},sn=t=>{let e=Ss().get(t);if(e||(e=Ss(!0).get(t)),!e)throw new Error("unknown type");return e};function Eu(t,e){const r=Math.pow(10,e),n=e<0?t:.01/r+t;return Math.round(n*r)/r}function Tu(t){return Array.from(Array(t).keys())}function ir(t){const e=Math.min(...t.map(r=>r.length));return Tu(e).map(r=>t.map(n=>n[r]))}function an(t){return Math.round(t*100)/100}const Sr=([t,e])=>`(${an(t)},${an(e)})`,Es=(t,e=1e-9)=>{let r=t;return Math.abs(t)<e&&(r=0),r.toFixed(-Math.log10(e))},Ts=(t,e=1e-9)=>Array.from(new Map(t.map(([r,n])=>[`[${Es(r,e)},${Es(n,e)}]`,[r,n]])).values()),Ue=([t,e])=>{const r=U();return new r.gp_Pnt2d_3(t,e)},xu=([t,e])=>{const r=U();return new r.gp_Dir2d_4(t,e)},xs=([t,e])=>{const r=U();return new r.gp_Vec2d_4(t,e)},ar=(t,e)=>{const r=U(),[n,o]=be(),s=new r.gp_Ax2d_2(n(Ue(t)),n(xu(e)));return o(),s};class Er extends ft{constructor(e){const r=U();let n=e;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[e,r]=this.bounds;return`${Sr(e)} - ${Sr(r)}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.wrapped.Get(e,r,n,o),[[e.current,r.current],[n.current,o.current]]}get center(){const[[e,r],[n,o]]=this.bounds;return[e+(n-e)/2,r+(o-r)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}outsidePoint(e=1){const[r,n]=this.bounds,o=n[0]-r[0],s=n[1]-r[1];return[n[0]+o/100*e,n[1]+s/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=ve()(Ue(e));return!this.wrapped.IsOut_1(n)}}const He=([t,e],[r,n],o=1e-6)=>Math.abs(t-r)<=o&&Math.abs(e-n)<=o,ur=([t,e],[r,n])=>[t+r,e+n],io=([t,e],[r,n])=>[t-r,e-n],ao=([t,e],r)=>[t*r,e*r],ht=([t,e],[r,n]=[0,0])=>Math.sqrt((t-r)**2+(e-n)**2),ku=([t,e],[r,n]=[0,0])=>(t-r)**2+(e-n)**2;function Pu([t,e],[r,n]){return t*n-e*r}const Cu=([t,e],[r,n]=[0,0])=>Math.atan2(n*t-e*r,t*r+e*n),Au=([t,e],[r,n]=[0,0])=>Math.atan2(n-e,r-t),Mt=([t,e])=>{const r=ht([t,e]);return[t/r,e/r]},Ru=(t,e,r=[0,0])=>{const[n,o]=t,[s,u]=r,c=n-s,f=o-u,p=Math.sin(e),g=Math.cos(e),y=c*g-f*p,m=c*p+f*g;return[y+s,m+u]},lr=(t,e)=>{const r=Math.cos(e)*t,n=Math.sin(e)*t;return[r,n]},Mu=([t,e])=>{const r=ht([t,e]),n=Math.atan2(e,t);return[r,n]};class ge extends ft{constructor(e){const r=U(),n=e.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=U(),r=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new Er(r),this._boundingBox}get repr(){return`${this.geomType} ${Sr(this.firstPoint)} - ${Sr(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const r=this.innerCurve.Value(e),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=U();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),r=sn(e.GetType());return e.delete(),r}clone(){return new ge(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const r=U(),n=ve(),o=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n(Ue(e)),this.wrapped));let s=1/0;try{s=o.LowerDistance()}catch{s=1/0}return Math.min(s,ht(e,this.firstPoint),ht(e,this.lastPoint))}distanceFromCurve(e){const r=U(),n=ve();let o=1/0;const s=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{o=s.LowerDistance()}catch{o=1/0}return Math.min(o,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return nn(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,r=1e-9){const n=U(),o=ve();let s,u;try{const c=o(new n.Geom2dAPI_ProjectPointOnCurve_2(o(Ue(e)),this.wrapped));s=c.LowerDistance(),u=c.LowerDistanceParameter()}catch{if(He(e,this.firstPoint,r))return this.firstParameter;if(He(e,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(s>r)throw new Error(`Point ${Sr(e)} not on curve ${this.repr}, ${s.toFixed(9)}`);return u}tangentAt(e){const r=U(),[n,o]=be();let s;Array.isArray(e)?s=this.parameter(e):s=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const u=n(new r.gp_Pnt2d_1),c=n(new r.gp_Vec2d_1);this.innerCurve.D1(s,u,c);const f=[c.X(),c.Y()];return o(),f}splitAt(e,r=1e-9){const n=U(),o=ve();let s=e.map(f=>nn(f)?this.parameter(f,r):f);s=Array.from(new Map(s.map(f=>[Eu(f,-Math.log10(r)),f])).values()).sort((f,p)=>f-p);const u=this.firstParameter,c=this.lastParameter;return u>c&&s.reverse(),Math.abs(s[0]-u)<r*100&&(s=s.slice(1)),s.length?(Math.abs(s[s.length-1]-c)<r*100&&(s=s.slice(0,-1)),s.length?ir([[u,...s],[...s,c]]).map(([f,p])=>{try{if(this.geomType==="BEZIER_CURVE"){const y=new n.Geom2d_BezierCurve_1(o(this.adaptor()).Bezier().get().Poles_2());return y.Segment(f,p),new ge(new n.Handle_Geom2d_Curve_2(y))}if(this.geomType==="BSPLINE_CURVE"){const y=o(this.adaptor()).BSpline().get(),m=new n.Geom2d_BSplineCurve_1(y.Poles_2(),y.Knots_2(),y.Multiplicities_2(),y.Degree(),y.IsPeriodic());return m.Segment(f,p,r),new ge(new n.Handle_Geom2d_Curve_2(m))}const g=new n.Geom2d_TrimmedCurve(this.wrapped,f,p,!0,!0);return new ge(new n.Handle_Geom2d_Curve_2(g))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const ks=(t,e=1e-8)=>{const r=U(),o=ve()(new r.Geom2dConvert_ApproxCurve_2(t.ShallowCopy(),e,r.GeomAbs_Shape.GeomAbs_C0,30,3));return new ge(o.Curve())},Ps=t=>{if(sn(t.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=t.BSpline(),r=U(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*o(){const u=n.NbArcs();if(!!u)for(let c=1;c<=u;c++){const f=n.Arc(c);yield new ge(f)}}const s=Array.from(o());return n.delete(),s};function*Cs(t){const e=t.NbPoints();if(!!e)for(let r=1;r<=e;r++){const n=t.Point(r);yield[n.X(),n.Y()]}}function*Ou(t){const e=t.NbSegments();if(!e)return;const r=U();for(let n=1;n<=e;n++){const o=new r.Handle_Geom2d_Curve_1,s=new r.Handle_Geom2d_Curve_1;try{t.Segment(n,o,s)}catch{continue}yield new ge(o),s.delete()}}const Tr=(t,e,r=1e-9)=>{if(t.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=U(),o=new n.Geom2dAPI_InterCurveCurve_1;let s,u;try{o.Init_1(t.wrapped,e.wrapped,r),s=Array.from(Cs(o)),u=Array.from(Ou(o))}catch(p){throw console.error(t,e,p),new Error("Intersections failed between curves")}finally{o.delete()}const c=u.filter(p=>He(p.firstPoint,p.lastPoint,r)).map(p=>p.firstPoint);c.length&&(s.push(...c),u=u.filter(p=>!He(p.firstPoint,p.lastPoint,r)));const f=u.flatMap(p=>[p.firstPoint,p.lastPoint]);return{intersections:s,commonSegments:u,commonSegmentsPoints:f}},Du=(t,e=1e-9)=>{const r=U(),n=new r.Geom2dAPI_InterCurveCurve_1;let o;try{n.Init_1(t.wrapped,t.wrapped,e),o=Array.from(Cs(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return o},xr=(t,e)=>{const r=U(),[n,o]=be(),s=n(new r.GCE2d_MakeSegment_1(n(Ue(t)),n(Ue(e)))).Value(),u=new ge(s);return He(u.firstPoint,t)||u.reverse(),o(),u},uo=(t,e,r)=>{const n=U(),[o,s]=be(),u=o(new n.GCE2d_MakeArcOfCircle_4(o(Ue(t)),o(Ue(e)),o(Ue(r)))).Value();s();const c=new ge(u);return He(c.firstPoint,t)||c.wrapped.get().SetTrim(c.lastParameter,c.firstParameter,!0,!0),c},Bu=(t,e,r)=>{const n=U(),[o,s]=be(),u=o(new n.GCE2d_MakeArcOfCircle_5(o(Ue(t)),o(xs(e)),o(Ue(r)))).Value();s();const c=new ge(u);return He(c.firstPoint,t)||c.wrapped.get().SetTrim(c.lastParameter,c.firstParameter,!0,!0),c},Iu=(t,e,r,n,o=[0,0],s,u=!0)=>{const c=U(),[f,p]=be(),g=f(new c.gp_Elips2d_2(f(ar(o,s)),t,e,!0)),y=f(new c.GCE2d_MakeArcOfEllipse_1(g,r,n,u)).Value();return p(),new ge(y)},Fu=(t,e,r)=>{const n=U(),[o,s]=be(),u=o(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));u.SetValue(1,o(Ue(t))),e.forEach((f,p)=>{u.SetValue(p+2,o(Ue(f)))}),u.SetValue(e.length+2,o(Ue(r)));const c=new n.Geom2d_BezierCurve_1(u);return s(),new ge(new n.Handle_Geom2d_Curve_2(c))},As=(t,e,r)=>{const n=ao(ur(t,e),.5),o=ht(r,t),s=Mt(io(n,r));return uo(t,ur(ao(s,o),r),e)},Uu=(t,e,r)=>{const n=Mt(io(e,t)),o=[n[1],-n[0]],s=[o[0]*r,o[1]*r];return{firstPoint:ur(t,s),lastPoint:ur(e,s)}},lo=(t,e)=>{const r=ve(),n=t.geomType;if(n==="CIRCLE"){const f=r(r(t.adaptor()).Circle()),p=f.Radius(),g=f.IsDirect()?1:-1,y=e*g,m=p+y;if(m<1e-10){const C=r(f.Location()),R=[C.X(),C.Y()],O=$=>{const[z,ae]=Mt(io($,R));return ur($,[y*z,y*ae])};return{collapsed:!0,firstPoint:O(t.firstPoint),lastPoint:O(t.lastPoint)}}const _=U(),E=new _.gp_Circ2d_3(f.Axis(),m),x=new _.Geom2d_Circle_1(E),k=new _.Geom2d_TrimmedCurve(new _.Handle_Geom2d_Curve_2(x),t.firstParameter,t.lastParameter,!0,!0);return new ge(new _.Handle_Geom2d_Curve_2(k))}if(n==="LINE"){const{firstPoint:f,lastPoint:p}=Uu(t.firstPoint,t.lastPoint,e);return xr(f,p)}const o=U(),s=new ge(new o.Handle_Geom2d_Curve_2(new o.Geom2d_OffsetCurve(t.wrapped,e,!0))),u=ks(s.adaptor());return Du(u).length?{collapsed:!0,firstPoint:u.firstPoint,lastPoint:u.lastPoint}:u};function Rs(t,e,r){const n=Pu(t.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const o=n>0?-1:1,s=Math.abs(r)*o,u=lo(t,s),c=lo(e,s);if(!(u instanceof ge)||!(c instanceof ge))return null;let f;try{const{intersections:_}=Tr(u,c,1e-9);f=_.at(-1)}catch{return null}if(!nn(f))return null;const p=f,g=(_,E)=>{const[x,k]=E.tangentAt(p),C=Mt([-k,x]),R=ur(p,ao(C,s)),O=_.parameter(R,1e-6);return _.splitAt([O])},[y]=g(t,u),[,m]=g(e,c);return{first:y,second:m,center:p}}function co(t,e,r){const n=Rs(t,e,r);if(!n)return console.warn("Cannot fillet between curves",t.repr,e.repr),[t,e];const{first:o,second:s,center:u}=n;return[o,As(o.lastPoint,s.firstPoint,u),s]}function fo(t,e,r){const n=Rs(t,e,r);if(!n)return console.warn("Cannot chamfer between curves",t.repr,e.repr),[t,e];const{first:o,second:s}=n;return[o,xr(o.lastPoint,s.firstPoint),s]}class Lu{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,r){let n=this.length++;for(;n>0;){const o=n-1>>1,s=this.values[o];if(r>=s)break;this.ids[n]=this.ids[o],this.values[n]=s,n=o}this.ids[n]=e,this.values[n]=r}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],o=this.length>>1;let s=0;for(;s<o;){let u=(s<<1)+1;const c=u+1;let f=this.ids[u],p=this.values[u];const g=this.values[c];if(c<this.length&&g<p&&(u=c,f=this.ids[c],p=g),p>=n)break;this.ids[s]=f,this.values[s]=p,s=u}this.ids[s]=r,this.values[s]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Ms=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],ho=3;class po{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==ho)throw new Error(`Got v${n>>4} data when expected v${ho}.`);const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new po(s,o,Ms[n&15],e)}constructor(e,r=16,n=Float64Array,o){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535);let s=e,u=s;this._levelBounds=[s*4];do s=Math.ceil(s/this.nodeSize),u+=s,this._levelBounds.push(u*4);while(s!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const c=Ms.indexOf(this.ArrayType),f=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(c<0)throw new Error(`Unexpected typed array class: ${n}.`);o&&o instanceof ArrayBuffer?(this.data=o,this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+f,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+f+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+f,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(ho<<4)+c]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e),this._queue=new Lu}add(e,r,n,o){const s=this._pos>>2;return this._indices[s]=s,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=o,e<this.minX&&(this.minX=e),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),o>this.maxY&&(this.maxY=o),s}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),o=(1<<16)-1;for(let s=0;s<this.numItems;s++){let u=4*s;const c=this._boxes[u++],f=this._boxes[u++],p=this._boxes[u++],g=this._boxes[u++],y=Math.floor(o*((c+p)/2-this.minX)/e),m=Math.floor(o*((f+g)/2-this.minY)/r);n[s]=Nu(y,m)}vo(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let s=0,u=0;s<this._levelBounds.length-1;s++){const c=this._levelBounds[s];for(;u<c;){const f=u;let p=1/0,g=1/0,y=-1/0,m=-1/0;for(let _=0;_<this.nodeSize&&u<c;_++)p=Math.min(p,this._boxes[u++]),g=Math.min(g,this._boxes[u++]),y=Math.max(y,this._boxes[u++]),m=Math.max(m,this._boxes[u++]);this._indices[this._pos>>2]=f,this._boxes[this._pos++]=p,this._boxes[this._pos++]=g,this._boxes[this._pos++]=y,this._boxes[this._pos++]=m}}}search(e,r,n,o,s){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let u=this._boxes.length-4;const c=[],f=[];for(;u!==void 0;){const p=Math.min(u+this.nodeSize*4,Ds(u,this._levelBounds));for(let g=u;g<p;g+=4){if(n<this._boxes[g]||o<this._boxes[g+1]||e>this._boxes[g+2]||r>this._boxes[g+3])continue;const y=this._indices[g>>2]|0;u<this.numItems*4?(s===void 0||s(y))&&f.push(y):c.push(y)}u=c.pop()}return f}neighbors(e,r,n=1/0,o=1/0,s){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let u=this._boxes.length-4;const c=this._queue,f=[],p=o*o;for(;u!==void 0;){const g=Math.min(u+this.nodeSize*4,Ds(u,this._levelBounds));for(let y=u;y<g;y+=4){const m=this._indices[y>>2]|0,_=Os(e,this._boxes[y],this._boxes[y+2]),E=Os(r,this._boxes[y+1],this._boxes[y+3]),x=_*_+E*E;u<this.numItems*4?(s===void 0||s(m))&&c.push((m<<1)+1,x):c.push(m<<1,x)}for(;c.length&&c.peek()&1;)if(c.peekValue()>p||(f.push(c.pop()>>1),f.length===n))return c.clear(),f;u=c.pop()>>1}return c.clear(),f}}function Os(t,e,r){return t<e?e-t:t<=r?0:t-r}function Ds(t,e){let r=0,n=e.length-1;for(;r<n;){const o=r+n>>1;e[o]>t?n=o:r=o+1}return e[r]}function vo(t,e,r,n,o,s){if(Math.floor(n/s)>=Math.floor(o/s))return;const u=t[n+o>>1];let c=n-1,f=o+1;for(;;){do c++;while(t[c]<u);do f--;while(t[f]>u);if(c>=f)break;Gu(t,e,r,c,f)}vo(t,e,r,n,f,s),vo(t,e,r,f+1,o,s)}function Gu(t,e,r,n,o){const s=t[n];t[n]=t[o],t[o]=s;const u=4*n,c=4*o,f=e[u],p=e[u+1],g=e[u+2],y=e[u+3];e[u]=e[c],e[u+1]=e[c+1],e[u+2]=e[c+2],e[u+3]=e[c+3],e[c]=f,e[c+1]=p,e[c+2]=g,e[c+3]=y;const m=r[n];r[n]=r[o],r[o]=m}function Nu(t,e){let r=t^e,n=65535^r,o=65535^(t|e),s=t&(e^65535),u=r|n>>1,c=r>>1^r,f=o>>1^n&s>>1^o,p=r&o>>1^s>>1^s;r=u,n=c,o=f,s=p,u=r&r>>2^n&n>>2,c=r&n>>2^n&(r^n)>>2,f^=r&o>>2^n&s>>2,p^=n&o>>2^(r^n)&s>>2,r=u,n=c,o=f,s=p,u=r&r>>4^n&n>>4,c=r&n>>4^n&(r^n)>>4,f^=r&o>>4^n&s>>4,p^=n&o>>4^(r^n)&s>>4,r=u,n=c,o=f,s=p,f^=r&o>>8^n&s>>8,p^=n&o>>8^(r^n)&s>>8,r=f^f>>1,n=p^p>>1;let g=t^e,y=n|65535^(g|r);return g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,(y<<1|g)>>>0}const Bs=(t,e=1e-7)=>{const r=new po(t.length);t.forEach(s=>{const[u,c]=s.firstPoint;r.add(u-e,c-e,u+e,c+e)}),r.finish();const n=[],o=new Set;return t.forEach((s,u)=>{if(o.has(u))return;const c=[s];let f=u;o.add(u);let p=t.length;for(;;){if(p--<0)throw new Error("Infinite loop detected");const g=c[c.length-1].lastPoint,[y,m]=g,_=r.search(y-e,m-e,y+e,m+e),E=R=>Math.abs((f-R)%t.length),x=_.filter(R=>!o.has(R)).map(R=>[t[R],R,E(R)]).sort(([,,R],[,,O])=>E(R)-E(O));if(x.length===0){n.push(c);break}const[k,C]=x[0];c.push(k),o.add(C),f=C}}),n};function ot(t){return Math.round(t*1e5)/1e5}const go=t=>`${an(t.X())} ${an(t.Y())}`,kr=(t,e)=>{const r=U(),n=sn(t.GetType()),[o,s]=e,u=`${ot(o)} ${ot(s)}`;if(n==="LINE")return`L ${u}`;if(n==="BEZIER_CURVE"){const p=t.Bezier().get(),g=p.Degree();if(g===1)return`L ${u}`;if(g===2)return`Q ${go(p.Pole(2))} ${u}`;if(g===3){const y=go(p.Pole(2)),m=go(p.Pole(3));return`C ${y} ${m} ${u}`}}if(n==="CIRCLE"){const p=t.Circle(),g=p.Radius(),y=t.FirstParameter(),_=(t.LastParameter()-y)*br,E=_!==360?u:`${ot(o)} ${ot(s+1e-4)}`;return`A ${g} ${g} 0 ${Math.abs(_)>180?"1":"0"} ${p.IsDirect()?"1":"0"} ${E}`}if(n==="ELLIPSE"){const p=t.Ellipse(),g=p.MajorRadius(),y=p.MinorRadius(),m=t.FirstParameter(),E=(t.LastParameter()-m)*br,x=E!==360?u:`${ot(o)} ${ot(s+1e-4)}`,k=new r.gp_Dir2d_1,C=180-p.XAxis().Direction().Angle(k)*br;return k.delete(),`A ${ot(g)} ${ot(y)} ${ot(C)} ${Math.abs(E)>180?"1":"0"} ${p.IsDirect()?"1":"0"} ${x}`}if(n==="BSPLINE_CURVE"&&t.BSpline().get().Degree()<4)return Ps(t).map(y=>kr(y.adaptor(),y.lastPoint)).join(" ");const c=ks(t);return Ps(c.adaptor()).map(p=>kr(p.adaptor(),p.lastPoint)).join(" ")},Hu={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},un={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class Is{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(r=>r(this)),this}not(e){const r=new this.constructor;e(r);const n=({element:o})=>!r.shouldKeep(o);return this.filters.push(n),this}either(e){const r=e.map(o=>{const s=new this.constructor;return o(s),s}),n=({element:o})=>r.some(s=>s.shouldKeep(o));return this.filters.push(n),this}find(e,{unique:r=!1}={}){const n=this.applyFilter(e);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class Fs extends Is{inList(e){const r=({element:n})=>!!e.find(o=>o.isSame(n));return this.filters.push(r),this}atAngleWith(e="Z",r=0){let n;typeof e=="string"?n=new q(Hu[e]):n=new q(e);const o=({normal:s})=>{if(!s)return!1;const u=Math.acos(Math.abs(s.dot(n)));return Math.abs(u-nt*r)<1e-6};return this.filters.push(o),this}atDistance(e,r=[0,0,0]){const n=je(r),o=U(),s=new o.BRepBuilderAPI_MakeVertex(n),u=s.Vertex();s.delete();const c=new o.BRepExtrema_DistShapeShape_1;c.LoadS1(u);const f=({element:p})=>{const g=ve();c.LoadS2(p.wrapped);const y=g(new o.Message_ProgressRange_1);return c.Perform(y),Math.abs(c.Value()-e)<1e-6};return this.filters.push(f),ys(f)(c),this}containsPoint(e){return this.atDistance(0,e)}inBox(e,r){const n=U(),o=new n.BRepPrimAPI_MakeBox_4(je(e),je(r)),s=o.Solid();o.delete();const u=new n.BRepExtrema_DistShapeShape_1;u.LoadS1(s);const c=({element:p})=>{const g=ve();u.LoadS2(p.wrapped);const y=g(new n.Message_ProgressRange_1);return u.Perform(y),u.Value()<1e-6},f=ys(c);return f(s),f(u),this.filters.push(c),this}}class ln extends Fs{clone(){const e=new ln;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const r=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(r),this}ofCurveType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}parallelTo(e){if(typeof e=="string"&&un[e])return this.atAngleWith(un[e],90);if(typeof e!="string"&&e instanceof Je)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(e,r){const n=e instanceof Je?sr(e):sr(e,r);this.parallelTo(n);const o=({element:s})=>{const u=s.startPoint,c=u.projectToPlane(n);return u.equals(c)};return this.filters.push(o),this}shouldKeep(e){let r=null;try{r=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:e}))}applyFilter(e){return e.edges.filter(r=>this.shouldKeep(r))}}class mo extends Fs{clone(){const e=new mo;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&un[e])return this.atAngleWith(un[e]);if(typeof e!="string"&&e instanceof Je)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}inPlane(e,r){const n=e instanceof Je?sr(e):sr(e,r);this.parallelTo(n);const o=({element:s})=>{const u=s.center,c=u.projectToPlane(n);return u.equals(c)};return this.filters.push(o),this}shouldKeep(e){const r=e.normalAt();return this.filters.every(o=>o({normal:r,element:e}))}applyFilter(e){return e.faces.filter(r=>this.shouldKeep(r))}}const Wu=function(t){return t.curves.map((e,r)=>({firstCurve:e,secondCurve:t.curves[(r+1)%t.curves.length],point:e.lastPoint}))},yo=2*Math.PI,Us=t=>{const e=t%yo,r=e<0?e+yo:e;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-yo)};class cn extends Is{clone(){const e=new cn;return e.filters=[...this.filters],e}inList(e){const r=({element:n})=>!!e.find(o=>He(o,n.point));return this.filters.push(r),this}atDistance(e,r=[0,0]){function n({element:o}){return Math.abs(ht(r,o.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function r({element:n}){return He(e,n.point)}return this.filters.push(r),this}inBox(e,r){const[n,o]=e,[s,u]=r,c=Math.min(n,s),f=Math.max(n,s),p=Math.min(o,u),g=Math.max(o,u);function y({element:m}){const[_,E]=m.point;return _>=c&&_<=f&&E>=p&&E<=g}return this.filters.push(y),this}ofAngle(e){function r({element:n}){const o=n.firstCurve.tangentAt(1),s=n.secondCurve.tangentAt(0);return Math.abs(Us(Cu(o,s))-Us(nt*e))<1e-9}return this.filters.push(r),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return Wu(e).filter(r=>this.shouldKeep(r))}}const Ls=t=>{const e=U();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[t]},Vu=function*(e,r){const n=U(),o=new n.TopExp_Explorer_2(e,Ls(r),Ls("shape")),s=new Map;for(;o.More();){const u=o.Current(),c=u.HashCode(ws);s.get(c)||(s.set(c,!0),yield u),o.Next()}o.delete()},Gs=t=>{if(t.IsNull())throw new Error("This shape has not type, it is null");return t.ShapeType()};class fn extends ft{constructor(e){super(e)}clone(){return new this.constructor(Xt(this.wrapped))}get hashCode(){return this.wrapped.HashCode(ws)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=U(),r=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=ue(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,r=0,n=0){const o=typeof e=="number"?[e,r,n]:e,s=ue(bu(this.wrapped,o));if(this.delete(),this.constructor!==s.constructor)throw new Error("unexpected types mismatch");return s}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,r=[0,0,0],n=[0,0,1]){const o=ue(wu(this.wrapped,e,r,n));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}mirror(e,r){const n=ue(_u(this.wrapped,e,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,r=[0,0,0]){const n=ue(Su(this.wrapped,r,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return Vu(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(r=>Xt(r))}get edges(){return this._listTopo("edge").map(e=>new Ot(e))}get faces(){return this._listTopo("face").map(e=>new cr(e))}get wires(){return this._listTopo("wire").map(e=>new Dt(e))}get boundingBox(){const e=new yu;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,r,!1)}mesh({tolerance:e=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:e,angularTolerance:r});let n=[],o=[],s=[];const u=[];for(const c of this.faces){const f=c.triangulation(o.length/3);if(!f)continue;const{trianglesIndexes:p,vertices:g,verticesNormals:y}=f;u.push({start:n.length,count:p.length,faceId:c.hashCode}),n=n.concat(p),o=o.concat(g),s=s.concat(y)}return{triangles:n,vertices:o,normals:s,faceGroups:u}}meshEdges({tolerance:e=.001,angularTolerance:r=.1}={}){var n;const o=ve(),s=new Set,u=[],c=[],f=()=>{const g=u.length;let y=null;return[m=>{y?(u.push(...y),y=[m.X(),m.Y(),m.Z()],u.push(...y)):y=[m.X(),m.Y(),m.Z()]},m=>{c.push({start:g/3,count:(u.length-g)/3,edgeId:m}),s.add(m)}]},p=o(new this.oc.TopLoc_Location_1);for(const g of this.faces){const y=o(this.oc.BRep_Tool.Triangulation(g.wrapped,p,0));if(y.IsNull())continue;const m=y.get();for(const _ of g.edges){if(o(_),s.has(_.hashCode))continue;const E=o(new this.oc.TopLoc_Location_1),x=o(this.oc.BRep_Tool.PolygonOnTriangulation_1(_.wrapped,y,E)),k=(n=x?.get())==null?void 0:n.Nodes();if(!k)continue;o(k);const[C,R]=f();for(let O=k.Lower();O<=k.Upper();O++){const $=o(o(m.Node(k.Value(O))).Transformed(E.Transformation()));C($)}R(_.hashCode)}}for(const g of this.edges){o(g);const y=g.hashCode;if(s.has(y))continue;const m=o(new this.oc.BRepAdaptor_Curve_2(g.wrapped)),_=o(new this.oc.GCPnts_TangentialDeflection_2(m,e,r,2,1e-9,1e-7)),[E,x]=f();for(let k=0;k<_.NbPoints();k++){const C=o(_.Value(k+1).Transformed(p.Transformation()));E(C)}x(y)}return{lines:u,edgeGroups:c}}blobSTEP(){const e="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const o=r.Write(e);if(r.delete(),n.delete(),o===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const s=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([s],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:r});const o="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,o,!n)){const u=this.oc.FS.readFile("/"+o);return this.oc.FS.unlink("/"+o),new Blob([u],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class Ns extends fn{}class Hs extends fn{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),r.delete(),n}get curve(){return new zu(this._geomAdaptor())}get startPoint(){const e=this.curve,r=e.startPoint;return e.delete(),r}get endPoint(){const e=this.curve,r=e.endPoint;return e.delete(),r}tangentAt(e=0){const r=this.curve,n=r.tangentAt(e);return r.delete(),n}get isClosed(){const e=this.curve,r=e.isClosed;return e.delete(),r}get isPeriodic(){const e=this.curve,r=e.isPeriodic;return e.delete(),r}get period(){const e=this.curve,r=e.period;return e.delete(),r}get geomType(){const e=this.curve,r=e.curveType;return e.delete(),r}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const r=e.Mass();return e.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class zu extends ft{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),r.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return sn(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new q(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new q(e)}tangentAt(e){let r=e;e||(r=(this.wrapped.LastParameter()-this.wrapped.FirstParameter())/2);const n=new this.oc.gp_Pnt_1,o=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,o);const s=new q(o);return n.delete(),o.delete(),s}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class Ot extends Hs{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class Dt extends Hs{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},o=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);o.Perform(e,0);const s=ue(o.Shape());if(o.delete(),this.delete(),!(s instanceof Dt))throw new Error("Could not offset with a wire");return s}}class qu extends ft{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class cr extends fn{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new qu(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,r=e.surfaceType;return e.delete(),r}get UVBounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,r,n,o),{uMin:e.current,uMax:r.current,vMin:n.current,vMax:o.current}}pointOnSurface(e,r){const{uMin:n,uMax:o,vMin:s,vMax:u}=this.UVBounds,c=this._geomAdaptor(),f=new this.oc.gp_Pnt_1,p=e*(o-n)+n,g=r*(u-s)+s;c.D0(p,g,f);const y=new q(f);return c.delete(),f.delete(),y}normalAt(e){let r=0,n=0;const o=ve();if(e){const p=o(this.oc.BRep_Tool.Surface_2(this.wrapped)),g=o(new this.oc.GeomAPI_ProjectPointOnSurf_2(o(je(e)),p,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),y={current:0},m={current:0};g.LowerDistanceParameters(y,m),r=y.current,n=m.current}else{const{uMin:p,uMax:g,vMin:y,vMax:m}=this.UVBounds;r=.5*(p+g),n=.5*(y+m)}const s=o(new this.oc.gp_Pnt_1),u=o(new this.oc.gp_Vec_1);return o(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,s,u),new q(u)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const r=new q(e.CentreOfMass());return e.delete(),r}outerWire(){const e=new Dt(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),r=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),r}triangulation(e=0){const r=ve(),n=r(new this.oc.TopLoc_Location_1),o=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(o.IsNull())return null;const s=r(n.Transformation()),u={vertices:[],trianglesIndexes:[],verticesNormals:[]},c=o.get(),f=c.NbNodes();u.vertices=new Array(f*3);for(let E=1;E<=f;E++){const x=r(r(c.Node(E)).Transformed(s));u.vertices[(E-1)*3+0]=x.X(),u.vertices[(E-1)*3+1]=x.Y(),u.vertices[(E-1)*3+2]=x.Z()}const p=r(new this.oc.TColgp_Array1OfDir_2(1,f)),g=r(new this.oc.Poly_Connect_2(o));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,g,p),u.verticesNormals=new Array(p.Length()*3);for(let E=p.Lower();E<=p.Upper();E++){const x=r(r(p.Value(E)).Transformed(s));u.verticesNormals[(E-1)*3+0]=x.X(),u.verticesNormals[(E-1)*3+1]=x.Y(),u.verticesNormals[(E-1)*3+2]=x.Z()}const y=this.orientation,m=c.NbTriangles();u.trianglesIndexes=new Array(m*3);let _=0;for(let E=1;E<=m;E++){const x=r(c.Triangle(E));let k=x.Value(1),C=x.Value(2);const R=x.Value(3);if(y==="backward"){const O=k;k=C,C=O}u.trianglesIndexes[_*3+0]=k-1+e,u.trianglesIndexes[_*3+1]=C-1+e,u.trianglesIndexes[_*3+2]=R-1+e,_++}return u}}class hn extends fn{fuse(e,{optimisation:r="none"}={}){const n=ve(),o=n(new this.oc.Message_ProgressRange_1),s=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,o));r==="commonFace"&&s.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&s.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),s.Build(o),s.SimplifyResult(!0,!0,.001);const u=ue(s.Shape());if(!yt(u))throw new Error("Could not fuse as a 3d shape");return u}cut(e,{optimisation:r="none"}={}){const n=ve(),o=n(new this.oc.Message_ProgressRange_1),s=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,o));r==="commonFace"&&s.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&s.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),s.Build(o),s.SimplifyResult(!0,!0,.001);const u=ue(s.Shape());if(!yt(u))throw new Error("Could not cut as a 3d shape");return u}intersect(e){const r=ve(),n=r(new this.oc.Message_ProgressRange_1),o=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));o.Build(n),o.SimplifyResult(!0,!0,.001);const s=ue(o.Shape());if(!yt(s))throw new Error("Could not intersect as a 3d shape");return s}shell(e,r=null,n=.001){const o=typeof r=="number"?r:n;let s,u;if(typeof e=="number"){u=e;const _=new mo;s=typeof r=="function"?r(_):_}else u=e.thickness,s=e.filter;const c=ve(),f=s.find(this),p=c(new this.oc.TopTools_ListOfShape_1);f.forEach(_=>{p.Append_1(_.wrapped)});const g=c(new this.oc.Message_ProgressRange_1),y=c(new this.oc.BRepOffsetAPI_MakeThickSolid);y.MakeThickSolidByJoin(this.wrapped,p,-u,o,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,g);const m=ue(y.Shape());if(!yt(m))throw new Error("Could not shell as a 3d shape");return m}_builderIter(e,r){if(typeof e=="number"){let u=0;for(const c of this._iterTopo("edge"))r(e,Xt(c)),u+=1;return u}let n,o=null;typeof e=="function"?n=e:(n=u=>e.filter.shouldKeep(u)?e.radius||1:0,e.filter&&!e.keep&&(o=()=>e.filter.delete()));let s=0;for(const u of this._iterTopo("edge")){const c=Xt(u),f=new Ot(c),p=n(f);p&&(r(p,c),s+=1),f.delete()}return o&&o(),s}fillet(e,r){const o=ve()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let s=e;if(typeof e=="number"&&r&&(s={radius:e,filter:r(new ln)}),!this._builderIter(s,(f,p)=>o.Add_2(f,p)))throw new Error("Could not fillet, no edge was selected");const c=ue(o.Shape());if(!yt(c))throw new Error("Could not fillet as a 3d shape");return c}chamfer(e,r){const o=ve()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let s=e;if(typeof e=="number"&&r&&(s={radius:e,filter:r(new ln)}),!this._builderIter(s,(f,p)=>o.Add_2(f,p)))throw new Error("Could not chamfer, no edge was selected");const c=ue(o.Shape());if(!yt(c))throw new Error("Could not chamfer as a 3d shape");return c}}class wo extends hn{}class Pr extends hn{}class Ws extends hn{}class Vs extends hn{}function yt(t){return t instanceof wo||t instanceof Pr||t instanceof Ws||t instanceof Vs}function zs(t){return t instanceof Dt}function Xt(t){const e=U(),r=e.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,e.TopoDS.Edge_1],[r.TopAbs_WIRE,e.TopoDS.Wire_1],[r.TopAbs_FACE,e.TopoDS.Face_1],[r.TopAbs_SHELL,e.TopoDS.Shell_1],[r.TopAbs_SOLID,e.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),o=Gs(t),s=n.get(o);if(!s)throw new Error("Could not find a wrapper for this shape type");return s(t)}function ue(t){const r=U().TopAbs_ShapeEnum,o=new Map([[r.TopAbs_VERTEX,Ns],[r.TopAbs_EDGE,Ot],[r.TopAbs_WIRE,Dt],[r.TopAbs_FACE,cr],[r.TopAbs_SHELL,wo],[r.TopAbs_SOLID,Pr],[r.TopAbs_COMPSOLID,Ws],[r.TopAbs_COMPOUND,Vs]]).get(Gs(t));if(!o)throw new Error("Could not find a wrapper for this shape type");return new o(Xt(t))}const qs=(t,e)=>{const r=U();return new Ot(new r.BRepBuilderAPI_MakeEdge_3(je(t),je(e)).Edge())},Yu=(t,e,r,n=[0,0,0],o=[0,0,1],s=!1)=>{const u=U(),[c,f]=be();let p=2*Math.PI;s&&(p=-2*Math.PI);const g=c(new u.Geom2d_Line_3(c(new u.gp_Pnt2d_3(0,0)),c(new u.gp_Dir2d_4(p,t)))),y=e/t,m=g.Value(0),_=g.Value(y*Math.sqrt((2*Math.PI)**2+t**2)),E=c(new u.GCE2d_MakeSegment_1(m,_)),x=new u.Geom_CylindricalSurface_1(c(_r(n,o)),r),k=c(new u.BRepBuilderAPI_MakeEdge_30(c(new u.Handle_Geom2d_Curve_2(E.Value().get())),c(new u.Handle_Geom_Surface_2(x)))).Edge(),C=c(new u.BRepBuilderAPI_MakeWire_2(k)).Wire();return u.BRepLib.BuildCurves3d_2(C),f(),new Ot(C)},pn=t=>{const e=U(),r=new e.BRepBuilderAPI_MakeWire_1;t.forEach(u=>{u instanceof Ot&&r.Add_1(u.wrapped),u instanceof Dt&&r.Add_2(u.wrapped)});const n=new e.Message_ProgressRange_1;r.Build(n);const o=r.Error();if(o!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const u=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${u.get(o)||"unknown error"}`)}const s=new Dt(r.Wire());return r.delete(),n.delete(),s},dn=(t,e)=>{const r=U(),n=new r.BRepBuilderAPI_MakeFace_15(t.wrapped,!1);if(e?.forEach(s=>{n.Add(s.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const o=n.Face();return n.delete(),new cr(o)},Xu=(t,e)=>{const r=U(),[n,o]=be(),s=n(r.BRep_Tool.Surface_2(t.wrapped)),c=n(new r.BRepBuilderAPI_MakeFace_21(s,e.wrapped,!0)).Face();return o(),new cr(c)},$u=(t,e,r=[0,0,0],n=[0,0,1])=>{const o=U(),s=rn(r,n),u=new o.BRepPrimAPI_MakeCylinder_3(s,t,e),c=new Pr(u.Shape());return s.delete(),u.delete(),c},Ys=t=>{const e=U(),r=je(t),n=new e.BRepBuilderAPI_MakeVertex(r),o=n.Vertex();return n.delete(),new Ns(o)},Cr=t=>{const e=U(),r=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return r.MakeCompound(n),t.forEach(s=>{r.Add(n,s.wrapped),s.delete()}),ue(n)};function Xs(t){const e=U(),[r,n]=be(),o=r(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));t.forEach(({wrapped:c})=>{o.Add(c)}),o.Perform(r(new e.Message_ProgressRange_1));const s=r(Xt(o.SewedShape())),u=ue(r(new e.ShapeFix_Solid_1).SolidFromShell(s));if(n(),!(u instanceof Pr))throw new Error("Could not make a solid of faces and shells");return u}const $s=(t,e)=>{const r=U(),[n,o]=be(),s=n(new r.BRepBuilderAPI_MakeFace_2(t.wrapped));e.forEach(p=>{s.Add(p.wrapped)});const u=n(s.Face()),c=n(new r.ShapeFix_Face_2(u));c.FixOrientation_1();const f=c.Face();return o(),new cr(f)},ju=t=>t==="symmetric"||typeof t=="number"||Array.isArray(t)&&t.length===2,Zu=t=>{let e;t?ju(t)?e={endTangent:t}:e={endTangent:0,...t}:e={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:o=1,startTangent:s}=e;let u;typeof r=="number"?u=lr(1,r*nt):u=r;let c;return typeof s=="number"?c=lr(1,s*nt):c=s,{endTangent:u,startFactor:n,endFactor:o,startTangent:c}};function js(t,e,r,n){const o=t*r+e*n,s=Math.sqrt((t*t+e*e)*(r*r+n*n));let u=Math.acos(o/s);return t*n-e*r<0&&(u=-u),u}function Ku([t,e],[r,n],o,s,u,c,f){const p=Math.PI*2;if(o<0&&(o=-o),s<0&&(s=-s),o==0||s==0)throw Error("rx and ry can not be 0");const g=Math.sin(u),y=Math.cos(u),m=(t-r)/2,_=(e-n)/2,E=(t+r)/2,x=(e+n)/2,k=y*m+g*_,C=y*_-g*m,R=k*k/(o*o)+C*C/(s*s);R>1&&(o=o*Math.sqrt(R),s=s*Math.sqrt(R));const O=o*s,$=o*C,z=s*k,ae=$*$+z*z;if(!ae)throw Error("start point can not be same as end point");let te=Math.sqrt(Math.abs((O*O-ae)/ae));c==f&&(te=-te);const ee=te*$/s,pe=-te*z/o,Me=y*ee-g*pe+E,Ge=g*ee+y*pe+x,ze=(k-ee)/o,Be=(k+ee)/o,ie=(C-pe)/s,Te=(C+pe)/s,Pe=js(1,0,ze,ie);let fe=js(ze,ie,-Be,-Te);for(;fe>p;)fe-=p;for(;fe<0;)fe+=p;f||(fe-=p);let me=Pe+fe;for(;me>p;)me-=p;for(;me<0;)me+=p;return{cx:Me,cy:Ge,startAngle:Pe,deltaAngle:fe,endAngle:me,clockwise:!!f,rx:o,ry:s}}const Zs=(t,e)=>{const r=U(),n=new r.BRepPrimAPI_MakePrism_1(t.wrapped,e.wrapped,!1,!0),o=new Pr(Xt(n.Shape()));return n.delete(),o},Ks=(t,e=[0,0,0],r=[0,0,1],n=360)=>{const o=U(),s=bs(e,r),u=new o.BRepPrimAPI_MakeRevol_1(t.wrapped,s,n*nt,!1),c=ue(u.Shape());if(s.delete(),u.delete(),!yt(c))throw new Error("Could not revolve to a 3d shape");return c};function Ar(t,e,{frenet:r=!1,auxiliarySpine:n,law:o=null,transitionMode:s="right",withContact:u,support:c,forceProfileSpineOthogonality:f}={},p=!1){const g=U(),y=s==="round"?!0:!!f,m=new g.BRepOffsetAPI_MakePipeShell(e.wrapped);if(s){const x={transformed:g.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:g.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:g.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[s];x&&m.SetTransitionMode(x)}c?m.SetMode_4(c):r&&m.SetMode_1(r),n&&m.SetMode_5(n.wrapped,!1,g.BRepFill_TypeOfContact.BRepFill_NoContact),o?m.SetLaw_1(t.wrapped,o,!!u,y):m.Add_1(t.wrapped,!!u,y);const _=new g.Message_ProgressRange_1;m.Build(_),p||m.MakeSolid();const E=ue(m.Shape());if(!yt(E))throw new Error("Could not sweep to a 3d shape");if(p){const x=ue(m.FirstShape()),k=ue(m.LastShape());if(!zs(x))throw new Error("Could not sweep with one start wire");if(!zs(k))throw new Error("Could not sweep with one end wire");return m.delete(),[E,x,k]}return m.delete(),_.delete(),E}const Qs=(t,{profile:e,endFactor:r=1})=>{let n;const o=U();if(e==="s-curve")n=new o.Law_S,n.Set_1(0,1,t,r);else if(e==="linear")n=new o.Law_Linear,n.Set(0,1,t,r);else throw new Error("Could not generate a law function");return n.Trim(0,t,1e-6)};function Js(t,e,r,n,o=!1){const s=new q(e),u=new q(r),c=qs(s,s.add(u)),f=pn([c]),p=n?Qs(u.Length,n):null;return o?Ar(t,f,{law:p},o):Ar(t,f,{law:p},o)}function ei(t,e,r,n,o,s=!1){const u=new q(r),c=new q(n),f=qs(u,u.add(c)),p=pn([f]),g=360/e*c.Length,y=1,m=Yu(g,c.Length,y,r,n),_=o?Qs(c.Length,o):null;return s?Ar(t,p,{auxiliarySpine:m,law:_},s):Ar(t,p,{auxiliarySpine:m,law:_},s)}const Qu=(t,{ruled:e=!0,startPoint:r,endPoint:n}={},o=!1)=>{const s=U(),[u,c]=be(),f=u(new s.BRepOffsetAPI_ThruSections(!o,e,1e-6));r&&f.AddVertex(u(Ys(r)).wrapped),t.forEach(y=>f.AddWire(y.wrapped)),n&&f.AddVertex(u(Ys(n)).wrapped);const p=u(new s.Message_ProgressRange_1);f.Build(p);const g=ue(f.Shape());if(c(),!yt(g))throw new Error("Could not loft to a 3d shape");return g};class Rr{constructor(e,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new Rr(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new q(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new q(e)}face(){let e;return this.baseFace?e=Xu(this.baseFace,this.wire):e=dn(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:r}={}){const n=dn(this.wire),o=Ks(n,r||this.defaultOrigin,e);return n.delete(),this.delete(),o}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:s}={}){const[u,c]=be(),f=u(new q(r||this.defaultDirection).normalized().multiply(e));if(n&&!o){const y=Js(this.wire,s||this.defaultOrigin,f,n);return c(),this.delete(),y}if(o){const y=ei(this.wire,o,s||this.defaultOrigin,f,n);return c(),this.delete(),y}const p=dn(this.wire),g=Zs(p,f);return c(),this.delete(),g}sweepSketch(e,r={}){const n=this.wire.startPoint,o=this.wire.tangentAt(1e-9).multiply(-1).normalize(),s=o.cross(this.defaultDirection).multiply(-1),u=e(new Je(n,s,o),n),c={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(c.support=this.baseFace.wrapped);const f=Ar(u.wire,this.wire,c);return this.delete(),f}loftWith(e,r={},n=!1){const o=Array.isArray(e)?[this,...e]:[this,e],s=Qu(o.map(u=>u.wire),r,n);return o.forEach(u=>u.delete()),s}}const Ju=t=>{const e=U(),r=new e.Bnd_Box2d;return t.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new Er(r)};function el(t,e){const[r,n]=be(),o=r(rn(e.origin,e.zDir,e.xDir)),s=U(),u=t.map(c=>{const f=s.GeomLib.To3d(o,c.wrapped);return new Ot(new s.BRepBuilderAPI_MakeEdge_24(f).Edge())});return n(),u}const tl=(t,e)=>{const[r,n]=be(),o=U(),s=t.map(u=>{const c=r(new o.BRepBuilderAPI_MakeEdge_30(u.wrapped,e));return new Ot(c.Edge())});return n(),s},ti=(t,e)=>{const r=U();return t.map(o=>e?new ge(r.GeomLib.GTransform(o.wrapped,e)):o.clone())};class Mr extends ft{transformCurves(e){return ti(e,this.wrapped)}}const ri=(t,e,r=[0,0])=>{const n=U(),o=ar(r,e),s=new n.gp_GTrsf2d_1;return s.SetAffinity(o,t),o.delete(),new Mr(s)},rl=t=>{const e=U(),[r,n]=be(),o=new e.gp_Trsf2d_1;o.SetTranslation_1(r(xs(t)));const s=new e.gp_GTrsf2d_2(o);return n(),new Mr(s)},nl=(t,e=[0,0],r="center")=>{const n=U(),[o,s]=be(),u=new n.gp_Trsf2d_1;r==="center"?u.SetMirror_1(o(Ue(t))):u.SetMirror_2(o(ar(e,t)));const c=new n.gp_GTrsf2d_2(u);return s(),new Mr(c)},ol=(t,e=[0,0])=>{const r=U(),[n,o]=be(),s=new r.gp_Trsf2d_1;s.SetRotation(n(Ue(e)),t);const u=new r.gp_GTrsf2d_2(s);return o(),new Mr(u)},sl=(t,e=[0,0])=>{const r=U(),[n,o]=be(),s=new r.gp_Trsf2d_1;s.SetScale(n(Ue(e)),t);const u=new r.gp_GTrsf2d_2(s);return o(),new Mr(u)};function il(t,e,r="original"){const[n,o]=be(),s=U();let u=n(s.BRep_Tool.Surface_2(e.wrapped));const c=e.UVBounds;let f=null;const p=n(ar([0,0],[0,1])),g=n(ar([0,0],[1,0]));if(r==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const _=n(u.get().Cylinder());_.Direct()||(u=u.get().UReversed());const E=_.Radius();f=ri(1/E,[0,1]).wrapped}if(r==="bounds"){if(f=n(new s.gp_GTrsf2d_1),f.SetAffinity(p,c.uMax-c.uMin),c.uMin!==0){const E=n(new s.gp_GTrsf2d_1);E.SetTranslationPart(new s.gp_XY_2(0,-c.uMin)),f.Multiply(E)}const _=n(new s.gp_GTrsf2d_1);if(_.SetAffinity(g,c.vMax-c.vMin),f.Multiply(_),c.vMin!==0){const E=n(new s.gp_GTrsf2d_1);E.SetTranslationPart(n(new s.gp_XY_2(0,-c.vMin))),f.Multiply(E)}}const y=ti(t,f),m=tl(y,u);return o(),m}function al(t,e){const r=U(),o=ve()(new r.BRepAdaptor_Curve2d_2(t.wrapped,e.wrapped)),s=new r.Geom2d_TrimmedCurve(o.Curve(),o.FirstParameter(),o.LastParameter(),!0,!0);return t.orientation==="backward"&&s.Reverse(),new ge(new r.Handle_Geom2d_Curve_2(s))}const vn=(t,e=1)=>{const r=t.bounds[0][0]-e,n=-t.bounds[1][1]-e;return`${r} ${n} ${t.width+2*e} ${t.height+2*e}`},bo=(t,e,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${vn(e,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${t}
</svg>`;class Q{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new Q(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=Ju(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=e.map((n,o)=>{const s=e[(o+1)%e.length];return(s[0]-n[0])*(s[1]+n[1])}).reduce((n,o)=>n+o,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,r,n=[0,0]){const o=ri(e,r,n).transformCurves(this.curves);return new Q(o)}scale(e,r){const n=r||this.boundingBox.center,o=sl(e,n).transformCurves(this.curves);return new Q(o)}rotate(e,r){const n=ol(e*nt,r).transformCurves(this.curves);return new Q(n)}translate(e,r=0){const n=nn(e)?e:[e,r],o=rl(n).transformCurves(this.curves);return new Q(o)}mirror(e,r=[0,0],n="center"){const o=nl(e,r,n).transformCurves(this.curves);return new Q(o)}sketchOnPlane(e,r){const n=e instanceof Je?sr(e):sr(e,r),o=el(this.curves,n),s=pn(o);return new Rr(s,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,r){const n=U(),o=il(this.curves,e,r),s=pn(o);n.BRepLib.BuildCurves3d_2(s.wrapped);const u=new n.ShapeFix_Wire_2(s.wrapped,e.wrapped,1e-9);u.FixEdgeCurves(),u.delete();const c=new Rr(s);if(s.isClosed){const f=c.clone().face();c.defaultOrigin=f.pointOnSurface(.5,.5),c.defaultDirection=f.normalAt(),f.orientation!==e.orientation&&(c.defaultDirection=c.defaultDirection.multiply(-1)),c.baseFace=e}else{const f=s.startPoint;c.defaultOrigin=f,c.defaultDirection=e.normalAt(f),c.baseFace=e}return c}toSVGPathD(){const e=ve(),r=this.clone().mirror([1,0],[0,0],"plane"),n=r.curves.flatMap(u=>{if((u.geomType==="ELLIPSE"||u.geomType==="CIRCLE")&&He(u.firstPoint,u.lastPoint)){const[c,f]=u.splitAt([.5]);return[kr(e(c.adaptor()),c.lastPoint),kr(e(f.adaptor()),f.lastPoint)]}return kr(e(u.adaptor()),u.lastPoint)}),[o,s]=r.curves[0].firstPoint;return`M ${ot(o)} ${ot(s)} ${n.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return vn(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return bo(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const r=U(),n=new r.Geom2dAPI_InterCurveCurve_1,o=xr(e,this.boundingBox.outsidePoint());let s=0;return this.curves.find(c=>c.isOnCurve(e))?!1:(this.curves.forEach(c=>{c.boundingBox.isOut(o.boundingBox)||(n.Init_1(o.wrapped,c.wrapped,1e-9),s+=n.NbPoints())}),n.delete(),!!(s%2))}isClosed(){return He(this.firstPoint,this.lastPoint)}intersects(e){const r=U(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const o of this.curves)for(const s of e.curves)if(!o.boundingBox.isOut(s.boundingBox)&&(n.Init_1(o.wrapped,s.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class ul{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,r]){return[e,r]}_convertFromUV([e,r]){return[e,r]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?fo:co;this.pendingCurves.push(...n(r,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const r=xr(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(r),this}line(e,r){return this.lineTo([this.pointer[0]+e,this.pointer[1]+r])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,r]){const n=r*nt,o=lr(e,n);return this.lineTo(o)}polarLine(e,r){const n=r*nt,[o,s]=lr(e,n);return this.line(o,s)}tangentLine(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=Mt(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,r){return this.saveCurve(uo(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,r,n,o){const[s,u]=this.pointer;return this.threePointsArcTo([s+e,u+r],[s+n,u+o])}sagittaArcTo(e,r){const[n,o]=this.pointer,[s,u]=e,c=[(n+s)/2,(o+u)/2],f=[-(u-o),s-n],p=Math.sqrt(f[0]**2+f[1]**2),g=[c[0]+f[0]/p*r,c[1]+f[1]/p*r];return this.saveCurve(uo(this._convertToUV(this.pointer),this._convertToUV(g),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,r,n){return this.sagittaArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=ht(this.pointer,e)/2,o=-r*n;return this.sagittaArcTo(e,o)}bulgeArc(e,r,n){return this.bulgeArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}tangentArcTo(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(Bu(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,r){const[n,o]=this.pointer;return this.tangentArcTo([e+n,r+o])}ellipseTo(e,r,n,o=0,s=!1,u=!1){let c=o,f=r,p=n;r<n&&(c=o+90,f=n,p=r);const g=c*nt,y=ee=>ht(this._convertToUV(ee)),m=y(lr(f,g)),_=y(lr(p,g+Math.PI/2)),E=Mt(this._convertToUV(Ru([1,0],g))),[,x]=Mu(E),{cx:k,cy:C,startAngle:R,endAngle:O,clockwise:$,rx:z,ry:ae}=Ku(this._convertToUV(this.pointer),this._convertToUV(e),m,_,x,s,u),te=Iu(z,ae,$?R:O,$?O:R,[k,C],E);return $||te.reverse(),this.saveCurve(te),this.pointer=e,this}ellipse(e,r,n,o,s=0,u=!1,c=!1){const[f,p]=this.pointer;return this.ellipseTo([e+f,r+p],n,o,s,u,c)}halfEllipseTo(e,r,n=!1){const o=Au(e,this.pointer),s=ht(e,this.pointer);return this.ellipseTo(e,s/2,r,o*br,!0,n)}halfEllipse(e,r,n,o=!1){const[s,u]=this.pointer;return this.halfEllipseTo([s+e,u+r],n,o)}bezierCurveTo(e,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(Fu(this._convertToUV(this.pointer),n.map(o=>this._convertToUV(o)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const{endTangent:n,startTangent:o,startFactor:s,endFactor:u}=Zu(r),c=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,f=ht(this.pointer,e)*.25;let p;o?p=o:c?p=this._convertFromUV(c.tangentAt(1)):p=[1,0],p=Mt(p);const g=[this.pointer[0]+p[0]*s*f,this.pointer[1]+p[1]*s*f];let y;n==="symmetric"?y=[-p[0],-p[1]]:y=n,y=Mt(y);const m=[e[0]-y[0]*u*f,e[1]-y[1]*u*f];return this.cubicBezierCurveTo(e,g,m)}smoothSpline(e,r,n){return this.smoothSplineTo([e+this.pointer[0],r+this.pointer[1]],n)}customCorner(e,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:e},this}_customCornerLastWithFirst(e,r="fillet"){if(!e)return;const n=this.pendingCurves.pop(),o=this.pendingCurves.shift();if(!n||!o)throw new Error("Not enough curves to close and fillet");const s=r==="chamfer"?fo:co;this.pendingCurves.push(...s(n,o,e))}_closeSketch(){He(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(He(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=ar(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(o=>new ge(o.innerCurve.Mirrored_2(r)));n.reverse(),n.map(o=>o.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}class ll extends ul{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Q(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}const cl=t=>{const e=U(),r=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);t.forEach((s,u)=>{s.edges.forEach(c=>{r.Add_1(c.wrapped,e.GeomAbs_Shape.GeomAbs_C0,u===0)})});const n=new e.Message_ProgressRange_1;r.Build(n),n.delete();const o=ue(r.Shape());if(r.delete(),!(o instanceof cr))throw new Error("Failed to create a face");return o},fl=(t,e)=>{const r=U(),n=new r.ShapeFix_Wire_2(t.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),t},ni=t=>{let e,r;try{e=dn(t[0]),r=t.slice(1)}catch{e=cl(t),r=t.slice(1).map(o=>fl(o,e))}return $s(e,r)},oi=(t,e)=>{const r=[],n=[],o=[];t.forEach(f=>{const[p,g,y]=e(f);r.push(p),n.push(g),o.push(y)});const s=ni(n),u=ni(o);return Xs([s,...r,u])};class si{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(r=>r.wire);return Cr(e)}face(){const e=this.outerSketch.face();return $s(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:s}={}){const u=new q(r||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!o?oi(this.sketches,p=>Js(p.wire,s||this.outerSketch.defaultOrigin,u,n,!0)):o?oi(this.sketches,p=>ei(p.wire,o,s||this.outerSketch.defaultOrigin,u,n,!0)):Zs(this.face(),u)}revolve(e,{origin:r}={}){return Ks(this.face(),r||this.outerSketch.defaultOrigin,e)}loftWith(e,r){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((s,u)=>{const c=e.sketches[u];return s.clone().loftWith(c.clone(),{ruled:r.ruled},!0)}),o=this.face().clone();return n.push(o,e.face()),Xs(n)}}class le{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new le(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Er;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,r,n){return new le(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new le(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new le(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new le(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new le(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){const n=this.blueprints.map(o=>o.sketchOnPlane(e,r));return new si(n)}sketchOnFace(e,r){const n=this.blueprints.map(o=>o.sketchOnFace(e,r));return new si(n)}toSVGViewBox(e=1){return vn(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return bo(this.toSVGGroup(),this.boundingBox,e)}}class ii{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(r=>r instanceof Rr?r.wire:r.wires);return Cr(e)}faces(){const e=this.sketches.map(r=>r.face());return Cr(e)}extrude(e,r={}){const n=this.sketches.map(o=>o.extrude(e,r));return Cr(n)}revolve(e,r){return Cr(this.sketches.map(n=>n.revolve(e,r)))}}class j{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new j(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Er;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,r,n){return new j(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new j(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new j(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new j(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new j(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){return new ii(this.blueprints.map(n=>n.sketchOnPlane(e,r)))}sketchOnFace(e,r){return new ii(this.blueprints.map(n=>n.sketchOnFace(e,r)))}toSVGViewBox(e=1){return vn(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const r=this.blueprints.map(n=>n instanceof Q?n.toSVGPath():n.toSVGGroup());return bo(r.join(`
    `),this.boundingBox,e)}}const hl=t=>{const e=t.map((o,s)=>t.slice(s+1).map((u,c)=>[c+s+1,u]).filter(([,u])=>!o.boundingBox.isOut(u.boundingBox)).map(([u])=>u)),r=[],n=Array(e.length);return e.forEach((o,s)=>{let u=n[s];u||(u=[],r.push(u)),u.push(t[s]),o.length&&o.forEach(c=>{n[c]=u})}),r},ai=t=>t.map((e,r)=>{const n=e.curves[0],o=n.value((n.lastParameter+n.firstParameter)/2),s=t.filter((u,c)=>r===c?!1:u.isInside(o));return{blueprint:e,isIn:s}}),pl=(t,e)=>t.flatMap(({blueprint:r})=>_o(e.filter(({blueprint:n,isIn:o})=>n===r||o.indexOf(r)!==-1))),dl=(t,e)=>{const r=e.filter(({isIn:o})=>o.length<=1),n=_o(ai(t.map(({blueprint:o})=>o)));return[r,...n]},_o=t=>{if(!t.length)return[];const e=t.filter(({isIn:n})=>!n.length),r=t.filter(({isIn:n})=>n.length>1);return e.length===1&&r.length===0?[t]:e.length>1?pl(e,t):dl(r,t)},Or=t=>{const e=hl(t).map(ai);return new j(e.flatMap(_o).map(r=>r.length===1?r[0].blueprint:(r.sort((n,o)=>n.isIn.length-o.isIn.length),new le(r.map(({blueprint:n})=>n)))))},vl=(t,e,r=0)=>{const{rx:n=0,ry:o=0}=typeof r=="number"?{ry:r,rx:r}:r;let s=Math.min(n,t/2),u=Math.min(o,e/2);const c=s&&u;c||(s=0,u=0);const f=s===u,p=new ll([Math.min(0,-(t/2-s)),-e/2]),g=(y,m)=>{c&&(f?p.tangentArc(y,m):p.ellipse(y,m,s,u,0,!1,!0))};return s<t/2&&p.hLine(t-2*s),g(s,u),u<e/2&&p.vLine(e-2*u),g(-s,u),s<t/2&&p.hLine(-(t-2*s)),g(-s,-u),u<e/2&&p.vLine(-(e-2*u)),g(s,-u),p.close()},gn=1e-9,We=(t,e)=>He(t,e,gn),Dr=t=>{const e=(t.lastParameter+t.firstParameter)/2;return t.value(e)},ui=(t,e)=>{const r=t.findIndex(s=>We(e,s.firstPoint)),n=t.slice(0,r);return t.slice(r).concat(n)},li=(t,e)=>{const r=u=>We(e.firstPoint,u.firstPoint)&&We(e.lastPoint,u.lastPoint);let n=t.findIndex(r);if(n===-1&&(t=Eo(t),n=t.findIndex(r),n===-1))throw console.error(t.map(u=>u.repr),e.repr),new Error("Failed to rotate to segment start");const o=t.slice(0,n);return t.slice(n).concat(o)};function*ci(t,e,r){const n=u=>!!e.find(c=>We(c,u.lastPoint)),o=u=>!!r.find(c=>We(c.firstPoint,u.firstPoint)&&We(c.lastPoint,u.lastPoint)||We(c.firstPoint,u.lastPoint)&&We(c.lastPoint,u.firstPoint));let s=[];for(const u of t)n(u)?(s.push(u),yield s,s=[]):o(u)?(s.length&&(yield s,s=[]),yield[u]):s.push(u);s.length&&(yield s)}const gl=t=>t[0].firstPoint,So=t=>t[t.length-1].lastPoint,Eo=t=>(t.reverse(),t.map(e=>{const r=e.clone();return r.reverse(),r})),ml=t=>(t.reverse(),t.map(Eo));function yl(t,e,r){return t.filter(n=>{const o=e.filter(c=>We(c.firstPoint,n)||We(c.lastPoint,n));if(o.length%2)throw console.error(o,n),new Error("Bug in the intersection algo on non crossing point");const s=o.map(c=>r.isInside(Dr(c)));return!(s.every(c=>c)||!s.some(c=>c))})}function wl(t,e){let r=[];const n=[],o=new Array(t.curves.length).fill(0).map(()=>[]),s=new Array(e.curves.length).fill(0).map(()=>[]);if(t.curves.forEach((m,_)=>{e.curves.forEach((E,x)=>{const{intersections:k,commonSegments:C,commonSegmentsPoints:R}=Tr(m,E,gn/100);r.push(...k),o[_].push(...k),s[x].push(...k),n.push(...C),r.push(...R),o[_].push(...R),s[x].push(...R)})}),r=Ts(r,gn),!r.length||r.length===1)return null;const u=([m,_])=>_.length?m.splitAt(_,gn/100):[m];let c=ir([t.curves,o]).flatMap(u),f=ir([e.curves,s]).flatMap(u);const p=n.map(m=>[m.firstPoint,m.lastPoint]);if(r=yl(r,c,e),!r.length&&!n.length)return null;if(n.length){const m=n[0];c=li(c,m),f=li(f,m)}else{const m=r[0];c=ui(c,m),f=ui(f,m)}const g=Array.from(ci(c,r,n));let y=Array.from(ci(f,r,n));return(!We(So(y[0]),So(g[0]))||n.length>0&&y[0].length!==1)&&(y=ml(y)),ir([g,y]).map(([m,_])=>{const E=gl(m),x=So(m);return p.find(([k,C])=>We(k,E)&&We(C,x)||We(k,x)&&We(k,E))?[m,"same"]:[m,_]})}const bl=t=>{const e=t.map(u=>u.firstPoint);let r=t.map(u=>u.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=ir([e,r]).map(([u,c],f)=>We(u,c)?null:f).filter(u=>u!==null);if(!n.length)return[t];const o=ir([n.slice(0,-1),n.slice(1)]).map(([u,c])=>t.slice(u,c));let s=t.slice(n[n.length-1]);return n[0]!==0&&(s=s.concat(t.slice(0,n[0]))),o.push(s),o};function To(t,e,{firstInside:r,secondInside:n}){const o=wl(t,e);if(!o){const p=Dr(t.curves[0]),g=e.isInside(p),y=Dr(e.curves[0]),m=t.isInside(y);return{identical:!1,firstCurveInSecond:g,secondCurveInFirst:m}}if(o.every(([,p])=>p==="same"))return{identical:!0};let s=null,u=null;const c=o.flatMap(([p,g])=>{let y=[],m=0;if(g==="same")return u===1?(u=1,[...p]):u===2||u===0?(u=null,[]):u===null?(s?s=[...s,...p]:s=p,[]):(console.error("weird situation"),[]);const _=Dr(p[0]),E=e.isInside(_);(r==="keep"&&E||r==="remove"&&!E)&&(m+=1,y.push(...p));const x=Dr(g[0]),k=t.isInside(x);if(n==="keep"&&k||n==="remove"&&!k){let C=g;m===1&&(C=Eo(g)),m+=1,y.push(...C)}return u===null&&m===1&&s&&(y=[...s,...y]),m===1&&(u=m,s=null),y}),f=bl(c).filter(p=>p.length).map(p=>new Q(p));return f.length===0?null:f.length===1?f[0]:Or(f)}const mn=(t,e)=>{const r=To(t,e,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof Q||r instanceof j?r:r.identical?t.clone():r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():new j([t,e])},Br=(t,e)=>{const r=To(t,e,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof Q||r instanceof j?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new j([new le([t,e])]):t.clone()},xo=(t,e)=>{const r=To(t,e,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof Q||r instanceof j?r:r.identical||r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():null},ko=(t,e)=>{if(t instanceof Q&&e instanceof Q){let r=[];return t.curves.forEach(n=>{e.curves.forEach(o=>{const{intersections:s,commonSegmentsPoints:u}=Tr(n,o);r.push(...s),r.push(...u)})}),r=Ts(r),r.length>1}if(t instanceof le||t instanceof j)return t.blueprints.some(r=>ko(r,e));if(e instanceof le||e instanceof j)return e.blueprints.some(r=>ko(t,r));throw new Error("Bug in the generic intersects algorithm")},_l=(t,e)=>{if(t instanceof le){if(e instanceof Q)return yn(e,t);if(e instanceof le)return wn(t,e)}if(e instanceof le){if(t instanceof Q)return yn(t,e);if(t instanceof le)return wn(t,e)}if(t instanceof Q&&e instanceof Q)return mn(t,e);throw new Error("Bug in the generic fuse algorithm")},fi=t=>{const e=new Map,r=[];return t.forEach((n,o)=>{let s;e.has(o)?s=e.get(o):(s={current:n,fusedWith:new Set([o])},r.push(s)),t.slice(o+1).forEach((u,c)=>{const f=s.current,p=o+c+1;if(s.fusedWith.has(p))return;let g=u,y=!1;if(e.has(p)&&(g=e.get(p).current,y=!0),f.boundingBox.isOut(g.boundingBox)||!ko(f,g))return;let m;if(f instanceof j||g instanceof j?m=bt(f,g):m=_l(f,g),!(m instanceof Q||m instanceof le)){if(m instanceof j&&m.blueprints.length===2)return;if(m instanceof j&&m.blueprints.length===1)m=m.blueprints[0];else if(!(m instanceof j))throw console.error(m),new Error("Bug in blueprint fusing algorigthm")}s.fusedWith.add(p),s.current=m,y||e.set(p,s)})}),Or(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>wt(n)))},wt=t=>t instanceof Q?[t]:t instanceof le?t.blueprints:t instanceof j?t.blueprints.flatMap(e=>wt(e)):[],yn=(t,e)=>{const r=mn(t,e.blueprints[0]),n=e.blueprints.slice(1).map(o=>Br(o,t));return Or([...wt(r),...n.flatMap(o=>wt(o))])};function Sl(t,e){const r=[];for(const n of t)for(const o of e)r.push([n,o]);return r}const wn=(t,e)=>{const r=mn(t.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(u=>Br(u,t.blueprints[0])),o=t.blueprints.slice(1).map(u=>Br(u,e.blueprints[0])),s=Sl(t.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([u,c])=>wt(xo(u,c)));return Or([...wt(r),...n.flatMap(u=>wt(u)),...o.flatMap(u=>wt(u)),...s])},bt=(t,e)=>{if(t===null)return e&&e.clone();if(e===null)return t&&t.clone();if(!(t instanceof j)&&e instanceof j)return fi([t,...e.blueprints]);if(!(e instanceof j)&&t instanceof j)return fi([e,...t.blueprints]);if(t instanceof j&&e instanceof j){let r=bt(t.blueprints[0],e);return t.blueprints.slice(1).forEach(n=>{r=bt(n,r)}),r}if(t instanceof le){if(e instanceof j)return bt(e,t);if(e instanceof Q)return yn(e,t);if(e instanceof le)return wn(t,e)}if(e instanceof le){if(t instanceof j)return bt(t,e);if(t instanceof Q)return yn(t,e);if(t instanceof le)return wn(t,e)}return t instanceof Q&&e instanceof Q?mn(t,e):null},bn=t=>{const e=t.flatMap(r=>r===null?[]:r instanceof j?r.blueprints:r);return e.length===1?e[0]:new j(e)},Bt=(t,e)=>{if(t===null)return null;if(e===null)return t.clone();if(t instanceof j)return bn(t.blueprints.map(n=>Bt(n,e)));if(t instanceof le){const n=t.blueprints[0];if(e instanceof Q&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const o=bt(e,new j(t.blueprints.slice(1)));return Or([n,...wt(o)])}else{let o=Bt(t.blueprints[0],e);return t.blueprints.slice(1).forEach(s=>{o=Bt(o,s)}),o}}if(e instanceof j)return bn(e.blueprints.map(n=>Bt(t,n)));if(e instanceof le){let n=Br(t,e.blueprints[0]);return e.blueprints.slice(1).forEach(o=>{n=bt(n,xo(o,t))}),n}return Br(t,e)};function Ir(t,e){if(t===null||e===null)return null;if(t instanceof Q&&e instanceof Q)return xo(t,e);if(t instanceof j)return bn(t.blueprints.map(r=>Ir(r,e)));if(t instanceof le){const r=t.blueprints[0],n=t.blueprints[1];return Bt(Ir(r,e),n)}if(e instanceof j)return bn(e.blueprints.map(r=>Ir(t,r)));if(e instanceof le){const r=e.blueprints[0],n=e.blueprints[1];return Bt(Ir(r,t),n)}throw new Error("intersct 2D algorithm error")}/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var r={},n=Object.defineProperty,o=n(r,r,r)&&n}catch{}return o}(),e=function(r){if(this==null)throw TypeError();var n=String(this),o=n.length,s=r?Number(r):0;if(s!=s&&(s=0),!(s<0||s>=o)){var u=n.charCodeAt(s),c;return u>=55296&&u<=56319&&o>s+1&&(c=n.charCodeAt(s+1),c>=56320&&c<=57343)?(u-55296)*1024+c-56320+65536:u}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function Po(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var El=new Po,Tl=new Po,hi=new Uint8Array(30),pi=new Uint16Array(30),xl=new Uint8Array(30),kl=new Uint16Array(30);new Po;function di(t,e,r,n){var o,s;for(o=0;o<r;++o)t[o]=0;for(o=0;o<30-r;++o)t[o+r]=o/r|0;for(s=n,o=0;o<30;++o)e[o]=s,s+=1<<t[o]}function Pl(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[24+144+r]=280+r;for(r=0;r<112;++r)t.trans[24+144+8+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}Pl(El,Tl),di(hi,pi,4,3),di(xl,kl,2,1),hi[28]=0,pi[28]=258;function fr(t,e,r,n,o){return Math.pow(1-o,3)*t+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*r+Math.pow(o,3)*n}function It(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}It.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},It.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},It.prototype.addX=function(t){this.addPoint(t,null)},It.prototype.addY=function(t){this.addPoint(null,t)},It.prototype.addBezier=function(t,e,r,n,o,s,u,c){var f=[t,e],p=[r,n],g=[o,s],y=[u,c];this.addPoint(t,e),this.addPoint(u,c);for(var m=0;m<=1;m++){var _=6*f[m]-12*p[m]+6*g[m],E=-3*f[m]+9*p[m]-9*g[m]+3*y[m],x=3*p[m]-3*f[m];if(E===0){if(_===0)continue;var k=-x/_;0<k&&k<1&&(m===0&&this.addX(fr(f[m],p[m],g[m],y[m],k)),m===1&&this.addY(fr(f[m],p[m],g[m],y[m],k)));continue}var C=Math.pow(_,2)-4*x*E;if(!(C<0)){var R=(-_+Math.sqrt(C))/(2*E);0<R&&R<1&&(m===0&&this.addX(fr(f[m],p[m],g[m],y[m],R)),m===1&&this.addY(fr(f[m],p[m],g[m],y[m],R)));var O=(-_-Math.sqrt(C))/(2*E);0<O&&O<1&&(m===0&&this.addX(fr(f[m],p[m],g[m],y[m],O)),m===1&&this.addY(fr(f[m],p[m],g[m],y[m],O)))}}},It.prototype.addQuad=function(t,e,r,n,o,s){var u=t+.6666666666666666*(r-t),c=e+2/3*(n-e),f=u+1/3*(o-t),p=c+1/3*(s-e);this.addBezier(t,e,u,c,f,p,o,s)};function Re(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Re.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})},Re.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})},Re.prototype.curveTo=Re.prototype.bezierCurveTo=function(t,e,r,n,o,s){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:o,y:s})},Re.prototype.quadTo=Re.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})},Re.prototype.close=Re.prototype.closePath=function(){this.commands.push({type:"Z"})},Re.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof It){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)},Re.prototype.getBoundingBox=function(){for(var t=new It,e=0,r=0,n=0,o=0,s=0;s<this.commands.length;s++){var u=this.commands[s];switch(u.type){case"M":t.addPoint(u.x,u.y),e=n=u.x,r=o=u.y;break;case"L":t.addPoint(u.x,u.y),n=u.x,o=u.y;break;case"Q":t.addQuad(n,o,u.x1,u.y1,u.x,u.y),n=u.x,o=u.y;break;case"C":t.addBezier(n,o,u.x1,u.y1,u.x2,u.y2,u.x,u.y),n=u.x,o=u.y;break;case"Z":n=e,o=r;break;default:throw new Error("Unexpected path command "+u.type)}}return t.isEmpty()&&t.addPoint(0,0),t},Re.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())},Re.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(u){return Math.round(u)===u?""+Math.round(u):u.toFixed(t)}function r(){for(var u=arguments,c="",f=0;f<arguments.length;f+=1){var p=u[f];p>=0&&f>0&&(c+=" "),c+=e(p)}return c}for(var n="",o=0;o<this.commands.length;o+=1){var s=this.commands[o];s.type==="M"?n+="M"+r(s.x,s.y):s.type==="L"?n+="L"+r(s.x,s.y):s.type==="C"?n+="C"+r(s.x1,s.y1,s.x2,s.y2,s.x,s.y):s.type==="Q"?n+="Q"+r(s.x1,s.y1,s.x,s.y):s.type==="Z"&&(n+="Z")}return n},Re.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e},Re.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function vi(t){throw new Error(t)}function gi(t,e){t||vi(e)}var X={fail:vi,argument:gi,assert:gi},mi=32768,yi=2147483648,hr={},G={},Y={};function st(t){return function(){return t}}G.BYTE=function(t){return X.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]},Y.BYTE=st(1),G.CHAR=function(t){return[t.charCodeAt(0)]},Y.CHAR=st(1),G.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e},Y.CHARARRAY=function(t){return typeof t>"u"?0:t.length},G.USHORT=function(t){return[t>>8&255,t&255]},Y.USHORT=st(2),G.SHORT=function(t){return t>=mi&&(t=-(2*mi-t)),[t>>8&255,t&255]},Y.SHORT=st(2),G.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]},Y.UINT24=st(3),G.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]},Y.ULONG=st(4),G.LONG=function(t){return t>=yi&&(t=-(2*yi-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]},Y.LONG=st(4),G.FIXED=G.ULONG,Y.FIXED=Y.ULONG,G.FWORD=G.SHORT,Y.FWORD=Y.SHORT,G.UFWORD=G.USHORT,Y.UFWORD=Y.USHORT,G.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]},Y.LONGDATETIME=st(8),G.TAG=function(t){return X.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]},Y.TAG=st(4),G.Card8=G.BYTE,Y.Card8=Y.BYTE,G.Card16=G.USHORT,Y.Card16=Y.USHORT,G.OffSize=G.BYTE,Y.OffSize=Y.BYTE,G.SID=G.USHORT,Y.SID=Y.USHORT,G.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?G.NUMBER16(t):G.NUMBER32(t)},Y.NUMBER=function(t){return G.NUMBER(t).length},G.NUMBER16=function(t){return[28,t>>8&255,t&255]},Y.NUMBER16=st(3),G.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]},Y.NUMBER32=st(5),G.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var o="",s=0,u=e.length;s<u;s+=1){var c=e[s];c==="e"?o+=e[++s]==="-"?"c":"b":c==="."?o+="a":c==="-"?o+="e":o+=c}o+=o.length&1?"f":"ff";for(var f=[30],p=0,g=o.length;p<g;p+=2)f.push(parseInt(o.substr(p,2),16));return f},Y.REAL=function(t){return G.REAL(t).length},G.NAME=G.CHARARRAY,Y.NAME=Y.CHARARRAY,G.STRING=G.CHARARRAY,Y.STRING=Y.CHARARRAY,hr.UTF8=function(t,e,r){for(var n=[],o=r,s=0;s<o;s++,e+=1)n[s]=t.getUint8(e);return String.fromCharCode.apply(null,n)},hr.UTF16=function(t,e,r){for(var n=[],o=r/2,s=0;s<o;s++,e+=2)n[s]=t.getUint16(e);return String.fromCharCode.apply(null,n)},G.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e},Y.UTF16=function(t){return t.length*2};var Co={"x-mac-croatian":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\u0160\u2122\xB4\xA8\u2260\u017D\xD8\u221E\xB1\u2264\u2265\u2206\xB5\u2202\u2211\u220F\u0161\u222B\xAA\xBA\u03A9\u017E\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u0106\xAB\u010C\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u0110\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\uF8FF\xA9\u2044\u20AC\u2039\u203A\xC6\xBB\u2013\xB7\u201A\u201E\u2030\xC2\u0107\xC1\u010D\xC8\xCD\xCE\xCF\xCC\xD3\xD4\u0111\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u03C0\xCB\u02DA\xB8\xCA\xE6\u02C7","x-mac-cyrillic":"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u2020\xB0\u0490\xA3\xA7\u2022\xB6\u0406\xAE\xA9\u2122\u0402\u0452\u2260\u0403\u0453\u221E\xB1\u2264\u2265\u0456\xB5\u0491\u0408\u0404\u0454\u0407\u0457\u0409\u0459\u040A\u045A\u0458\u0405\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\u040B\u045B\u040C\u045C\u0455\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u201E\u040E\u045E\u040F\u045F\u2116\u0401\u0451\u044F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E","x-mac-gaelic":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u1E02\xB1\u2264\u2265\u1E03\u010A\u010B\u1E0A\u1E0B\u1E1E\u1E1F\u0120\u0121\u1E40\xE6\xF8\u1E41\u1E56\u1E57\u027C\u0192\u017F\u1E60\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\u1E61\u1E9B\xFF\u0178\u1E6A\u20AC\u2039\u203A\u0176\u0177\u1E6B\xB7\u1EF2\u1EF3\u204A\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\u2663\xD2\xDA\xDB\xD9\u0131\xDD\xFD\u0174\u0175\u1E84\u1E85\u1E80\u1E81\u1E82\u1E83","x-mac-greek":"\xC4\xB9\xB2\xC9\xB3\xD6\xDC\u0385\xE0\xE2\xE4\u0384\xA8\xE7\xE9\xE8\xEA\xEB\xA3\u2122\xEE\xEF\u2022\xBD\u2030\xF4\xF6\xA6\u20AC\xF9\xFB\xFC\u2020\u0393\u0394\u0398\u039B\u039E\u03A0\xDF\xAE\xA9\u03A3\u03AA\xA7\u2260\xB0\xB7\u0391\xB1\u2264\u2265\xA5\u0392\u0395\u0396\u0397\u0399\u039A\u039C\u03A6\u03AB\u03A8\u03A9\u03AC\u039D\xAC\u039F\u03A1\u2248\u03A4\xAB\xBB\u2026\xA0\u03A5\u03A7\u0386\u0388\u0153\u2013\u2015\u201C\u201D\u2018\u2019\xF7\u0389\u038A\u038C\u038E\u03AD\u03AE\u03AF\u03CC\u038F\u03CD\u03B1\u03B2\u03C8\u03B4\u03B5\u03C6\u03B3\u03B7\u03B9\u03BE\u03BA\u03BB\u03BC\u03BD\u03BF\u03C0\u03CE\u03C1\u03C3\u03C4\u03B8\u03C9\u03C2\u03C7\u03C5\u03B6\u03CA\u03CB\u0390\u03B0\xAD","x-mac-icelandic":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\xDD\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\xD0\xF0\xDE\xFE\xFD\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-inuit":"\u1403\u1404\u1405\u1406\u140A\u140B\u1431\u1432\u1433\u1434\u1438\u1439\u1449\u144E\u144F\u1450\u1451\u1455\u1456\u1466\u146D\u146E\u146F\u1470\u1472\u1473\u1483\u148B\u148C\u148D\u148E\u1490\u1491\xB0\u14A1\u14A5\u14A6\u2022\xB6\u14A7\xAE\xA9\u2122\u14A8\u14AA\u14AB\u14BB\u14C2\u14C3\u14C4\u14C5\u14C7\u14C8\u14D0\u14EF\u14F0\u14F1\u14F2\u14F4\u14F5\u1505\u14D5\u14D6\u14D7\u14D8\u14DA\u14DB\u14EA\u1528\u1529\u152A\u152B\u152D\u2026\xA0\u152E\u153E\u1555\u1556\u1557\u2013\u2014\u201C\u201D\u2018\u2019\u1558\u1559\u155A\u155D\u1546\u1547\u1548\u1549\u154B\u154C\u1550\u157F\u1580\u1581\u1582\u1583\u1584\u1585\u158F\u1590\u1591\u1592\u1593\u1594\u1595\u1671\u1672\u1673\u1674\u1675\u1676\u1596\u15A0\u15A1\u15A2\u15A3\u15A4\u15A5\u15A6\u157C\u0141\u0142","x-mac-ce":"\xC4\u0100\u0101\xC9\u0104\xD6\xDC\xE1\u0105\u010C\xE4\u010D\u0106\u0107\xE9\u0179\u017A\u010E\xED\u010F\u0112\u0113\u0116\xF3\u0117\xF4\xF6\xF5\xFA\u011A\u011B\xFC\u2020\xB0\u0118\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\u0119\xA8\u2260\u0123\u012E\u012F\u012A\u2264\u2265\u012B\u0136\u2202\u2211\u0142\u013B\u013C\u013D\u013E\u0139\u013A\u0145\u0146\u0143\xAC\u221A\u0144\u0147\u2206\xAB\xBB\u2026\xA0\u0148\u0150\xD5\u0151\u014C\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\u014D\u0154\u0155\u0158\u2039\u203A\u0159\u0156\u0157\u0160\u201A\u201E\u0161\u015A\u015B\xC1\u0164\u0165\xCD\u017D\u017E\u016A\xD3\xD4\u016B\u016E\xDA\u016F\u0170\u0171\u0172\u0173\xDD\xFD\u0137\u017B\u0141\u017C\u0122\u02C7",macintosh:"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\u2039\u203A\uFB01\uFB02\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-romanian":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\u0102\u0218\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\u0103\u0219\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\u2039\u203A\u021A\u021B\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-turkish":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u011E\u011F\u0130\u0131\u015E\u015F\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\uF8A0\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7"};hr.MACSTRING=function(t,e,r,n){var o=Co[n];if(o!==void 0){for(var s="",u=0;u<r;u++){var c=t.getUint8(e+u);c<=127?s+=String.fromCharCode(c):s+=o[c&127]}return s}};var _n=typeof WeakMap=="function"&&new WeakMap,Sn,Cl=function(t){if(!Sn){Sn={};for(var e in Co)Sn[e]=new String(e)}var r=Sn[t];if(r!==void 0){if(_n){var n=_n.get(r);if(n!==void 0)return n}var o=Co[t];if(o!==void 0){for(var s={},u=0;u<o.length;u++)s[o.charCodeAt(u)]=u+128;return _n&&_n.set(r,s),s}}};G.MACSTRING=function(t,e){var r=Cl(e);if(r!==void 0){for(var n=[],o=0;o<t.length;o++){var s=t.charCodeAt(o);if(s>=128&&(s=r[s],s===void 0))return;n[o]=s}return n}},Y.MACSTRING=function(t,e){var r=G.MACSTRING(t,e);return r!==void 0?r.length:0};function Ao(t){return t>=-128&&t<=127}function Al(t,e,r){for(var n=0,o=t.length;e<o&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function Rl(t,e,r){for(var n=0,o=t.length,s=e;s<o&&n<64;){var u=t[s];if(!Ao(u)||u===0&&s+1<o&&t[s+1]===0)break;++s,++n}r.push(n-1);for(var c=e;c<s;++c)r.push(t[c]+256&255);return s}function Ml(t,e,r){for(var n=0,o=t.length,s=e;s<o&&n<64;){var u=t[s];if(u===0||Ao(u)&&s+1<o&&Ao(t[s+1]))break;++s,++n}r.push(64|n-1);for(var c=e;c<s;++c){var f=t[c];r.push(f+65536>>8&255,f+256&255)}return s}G.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=Al(t,e,r):n>=-128&&n<=127?e=Rl(t,e,r):e=Ml(t,e,r)}return r},G.INDEX=function(t){for(var e=1,r=[e],n=[],o=0;o<t.length;o+=1){var s=G.OBJECT(t[o]);Array.prototype.push.apply(n,s),e+=s.length,r.push(e)}if(n.length===0)return[0,0];for(var u=[],c=1+Math.floor(Math.log(e)/Math.log(2))/8|0,f=[void 0,G.BYTE,G.USHORT,G.UINT24,G.ULONG][c],p=0;p<r.length;p+=1){var g=f(r[p]);Array.prototype.push.apply(u,g)}return Array.prototype.concat(G.Card16(t.length),G.OffSize(c),u,n)},Y.INDEX=function(t){return G.INDEX(t).length},G.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,o=0;o<n;o+=1){var s=parseInt(r[o],0),u=t[s];e=e.concat(G.OPERAND(u.value,u.type)),e=e.concat(G.OPERATOR(s))}return e},Y.DICT=function(t){return G.DICT(t).length},G.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]},G.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)X.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(G.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(G.NUMBER(t));else if(e==="offset")r=r.concat(G.NUMBER32(t));else if(e==="number")r=r.concat(G.NUMBER(t));else if(e==="real")r=r.concat(G.REAL(t));else throw new Error("Unknown operand type "+e);return r},G.OP=G.BYTE,Y.OP=Y.BYTE;var En=typeof WeakMap=="function"&&new WeakMap;G.CHARSTRING=function(t){if(En){var e=En.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,o=0;o<n;o+=1){var s=t[o];r=r.concat(G[s.type](s.value))}return En&&En.set(t,r),r},Y.CHARSTRING=function(t){return G.CHARSTRING(t).length},G.OBJECT=function(t){var e=G[t.type];return X.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)},Y.OBJECT=function(t){var e=Y[t.type];return X.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)},G.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],o=[],s=0;s<r;s+=1){var u=t.fields[s],c=G[u.type];X.argument(c!==void 0,"No encoding function for field type "+u.type+" ("+u.name+")");var f=t[u.name];f===void 0&&(f=u.value);var p=c(f);u.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),n.push(p)):e=e.concat(p)}for(var g=0;g<n.length;g+=1){var y=o[g],m=e.length;X.argument(m<65536,"Table "+t.tableName+" too big."),e[y]=m>>8,e[y+1]=m&255,e=e.concat(n[g])}return e},Y.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var o=t.fields[n],s=Y[o.type];X.argument(s!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var u=t[o.name];u===void 0&&(u=o.value),e+=s(u),o.type==="TABLE"&&(e+=2)}return e},G.RECORD=G.TABLE,Y.RECORD=Y.TABLE,G.LITERAL=function(t){return t},Y.LITERAL=function(t){return t.length};function De(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var o=e[n];this[o.name]=o.value}if(this.tableName=t,this.fields=e,r)for(var s=Object.keys(r),u=0;u<s.length;u+=1){var c=s[u],f=r[c];this[c]!==void 0&&(this[c]=f)}}De.prototype.encode=function(){return G.TABLE(this)},De.prototype.sizeOf=function(){return Y.TABLE(this)};function Fr(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var o=0;o<e.length;o++)n[o+1]={name:t+o,type:"USHORT",value:e[o]};return n}function Ro(t,e,r){var n=e.length,o=new Array(n+1);o[0]={name:t+"Count",type:"USHORT",value:n};for(var s=0;s<n;s++)o[s+1]={name:t+s,type:"TABLE",value:r(e[s],s)};return o}function Ur(t,e,r){var n=e.length,o=[];o[0]={name:t+"Count",type:"USHORT",value:n};for(var s=0;s<n;s++)o=o.concat(r(e[s],s));return o}function Tn(t){t.format===1?De.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Fr("glyph",t.glyphs))):t.format===2?De.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(Ur("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):X.assert(!1,"Coverage format must be 1 or 2.")}Tn.prototype=Object.create(De.prototype),Tn.prototype.constructor=Tn;function xn(t){De.call(this,"scriptListTable",Ur("scriptRecord",t,function(e,r){var n=e.script,o=n.defaultLangSys;return X.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new De("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new De("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(Fr("featureIndex",o.featureIndexes)))}].concat(Ur("langSys",n.langSysRecords,function(s,u){var c=s.langSys;return[{name:"langSysTag"+u,type:"TAG",value:s.tag},{name:"langSys"+u,type:"TABLE",value:new De("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:c.reqFeatureIndex}].concat(Fr("featureIndex",c.featureIndexes)))}]})))}]}))}xn.prototype=Object.create(De.prototype),xn.prototype.constructor=xn;function kn(t){De.call(this,"featureListTable",Ur("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new De("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(Fr("lookupListIndex",n.lookupListIndexes)))}]}))}kn.prototype=Object.create(De.prototype),kn.prototype.constructor=kn;function Pn(t,e){De.call(this,"lookupListTable",Ro("lookup",t,function(r){var n=e[r.lookupType];return X.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new De("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(Ro("subtable",r.subtables,n)))}))}Pn.prototype=Object.create(De.prototype),Pn.prototype.constructor=Pn;var H={Table:De,Record:De,Coverage:Tn,ScriptList:xn,FeatureList:kn,LookupList:Pn,ushortList:Fr,tableList:Ro,recordList:Ur};function wi(t,e){return t.getUint8(e)}function Cn(t,e){return t.getUint16(e,!1)}function Ol(t,e){return t.getInt16(e,!1)}function Mo(t,e){return t.getUint32(e,!1)}function bi(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function Dl(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function Bl(t,e,r){for(var n=0,o=0;o<r;o+=1)n<<=8,n+=t.getUint8(e+o);return n}function Il(t,e,r){for(var n=[],o=e;o<r;o+=1)n.push(t.getUint8(o));return n}function Fl(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var Ul={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function P(t,e){this.data=t,this.offset=e,this.relativeOffset=0}P.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},P.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},P.prototype.parseCard8=P.prototype.parseByte,P.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},P.prototype.parseCard16=P.prototype.parseUShort,P.prototype.parseSID=P.prototype.parseUShort,P.prototype.parseOffset16=P.prototype.parseUShort,P.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},P.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t},P.prototype.parseULong=function(){var t=Mo(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},P.prototype.parseOffset32=P.prototype.parseULong,P.prototype.parseFixed=function(){var t=bi(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},P.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var o=0;o<t;o++)n+=String.fromCharCode(e.getUint8(r+o));return n},P.prototype.parseTag=function(){return this.parseString(4)},P.prototype.parseLongDateTime=function(){var t=Mo(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t},P.prototype.parseVersion=function(t){var e=Cn(this.data,this.offset+this.relativeOffset),r=Cn(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10},P.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=Ul[t]*e},P.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e},P.prototype.parseOffset16List=P.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e},P.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e},P.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint8(n++);return this.relativeOffset+=t,e},P.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},P.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},P.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var s={},u=0;u<n.length;u++){var c=n[u],f=e[c];s[c]=f.call(this)}r[o]=s}return r},P.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var s={},u=0;u<n.length;u++){var c=n[u],f=e[c];s[c]=f.call(this)}r[o]=s}return r},P.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var o=e[n],s=t[o];r[o]=s.call(this)}return r},P.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}},P.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r},P.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new P(this.data,this.offset+e).parseStruct(t)},P.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new P(this.data,this.offset+e).parseStruct(t)},P.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,o=new Array(r),s=0;s<r;s++){var u=e[s];if(u===0){o[s]=void 0;continue}if(this.relativeOffset=u,t){for(var c=this.parseOffset16List(),f=new Array(c.length),p=0;p<c.length;p++)this.relativeOffset=u+c[p],f[p]=t.call(this);o[s]=f}else o[s]=this.parseUShortList()}return this.relativeOffset=n,o},P.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),o=0;o<r;o++)n[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")},P.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:P.uShort,end:P.uShort,classId:P.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")},P.list=function(t,e){return function(){return this.parseList(t,e)}},P.list32=function(t,e){return function(){return this.parseList32(t,e)}},P.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}},P.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}},P.pointer=function(t){return function(){return this.parsePointer(t)}},P.pointer32=function(t){return function(){return this.parsePointer32(t)}},P.tag=P.prototype.parseTag,P.byte=P.prototype.parseByte,P.uShort=P.offset16=P.prototype.parseUShort,P.uShortList=P.prototype.parseUShortList,P.uLong=P.offset32=P.prototype.parseULong,P.uLongList=P.prototype.parseULongList,P.struct=P.prototype.parseStruct,P.coverage=P.prototype.parseCoverage,P.classDef=P.prototype.parseClassDef;var _i={reserved:P.uShort,reqFeatureIndex:P.uShort,featureIndexes:P.uShortList};P.prototype.parseScriptList=function(){return this.parsePointer(P.recordList({tag:P.tag,script:P.pointer({defaultLangSys:P.pointer(_i),langSysRecords:P.recordList({tag:P.tag,langSys:P.pointer(_i)})})}))||[]},P.prototype.parseFeatureList=function(){return this.parsePointer(P.recordList({tag:P.tag,feature:P.pointer({featureParams:P.offset16,lookupListIndexes:P.uShortList})}))||[]},P.prototype.parseLookupList=function(t){return this.parsePointer(P.list(P.pointer(function(){var e=this.parseUShort();X.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(P.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]},P.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();X.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:P.offset32,featureTableSubstitutionOffset:P.offset32});return r})||[]};var Z={getByte:wi,getCard8:wi,getUShort:Cn,getCard16:Cn,getShort:Ol,getULong:Mo,getFixed:bi,getTag:Dl,getOffset:Bl,getBytes:Il,bytesToString:Fl,Parser:P};function Ll(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var o=e.parseULong(),s=e.parseULong(),u=e.parseULong(),c=o;c<=s;c+=1)t.glyphIndexMap[c]=u,u++}function Gl(t,e,r,n,o){t.length=e.parseUShort(),t.language=e.parseUShort();var s;t.segCount=s=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var u=new Z.Parser(r,n+o+14),c=new Z.Parser(r,n+o+16+s*2),f=new Z.Parser(r,n+o+16+s*4),p=new Z.Parser(r,n+o+16+s*6),g=n+o+16+s*8,y=0;y<s-1;y+=1)for(var m=void 0,_=u.parseUShort(),E=c.parseUShort(),x=f.parseShort(),k=p.parseUShort(),C=E;C<=_;C+=1)k!==0?(g=p.offset+p.relativeOffset-2,g+=k,g+=(C-E)*2,m=Z.getUShort(r,g),m!==0&&(m=m+x&65535)):m=C+x&65535,t.glyphIndexMap[C]=m}function Nl(t,e){var r={};r.version=Z.getUShort(t,e),X.argument(r.version===0,"cmap table version should be 0."),r.numTables=Z.getUShort(t,e+2);for(var n=-1,o=r.numTables-1;o>=0;o-=1){var s=Z.getUShort(t,e+4+o*8),u=Z.getUShort(t,e+4+o*8+2);if(s===3&&(u===0||u===1||u===10)||s===0&&(u===0||u===1||u===2||u===3||u===4)){n=Z.getULong(t,e+4+o*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var c=new Z.Parser(t,e+n);if(r.format=c.parseUShort(),r.format===12)Ll(r,c);else if(r.format===4)Gl(r,c,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function Hl(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function Wl(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function Vl(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:12+8}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var s=new H.Table("cmap",o);for(s.segments=[],r=0;r<t.length;r+=1){for(var u=t.get(r),c=0;c<u.unicodes.length;c+=1)Hl(s,u.unicodes[c],r);s.segments=s.segments.sort(function(R,O){return R.start-O.start})}Wl(s);var f=s.segments.length,p=0,g=[],y=[],m=[],_=[],E=[],x=[];for(r=0;r<f;r+=1){var k=s.segments[r];k.end<=65535&&k.start<=65535?(g=g.concat({name:"end_"+r,type:"USHORT",value:k.end}),y=y.concat({name:"start_"+r,type:"USHORT",value:k.start}),m=m.concat({name:"idDelta_"+r,type:"SHORT",value:k.delta}),_=_.concat({name:"idRangeOffset_"+r,type:"USHORT",value:k.offset}),k.glyphId!==void 0&&(E=E.concat({name:"glyph_"+r,type:"USHORT",value:k.glyphId}))):p+=1,!e&&k.glyphIndex!==void 0&&(x=x.concat({name:"cmap12Start_"+r,type:"ULONG",value:k.start}),x=x.concat({name:"cmap12End_"+r,type:"ULONG",value:k.end}),x=x.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:k.glyphIndex}))}if(s.segCountX2=(f-p)*2,s.searchRange=Math.pow(2,Math.floor(Math.log(f-p)/Math.log(2)))*2,s.entrySelector=Math.log(s.searchRange/2)/Math.log(2),s.rangeShift=s.segCountX2-s.searchRange,s.fields=s.fields.concat(g),s.fields.push({name:"reservedPad",type:"USHORT",value:0}),s.fields=s.fields.concat(y),s.fields=s.fields.concat(m),s.fields=s.fields.concat(_),s.fields=s.fields.concat(E),s.cmap4Length=14+g.length*2+2+y.length*2+m.length*2+_.length*2+E.length*2,!e){var C=16+x.length*4;s.cmap12Offset=12+2*2+4+s.cmap4Length,s.fields=s.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:C},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:x.length/3}]),s.fields=s.fields.concat(x)}return s}var zl={parse:Nl,make:Vl},An=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],ql=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Yl=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Si=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function Ei(t){this.font=t}Ei.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var o=r.get(n),s=0;s<o.unicodes.length;s+=1)if(o.unicodes[s]===e)return n}return null};function Rn(t,e){this.encoding=t,this.charset=e}Rn.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function Xl(t,e,r,n,o){t.beginPath(),t.moveTo(e,r),t.lineTo(n,o),t.stroke()}var $t={line:Xl};function $l(t,e){var r=e||new Re;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function rt(t){this.bindConstructorValues(t)}rt.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",$l(this,t.path))},rt.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)},rt.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},rt.prototype.getPath=function(t,e,r,n,o){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var s,u;n||(n={});var c=n.xScale,f=n.yScale;if(n.hinting&&o&&o.hinting&&(u=this.path&&o.hinting.exec(this,r)),u)s=o.hinting.getCommands(u),t=Math.round(t),e=Math.round(e),c=f=1;else{s=this.path.commands;var p=1/(this.path.unitsPerEm||1e3)*r;c===void 0&&(c=p),f===void 0&&(f=p)}for(var g=new Re,y=0;y<s.length;y+=1){var m=s[y];m.type==="M"?g.moveTo(t+m.x*c,e+-m.y*f):m.type==="L"?g.lineTo(t+m.x*c,e+-m.y*f):m.type==="Q"?g.quadraticCurveTo(t+m.x1*c,e+-m.y1*f,t+m.x*c,e+-m.y*f):m.type==="C"?g.curveTo(t+m.x1*c,e+-m.y1*f,t+m.x2*c,e+-m.y2*f,t+m.x*c,e+-m.y*f):m.type==="Z"&&g.closePath()}return g},rt.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return X.argument(e.length===0,"There are still points left in the current contour."),t},rt.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];o.type!=="Z"&&(e.push(o.x),r.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),r.push(o.y1)),o.type==="C"&&(e.push(o.x2),r.push(o.y2))}var s={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(s.xMin)||(s.xMin=0),isFinite(s.xMax)||(s.xMax=this.advanceWidth),isFinite(s.yMin)||(s.yMin=0),isFinite(s.yMax)||(s.yMax=0),s.rightSideBearing=this.advanceWidth-s.leftSideBearing-(s.xMax-s.xMin),s},rt.prototype.draw=function(t,e,r,n,o){this.getPath(e,r,n,o).draw(t)},rt.prototype.drawPoints=function(t,e,r,n){function o(y,m,_,E){t.beginPath();for(var x=0;x<y.length;x+=1)t.moveTo(m+y[x].x*E,_+y[x].y*E),t.arc(m+y[x].x*E,_+y[x].y*E,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var s=1/this.path.unitsPerEm*n,u=[],c=[],f=this.path,p=0;p<f.commands.length;p+=1){var g=f.commands[p];g.x!==void 0&&u.push({x:g.x,y:-g.y}),g.x1!==void 0&&c.push({x:g.x1,y:-g.y1}),g.x2!==void 0&&c.push({x:g.x2,y:-g.y2})}t.fillStyle="blue",o(u,e,r,s),t.fillStyle="red",o(c,e,r,s)},rt.prototype.drawMetrics=function(t,e,r,n){var o;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,o=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",$t.line(t,e,-1e4,e,1e4),$t.line(t,-1e4,r,1e4,r);var s=this.xMin||0,u=this.yMin||0,c=this.xMax||0,f=this.yMax||0,p=this.advanceWidth||0;t.strokeStyle="blue",$t.line(t,e+s*o,-1e4,e+s*o,1e4),$t.line(t,e+c*o,-1e4,e+c*o,1e4),$t.line(t,-1e4,r+-u*o,1e4,r+-u*o),$t.line(t,-1e4,r+-f*o,1e4,r+-f*o),t.strokeStyle="green",$t.line(t,e+p*o,-1e4,e+p*o,1e4)};function Mn(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function Oo(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}Oo.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]},Oo.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function jl(t,e){return new rt({index:e,font:t})}function Zl(t,e,r,n,o,s){return function(){var u=new rt({index:e,font:t});return u.path=function(){r(u,n,o);var c=s(t.glyphs,u);return c.unitsPerEm=t.unitsPerEm,c},Mn(u,"xMin","_xMin"),Mn(u,"xMax","_xMax"),Mn(u,"yMin","_yMin"),Mn(u,"yMax","_yMax"),u}}function Kl(t,e,r,n){return function(){var o=new rt({index:e,font:t});return o.path=function(){var s=r(t,o,n);return s.unitsPerEm=t.unitsPerEm,s},o}}var pt={GlyphSet:Oo,glyphLoader:jl,ttfGlyphLoader:Zl,cffGlyphLoader:Kl};function Ti(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!Ti(t[r],e[r]))return!1;return!0}else return!1}function Do(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function Ft(t,e,r){var n=[],o=[],s=Z.getCard16(t,e),u,c;if(s!==0){var f=Z.getByte(t,e+2);u=e+(s+1)*f+2;for(var p=e+3,g=0;g<s+1;g+=1)n.push(Z.getOffset(t,p,f)),p+=f;c=u+n[s]}else c=e+2;for(var y=0;y<n.length-1;y+=1){var m=Z.getBytes(t,u+n[y],u+n[y+1]);r&&(m=r(m)),o.push(m)}return{objects:o,startOffset:e,endOffset:c}}function Ql(t,e){var r=[],n=Z.getCard16(t,e),o,s;if(n!==0){var u=Z.getByte(t,e+2);o=e+(n+1)*u+2;for(var c=e+3,f=0;f<n+1;f+=1)r.push(Z.getOffset(t,c,u)),c+=u;s=o+r[n]}else s=e+2;return{offsets:r,startOffset:e,endOffset:s}}function Jl(t,e,r,n,o){var s=Z.getCard16(r,n),u=0;if(s!==0){var c=Z.getByte(r,n+2);u=n+(s+1)*c+2}var f=Z.getBytes(r,u+e[t],u+e[t+1]);return o&&(f=o(f)),f}function ec(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=t.parseByte(),s=o>>4,u=o&15;if(s===r||(e+=n[s],u===r))break;e+=n[u]}return parseFloat(e)}function tc(t,e){var r,n,o,s;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),o=t.parseByte(),s=t.parseByte(),r<<24|n<<16|o<<8|s;if(e===30)return ec(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function rc(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],o=t[r][1],s=void 0;if(o.length===1?s=o[0]:s=o,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=s}return e}function xi(t,e,r){e=e!==void 0?e:0;var n=new Z.Parser(t,e),o=[],s=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var u=n.parseByte();u<=21?(u===12&&(u=1200+n.parseByte()),o.push([u,s]),s=[]):s.push(tc(n,u))}return rc(o)}function Lr(t,e){return e<=390?e=An[e]:e=t[e-391],e}function ki(t,e,r){for(var n={},o,s=0;s<e.length;s+=1){var u=e[s];if(Array.isArray(u.type)){var c=[];c.length=u.type.length;for(var f=0;f<u.type.length;f++)o=t[u.op]!==void 0?t[u.op][f]:void 0,o===void 0&&(o=u.value!==void 0&&u.value[f]!==void 0?u.value[f]:null),u.type[f]==="SID"&&(o=Lr(r,o)),c[f]=o;n[u.name]=c}else o=t[u.op],o===void 0&&(o=u.value!==void 0?u.value:null),u.type==="SID"&&(o=Lr(r,o)),n[u.name]=o}return n}function nc(t,e){var r={};return r.formatMajor=Z.getCard8(t,e),r.formatMinor=Z.getCard8(t,e+1),r.size=Z.getCard8(t,e+2),r.offsetSize=Z.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var Pi=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Ci=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function oc(t,e){var r=xi(t,0,t.byteLength);return ki(r,Pi,e)}function Ai(t,e,r,n){var o=xi(t,e,r);return ki(o,Ci,n)}function Ri(t,e,r,n){for(var o=[],s=0;s<r.length;s+=1){var u=new DataView(new Uint8Array(r[s]).buffer),c=oc(u,n);c._subrs=[],c._subrsBias=0,c._defaultWidthX=0,c._nominalWidthX=0;var f=c.private[0],p=c.private[1];if(f!==0&&p!==0){var g=Ai(t,p+e,f,n);if(c._defaultWidthX=g.defaultWidthX,c._nominalWidthX=g.nominalWidthX,g.subrs!==0){var y=p+g.subrs,m=Ft(t,y+e);c._subrs=m.objects,c._subrsBias=Do(c._subrs)}c._privateDict=g}o.push(c)}return o}function sc(t,e,r,n){var o,s,u=new Z.Parser(t,e);r-=1;var c=[".notdef"],f=u.parseCard8();if(f===0)for(var p=0;p<r;p+=1)o=u.parseSID(),c.push(Lr(n,o));else if(f===1)for(;c.length<=r;){o=u.parseSID(),s=u.parseCard8();for(var g=0;g<=s;g+=1)c.push(Lr(n,o)),o+=1}else if(f===2)for(;c.length<=r;){o=u.parseSID(),s=u.parseCard16();for(var y=0;y<=s;y+=1)c.push(Lr(n,o)),o+=1}else throw new Error("Unknown charset format "+f);return c}function ic(t,e,r){var n,o={},s=new Z.Parser(t,e),u=s.parseCard8();if(u===0)for(var c=s.parseCard8(),f=0;f<c;f+=1)n=s.parseCard8(),o[n]=f;else if(u===1){var p=s.parseCard8();n=1;for(var g=0;g<p;g+=1)for(var y=s.parseCard8(),m=s.parseCard8(),_=y;_<=y+m;_+=1)o[_]=n,n+=1}else throw new Error("Unknown encoding format "+u);return new Rn(o,r)}function Mi(t,e,r){var n,o,s,u,c=new Re,f=[],p=0,g=!1,y=!1,m=0,_=0,E,x,k,C;if(t.isCIDFont){var R=t.tables.cff.topDict._fdSelect[e.index],O=t.tables.cff.topDict._fdArray[R];E=O._subrs,x=O._subrsBias,k=O._defaultWidthX,C=O._nominalWidthX}else E=t.tables.cff.topDict._subrs,x=t.tables.cff.topDict._subrsBias,k=t.tables.cff.topDict._defaultWidthX,C=t.tables.cff.topDict._nominalWidthX;var $=k;function z(ee,pe){y&&c.closePath(),c.moveTo(ee,pe),y=!0}function ae(){var ee;ee=f.length%2!==0,ee&&!g&&($=f.shift()+C),p+=f.length>>1,f.length=0,g=!0}function te(ee){for(var pe,Me,Ge,ze,Be,ie,Te,Pe,fe,me,Ie,Xe,ye=0;ye<ee.length;){var Oe=ee[ye];switch(ye+=1,Oe){case 1:ae();break;case 3:ae();break;case 4:f.length>1&&!g&&($=f.shift()+C,g=!0),_+=f.pop(),z(m,_);break;case 5:for(;f.length>0;)m+=f.shift(),_+=f.shift(),c.lineTo(m,_);break;case 6:for(;f.length>0&&(m+=f.shift(),c.lineTo(m,_),f.length!==0);)_+=f.shift(),c.lineTo(m,_);break;case 7:for(;f.length>0&&(_+=f.shift(),c.lineTo(m,_),f.length!==0);)m+=f.shift(),c.lineTo(m,_);break;case 8:for(;f.length>0;)n=m+f.shift(),o=_+f.shift(),s=n+f.shift(),u=o+f.shift(),m=s+f.shift(),_=u+f.shift(),c.curveTo(n,o,s,u,m,_);break;case 10:Be=f.pop()+x,ie=E[Be],ie&&te(ie);break;case 11:return;case 12:switch(Oe=ee[ye],ye+=1,Oe){case 35:n=m+f.shift(),o=_+f.shift(),s=n+f.shift(),u=o+f.shift(),Te=s+f.shift(),Pe=u+f.shift(),fe=Te+f.shift(),me=Pe+f.shift(),Ie=fe+f.shift(),Xe=me+f.shift(),m=Ie+f.shift(),_=Xe+f.shift(),f.shift(),c.curveTo(n,o,s,u,Te,Pe),c.curveTo(fe,me,Ie,Xe,m,_);break;case 34:n=m+f.shift(),o=_,s=n+f.shift(),u=o+f.shift(),Te=s+f.shift(),Pe=u,fe=Te+f.shift(),me=u,Ie=fe+f.shift(),Xe=_,m=Ie+f.shift(),c.curveTo(n,o,s,u,Te,Pe),c.curveTo(fe,me,Ie,Xe,m,_);break;case 36:n=m+f.shift(),o=_+f.shift(),s=n+f.shift(),u=o+f.shift(),Te=s+f.shift(),Pe=u,fe=Te+f.shift(),me=u,Ie=fe+f.shift(),Xe=me+f.shift(),m=Ie+f.shift(),c.curveTo(n,o,s,u,Te,Pe),c.curveTo(fe,me,Ie,Xe,m,_);break;case 37:n=m+f.shift(),o=_+f.shift(),s=n+f.shift(),u=o+f.shift(),Te=s+f.shift(),Pe=u+f.shift(),fe=Te+f.shift(),me=Pe+f.shift(),Ie=fe+f.shift(),Xe=me+f.shift(),Math.abs(Ie-m)>Math.abs(Xe-_)?m=Ie+f.shift():_=Xe+f.shift(),c.curveTo(n,o,s,u,Te,Pe),c.curveTo(fe,me,Ie,Xe,m,_);break;default:console.log("Glyph "+e.index+": unknown operator "+1200+Oe),f.length=0}break;case 14:f.length>0&&!g&&($=f.shift()+C,g=!0),y&&(c.closePath(),y=!1);break;case 18:ae();break;case 19:case 20:ae(),ye+=p+7>>3;break;case 21:f.length>2&&!g&&($=f.shift()+C,g=!0),_+=f.pop(),m+=f.pop(),z(m,_);break;case 22:f.length>1&&!g&&($=f.shift()+C,g=!0),m+=f.pop(),z(m,_);break;case 23:ae();break;case 24:for(;f.length>2;)n=m+f.shift(),o=_+f.shift(),s=n+f.shift(),u=o+f.shift(),m=s+f.shift(),_=u+f.shift(),c.curveTo(n,o,s,u,m,_);m+=f.shift(),_+=f.shift(),c.lineTo(m,_);break;case 25:for(;f.length>6;)m+=f.shift(),_+=f.shift(),c.lineTo(m,_);n=m+f.shift(),o=_+f.shift(),s=n+f.shift(),u=o+f.shift(),m=s+f.shift(),_=u+f.shift(),c.curveTo(n,o,s,u,m,_);break;case 26:for(f.length%2&&(m+=f.shift());f.length>0;)n=m,o=_+f.shift(),s=n+f.shift(),u=o+f.shift(),m=s,_=u+f.shift(),c.curveTo(n,o,s,u,m,_);break;case 27:for(f.length%2&&(_+=f.shift());f.length>0;)n=m+f.shift(),o=_,s=n+f.shift(),u=o+f.shift(),m=s+f.shift(),_=u,c.curveTo(n,o,s,u,m,_);break;case 28:pe=ee[ye],Me=ee[ye+1],f.push((pe<<24|Me<<16)>>16),ye+=2;break;case 29:Be=f.pop()+t.gsubrsBias,ie=t.gsubrs[Be],ie&&te(ie);break;case 30:for(;f.length>0&&(n=m,o=_+f.shift(),s=n+f.shift(),u=o+f.shift(),m=s+f.shift(),_=u+(f.length===1?f.shift():0),c.curveTo(n,o,s,u,m,_),f.length!==0);)n=m+f.shift(),o=_,s=n+f.shift(),u=o+f.shift(),_=u+f.shift(),m=s+(f.length===1?f.shift():0),c.curveTo(n,o,s,u,m,_);break;case 31:for(;f.length>0&&(n=m+f.shift(),o=_,s=n+f.shift(),u=o+f.shift(),_=u+f.shift(),m=s+(f.length===1?f.shift():0),c.curveTo(n,o,s,u,m,_),f.length!==0);)n=m,o=_+f.shift(),s=n+f.shift(),u=o+f.shift(),m=s+f.shift(),_=u+(f.length===1?f.shift():0),c.curveTo(n,o,s,u,m,_);break;default:Oe<32?console.log("Glyph "+e.index+": unknown operator "+Oe):Oe<247?f.push(Oe-139):Oe<251?(pe=ee[ye],ye+=1,f.push((Oe-247)*256+pe+108)):Oe<255?(pe=ee[ye],ye+=1,f.push(-(Oe-251)*256-pe-108)):(pe=ee[ye],Me=ee[ye+1],Ge=ee[ye+2],ze=ee[ye+3],ye+=4,f.push((pe<<24|Me<<16|Ge<<8|ze)/65536))}}}return te(r),e.advanceWidth=$,c}function ac(t,e,r,n){var o=[],s,u=new Z.Parser(t,e),c=u.parseCard8();if(c===0)for(var f=0;f<r;f++){if(s=u.parseCard8(),s>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+s+" (FD count "+n+")");o.push(s)}else if(c===3){var p=u.parseCard16(),g=u.parseCard16();if(g!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+g);for(var y,m=0;m<p;m++){if(s=u.parseCard8(),y=u.parseCard16(),s>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+s+" (FD count "+n+")");if(y>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+y);for(;g<y;g++)o.push(s);g=y}if(y!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+y)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+c);return o}function uc(t,e,r,n){r.tables.cff={};var o=nc(t,e),s=Ft(t,o.endOffset,Z.bytesToString),u=Ft(t,s.endOffset),c=Ft(t,u.endOffset,Z.bytesToString),f=Ft(t,c.endOffset);r.gsubrs=f.objects,r.gsubrsBias=Do(r.gsubrs);var p=Ri(t,e,u.objects,c.objects);if(p.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+p.length);var g=p[0];if(r.tables.cff.topDict=g,g._privateDict&&(r.defaultWidthX=g._privateDict.defaultWidthX,r.nominalWidthX=g._privateDict.nominalWidthX),g.ros[0]!==void 0&&g.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var y=g.fdArray,m=g.fdSelect;if(y===0||m===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");y+=e;var _=Ft(t,y),E=Ri(t,e,_.objects,c.objects);g._fdArray=E,m+=e,g._fdSelect=ac(t,m,r.numGlyphs,E.length)}var x=e+g.private[1],k=Ai(t,x,g.private[0],c.objects);if(r.defaultWidthX=k.defaultWidthX,r.nominalWidthX=k.nominalWidthX,k.subrs!==0){var C=x+k.subrs,R=Ft(t,C);r.subrs=R.objects,r.subrsBias=Do(r.subrs)}else r.subrs=[],r.subrsBias=0;var O;n.lowMemory?(O=Ql(t,e+g.charStrings),r.nGlyphs=O.offsets.length):(O=Ft(t,e+g.charStrings),r.nGlyphs=O.objects.length);var $=sc(t,e+g.charset,r.nGlyphs,c.objects);if(g.encoding===0?r.cffEncoding=new Rn(ql,$):g.encoding===1?r.cffEncoding=new Rn(Yl,$):r.cffEncoding=ic(t,e+g.encoding,$),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new pt.GlyphSet(r),n.lowMemory)r._push=function(te){var ee=Jl(te,O.offsets,t,e+g.charStrings);r.glyphs.push(te,pt.cffGlyphLoader(r,te,Mi,ee))};else for(var z=0;z<r.nGlyphs;z+=1){var ae=O.objects[z];r.glyphs.push(z,pt.cffGlyphLoader(r,z,Mi,ae))}}function Oi(t,e){var r,n=An.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+An.length:(r=An.length+e.length,e.push(t)),r}function lc(){return new H.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function cc(t){var e=new H.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function Di(t,e,r){for(var n={},o=0;o<t.length;o+=1){var s=t[o],u=e[s.name];u!==void 0&&!Ti(u,s.value)&&(s.type==="SID"&&(u=Oi(u,r)),n[s.op]={name:s.name,type:s.type,value:u})}return n}function Bi(t,e){var r=new H.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Di(Pi,t,e),r}function Ii(t){var e=new H.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function fc(t){var e=new H.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function hc(){return new H.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function pc(t,e){for(var r=new H.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var o=t[n],s=Oi(o,e);r.fields.push({name:"glyph_"+n,type:"SID",value:s})}return r}function dc(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,o=0,s=0;s<r.commands.length;s+=1){var u=void 0,c=void 0,f=r.commands[s];if(f.type==="Q"){var p=.3333333333333333,g=2/3;f={type:"C",x:f.x,y:f.y,x1:Math.round(p*n+g*f.x1),y1:Math.round(p*o+g*f.y1),x2:Math.round(p*f.x+g*f.x1),y2:Math.round(p*f.y+g*f.y1)}}if(f.type==="M")u=Math.round(f.x-n),c=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:c}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(f.x),o=Math.round(f.y);else if(f.type==="L")u=Math.round(f.x-n),c=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:c}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(f.x),o=Math.round(f.y);else if(f.type==="C"){var y=Math.round(f.x1-n),m=Math.round(f.y1-o),_=Math.round(f.x2-f.x1),E=Math.round(f.y2-f.y1);u=Math.round(f.x-f.x2),c=Math.round(f.y-f.y2),e.push({name:"dx1",type:"NUMBER",value:y}),e.push({name:"dy1",type:"NUMBER",value:m}),e.push({name:"dx2",type:"NUMBER",value:_}),e.push({name:"dy2",type:"NUMBER",value:E}),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:c}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(f.x),o=Math.round(f.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function vc(t){for(var e=new H.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),o=dc(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:o})}return e}function gc(t,e){var r=new H.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Di(Ci,t,e),r}function mc(t,e){for(var r=new H.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},s={},u=[],c,f=1;f<t.length;f+=1)c=t.get(f),u.push(c.name);var p=[];r.header=lc(),r.nameIndex=cc([e.postScriptName]);var g=Bi(o,p);r.topDictIndex=Ii(g),r.globalSubrIndex=hc(),r.charsets=pc(u,p),r.charStringsIndex=vc(t),r.privateDict=gc(s,p),r.stringIndex=fc(p);var y=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return o.charset=y,o.encoding=0,o.charStrings=o.charset+r.charsets.sizeOf(),o.private[1]=o.charStrings+r.charStringsIndex.sizeOf(),g=Bi(o,p),r.topDictIndex=Ii(g),r}var yc={parse:uc,make:mc};function wc(t,e){var r={},n=new Z.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),X.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function bc(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new H.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var _c={parse:wc,make:bc};function Sc(t,e){var r={},n=new Z.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function Ec(t){return new H.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var Tc={parse:Sc,make:Ec};function xc(t,e,r,n,o){for(var s,u,c=new Z.Parser(t,e),f=0;f<n;f+=1){f<r&&(s=c.parseUShort(),u=c.parseShort());var p=o.get(f);p.advanceWidth=s,p.leftSideBearing=u}}function kc(t,e,r,n,o){t._hmtxTableData={};for(var s,u,c=new Z.Parser(e,r),f=0;f<o;f+=1)f<n&&(s=c.parseUShort(),u=c.parseShort()),t._hmtxTableData[f]={advanceWidth:s,leftSideBearing:u}}function Pc(t,e,r,n,o,s,u){u.lowMemory?kc(t,e,r,n,o):xc(e,r,n,o,s)}function Cc(t){for(var e=new H.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),o=n.advanceWidth||0,s=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:s})}return e}var Ac={parse:Pc,make:Cc};function Rc(t){for(var e=new H.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,o=0;o<t.length;++o){var s=r.indexOf(t[o]);s<0&&(s=r.length,r+=t[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:n+s}),e.fields.push({name:"length "+o,type:"USHORT",value:t[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function Mc(t,e){var r=new Z.Parser(t,e),n=r.parseULong();X.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var o=r.parseULong(),s=[],u=0;u<o;u++){for(var c="",f=e+r.parseUShort(),p=r.parseUShort(),g=f;g<f+p;++g)c+=String.fromCharCode(t.getInt8(g));s.push(c)}return s}var Oc={make:Rc,parse:Mc};function Dc(t,e){var r={},n=new Z.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function Bc(t){return new H.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var Ic={parse:Dc,make:Bc},Fi=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Ui={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Fc={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Li={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Uc(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return Ui[e];case 3:return Li[e]}}var Bo="utf-16",Lc={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Gc={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Gi(t,e,r){switch(t){case 0:return Bo;case 1:return Gc[r]||Lc[e];case 3:if(e===1||e===10)return Bo;break}}function Nc(t,e,r){for(var n={},o=new Z.Parser(t,e),s=o.parseUShort(),u=o.parseUShort(),c=o.offset+o.parseUShort(),f=0;f<u;f++){var p=o.parseUShort(),g=o.parseUShort(),y=o.parseUShort(),m=o.parseUShort(),_=Fi[m]||m,E=o.parseUShort(),x=o.parseUShort(),k=Uc(p,y,r),C=Gi(p,g,y);if(C!==void 0&&k!==void 0){var R=void 0;if(C===Bo?R=hr.UTF16(t,c+x,E):R=hr.MACSTRING(t,c+x,E,C),R){var O=n[_];O===void 0&&(O=n[_]={}),O[k]=R}}}return s===1&&o.parseUShort(),n}function Io(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function Ni(t,e,r,n,o,s){return new H.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:s}])}function Hc(t,e){var r=t.length,n=e.length-r+1;e:for(var o=0;o<n;o++)for(;o<n;o++){for(var s=0;s<r;s++)if(e[o+s]!==t[s])continue e;return o}return-1}function Hi(t,e){var r=Hc(t,e);if(r<0){r=e.length;for(var n=0,o=t.length;n<o;++n)e.push(t[n])}return r}function Wc(t,e){var r,n=[],o={},s=Io(Fi);for(var u in t){var c=s[u];if(c===void 0&&(c=u),r=parseInt(c),isNaN(r))throw new Error('Name table entry "'+u+'" does not exist, see nameTableNames for complete list.');o[r]=t[u],n.push(r)}for(var f=Io(Ui),p=Io(Li),g=[],y=[],m=0;m<n.length;m++){r=n[m];var _=o[r];for(var E in _){var x=_[E],k=1,C=f[E],R=Fc[C],O=Gi(k,R,C),$=G.MACSTRING(x,O);$===void 0&&(k=0,C=e.indexOf(E),C<0&&(C=e.length,e.push(E)),R=4,$=G.UTF16(x));var z=Hi($,y);g.push(Ni(k,R,C,r,$.length,z));var ae=p[E];if(ae!==void 0){var te=G.UTF16(x),ee=Hi(te,y);g.push(Ni(3,1,ae,r,te.length,ee))}}}g.sort(function(Ge,ze){return Ge.platformID-ze.platformID||Ge.encodingID-ze.encodingID||Ge.languageID-ze.languageID||Ge.nameID-ze.nameID});for(var pe=new H.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:g.length},{name:"stringOffset",type:"USHORT",value:6+g.length*12}]),Me=0;Me<g.length;Me++)pe.fields.push({name:"record_"+Me,type:"RECORD",value:g[Me]});return pe.fields.push({name:"strings",type:"LITERAL",value:y}),pe}var Vc={parse:Nc,make:Wc},Fo=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function zc(t){for(var e=0;e<Fo.length;e+=1){var r=Fo[e];if(t>=r.begin&&t<r.end)return e}return-1}function qc(t,e){var r={},n=new Z.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var o=0;o<10;o++)r.panose[o]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function Yc(t){return new H.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var Wi={parse:qc,make:Yc,unicodeRanges:Fo,getUnicodeRange:zc};function Xc(t,e){var r={},n=new Z.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=Si.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.glyphNameIndex[o]=n.parseUShort();r.names=[];for(var s=0;s<r.numberOfGlyphs;s++)if(r.glyphNameIndex[s]>=Si.length){var u=n.parseChar();r.names.push(n.parseString(u))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var c=0;c<r.numberOfGlyphs;c++)r.offset[c]=n.parseChar();break}return r}function $c(){return new H.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var jc={parse:Xc,make:$c},it=new Array(9);it[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(P.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(P.coverage),substitute:this.parseOffset16List()};X.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},it[2]=function(){var e=this.parseUShort();return X.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(P.coverage),sequences:this.parseListOfLists()}},it[3]=function(){var e=this.parseUShort();return X.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(P.coverage),alternateSets:this.parseListOfLists()}},it[4]=function(){var e=this.parseUShort();return X.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(P.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var pr={sequenceIndex:P.uShort,lookupListIndex:P.uShort};it[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(P.coverage),ruleSets:this.parseListOfLists(function(){var s=this.parseUShort(),u=this.parseUShort();return{input:this.parseUShortList(s-1),lookupRecords:this.parseRecordList(u,pr)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(P.coverage),classDef:this.parsePointer(P.classDef),classSets:this.parseListOfLists(function(){var s=this.parseUShort(),u=this.parseUShort();return{classes:this.parseUShortList(s-1),lookupRecords:this.parseRecordList(u,pr)}})};if(r===3){var n=this.parseUShort(),o=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,P.pointer(P.coverage)),lookupRecords:this.parseRecordList(o,pr)}}X.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},it[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(P.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(pr)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(P.coverage),backtrackClassDef:this.parsePointer(P.classDef),inputClassDef:this.parsePointer(P.classDef),lookaheadClassDef:this.parsePointer(P.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(pr)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(P.pointer(P.coverage)),inputCoverage:this.parseList(P.pointer(P.coverage)),lookaheadCoverage:this.parseList(P.pointer(P.coverage)),lookupRecords:this.parseRecordList(pr)};X.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},it[7]=function(){var e=this.parseUShort();X.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new P(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:it[r].call(n)}},it[8]=function(){var e=this.parseUShort();return X.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(P.coverage),backtrackCoverage:this.parseList(P.pointer(P.coverage)),lookaheadCoverage:this.parseList(P.pointer(P.coverage)),substitutes:this.parseUShortList()}};function Zc(t,e){e=e||0;var r=new P(t,e),n=r.parseVersion(1);return X.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(it)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(it),variations:r.parseFeatureVariationsList()}}var dr=new Array(9);dr[1]=function(e){return e.substFormat===1?new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.ushortList("substitute",e.substitute)))},dr[2]=function(e){return X.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("seqSet",e.sequences,function(r){return new H.Table("sequenceSetTable",H.ushortList("sequence",r))})))},dr[3]=function(e){return X.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("altSet",e.alternateSets,function(r){return new H.Table("alternateSetTable",H.ushortList("alternate",r))})))},dr[4]=function(e){return X.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("ligSet",e.ligatureSets,function(r){return new H.Table("ligatureSetTable",H.tableList("ligature",r,function(n){return new H.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(H.ushortList("component",n.components,n.components.length+1)))}))})))},dr[6]=function(e){if(e.substFormat===1){var r=new H.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("chainRuleSet",e.chainRuleSets,function(s){return new H.Table("chainRuleSetTable",H.tableList("chainRule",s,function(u){var c=H.ushortList("backtrackGlyph",u.backtrack,u.backtrack.length).concat(H.ushortList("inputGlyph",u.input,u.input.length+1)).concat(H.ushortList("lookaheadGlyph",u.lookahead,u.lookahead.length)).concat(H.ushortList("substitution",[],u.lookupRecords.length));return u.lookupRecords.forEach(function(f,p){c=c.concat({name:"sequenceIndex"+p,type:"USHORT",value:f.sequenceIndex}).concat({name:"lookupListIndex"+p,type:"USHORT",value:f.lookupListIndex})}),new H.Table("chainRuleTable",c)}))})));return r}else if(e.substFormat===2)X.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(s,u){n.push({name:"backtrackCoverage"+u,type:"TABLE",value:new H.Coverage(s)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(s,u){n.push({name:"inputCoverage"+u,type:"TABLE",value:new H.Coverage(s)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(s,u){n.push({name:"lookaheadCoverage"+u,type:"TABLE",value:new H.Coverage(s)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(s,u){n=n.concat({name:"sequenceIndex"+u,type:"USHORT",value:s.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:s.lookupListIndex})});var o=new H.Table("chainContextTable",n);return o}X.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Kc(t){return new H.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new H.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new H.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new H.LookupList(t.lookups,dr)}])}var Qc={parse:Zc,make:Kc};function Jc(t,e){var r=new Z.Parser(t,e),n=r.parseULong();X.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var o=r.parseULong(),s={},u=0;u<o;u++){var c=r.parseTag(),f=r.parseULong(),p=r.parseULong(),g=hr.UTF8(t,e+f,p);s[c]=g}return s}function ef(t){var e=Object.keys(t).length,r="",n=16+e*12,o=new H.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var s in t){var u=r.length;r+=t[s],o.fields.push({name:"tag "+s,type:"TAG",value:s}),o.fields.push({name:"offset "+s,type:"ULONG",value:n+u}),o.fields.push({name:"length "+s,type:"ULONG",value:t[s].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),o}var tf={parse:Jc,make:ef};function Vi(t){return Math.log(t)/Math.log(2)|0}function Uo(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function zi(t,e,r,n){return new H.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function qi(t){var e=new H.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,Vi(e.numTables));e.searchRange=16*r,e.entrySelector=Vi(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],o=[],s=e.sizeOf()+zi().sizeOf()*e.numTables;s%4!==0;)s+=1,o.push({name:"padding",type:"BYTE",value:0});for(var u=0;u<t.length;u+=1){var c=t[u];X.argument(c.tableName.length===4,"Table name"+c.tableName+" is invalid.");var f=c.sizeOf(),p=zi(c.tableName,Uo(c.encode()),s,f);for(n.push({name:p.tag+" Table Record",type:"RECORD",value:p}),o.push({name:c.tableName+" table",type:"RECORD",value:c}),s+=f,X.argument(!isNaN(s),"Something went wrong calculating the offset.");s%4!==0;)s+=1,o.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(g,y){return g.value.tag>y.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(o),e}function Yi(t,e,r){for(var n=0;n<e.length;n+=1){var o=t.charToGlyphIndex(e[n]);if(o>0){var s=t.glyphs.get(o);return s.getMetrics()}}return r}function rf(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function nf(t){for(var e=[],r=[],n=[],o=[],s=[],u=[],c=[],f,p=0,g=0,y=0,m=0,_=0,E=0;E<t.glyphs.length;E+=1){var x=t.glyphs.get(E),k=x.unicode|0;if(isNaN(x.advanceWidth))throw new Error("Glyph "+x.name+" ("+E+"): advanceWidth is not a number.");(f>k||f===void 0)&&k>0&&(f=k),p<k&&(p=k);var C=Wi.getUnicodeRange(k);if(C<32)g|=1<<C;else if(C<64)y|=1<<C-32;else if(C<96)m|=1<<C-64;else if(C<123)_|=1<<C-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(x.name!==".notdef"){var R=x.getMetrics();e.push(R.xMin),r.push(R.yMin),n.push(R.xMax),o.push(R.yMax),u.push(R.leftSideBearing),c.push(R.rightSideBearing),s.push(x.advanceWidth)}}var O={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,s),advanceWidthAvg:rf(s),minLeftSideBearing:Math.min.apply(null,u),maxLeftSideBearing:Math.max.apply(null,u),minRightSideBearing:Math.min.apply(null,c)};O.ascender=t.ascender,O.descender=t.descender;var $=_c.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:O.xMin,yMin:O.yMin,xMax:O.xMax,yMax:O.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),z=Tc.make({ascender:O.ascender,descender:O.descender,advanceWidthMax:O.advanceWidthMax,minLeftSideBearing:O.minLeftSideBearing,minRightSideBearing:O.minRightSideBearing,xMaxExtent:O.maxLeftSideBearing+(O.xMax-O.xMin),numberOfHMetrics:t.glyphs.length}),ae=Ic.make(t.glyphs.length),te=Wi.make(Object.assign({xAvgCharWidth:Math.round(O.advanceWidthAvg),usFirstCharIndex:f,usLastCharIndex:p,ulUnicodeRange1:g,ulUnicodeRange2:y,ulUnicodeRange3:m,ulUnicodeRange4:_,sTypoAscender:O.ascender,sTypoDescender:O.descender,sTypoLineGap:0,usWinAscent:O.yMax,usWinDescent:Math.abs(O.yMin),ulCodePageRange1:1,sxHeight:Yi(t,"xyvw",{yMax:Math.round(O.ascender/2)}).yMax,sCapHeight:Yi(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",O).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),ee=Ac.make(t.glyphs),pe=zl.make(t.glyphs),Me=t.getEnglishName("fontFamily"),Ge=t.getEnglishName("fontSubfamily"),ze=Me+" "+Ge,Be=t.getEnglishName("postScriptName");Be||(Be=Me.replace(/\s/g,"")+"-"+Ge);var ie={};for(var Te in t.names)ie[Te]=t.names[Te];ie.uniqueID||(ie.uniqueID={en:t.getEnglishName("manufacturer")+":"+ze}),ie.postScriptName||(ie.postScriptName={en:Be}),ie.preferredFamily||(ie.preferredFamily=t.names.fontFamily),ie.preferredSubfamily||(ie.preferredSubfamily=t.names.fontSubfamily);var Pe=[],fe=Vc.make(ie,Pe),me=Pe.length>0?Oc.make(Pe):void 0,Ie=jc.make(),Xe=yc.make(t.glyphs,{version:t.getEnglishName("version"),fullName:ze,familyName:Me,weightName:Ge,postScriptName:Be,unitsPerEm:t.unitsPerEm,fontBBox:[0,O.yMin,O.ascender,O.advanceWidthMax]}),ye=t.metas&&Object.keys(t.metas).length>0?tf.make(t.metas):void 0,Oe=[$,z,ae,te,fe,pe,Ie,Xe,ee];me&&Oe.push(me),t.tables.gsub&&Oe.push(Qc.make(t.tables.gsub)),ye&&Oe.push(ye);for(var Yr=qi(Oe),Qo=Yr.encode(),Un=Uo(Qo),Xr=Yr.fields,Ln=!1,Tt=0;Tt<Xr.length;Tt+=1)if(Xr[Tt].name==="head table"){Xr[Tt].value.checkSumAdjustment=2981146554-Un,Ln=!0;break}if(!Ln)throw new Error("Could not find head table with checkSum to adjust.");return Yr}var of={make:qi,fontToTable:nf,computeCheckSum:Uo};function Lo(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,s=t[o].tag;if(s===e)return o;s<e?r=o+1:n=o-1}return-r-1}function Xi(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,s=t[o];if(s===e)return o;s<e?r=o+1:n=o-1}return-r-1}function $i(t,e){for(var r,n=0,o=t.length-1;n<=o;){var s=n+o>>>1;r=t[s];var u=r.start;if(u===e)return r;u<e?n=s+1:o=s-1}if(n>0)return r=t[n-1],e>r.end?0:r}function Gr(t,e){this.font=t,this.tableName=e}Gr.prototype={searchTag:Lo,binSearch:Xi,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(!!t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,o=Lo(r.scripts,t);if(o>=0)return n[o].script;if(e){var s={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-o,0,s),s.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var o=Lo(n.langSysRecords,e);if(o>=0)return n.langSysRecords[o].langSys;if(r){var s={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-o,0,s),s.langSys}}},getFeatureTable:function(t,e,r,n){var o=this.getLangSysTable(t,e,n);if(o){for(var s,u=o.featureIndexes,c=this.font.tables[this.tableName].features,f=0;f<u.length;f++)if(s=c[u[f]],s.tag===r)return s.feature;if(n){var p=c.length;return X.assert(p===0||r>=c[p-1].tag,"Features must be added in alphabetical order."),s={tag:r,feature:{params:0,lookupListIndexes:[]}},c.push(s),u.push(p),s.feature}}},getLookupTables:function(t,e,r,n,o){var s=this.getFeatureTable(t,e,r,o),u=[];if(s){for(var c,f=s.lookupListIndexes,p=this.font.tables[this.tableName].lookups,g=0;g<f.length;g++)c=p[f[g]],c.lookupType===n&&u.push(c);if(u.length===0&&o){c={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var y=p.length;return p.push(c),f.push(y),[c]}}return u},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=$i(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=Xi(t.glyphs,e);return r>=0?r:-1;case 2:var n=$i(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var o=r[n],s=o.start,u=o.end,c=s;c<=u;c++)e.push(c);return e}};function Nr(t){Gr.call(this,t,"gpos")}Nr.prototype=Gr.prototype,Nr.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)},Nr.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var o=t[n].subtables,s=0;s<o.length;s++){var u=o[s],c=this.getCoverageIndex(u.coverage,e);if(!(c<0))switch(u.posFormat){case 1:for(var f=u.pairSets[c],p=0;p<f.length;p++){var g=f[p];if(g.secondGlyph===r)return g.value1&&g.value1.xAdvance||0}break;case 2:var y=this.getGlyphClass(u.classDef1,e),m=this.getGlyphClass(u.classDef2,r),_=u.classRecords[y][m];return _.value1&&_.value1.xAdvance||0}}return 0},Nr.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function et(t){Gr.call(this,t,"gsub")}function sf(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Go(t,e,r){for(var n=t.subtables,o=0;o<n.length;o++){var s=n[o];if(s.substFormat===e)return s}if(r)return n.push(r),r}et.prototype=Gr.prototype,et.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},et.prototype.getSingle=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,1),s=0;s<o.length;s++)for(var u=o[s].subtables,c=0;c<u.length;c++){var f=u[c],p=this.expandCoverage(f.coverage),g=void 0;if(f.substFormat===1){var y=f.deltaGlyphId;for(g=0;g<p.length;g++){var m=p[g];n.push({sub:m,by:m+y})}}else{var _=f.substitute;for(g=0;g<p.length;g++)n.push({sub:p[g],by:_[g]})}}return n},et.prototype.getMultiple=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,2),s=0;s<o.length;s++)for(var u=o[s].subtables,c=0;c<u.length;c++){var f=u[c],p=this.expandCoverage(f.coverage),g=void 0;for(g=0;g<p.length;g++){var y=p[g],m=f.sequences[g];n.push({sub:y,by:m})}}return n},et.prototype.getAlternates=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,3),s=0;s<o.length;s++)for(var u=o[s].subtables,c=0;c<u.length;c++)for(var f=u[c],p=this.expandCoverage(f.coverage),g=f.alternateSets,y=0;y<p.length;y++)n.push({sub:p[y],by:g[y]});return n},et.prototype.getLigatures=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,4),s=0;s<o.length;s++)for(var u=o[s].subtables,c=0;c<u.length;c++)for(var f=u[c],p=this.expandCoverage(f.coverage),g=f.ligatureSets,y=0;y<p.length;y++)for(var m=p[y],_=g[y],E=0;E<_.length;E++){var x=_[E];n.push({sub:[m].concat(x.components),by:x.ligGlyph})}return n},et.prototype.addSingle=function(t,e,r,n){var o=this.getLookupTables(r,n,t,1,!0)[0],s=Go(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});X.assert(s.coverage.format===1,"Single: unable to modify coverage table format "+s.coverage.format);var u=e.sub,c=this.binSearch(s.coverage.glyphs,u);c<0&&(c=-1-c,s.coverage.glyphs.splice(c,0,u),s.substitute.splice(c,0,0)),s.substitute[c]=e.by},et.prototype.addMultiple=function(t,e,r,n){X.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(r,n,t,2,!0)[0],s=Go(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});X.assert(s.coverage.format===1,"Multiple: unable to modify coverage table format "+s.coverage.format);var u=e.sub,c=this.binSearch(s.coverage.glyphs,u);c<0&&(c=-1-c,s.coverage.glyphs.splice(c,0,u),s.sequences.splice(c,0,0)),s.sequences[c]=e.by},et.prototype.addAlternate=function(t,e,r,n){var o=this.getLookupTables(r,n,t,3,!0)[0],s=Go(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});X.assert(s.coverage.format===1,"Alternate: unable to modify coverage table format "+s.coverage.format);var u=e.sub,c=this.binSearch(s.coverage.glyphs,u);c<0&&(c=-1-c,s.coverage.glyphs.splice(c,0,u),s.alternateSets.splice(c,0,0)),s.alternateSets[c]=e.by},et.prototype.addLigature=function(t,e,r,n){var o=this.getLookupTables(r,n,t,4,!0)[0],s=o.subtables[0];s||(s={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=s),X.assert(s.coverage.format===1,"Ligature: unable to modify coverage table format "+s.coverage.format);var u=e.sub[0],c=e.sub.slice(1),f={ligGlyph:e.by,components:c},p=this.binSearch(s.coverage.glyphs,u);if(p>=0){for(var g=s.ligatureSets[p],y=0;y<g.length;y++)if(sf(g[y].components,c))return;g.push(f)}else p=-1-p,s.coverage.glyphs.splice(p,0,u),s.ligatureSets.splice(p,0,[f])},et.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}},et.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function af(){return typeof window<"u"}function uf(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function Hr(t,e){if(!t)throw e}function ji(t,e,r,n,o){var s;return(e&n)>0?(s=t.parseByte(),(e&o)===0&&(s=-s),s=r+s):(e&o)>0?s=r:s=r+t.parseShort(),s}function Zi(t,e,r){var n=new Z.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var o,s;if(t.numberOfContours>0){for(var u=t.endPointIndices=[],c=0;c<t.numberOfContours;c+=1)u.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var f=0;f<t.instructionLength;f+=1)t.instructions.push(n.parseByte());var p=u[u.length-1]+1;o=[];for(var g=0;g<p;g+=1)if(s=n.parseByte(),o.push(s),(s&8)>0)for(var y=n.parseByte(),m=0;m<y;m+=1)o.push(s),g+=1;if(X.argument(o.length===p,"Bad flags."),u.length>0){var _=[],E;if(p>0){for(var x=0;x<p;x+=1)s=o[x],E={},E.onCurve=!!(s&1),E.lastPointOfContour=u.indexOf(x)>=0,_.push(E);for(var k=0,C=0;C<p;C+=1)s=o[C],E=_[C],E.x=ji(n,s,k,2,16),k=E.x;for(var R=0,O=0;O<p;O+=1)s=o[O],E=_[O],E.y=ji(n,s,R,4,32),R=E.y}t.points=_}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var $=!0;$;){o=n.parseUShort();var z={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?(z.dx=n.parseShort(),z.dy=n.parseShort()):z.matchedPoints=[n.parseUShort(),n.parseUShort()]:(o&2)>0?(z.dx=n.parseChar(),z.dy=n.parseChar()):z.matchedPoints=[n.parseByte(),n.parseByte()],(o&8)>0?z.xScale=z.yScale=n.parseF2Dot14():(o&64)>0?(z.xScale=n.parseF2Dot14(),z.yScale=n.parseF2Dot14()):(o&128)>0&&(z.xScale=n.parseF2Dot14(),z.scale01=n.parseF2Dot14(),z.scale10=n.parseF2Dot14(),z.yScale=n.parseF2Dot14()),t.components.push(z),$=!!(o&32)}if(o&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var ae=0;ae<t.instructionLength;ae+=1)t.instructions.push(n.parseByte())}}}function No(t,e){for(var r=[],n=0;n<t.length;n+=1){var o=t[n],s={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};r.push(s)}return r}function lf(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];r.push(o),o.lastPointOfContour&&(e.push(r),r=[])}return X.argument(r.length===0,"There are still points left in the current contour."),e}function Ki(t){var e=new Re;if(!t)return e;for(var r=lf(t),n=0;n<r.length;++n){var o=r[n],s=null,u=o[o.length-1],c=o[0];if(u.onCurve)e.moveTo(u.x,u.y);else if(c.onCurve)e.moveTo(c.x,c.y);else{var f={x:(u.x+c.x)*.5,y:(u.y+c.y)*.5};e.moveTo(f.x,f.y)}for(var p=0;p<o.length;++p)if(s=u,u=c,c=o[(p+1)%o.length],u.onCurve)e.lineTo(u.x,u.y);else{var g=c;s.onCurve||((u.x+s.x)*.5,(u.y+s.y)*.5),c.onCurve||(g={x:(u.x+c.x)*.5,y:(u.y+c.y)*.5}),e.quadraticCurveTo(u.x,u.y,g.x,g.y)}e.closePath()}return e}function Qi(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],o=t.get(n.glyphIndex);if(o.getPath(),o.points){var s=void 0;if(n.matchedPoints===void 0)s=No(o.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var u=e.points[n.matchedPoints[0]],c=o.points[n.matchedPoints[1]],f={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};c=No([c],f)[0],f.dx=u.x-c.x,f.dy=u.y-c.y,s=No(o.points,f)}e.points=e.points.concat(s)}}return Ki(e.points)}function cf(t,e,r,n){for(var o=new pt.GlyphSet(n),s=0;s<r.length-1;s+=1){var u=r[s],c=r[s+1];u!==c?o.push(s,pt.ttfGlyphLoader(n,s,Zi,t,e+u,Qi)):o.push(s,pt.glyphLoader(n,s))}return o}function ff(t,e,r,n){var o=new pt.GlyphSet(n);return n._push=function(s){var u=r[s],c=r[s+1];u!==c?o.push(s,pt.ttfGlyphLoader(n,s,Zi,t,e+u,Qi)):o.push(s,pt.glyphLoader(n,s))},o}function hf(t,e,r,n,o){return o.lowMemory?ff(t,e,r,n):cf(t,e,r,n)}var pf={getPath:Ki,parse:hf},Ji,jt,ea,Ho;function ta(t){this.font=t,this.getCommands=function(e){return pf.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function df(t){return t}function ra(t){return Math.sign(t)*Math.round(Math.abs(t))}function vf(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function gf(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function mf(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function yf(t){return Math.sign(t)*Math.floor(Math.abs(t))}var na=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,o=1;return t<0&&(t=-t,o=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*o:t*o},dt={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var o,s,u,c,f,p,g;if(!n||n===this){if(o=t.xo-e.xo,s=t.xo-r.xo,f=e.x-e.xo,p=r.x-r.xo,u=Math.abs(o),c=Math.abs(s),g=u+c,g===0){t.x=t.xo+(f+p)/2;return}t.x=t.xo+(f*c+p*u)/g;return}if(o=n.distance(t,e,!0,!0),s=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),u=Math.abs(o),c=Math.abs(s),g=u+c,g===0){dt.setRelative(t,t,(f+p)/2,n,!0);return}dt.setRelative(t,t,(f*c+p*u)/g,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,o){if(!n||n===this){t.x=(o?e.xo:e.x)+r;return}var s=o?e.xo:e.x,u=o?e.yo:e.y,c=s+r*n.x,f=u+r*n.y;t.x=c+(t.y-f)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},_t={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var o,s,u,c,f,p,g;if(!n||n===this){if(o=t.yo-e.yo,s=t.yo-r.yo,f=e.y-e.yo,p=r.y-r.yo,u=Math.abs(o),c=Math.abs(s),g=u+c,g===0){t.y=t.yo+(f+p)/2;return}t.y=t.yo+(f*c+p*u)/g;return}if(o=n.distance(t,e,!0,!0),s=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),u=Math.abs(o),c=Math.abs(s),g=u+c,g===0){_t.setRelative(t,t,(f+p)/2,n,!0);return}_t.setRelative(t,t,(f*c+p*u)/g,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,o){if(!n||n===this){t.y=(o?e.yo:e.y)+r;return}var s=o?e.xo:e.x,u=o?e.yo:e.y,c=s+r*n.x,f=u+r*n.y;t.y=f+n.normalSlope*(t.x-c)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(dt),Object.freeze(_t);function Wr(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}Wr.prototype.distance=function(t,e,r,n){return this.x*dt.distance(t,e,r,n)+this.y*_t.distance(t,e,r,n)},Wr.prototype.interpolate=function(t,e,r,n){var o,s,u,c,f,p,g;if(u=n.distance(t,e,!0,!0),c=n.distance(t,r,!0,!0),o=n.distance(e,e,!1,!0),s=n.distance(r,r,!1,!0),f=Math.abs(u),p=Math.abs(c),g=f+p,g===0){this.setRelative(t,t,(o+s)/2,n,!0);return}this.setRelative(t,t,(o*p+s*f)/g,n,!0)},Wr.prototype.setRelative=function(t,e,r,n,o){n=n||this;var s=o?e.xo:e.x,u=o?e.yo:e.y,c=s+r*n.x,f=u+r*n.y,p=n.normalSlope,g=this.slope,y=t.x,m=t.y;t.x=(g*y-p*c+f-m)/(g-p),t.y=g*(t.x-y)+m},Wr.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function Vr(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?dt:t===0&&e===1?_t:new Wr(t,e)}function St(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}St.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e},St.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var zr=Object.freeze(new St(0,0)),wf={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Ut(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=dt,this.round=ra}}ta.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var o=this._fpgmState;if(!o){Ut.prototype=wf,o=this._fpgmState=new Ut("fpgm",r.tables.fpgm),o.funcs=[],o.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{jt(o)}catch(p){console.log("Hinting error in FPGM:"+p),this._errorState=3;return}}Ut.prototype=o,n=this._prepState=new Ut("prep",r.tables.prep),n.ppem=e;var s=r.tables.cvt;if(s)for(var u=n.cvt=new Array(s.length),c=e/r.unitsPerEm,f=0;f<s.length;f++)u[f]=s[f]*c;else n.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{jt(n)}catch(p){this._errorState<2&&console.log("Hinting error in PREP:"+p),this._errorState=2}}if(!(this._errorState>1))try{return ea(t,n)}catch(p){this._errorState<1&&(console.log("Hinting error:"+p),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}},ea=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,o=t.components,s,u,c;if(Ut.prototype=e,!o)c=new Ut("glyf",t.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),c.step=-1),Ho(t,c,r,n),u=c.gZone;else{var f=e.font;u=[],s=[];for(var p=0;p<o.length;p++){var g=o[p],y=f.glyphs.get(g.glyphIndex);c=new Ut("glyf",y.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+p+"---"),c.step=-1),Ho(y,c,r,n);for(var m=Math.round(g.dx*r),_=Math.round(g.dy*n),E=c.gZone,x=c.contours,k=0;k<E.length;k++){var C=E[k];C.xTouched=C.yTouched=!1,C.xo=C.x=C.x+m,C.yo=C.y=C.y+_}var R=u.length;u.push.apply(u,E);for(var O=0;O<x.length;O++)s.push(x[O]+R)}t.instructions&&!c.inhibitGridFit&&(c=new Ut("glyf",t.instructions),c.gZone=c.z0=c.z1=c.z2=u,c.contours=s,u.push(new St(0,0),new St(Math.round(t.advanceWidth*r),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),c.step=-1),jt(c),u.length-=2)}return u},Ho=function(t,e,r,n){for(var o=t.points||[],s=o.length,u=e.gZone=e.z0=e.z1=e.z2=[],c=e.contours=[],f,p=0;p<s;p++)f=o[p],u[p]=new St(f.x*r,f.y*n,f.lastPointOfContour,f.onCurve);for(var g,y,m=0;m<s;m++)f=u[m],g||(g=f,c.push(m)),f.lastPointOfContour?(f.nextPointOnContour=g,g.prevPointOnContour=f,g=void 0):(y=u[m+1],f.nextPointOnContour=y,y.prevPointOnContour=f);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var _=0;_<s;_++)console.log(_,u[_].x,u[_].y)}if(u.push(new St(0,0),new St(Math.round(t.advanceWidth*r),0)),jt(e),u.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var E=0;E<s;E++)console.log(E,u[E].x,u[E].y)}}},jt=function(t){var e=t.prog;if(!!e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(exports.DEBUG&&t.step++,n=Ji[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function On(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new St(0,0)}function oa(t,e){var r=t.prog,n=t.ip,o=1,s;do if(s=r[++n],s===88)o++;else if(s===89)o--;else if(s===64)n+=r[n+1]+1;else if(s===65)n+=2*r[n+1]+1;else if(s>=176&&s<=183)n+=s-176+1;else if(s>=184&&s<=191)n+=(s-184+1)*2;else if(e&&o===1&&s===27)break;while(o>0);t.ip=n}function sa(t,e){exports.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function ia(t,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function aa(t,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function ua(t,e){var r=e.stack,n=r.pop(),o=r.pop(),s=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log("SPVTL["+t+"]",n,o);var c,f;t?(c=s.y-u.y,f=u.x-s.x):(c=u.x-s.x,f=u.y-s.y),e.pv=e.dpv=Vr(c,f)}function la(t,e){var r=e.stack,n=r.pop(),o=r.pop(),s=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log("SFVTL["+t+"]",n,o);var c,f;t?(c=s.y-u.y,f=u.x-s.x):(c=u.x-s.x,f=u.y-s.y),e.fv=Vr(c,f)}function bf(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=Vr(n,r)}function _f(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=Vr(n,r)}function Sf(t){var e=t.stack,r=t.pv;exports.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Ef(t){var e=t.stack,r=t.fv;exports.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Tf(t){t.fv=t.pv,exports.DEBUG&&console.log(t.step,"SFVTPV[]")}function xf(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop(),s=e.pop(),u=e.pop(),c=t.z0,f=t.z1,p=c[r],g=c[n],y=f[o],m=f[s],_=t.z2[u];exports.DEBUG&&console.log("ISECT[], ",r,n,o,s,u);var E=p.x,x=p.y,k=g.x,C=g.y,R=y.x,O=y.y,$=m.x,z=m.y,ae=(E-k)*(O-z)-(x-C)*(R-$),te=E*C-x*k,ee=R*z-O*$;_.x=(te*(R-$)-ee*(E-k))/ae,_.y=(te*(O-z)-ee*(x-C))/ae}function kf(t){t.rp0=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function Pf(t){t.rp1=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function Cf(t){t.rp2=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function Af(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||On(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Rf(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||On(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Mf(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||On(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Of(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||On(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Df(t){t.loop=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function Bf(t){exports.DEBUG&&console.log(t.step,"RTG[]"),t.round=ra}function If(t){exports.DEBUG&&console.log(t.step,"RTHG[]"),t.round=gf}function Ff(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function Uf(t){exports.DEBUG&&console.log(t.step,"ELSE[]"),oa(t,!1)}function Lf(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function Gf(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function Nf(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function Wo(t){exports.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function Hf(t){exports.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function Wf(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function Vf(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function zf(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var o=t.ip,s=t.prog;t.prog=t.funcs[r];for(var u=0;u<n;u++)jt(t),exports.DEBUG&&console.log(++t.step,u+1<n?"next loopcall":"done loopcall",u);t.ip=o,t.prog=s}function qf(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],jt(t),t.ip=r,t.prog=n,exports.DEBUG&&console.log(++t.step,"returning from",e)}function Yf(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function Xf(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function $f(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,o=e.pop(),s=n;for(exports.DEBUG&&console.log(t.step,"FDEF[]",o);r[++n]!==45;);t.ip=n,t.funcs[o]=r.slice(s+1,n)}function ca(t,e){var r=e.stack.pop(),n=e.z0[r],o=e.fv,s=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var u=s.distance(n,zr);t&&(u=e.round(u)),o.setRelative(n,zr,u,s),o.touch(n),e.rp0=e.rp1=r}function fa(t,e){var r=e.z2,n=r.length-2,o,s,u;exports.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var c=0;c<n;c++)o=r[c],!t.touched(o)&&(s=o.prevTouched(t),s!==o&&(u=o.nextTouched(t),s===u&&t.setRelative(o,o,t.distance(s,s,!1,!0),t,!0),t.interpolate(o,s,u,t)))}function ha(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],s=e.fv,u=e.pv,c=e.loop,f=e.z2;c--;){var p=r.pop(),g=f[p],y=u.distance(o,o,!1,!0);s.setRelative(g,g,y,u),s.touch(g),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-c)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",p)}e.loop=1}function pa(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],s=e.fv,u=e.pv,c=r.pop(),f=e.z2[e.contours[c]],p=f;exports.DEBUG&&console.log(e.step,"SHC["+t+"]",c);var g=u.distance(o,o,!1,!0);do p!==o&&s.setRelative(p,p,g,u),p=p.nextPointOnContour;while(p!==f)}function da(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],s=e.fv,u=e.pv,c=r.pop();exports.DEBUG&&console.log(e.step,"SHZ["+t+"]",c);var f;switch(c){case 0:f=e.tZone;break;case 1:f=e.gZone;break;default:throw new Error("Invalid zone")}for(var p,g=u.distance(o,o,!1,!0),y=f.length-2,m=0;m<y;m++)p=f[m],s.setRelative(p,p,g,u)}function jf(t){for(var e=t.stack,r=t.loop,n=t.fv,o=e.pop()/64,s=t.z2;r--;){var u=e.pop(),c=s[u];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",u,o),n.setRelative(c,c,o),n.touch(c)}t.loop=1}function Zf(t){for(var e=t.stack,r=t.rp1,n=t.rp2,o=t.loop,s=t.z0[r],u=t.z1[n],c=t.fv,f=t.dpv,p=t.z2;o--;){var g=e.pop(),y=p[g];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"IP[]",g,r,"<->",n),c.interpolate(y,s,u,f),c.touch(y)}t.loop=1}function va(t,e){var r=e.stack,n=r.pop()/64,o=r.pop(),s=e.z1[o],u=e.z0[e.rp0],c=e.fv,f=e.pv;c.setRelative(s,u,n,f),c.touch(s),exports.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,o),e.rp1=e.rp0,e.rp2=o,t&&(e.rp0=o)}function Kf(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],o=t.loop,s=t.fv,u=t.pv,c=t.z1;o--;){var f=e.pop(),p=c[f];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"ALIGNRP[]",f),s.setRelative(p,n,0,u),s.touch(p)}t.loop=1}function Qf(t){exports.DEBUG&&console.log(t.step,"RTDG[]"),t.round=vf}function ga(t,e){var r=e.stack,n=r.pop(),o=r.pop(),s=e.z0[o],u=e.fv,c=e.pv,f=e.cvt[n];exports.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",f,")",o);var p=c.distance(s,zr);t&&(Math.abs(p-f)<e.cvCutIn&&(p=f),p=e.round(p)),u.setRelative(s,zr,p,c),e.zp0===0&&(s.xo=s.x,s.yo=s.y),u.touch(s),e.rp0=e.rp1=o}function Jf(t){var e=t.prog,r=t.ip,n=t.stack,o=e[++r];exports.DEBUG&&console.log(t.step,"NPUSHB[]",o);for(var s=0;s<o;s++)n.push(e[++r]);t.ip=r}function eh(t){var e=t.ip,r=t.prog,n=t.stack,o=r[++e];exports.DEBUG&&console.log(t.step,"NPUSHW[]",o);for(var s=0;s<o;s++){var u=r[++e]<<8|r[++e];u&32768&&(u=-((u^65535)+1)),n.push(u)}t.ip=e}function th(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),o=e.pop();exports.DEBUG&&console.log(t.step,"WS",n,o),r[o]=n}function rh(t){var e=t.stack,r=t.store,n=e.pop();exports.DEBUG&&console.log(t.step,"RS",n);var o=r&&r[n]||0;e.push(o)}function nh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function oh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function ma(t,e){var r=e.stack,n=r.pop(),o=e.z2[n];exports.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(o,zr,t,!1)*64)}function ya(t,e){var r=e.stack,n=r.pop(),o=r.pop(),s=e.z1[n],u=e.z0[o],c=e.dpv.distance(u,s,t,t);exports.DEBUG&&console.log(e.step,"MD["+t+"]",n,o,"->",c),e.stack.push(Math.round(c*64))}function sh(t){exports.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function ih(t){exports.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function ah(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function uh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function lh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function ch(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function fh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function hh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function ph(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function dh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function vh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"IF[]",e),e||(oa(t,!0),exports.DEBUG&&console.log(t.step,"EIF[]"))}function gh(t){exports.DEBUG&&console.log(t.step,"EIF[]")}function mh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function yh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function wh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function Vo(t,e){var r=e.stack,n=r.pop(),o=e.fv,s=e.pv,u=e.ppem,c=e.deltaBase+(t-1)*16,f=e.deltaShift,p=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var g=0;g<n;g++){var y=r.pop(),m=r.pop(),_=c+((m&240)>>4);if(_===u){var E=(m&15)-8;E>=0&&E++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",y,"by",E*f);var x=p[y];o.setRelative(x,x,E*f,s)}}}function bh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function _h(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function Sh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function Eh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function Th(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function xh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function kh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function Ph(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function Ch(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function Ah(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function Dn(t,e){var r=e.stack,n=r.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function Rh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function zo(t,e){var r=e.stack,n=r.pop(),o=e.ppem,s=e.deltaBase+(t-1)*16,u=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var c=0;c<n;c++){var f=r.pop(),p=r.pop(),g=s+((p&240)>>4);if(g===o){var y=(p&15)-8;y>=0&&y++;var m=y*u;exports.DEBUG&&console.log(e.step,"DELTACFIX",f,"by",m),e.cvt[f]+=m}}}function Mh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=na;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function Oh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=na;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function Dh(t){exports.DEBUG&&console.log(t.step,"ROFF[]"),t.round=df}function Bh(t){exports.DEBUG&&console.log(t.step,"RUTG[]"),t.round=mf}function Ih(t){exports.DEBUG&&console.log(t.step,"RDTG[]"),t.round=yf}function Fh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function wa(t,e){var r=e.stack,n=r.pop(),o=r.pop(),s=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,o);var c,f;t?(c=s.y-u.y,f=u.x-s.x):(c=u.x-s.x,f=u.y-s.y),e.dpv=Vr(c,f)}function Uh(t){var e=t.stack,r=e.pop(),n=0;exports.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function Lh(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop();exports.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(o)}function Gh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function Nh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function Hh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function Wh(t){var e=t.stack.pop(),r=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Lt(t,e){var r=e.stack,n=e.prog,o=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var s=0;s<t;s++)r.push(n[++o]);e.ip=o}function Gt(t,e){var r=e.ip,n=e.prog,o=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var s=0;s<t;s++){var u=n[++r]<<8|n[++r];u&32768&&(u=-((u^65535)+1)),o.push(u)}e.ip=r}function N(t,e,r,n,o,s){var u=s.stack,c=t&&u.pop(),f=u.pop(),p=s.rp0,g=s.z0[p],y=s.z1[f],m=s.minDis,_=s.fv,E=s.dpv,x,k,C,R;k=x=E.distance(y,g,!0,!0),C=k>=0?1:-1,k=Math.abs(k),t&&(R=s.cvt[c],n&&Math.abs(k-R)<s.cvCutIn&&(k=R)),r&&k<m&&(k=m),n&&(k=s.round(k)),_.setRelative(y,g,C*k,E),_.touch(y),exports.DEBUG&&console.log(s.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",t?c+"("+s.cvt[c]+","+R+")":"",f,"(d =",x,"->",C*k,")"),s.rp1=s.rp0,s.rp2=f,e&&(s.rp0=f)}Ji=[sa.bind(void 0,_t),sa.bind(void 0,dt),ia.bind(void 0,_t),ia.bind(void 0,dt),aa.bind(void 0,_t),aa.bind(void 0,dt),ua.bind(void 0,0),ua.bind(void 0,1),la.bind(void 0,0),la.bind(void 0,1),bf,_f,Sf,Ef,Tf,xf,kf,Pf,Cf,Af,Rf,Mf,Of,Df,Bf,If,Ff,Uf,Lf,Gf,void 0,void 0,Nf,Wo,Hf,Wf,Vf,Yf,Xf,void 0,void 0,void 0,zf,qf,$f,void 0,ca.bind(void 0,0),ca.bind(void 0,1),fa.bind(void 0,_t),fa.bind(void 0,dt),ha.bind(void 0,0),ha.bind(void 0,1),pa.bind(void 0,0),pa.bind(void 0,1),da.bind(void 0,0),da.bind(void 0,1),jf,Zf,va.bind(void 0,0),va.bind(void 0,1),Kf,Qf,ga.bind(void 0,0),ga.bind(void 0,1),Jf,eh,th,rh,nh,oh,ma.bind(void 0,0),ma.bind(void 0,1),void 0,ya.bind(void 0,0),ya.bind(void 0,1),sh,void 0,ih,void 0,void 0,ah,uh,lh,ch,fh,hh,ph,dh,vh,gh,mh,yh,wh,Vo.bind(void 0,1),bh,_h,Sh,Eh,Th,xh,kh,Ph,Ch,Ah,Dn.bind(void 0,0),Dn.bind(void 0,1),Dn.bind(void 0,2),Dn.bind(void 0,3),void 0,void 0,void 0,void 0,Rh,Vo.bind(void 0,2),Vo.bind(void 0,3),zo.bind(void 0,1),zo.bind(void 0,2),zo.bind(void 0,3),Mh,Oh,void 0,void 0,Dh,void 0,Bh,Ih,Wo,Wo,void 0,void 0,void 0,void 0,void 0,Fh,wa.bind(void 0,0),wa.bind(void 0,1),Uh,void 0,Lh,Gh,Nh,Hh,Wh,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Lt.bind(void 0,1),Lt.bind(void 0,2),Lt.bind(void 0,3),Lt.bind(void 0,4),Lt.bind(void 0,5),Lt.bind(void 0,6),Lt.bind(void 0,7),Lt.bind(void 0,8),Gt.bind(void 0,1),Gt.bind(void 0,2),Gt.bind(void 0,3),Gt.bind(void 0,4),Gt.bind(void 0,5),Gt.bind(void 0,6),Gt.bind(void 0,7),Gt.bind(void 0,8),N.bind(void 0,0,0,0,0,0),N.bind(void 0,0,0,0,0,1),N.bind(void 0,0,0,0,0,2),N.bind(void 0,0,0,0,0,3),N.bind(void 0,0,0,0,1,0),N.bind(void 0,0,0,0,1,1),N.bind(void 0,0,0,0,1,2),N.bind(void 0,0,0,0,1,3),N.bind(void 0,0,0,1,0,0),N.bind(void 0,0,0,1,0,1),N.bind(void 0,0,0,1,0,2),N.bind(void 0,0,0,1,0,3),N.bind(void 0,0,0,1,1,0),N.bind(void 0,0,0,1,1,1),N.bind(void 0,0,0,1,1,2),N.bind(void 0,0,0,1,1,3),N.bind(void 0,0,1,0,0,0),N.bind(void 0,0,1,0,0,1),N.bind(void 0,0,1,0,0,2),N.bind(void 0,0,1,0,0,3),N.bind(void 0,0,1,0,1,0),N.bind(void 0,0,1,0,1,1),N.bind(void 0,0,1,0,1,2),N.bind(void 0,0,1,0,1,3),N.bind(void 0,0,1,1,0,0),N.bind(void 0,0,1,1,0,1),N.bind(void 0,0,1,1,0,2),N.bind(void 0,0,1,1,0,3),N.bind(void 0,0,1,1,1,0),N.bind(void 0,0,1,1,1,1),N.bind(void 0,0,1,1,1,2),N.bind(void 0,0,1,1,1,3),N.bind(void 0,1,0,0,0,0),N.bind(void 0,1,0,0,0,1),N.bind(void 0,1,0,0,0,2),N.bind(void 0,1,0,0,0,3),N.bind(void 0,1,0,0,1,0),N.bind(void 0,1,0,0,1,1),N.bind(void 0,1,0,0,1,2),N.bind(void 0,1,0,0,1,3),N.bind(void 0,1,0,1,0,0),N.bind(void 0,1,0,1,0,1),N.bind(void 0,1,0,1,0,2),N.bind(void 0,1,0,1,0,3),N.bind(void 0,1,0,1,1,0),N.bind(void 0,1,0,1,1,1),N.bind(void 0,1,0,1,1,2),N.bind(void 0,1,0,1,1,3),N.bind(void 0,1,1,0,0,0),N.bind(void 0,1,1,0,0,1),N.bind(void 0,1,1,0,0,2),N.bind(void 0,1,1,0,0,3),N.bind(void 0,1,1,0,1,0),N.bind(void 0,1,1,0,1,1),N.bind(void 0,1,1,0,1,2),N.bind(void 0,1,1,0,1,3),N.bind(void 0,1,1,1,0,0),N.bind(void 0,1,1,1,0,1),N.bind(void 0,1,1,1,0,2),N.bind(void 0,1,1,1,0,3),N.bind(void 0,1,1,1,1,0),N.bind(void 0,1,1,1,1,1),N.bind(void 0,1,1,1,1,2),N.bind(void 0,1,1,1,1,3)];function vr(t){this.char=t,this.state={},this.activeState=null}function qo(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function Vh(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function at(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Bn(t){this.eventId=t,this.subscribers=[]}function zh(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(o){Object.defineProperty(e.events,o,{value:new Bn(o)})}),t&&r.forEach(function(o){var s=t[o];typeof s=="function"&&e.events[o].subscribe(s)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function _e(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],zh.call(this,t)}vr.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState},vr.prototype.getState=function(t){return this.state[t]||null},_e.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length},_e.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(s){return e[s[0]].apply(e,s.slice(1).concat(r))}),o=function(s){return typeof s=="object"&&s.hasOwnProperty("FAIL")};if(n.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(o)};this.dispatch("composeRUD",[n.filter(function(s){return!o(s)})])},_e.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var o=r.every(function(u){return u instanceof vr});if(!isNaN(t)&&this.inboundIndex(t)&&o){var s=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[s,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}},_e.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof vr){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}},_e.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n},_e.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}},_e.prototype.insertToken=function(t,e,r){var n=t.every(function(o){return o instanceof vr});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}},_e.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,o){var s=[n,o],u=e===null||e.apply(this,s)===!0,c=[n,o];if(u){var f=r.apply(this,c);n.setState(t,f)}}),this.registeredModifiers.push(t)},Bn.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},Bn.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)},at.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)},at.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}},_e.prototype.rangeToText=function(t){if(t instanceof qo)return this.getRangeTokens(t).map(function(e){return e.char}).join("")},_e.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")},_e.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null},_e.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null},_e.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof Bn&&n.subscribers.forEach(function(o){o.apply(r,e||[])})},_e.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new Vh(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n},_e.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))},_e.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}},_e.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}},_e.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new at(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},_e.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new qo(r,t,e),o=this.getContext(e).ranges;return n.rangeId=e+"."+o.length,o.push(n),this.getContext(e).openRange=null,n},_e.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var o=n.contextName,s=e.getContext(o).openRange;if(!s&&n.checkStart(t)&&(s=new qo(r,null,o),e.getContext(o).openRange=s,e.dispatch("contextStart",[o,r])),!!s&&n.checkEnd(t)){var u=r-s.startIndex+1,c=e.setEndOffset(u,o);e.dispatch("contextEnd",[o,c])}})},_e.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],o=new at(e,r);this.dispatch("next",[o]),this.runContextCheck(o);var s=new vr(n);this.tokens.push(s),this.dispatch("newToken",[s,o])}return this.dispatch("end",[this.tokens]),this.tokens};function Nt(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function ba(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function Ht(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function In(t){return/[A-z]/.test(t)}function qh(t){return/\s/.test(t)}function tt(t){this.font=t,this.features={}}function Zt(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function qr(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var o=r[n];if(t>=o.start&&t<=o.end){var s=t-o.start;return o.index+s}}break;default:return-1}return-1}function Yh(t,e){var r=qr(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function Xh(t,e){var r=qr(t,e.coverage);return r===-1?null:e.substitute[r]}function Yo(t,e){for(var r=[],n=0;n<t.length;n++){var o=t[n],s=e.current;s=Array.isArray(s)?s[0]:s;var u=qr(s,o);u!==-1&&r.push(u)}return r.length!==t.length?-1:r}function $h(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=Yo(e.inputCoverage,t);if(n===-1)return[];var o=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var s=t.lookahead.slice(o);s.length&&Ht(s[0].char);)s.shift();var u=new at(s,0),c=Yo(e.lookaheadCoverage,u),f=[].concat(t.backtrack);for(f.reverse();f.length&&Ht(f[0].char);)f.shift();if(f.length<e.backtrackCoverage.length)return[];var p=new at(f,0),g=Yo(e.backtrackCoverage,p),y=n.length===e.inputCoverage.length&&c.length===e.lookaheadCoverage.length&&g.length===e.backtrackCoverage.length,m=[];if(y)for(var _=0;_<e.lookupRecords.length;_++)for(var E=e.lookupRecords[_],x=E.lookupListIndex,k=this.getLookupByIndex(x),C=0;C<k.subtables.length;C++){var R=k.subtables[C],O=this.getLookupMethod(k,R),$=this.getSubstitutionType(k,R);if($==="12")for(var z=0;z<n.length;z++){var ae=t.get(z),te=O(ae);te&&m.push(te)}}return m}function jh(t,e){var r=t.current,n=qr(r,e.coverage);if(n===-1)return null;for(var o,s=e.ligatureSets[n],u=0;u<s.length;u++){o=s[u];for(var c=0;c<o.components.length;c++){var f=t.lookahead[c],p=o.components[c];if(f!==p)break;if(c===o.components.length-1)return o}}return null}function Zh(t,e){var r=qr(t,e.coverage);return r===-1?null:e.sequences[r]}tt.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]},tt.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var o=r[n];if(o.tag===t&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var s=o.langSysRecords;if(s)for(var u=0;u<s.length;u++){var c=s[u];if(c.tag===t){var f=c.langSys;return f.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()},tt.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var o=t[n].tag,s=t[n].feature;r[o]=s}this.features[e].tags=r},tt.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(o){return n.features[o]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e},tt.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n},tt.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(o){return Yh.apply(r,[o,e])};case"12":return function(o){return Xh.apply(r,[o,e])};case"63":return function(o){return $h.apply(r,[o,e])};case"41":return function(o){return jh.apply(r,[o,e])};case"21":return function(o){return Zh.apply(r,[o,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}},tt.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var o=this.getFeatureLookups(n),s=[].concat(e.context),u=0;u<o.length;u++)for(var c=o[u],f=this.getLookupSubtables(c),p=0;p<f.length;p++){var g=f[p],y=this.getSubstitutionType(c,g),m=this.getLookupMethod(c,g),_=void 0;switch(y){case"11":_=m(e.current),_&&s.splice(r,1,new Zt({id:11,tag:t.tag,substitution:_}));break;case"12":_=m(e.current),_&&s.splice(r,1,new Zt({id:12,tag:t.tag,substitution:_}));break;case"63":_=m(e),Array.isArray(_)&&_.length&&s.splice(r,1,new Zt({id:63,tag:t.tag,substitution:_}));break;case"41":_=m(e),_&&s.splice(r,1,new Zt({id:41,tag:t.tag,substitution:_}));break;case"21":_=m(e.current),_&&s.splice(r,1,new Zt({id:21,tag:t.tag,substitution:_}));break}e=new at(s,r),!(Array.isArray(_)&&!_.length)&&(_=null)}return s.length?s:null},tt.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r},tt.prototype.getLookupSubtables=function(t){return t.subtables||null},tt.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null},tt.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))},tt.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function Kh(t){var e=t.current,r=t.get(-1);return r===null&&Nt(e)||!Nt(r)&&Nt(e)}function Qh(t){var e=t.get(1);return e===null||!Nt(e)}var Jh={startCheck:Kh,endCheck:Qh};function ep(t){var e=t.current,r=t.get(-1);return(Nt(e)||Ht(e))&&!Nt(r)}function tp(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!Nt(e)&&!Ht(e)):var r=qh(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(o){return Nt(o)||Ht(o)}),!n)return!0}break;default:return!1}}var rp={startCheck:ep,endCheck:tp};function np(t,e,r){e[r].setState(t.tag,t.substitution)}function op(t,e,r){e[r].setState(t.tag,t.substitution)}function sp(t,e,r){t.substitution.forEach(function(n,o){var s=e[r+o];s.setState(t.tag,n)})}function ip(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var o=t.substitution.components.length,s=0;s<o;s++)n=e[r+s+1],n.setState("deleted",!0)}var _a={11:np,12:op,63:sp,41:ip};function Xo(t,e,r){t instanceof Zt&&_a[t.id]&&_a[t.id](t,e,r)}function ap(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],o=ba(n),s=Ht(n);if(!o&&!s)return!0;if(o)return!1}return!1}function up(t){if(ba(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=Ht(r);if(!n)return!0}return!1}function lp(t){var e=this,r="arab",n=this.featuresTags[r],o=this.tokenizer.getRangeTokens(t);if(o.length!==1){var s=new at(o.map(function(c){return c.getState("glyphIndex")}),0),u=new at(o.map(function(c){return c.char}),0);o.forEach(function(c,f){if(!Ht(c.char)){s.setCurrentIndex(f),u.setCurrentIndex(f);var p=0;ap(u)&&(p|=1),up(u)&&(p|=2);var g;switch(p){case 1:g="fina";break;case 2:g="init";break;case 3:g="medi";break}if(n.indexOf(g)!==-1){var y=e.query.lookupFeature({tag:g,script:r,contextParams:s});if(y instanceof Error)return console.info(y.message);y.forEach(function(m,_){m instanceof Zt&&(Xo(m,o,_),s.context[_]=m.substitution)})}}})}}function Sa(t,e){var r=t.map(function(n){return n.activeState.value});return new at(r,e||0)}function cp(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),o=Sa(n);o.context.forEach(function(s,u){o.setCurrentIndex(u);var c=e.query.lookupFeature({tag:"rlig",script:r,contextParams:o});c.length&&(c.forEach(function(f){return Xo(f,n,u)}),o=Sa(n))})}function fp(t){var e=t.current,r=t.get(-1);return r===null&&In(e)||!In(r)&&In(e)}function hp(t){var e=t.get(1);return e===null||!In(e)}var pp={startCheck:fp,endCheck:hp};function Ea(t,e){var r=t.map(function(n){return n.activeState.value});return new at(r,e||0)}function dp(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),o=Ea(n);o.context.forEach(function(s,u){o.setCurrentIndex(u);var c=e.query.lookupFeature({tag:"liga",script:r,contextParams:o});c.length&&(c.forEach(function(f){return Xo(f,n,u)}),o=Ea(n))})}function ut(t){this.baseDir=t||"ltr",this.tokenizer=new _e,this.featuresTags={}}ut.prototype.setText=function(t){this.text=t},ut.prototype.contextChecks={latinWordCheck:pp,arabicWordCheck:Jh,arabicSentenceCheck:rp};function $o(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function vp(){return $o.call(this,"latinWord"),$o.call(this,"arabicWord"),$o.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function gp(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}ut.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(o){return r.query.supports({script:t,tag:o})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n},ut.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new tt(t));for(var r=0;r<e.length;r++){var n=e[r];!this.query.supports({script:n.script})||this.registerFeatures(n.script,n.tags)}},ut.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function jo(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function mp(){var t=this,e="arab";if(!!this.featuresTags.hasOwnProperty(e)){jo.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){lp.call(t,n)})}}function yp(){var t=this,e="arab";if(!!this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){jo.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(o){cp.call(t,o)})}}}function wp(){var t=this,e="latn";if(!!this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){jo.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(o){dp.call(t,o)})}}}ut.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)},ut.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(mp.call(this),yp.call(this)),this.checkContextReady("latinWord")&&wp.call(this),this.checkContextReady("arabicSentence")&&gp.call(this)},ut.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),vp.call(this),this.applyFeaturesToContexts())},ut.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()},ut.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var o=n.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function he(t){t=t||{},t.tables=t.tables||{},t.empty||(Hr(t.familyName,"When creating a new Font object, familyName is required."),Hr(t.styleName,"When creating a new Font object, styleName is required."),Hr(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Hr(t.ascender,"When creating a new Font object, ascender is required."),Hr(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new pt.GlyphSet(this,t.glyphs||[]),this.encoding=new Ei(this),this.position=new Nr(this),this.substitution=new et(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new ta(this)}})}he.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null},he.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)},he.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},he.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})},he.prototype.stringToGlyphs=function(t,e){var r=this,n=new ut,o=function(y){return r.charToGlyphIndex(y.char)};n.registerModifier("glyphIndex",null,o);var s=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,s);for(var u=n.getTextGlyphs(t),c=u.length,f=new Array(c),p=this.glyphs.get(0),g=0;g<c;g+=1)f[g]=this.glyphs.get(u[g])||p;return f},he.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)},he.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},he.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""},he.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0},he.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},he.prototype.forEachGlyph=function(t,e,r,n,o,s){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,o=Object.assign({},this.defaultRenderOptions,o);var u=1/this.unitsPerEm*n,c=this.stringToGlyphs(t,o),f;if(o.kerning){var p=o.script||this.position.getDefaultScriptName();f=this.position.getKerningTables(p,o.language)}for(var g=0;g<c.length;g+=1){var y=c[g];if(s.call(this,y,e,r,n,o),y.advanceWidth&&(e+=y.advanceWidth*u),o.kerning&&g<c.length-1){var m=f?this.position.getKerningValue(f,y.index,c[g+1].index):this.getKerningValue(y,c[g+1]);e+=m*u}o.letterSpacing?e+=o.letterSpacing*n:o.tracking&&(e+=o.tracking/1e3*n)}return e},he.prototype.getPath=function(t,e,r,n,o){var s=new Re;return this.forEachGlyph(t,e,r,n,o,function(u,c,f,p){var g=u.getPath(c,f,p,o,this);s.extend(g)}),s},he.prototype.getPaths=function(t,e,r,n,o){var s=[];return this.forEachGlyph(t,e,r,n,o,function(u,c,f,p){var g=u.getPath(c,f,p,o,this);s.push(g)}),s},he.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})},he.prototype.draw=function(t,e,r,n,o,s){this.getPath(e,r,n,o,s).draw(t)},he.prototype.drawPoints=function(t,e,r,n,o,s){this.forEachGlyph(e,r,n,o,s,function(u,c,f,p){u.drawPoints(t,c,f,p)})},he.prototype.drawMetrics=function(t,e,r,n,o,s){this.forEachGlyph(e,r,n,o,s,function(u,c,f,p){u.drawMetrics(t,c,f,p)})},he.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en},he.prototype.validate=function(){var t=this;function e(n,o){}function r(n){var o=t.getEnglishName(n);o&&o.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0},he.prototype.toTables=function(){return of.fontToTable(this)},he.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},he.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),o=0;o<e.length;o++)n[o]=e[o];return r},he.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(af())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(n),s=new Blob([o],{type:"font/opentype"}),u=document.createElement("a");u.href=window.URL.createObjectURL(s),u.download=t;var c=document.createEvent("MouseEvents");c.initEvent("click",!0,!1),u.dispatchEvent(c)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var f=require("fs"),p=uf(n);f.writeFileSync(t,p)}},he.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},he.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},he.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var Et=new Array(10);Et[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(P.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(P.coverage),values:this.parseValueRecordList()};X.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},Et[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();X.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(P.coverage),o=this.parseUShort(),s=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:s,pairSets:this.parseList(P.pointer(P.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(s)}})))};if(r===2){var u=this.parsePointer(P.classDef),c=this.parsePointer(P.classDef),f=this.parseUShort(),p=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:s,classDef1:u,classDef2:c,class1Count:f,class2Count:p,classRecords:this.parseList(f,P.list(p,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(s)}}))}}},Et[3]=function(){return{error:"GPOS Lookup 3 not supported"}},Et[4]=function(){return{error:"GPOS Lookup 4 not supported"}},Et[5]=function(){return{error:"GPOS Lookup 5 not supported"}},Et[6]=function(){return{error:"GPOS Lookup 6 not supported"}},Et[7]=function(){return{error:"GPOS Lookup 7 not supported"}},Et[8]=function(){return{error:"GPOS Lookup 8 not supported"}},Et[9]=function(){return{error:"GPOS Lookup 9 not supported"}},new Array(10);const bp=()=>Date.now().toString(36)+Math.random().toString(36).substring(2);async function _p(t){const e=U(),[r,n]=be(),o=bp(),s=new Uint8Array(await t.arrayBuffer());e.FS.writeFile(`/${o}`,s);const u=r(new e.STEPControl_Reader_1);if(u.ReadFile(o)){e.FS.unlink("/"+o),u.TransferRoots(r(new e.Message_ProgressRange_1));const c=r(u.OneShape()),f=ue(c);return n(),f}else throw e.FS.unlink("/"+o),n(),new Error("Failed to load STEP file")}const Sp={XY:{dir:[0,0,1],xAxis:[1,0,0]},XZ:{dir:[0,-1,0],xAxis:[1,0,0]},YZ:{dir:[1,0,0],xAxis:[0,1,0]},YX:{dir:[0,0,-1],xAxis:[0,1,0]},ZX:{dir:[0,1,0],xAxis:[0,0,1]},ZY:{dir:[-1,0,0],xAxis:[0,0,1]},front:{dir:[0,-1,0],xAxis:[1,0,0]},back:{dir:[0,1,0],xAxis:[-1,0,0]},right:{dir:[-1,0,0],xAxis:[0,-1,0]},left:{dir:[1,0,0],xAxis:[0,1,0]},bottom:{dir:[0,0,1],xAxis:[1,0,0]},top:{dir:[0,0,-1],xAxis:[1,0,0]}};function Ep(t){const{dir:e,xAxis:r}=Sp[t];return new Zo([0,0,0],e,r)}function Ta(t){const e=new q(t);let r=new q([0,0,1]),n=r.cross(e);return n.Length===0&&(r=new q([0,1,0]),n=r.cross(e)),n.normalize()}class Zo extends ft{constructor(e=[0,0,0],r=[0,0,1],n){const o=n?new q(n):Ta(r),s=rn(e,r,o);super(s)}get position(){return new q(this.wrapped.Location())}get direction(){return new q(this.wrapped.Direction())}get xAxis(){return new q(this.wrapped.XDirection())}get yAxis(){return new q(this.wrapped.YDirection())}autoAxes(){const e=Ta(this.direction);this.wrapped.SetXDirection(mt(e))}setPosition(e){return this.wrapped.SetLocation(je(e)),this}setXAxis(e){return this.wrapped.SetYDirection(mt(e)),this}setYAxis(e){return this.wrapped.SetYDirection(mt(e)),this}lookAt(e){const r=new q("boundingBox"in e?e.boundingBox.center:e),n=this.position.sub(r).normalized();return this.wrapped.SetDirection(n.toDir()),this.autoAxes(),this}}const gr=t=>t.IsNull()?[]:ue(t).edges;function Tp(t,e,r=!0){const n=U(),o=ve(),s=o(new n.HLRBRep_Algo_1);s.Add_2(t.wrapped,0);const u=o(new n.HLRAlgo_Projector_2(e.wrapped));s.Projector_1(u),s.Update(),s.Hide_1();const c=new n.HLRBRep_HLRToShape(new n.Handle_HLRBRep_Algo_2(s)),f=[...gr(c.VCompound_1()),...gr(c.Rg1LineVCompound_1()),...gr(c.OutLineVCompound_1())];f.forEach(g=>n.BRepLib.BuildCurves3d_2(g.wrapped));const p=r?[...gr(c.HCompound_1()),...gr(c.Rg1LineHCompound_1()),...gr(c.OutLineHCompound_1())]:[];return p.forEach(g=>n.BRepLib.BuildCurves3d_2(g.wrapped)),{visible:f,hidden:p}}const Kt=1e-8,mr=(t,e)=>He(t,e,Kt*10);function xp(t,e){const r=t.orientation==="clockwise"?-e:e,n=t.curves.map(p=>({offset:lo(p,r),original:p})),o=[];let s=null,u=n.at(-1);if(!u)return[];if(o.length===1)return o;const c=p=>{s?p.offset instanceof ge?o.push(p.offset):mr(p.offset.firstPoint,p.offset.lastPoint)||o.push(xr(p.offset.firstPoint,p.offset.lastPoint)):s=p},f=function*(){for(const p of n.slice(0,-1))yield p;if(!s)throw new Error("Bug in the offset algorithm");yield s};for(const p of f()){const g=u.offset.lastPoint,y=p.offset.firstPoint;if(mr(g,y)){c(u),u=p;continue}let m=[];if(u.offset instanceof ge&&p.offset instanceof ge){const{intersections:E,commonSegmentsPoints:x}=Tr(u.offset,p.offset,Kt/100);m=[...E,...x]}if(m.length>0){let E=m[0];if(m.length>1){const C=u?.original.lastPoint,R=m.map(O=>ku(O,C));E=m[R.indexOf(Math.min(...R))]}const x=u.offset.splitAt([E],Kt)[0],k=p.offset.splitAt([E],Kt).at(-1);if(!k)throw new Error("Bug in the splitting algo in offset");c({offset:x,original:u.original}),u={offset:k,original:p.original};continue}const _=As(g,y,u.original.lastPoint);c(u),o.push(_),u=p}return c(u),o}function kp(t,e){const r=xp(t,e);if(r.length<2)return null;const n=new Map,o=(p,g)=>{const y=n.get(p)||[];n.set(p,[...y,...g])};if(r.forEach((p,g)=>{r.slice(g+1).forEach((y,m)=>{const{intersections:_,commonSegmentsPoints:E}=Tr(p,y,Kt),x=[..._,...E].filter(k=>{const C=mr(k,p.firstPoint)||mr(k,p.lastPoint),R=mr(k,y.firstPoint)||mr(k,y.lastPoint);return!(C&&R)});!x.length||(o(g,x),o(m+g+1,x))})}),!n.size){const p=new Q(r);return t.intersects(p)?null:p}const u=r.flatMap((p,g)=>{if(!n.has(g))return p;const y=n.get(g)||[];return p.splitAt(y,Kt*100)}).filter(p=>!t.curves.find(y=>y.distanceFrom(p)<Math.abs(e)-Kt));if(!u.length)return null;const f=Bs(u).filter(p=>p.length>1).map(p=>new Q(p)).filter(p=>p.isClosed());return f.length?f.length===1?f[0]:new j(f):null}const xa=t=>{let e=t[0];for(let r=1;r<t.length;r++)e=bt(e,t[r]);return e};function Fn(t,e){if(t instanceof Q)return kp(t,e);if(t instanceof j)return xa(t.blueprints.map(r=>Fn(r,e)));if(t instanceof le){const r=xa(t.blueprints.slice(1).map(n=>Fn(n,e)));return Bt(Fn(t.blueprints[0],e),r)}return null}function ka(t,e,r,n){let o=()=>!0;n&&(o=n.shouldKeep.bind(n));const s=[e.curves[0]],u=(f,p)=>{o({firstCurve:f,secondCurve:p,point:f.lastPoint})?s.push(...t(f,p,r)):s.push(f,p)};e.curves.slice(1).forEach(f=>{const p=s.pop();if(!p)throw new Error("Bug in the blueprint filletting algo");u(p,f)});const c=s.at(-1);if(!c)throw new Error("Bug in the blueprint corner algo");if(He(s[0].firstPoint,c.lastPoint)&&s.length>1){const f=s.pop(),p=s.shift();if(!f||!p)throw new Error("Bug in the blueprint filletting algo");u(f,p)}return new Q(s)}function Ko(t,e,r,n){if(e instanceof Q)return ka(t,e,r,n);if(e instanceof le)return new le(e.blueprints.map(o=>ka(t,o,r,n)));if(e instanceof j){const o=e.blueprints.map(s=>Ko(t,s,r,n)).filter(s=>s!==null);return new j(o)}return null}function Pp(t,e,r){return Ko(co,t,e,r)}function Cp(t,e,r){return Ko(fo,t,e,r)}class Se{constructor(e=null){this.innerShape=e}clone(){var e;return new Se(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new Er}stretch(e,r,n){return this.innerShape?new Se(this.innerShape.stretch(e,r,n)):new Se}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,r){return this.innerShape?new Se(this.innerShape.rotate(e,r)):new Se}translate(e,r=0){return this.innerShape?new Se(this.innerShape.translate(e,r)):new Se}scale(e,r){return this.innerShape?new Se(this.innerShape.scale(e,r)):new Se}mirror(e,r,n){return this.innerShape?new Se(this.innerShape.mirror(e,r,n)):new Se}cut(e){return new Se(Bt(this.innerShape,e.innerShape))}fuse(e){return new Se(bt(this.innerShape,e.innerShape))}intersect(e){return new Se(Ir(this.innerShape,e.innerShape))}fillet(e,r){const n=r&&r(new cn);return new Se(Pp(this.innerShape,e,n))}chamfer(e,r){const n=r&&r(new cn);return new Se(Cp(this.innerShape,e,n))}sketchOnPlane(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,r)}sketchOnFace(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,r)}toSVG(e){var r;return((r=this.innerShape)==null?void 0:r.toSVG(e))||""}toSVGViewBox(e=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new Se(Fn(this.innerShape,e))}get blueprint(){if(!(this.innerShape instanceof Q)){if(this.innerShape instanceof j&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof Q)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}function Ap(t,e,r=0){return new Se(vl(t,e,r))}const Rp=Ap,Pa=t=>{const e=Rp(1e3,1e3).sketchOnPlane().face(),r=t.map(o=>al(o,e)),n=Bs(r).map(o=>new Q(o));return n.length===0?new Se:n.length===1?new Se(n[0]):new Se(new j(n))};function Mp(t,e="front"){let r;e instanceof Zo?r=e:r=Ep(e);const{visible:n,hidden:o}=Tp(t,r);return{visible:Pa(n),hidden:Pa(o)}}function Le(t){return{type:"Ok",value:t}}function Ze(t){return{type:"Err",message:t}}const Ve=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function vt(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Ve[t&255]+Ve[t>>8&255]+Ve[t>>16&255]+Ve[t>>24&255]+"-"+Ve[e&255]+Ve[e>>8&255]+"-"+Ve[e>>16&15|64]+Ve[e>>24&255]+"-"+Ve[r&63|128]+Ve[r>>8&255]+"-"+Ve[r>>16&255]+Ve[r>>24&255]+Ve[n&255]+Ve[n>>8&255]+Ve[n>>16&255]+Ve[n>>24&255]).toLowerCase()}function Op(t){let[e,r]=be();try{let n=U(),o=[e(new n.gp_Pnt_3(0,0,t.leg1Length)),e(new n.gp_Pnt_3(0,0,0)),e(new n.gp_Pnt_3(t.leg2Length,0,0)),e(new n.gp_Pnt_3(t.leg2Length,0,t.thickness)),e(new n.gp_Pnt_3(t.thickness,0,t.thickness)),e(new n.gp_Pnt_3(t.thickness,0,t.leg1Length))],s=o.map(_=>{let E=new n.BRepBuilderAPI_MakeVertex(_);E.Build(e(new n.Message_ProgressRange_1));let x=e(n.TopoDS.Vertex_1(E.Vertex()));return E.delete(),x}),u=[];for(let _=0;_<s.length;++_){let E=(_+1)%s.length,x=new n.BRepBuilderAPI_MakeEdge_2(s[_],s[E]);x.Build(e(new n.Message_ProgressRange_1));let k=e(n.TopoDS.Edge_1(x.Edge()));x.delete(),u.push(k)}let c;{let _=new n.BRepBuilderAPI_MakeWire_1;for(let E of u)_.Add_1(E);_.Build(e(new n.Message_ProgressRange_1)),c=e(n.TopoDS.Wire_1(_.Wire())),_.delete()}let f;{let _=new n.BRepBuilderAPI_MakeFace_15(c,!0);_.Build(e(new n.Message_ProgressRange_1)),f=e(n.TopoDS.Face_1(_.Face())),_.delete()}let p;{let _=new n.BRepPrimAPI_MakePrism_1(f,e(new n.gp_Vec_4(0,t.length,0)),!1,!0);_.Build(e(new n.Message_ProgressRange_1)),p=n.TopoDS.Solid_1(_.Shape()),_.delete()}let g,y;{let _=new n.TopExp_Explorer_2(p,n.TopAbs_ShapeEnum.TopAbs_EDGE,n.TopAbs_ShapeEnum.TopAbs_SHAPE);for(;_.More()&&(g==null||y==null);){let E=n.TopoDS.Edge_1(_.Value()),x=new n.TopExp_Explorer_2(E,n.TopAbs_ShapeEnum.TopAbs_VERTEX,n.TopAbs_ShapeEnum.TopAbs_SHAPE),k,C;if(x.More()&&(k=n.TopoDS.Vertex_1(x.Value()),x.Next()),x.More()&&(C=n.TopoDS.Vertex_1(x.Value()),x.Next()),k!=null&&C!=null){let R=n.BRep_Tool.Pnt(k),O=n.BRep_Tool.Pnt(C);(R.IsEqual(o[4],.001)&&O.Y()>.5*t.length||O.IsEqual(o[4],.001)&&R.Y()>.5*t.length)&&(g=n.TopoDS.Edge_1(E)),(R.IsEqual(o[1],.001)&&O.Y()>.5*t.length||O.IsEqual(o[1],.001)&&R.Y()>.5*t.length)&&(y=n.TopoDS.Edge_1(E)),R.delete(),O.delete()}k?.delete(),C?.delete(),E.delete(),x.delete(),_.Next()}_.delete()}if(g!=null&&y!=null){let _=new n.BRepFilletAPI_MakeFillet(p,n.ChFi3d_FilletShape.ChFi3d_Rational);_.Add_2(t.thickness,g),_.Add_2(t.thickness+t.thickness,y),_.Build(e(new n.Message_ProgressRange_1));let E=_.Shape();E.ShapeType()==n.TopAbs_ShapeEnum.TopAbs_COMPOUND?(p.delete(),p=n.TopoDS.Compound_1(E)):E.ShapeType()==n.TopAbs_ShapeEnum.TopAbs_SHAPE&&(p.delete(),p=n.TopoDS.Solid_1(E)),_.delete(),g.delete(),y.delete()}let m;{let _=new n.BRepPrimAPI_MakeCylinder_1(.5*t.holeDiameter,2*t.thickness);_.Build(e(new n.Message_ProgressRange_1)),m=e(n.TopoDS.Solid_1(_.Shape())),_.delete()}{let _=(t.leg1Length-t.thickness)/t.leg1NumHoles,E=t.thickness+.5*_;for(let x=0;x<t.leg1NumHoles;++x){let k;{let C=e(new n.gp_Trsf_1);C.SetRotation_1(e(new n.gp_Ax1_2(e(new n.gp_Pnt_3(0,0,0)),e(new n.gp_Dir_4(0,1,0)))),90*Math.PI/180);let R=e(new n.gp_Trsf_1);R.SetTranslation_1(e(new n.gp_Vec_4(-t.thickness,.5*t.length,E+x*_))),R.Multiply(C);let O=new n.BRepBuilderAPI_Transform_2(m,R,!1);k=e(n.TopoDS.Solid_1(O.Shape())),O.delete()}{let C=new n.BRepAlgoAPI_Cut_3(p,k,e(new n.Message_ProgressRange_1)),R=C.Shape();R.ShapeType()==n.TopAbs_ShapeEnum.TopAbs_COMPOUND?(p.delete(),p=n.TopoDS.Compound_1(R)):R.ShapeType()==n.TopAbs_ShapeEnum.TopAbs_SHAPE&&(p.delete(),p=n.TopoDS.Solid_1(R)),C.delete()}}}{let _=(t.leg2Length-t.thickness)/t.leg2NumHoles,E=t.thickness+.5*_;for(let x=0;x<t.leg2NumHoles;++x){let k;{let C=e(new n.gp_Trsf_1);C.SetTranslation_1(e(new n.gp_Vec_4(E+x*_,.5*t.length,-t.thickness)));let R=new n.BRepBuilderAPI_Transform_2(m,C,!1);k=e(n.TopoDS.Solid_1(R.Shape())),R.delete()}{let C=new n.BRepAlgoAPI_Cut_3(p,k,e(new n.Message_ProgressRange_1)),R=C.Shape();R.ShapeType()==n.TopAbs_ShapeEnum.TopAbs_COMPOUND?(p.delete(),p=n.TopoDS.Compound_1(R)):R.ShapeType()==n.TopAbs_ShapeEnum.TopAbs_SHAPE&&(p.delete(),p=n.TopoDS.Solid_1(R)),C.delete()}}}return Le(p)}finally{r()}}let Ca,Aa=!1;const Dp=async()=>{if(Aa)return Promise.resolve(!0);const t=await hu({locateFile:()=>Ca});return Aa=!0,pu(t),!0};let Ee=new Map;self.addEventListener("message",async t=>{let e=JSON.parse(JSON.stringify(t.data));switch(e.type){case"setupOpenCascade":{Ca=e.params.opencascadeWasm,await Dp(),self.postMessage({requestId:e.requestId,result:Le({})});break}case"loadStepModelFromBase64String":{let r=e.params.base64Data,n=Bp(r,"application/step"),o=await _p(n),s=vt();Ee.set(s,o),self.postMessage({requestId:e.requestId,result:Le(s)});break}case"saveStepModelToBase64String":{let r=Ee.get(e.params.shapeId);if(r==null)self.postMessage({requestId:e.requestId,result:Ze("Shape not found")});else{let n=r.blobSTEP(),o=await Ip(n);self.postMessage({requestId:e.requestId,result:Le(o)})}break}case"cloneShape":{let r=Ee.get(e.params.shapeId);if(r==null)self.postMessage({requestId:e.requestId,result:Ze("Shape not found")});else{let n=r.clone(),o=vt();Ee.set(o,n),self.postMessage({requestId:e.requestId,result:Le(o)})}break}case"makeFace":{let r=U(),n=[];for(let g of e.params.vertices){let y=new r.gp_Pnt_3(g[0],g[1],g[2]),m=new r.BRepBuilderAPI_MakeVertex(y);m.Build(new r.Message_ProgressRange_1);let _=m.Vertex();m.delete(),n.push(_)}let o=[];for(let g=0;g<n.length;++g){let y=(g+1)%n.length,m=new r.BRepBuilderAPI_MakeEdge_2(n[g],n[y]);m.Build(new r.Message_ProgressRange_1);let _=m.Edge();m.delete(),o.push(_)}let s=new r.BRepBuilderAPI_MakeWire_1;for(let g of o)s.Add_1(g);s.Build(new r.Message_ProgressRange_1);let u=s.Wire();s.delete();let c=new r.BRepBuilderAPI_MakeFace_15(u,!0);c.Build(new r.Message_ProgressRange_1);let f=ue(c.Face());c.delete();let p=vt();Ee.set(p,f),self.postMessage({requestId:e.requestId,result:Le(p)});break}case"makeCylinder":{let r=$u(e.params.radius,e.params.height),n=vt();Ee.set(n,r),self.postMessage({requestId:e.requestId,result:Le(n)});break}case"shapeFromMesh":{self.postMessage({requestId:e.requestId,result:Fp(e.params)});break}case"shapeToMesh":{let r=Ee.get(e.params.shapeId);if(r==null)self.postMessage({requestId:e.requestId,result:Ze("Shape not found")});else{let n=.001,o=r.mesh({tolerance:.1,angularTolerance:5});for(let s=0;s<o.vertices.length;++s)o.vertices[s]*=n;self.postMessage({requestId:e.requestId,result:Le(o)})}break}case"shapeToEdges":{let r=Ee.get(e.params.shapeId);if(r==null)self.postMessage({requestId:e.requestId,result:Ze("Shape not found")});else{let n=.001,o=r.meshEdges({tolerance:.1,angularTolerance:5});for(let s=0;s<o.lines.length;++s)o.lines[s]*=n;self.postMessage({requestId:e.requestId,result:Le(o)})}break}case"fuseShapesWithTransforms":{let r=[];for(let{shapeId:u,transform:c}of e.params.shapeIdTransformList){let f=Ee.get(u);if(f==null){self.postMessage({requestId:e.requestId,result:Ze("Shape not found")});for(f of r)f.delete();return}let p=f.clone(),g=2*Math.acos(c.q[0])*180/Math.PI,y=[c.q[1],c.q[2],c.q[3]],m=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]);y[0]/=m,y[1]/=m,y[2]/=m,Number.isFinite(y[0])&&(p=p.rotate(g,[0,0,0],y)),p=p.translate(c.o[0],c.o[1],c.o[2]),r.push(p)}if(r.length==null){self.postMessage({requestId:e.requestId,result:Ze("No shapes to fuse")});return}let n,o=u=>{n==null?n=u:n=n.fuse(u)};for(let u of r)o(u);let s=vt();Ee.set(s,n??r[0]),self.postMessage({requestId:e.requestId,result:Le(s)});break}case"cut":{let r=Ee.get(e.params.shape1Id),n=Ee.get(e.params.shape2Id);if(r==null||n==null)self.postMessage({requestId:e.requestId,result:Ze("Shape not found")});else{r=Ra(r.clone(),e.params.transform1),n=Ra(n.clone(),e.params.transform2);let o=r.cut(n),s=vt();Ee.set(s,o),self.postMessage({requestId:e.requestId,result:Le(s)})}break}case"projectShape":{let r=Ee.get(e.params.shapeId);if(r==null)self.postMessage({requestId:e.requestId,result:Ze("Shape not found")});else{let n=new Zo(e.params.camera.position,e.params.camera.direction,e.params.camera.xAxis),o=Mp(r.clone(),n).visible;self.postMessage({requestId:e.requestId,result:Le(o.toSVGPaths())})}break}case"deleteShape":{let r=Ee.get(e.params.shapeId);r!=null&&(r.delete(),Ee.delete(e.params.shapeId)),self.postMessage({requestId:e.requestId,result:Le({})});break}case"filletEdge":{let r=Ee.get(e.params.shapeId);if(r==null)self.postMessage({requestId:e.requestId,result:Ze("Shape not found")});else{let n=r.edges.find(o=>o.hashCode.toString()==e.params.edgeId);if(n==null)self.postMessage({requestId:e.requestId,result:Ze("Edge not found")});else{let o=U(),s=new o.BRepFilletAPI_MakeFillet(r.wrapped,o.ChFi3d_FilletShape.ChFi3d_Rational);s.Add_2(e.params.radius,n.wrapped),s.Build(new o.Message_ProgressRange_1);let u=s.Shape();s.delete();let c=vt();Ee.set(c,ue(u)),self.postMessage({requestId:e.requestId,result:Le(c)})}}break}case"extrudeFace":{let r=Ee.get(e.params.shapeId);if(r==null)self.postMessage({requestId:e.requestId,result:Ze("Shape not found")});else{let n=r.faces.find(o=>o.hashCode.toString()==e.params.faceId);if(n==null)self.postMessage({requestId:e.requestId,result:Ze("Face not found")});else{let o=U(),s=new o.gp_Vec_4(e.params.direction[0],e.params.direction[1],e.params.direction[2]),u=new o.BRepPrimAPI_MakePrism_1(n.wrapped,s,!0,!0);u.Build(new o.Message_ProgressRange_1);let c=u.Shape();s.delete(),u.delete();let f=ue(c),p=vt();Ee.set(p,f),self.postMessage({requestId:e.requestId,result:Le(p)})}}break}case"generateAngleBracketShape":{let r=Op(e.params);if(r.type=="Err")self.postMessage({requestId:e.requestId,result:Ze(r.message)});else{let n=ue(r.value),o=vt();Ee.set(o,n),self.postMessage({requestId:e.requestId,result:Le(o)})}break}}});const Bp=(t,e,r=512)=>{const n=self.atob(t),o=[];for(let u=0;u<n.length;u+=r){const c=n.slice(u,u+r),f=new Array(c.length);for(let g=0;g<c.length;g++)f[g]=c.charCodeAt(g);const p=new Uint8Array(f);o.push(p)}return new Blob(o,{type:e})},Ip=async t=>new Promise((e,r)=>{const n=new FileReader;n.onload=()=>{let o=n.result;e(o.substring(o.indexOf("base64,")+7))},n.onerror=o=>r(o),n.readAsDataURL(t)});function Ra(t,e){let r=t.clone(),n=2*Math.acos(e.q[0])*180/Math.PI,o=[e.q[1],e.q[2],e.q[3]],s=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]);return o[0]/=s,o[1]/=s,o[2]/=s,Number.isFinite(o[0])&&(r=r.rotate(n,[0,0,0],o)),r=r.translate(e.o[0],e.o[1],e.o[2]),r}function Fp(t){let e=U(),r=new e.BRepBuilderAPI_Sewing(.001,!0,!0,!1,!1),n=[];for(let s of t.vertices){let u=new e.gp_Pnt_3(s[0],s[1],s[2]),c=new e.BRepBuilderAPI_MakeVertex(u);c.Build(new e.Message_ProgressRange_1),n.push(c.Vertex()),c.delete()}for(let s of t.faces){let u=[];for(let y=0;y<s.length;++y){let m=(y+1)%s.length,_=new e.BRepBuilderAPI_MakeEdge_2(n[s[y]],n[s[m]]);_.Build(new e.Message_ProgressRange_1),u.push(_.Edge()),_.delete()}let c=new e.BRepBuilderAPI_MakeWire_1;for(let y of u)c.Add_1(y);c.Build(new e.Message_ProgressRange_1);let f=c.Wire();c.delete();let p=new e.BRepBuilderAPI_MakeFace_15(f,!0);p.Build(new e.Message_ProgressRange_1);let g=p.Face();p.delete(),r.Add(g)}r.Perform(new e.Message_ProgressRange_1);let o=ue(r.SewedShape());if(o instanceof wo){let s=new e.BRepBuilderAPI_MakeSolid_1;s.Add(o.wrapped),s.Build(new e.Message_ProgressRange_1);let u=s.Solid();s.delete(),o.delete();let c=ue(u),f=vt();return Ee.set(f,c),Le(f)}else return Ze("Not a shell")}})();
